 
Comparison of Three Impedance Analysers Implemented on FPGA Circuits 
 
Abdulrahman Hamed, Etienne Tisserand, Patrick Schweitzer, Yves Berviller  
Laboratoire d’Instrumentation Electronique de Nancy (LIEN) 
Faculty of Sciences, University Henri Poincaré of Nancy 
Vandœuvre les Nancy, France 
e-mail address : etienne.tisserand@lien.uhp-nancy.fr 
 
 
Abstract— In this paper, we present three different methods we 
have developed for the design of an electrical impedance 
analyser implemented on an FPGA board. We describe in the 
first part the general principle of the methods : Ratiometric 
Measurement, Feedback Voltage Control and Adaptive 
Parametric Modelisation. In order to test and to compare the 
performances of each approach, the Hardware In the Loop 
strategy has been used. We present the steps from the mixed 
simulation using Matlab DSP Builder, which leads to the 
FPGA implementation. We investigate the limits and 
advantages for each method. The impedance analysis results of 
a model of an audio piezo transducer (7 kHz) are presented. 
The amplitude accuracy is less than 3 % and the analysis 
duration from 5 kHz to 10 kHz is about 54.5 ms for the first 
two methods. 
Keywords - electrical impedance spectroscopy; piezoelectric 
transducer; FPGA; DDS; Hardware In the Loop. 
I. 
INTRODUCTION 
The electrical impedance spectroscopy (EIS) applied to 
piezoelectric sensors and systems is very often used. It is 
commonly applied in non-destructive testing (NDT) [1][2]; 
to 
perform 
physical 
measurements 
[3]; 
biological 
measurements [4] or for the diagnosis of transducers [5]. In 
practice, the EIS requires heavy, bulky and expensive 
analyzer, (i.e., Hioki model IM 3570 : 5 MHz, 6 kg, 10 k$, 
Agilent model 4294A : 110 MHz, 25 kg, 40 k$) . To avoid 
these 
disadvantages, 
several 
research 
teams 
have 
investigated from 2004 on the design of implementable EIS 
on a light and low cost embedded system. 
Various methods have been proposed. Petersen [6] 
designed a digital low power EIS device with an accuracy of 
0.001%. The system includes an electrical bridge with two 
arms and a digital synchronous demodulator. One of the 
arms corresponds to the unknown impedance. The bridge is 
balanced by a least mean squares (LMS) algorithm. This 
method is not suitable when the impedance changes fastly 
and it is not implementable in a portable device. 
Lewis et al. [7] have developed a cheap system for 
impedance spectroscopy with a frequency band between 700 
kHz and 20 MHz. The excitation of the piezoelectric 
transducer is carried out with a pulse generator. The 
electrical impedance is then determined by a fast Fourier 
transform performed offline using the Matlab program. 
Yang et al. [8] have designed a portable device whose 
principle is inspired by the traditional ratiometric method. 
For good accuracy, the device requires three successive 
algorithms of calibration. 
Finally, Hamed et al. [9] have proposed and implemented 
on an FPGA target an impedance measurement method that 
does not require current measuring in the tested dipole. This 
method is based on feedback control of the excitation 
voltage. 
In this paper, we present the implementation of three 
different EIS methods on an FPGA board. These methods 
are then applied to the analysis of the complex impedance Z 
of the same dipole. 
In the first part, we present the principle and the 
equations of each method.  
The second part is devoted to the digital architectures. 
The diagrams are described by the Altera-DSPBuilder tool. 
This allows the design and the implementation directly on 
the FPGA target from Matlab-Simulink.  
In the last part, the impedance measurements of a 
Butterworth van Dycke dipole which simulate an audio piezo 
transducer, are analyzed and compared. 
II. 
THE EIS TESTED METHODS 
A. Ratiometric measurement (RM) 
The principle of this methode is shown in Fig. 1 
 
 
R 
- 
+ 
A 
VG 
RG 
Z 
VI 
I
G
G V
V
R
Z
−
=
X 
Complex 
computing 
 
 
Figure 1.  Ratiometric measurement of impedance 
In this scheme, Z = R + jX is the unknown impedance, RG is 
the reference resistor connected in series with Z. 
29
CENICS 2011 : The Fourth International Conference on Advances in Circuits, Electronics and Micro-electronics
Copyright (c) IARIA, 2011.     ISBN: 978-1-61208-150-2

 
The output voltage of the operational amplifier is 
 
G
G
I
Z V
R
V
= −
 
(1) 
This determines the impedance Z by 
 
ϕ
= −
= −
j
I
G
G
I
G
G
e
V
V
R
V
V
R
Z
 
(2) 
where ϕ corresponds to the phase shift between the 
signals VG and VI 
The computing block has two complex amplitude and 
phase detectors performed by quadrature demodulation 
B.  Feedback Voltage Control (FVC) method 
In this system (Figure 2), a sinusoidal voltage generator 
VG with an output resistance RG is used to excite the tested 
dipole. The generator sweeps the desired frequency band. 
The voltage VD applied to the dipole is regulated at a 
constant amplitude whatever the frequency is. For this 
reason, the variable resistor RG is controlled in real time by a 
proportional-integral controller. The value of RG and the 
phase φ between VG and VD are used to determine the 
complex value of Z. 
 
 
VD 
PI Controller 
½ 
+ 
- 
f 
Amplitude 
detector 
Z 
Phase 
detector 
R & X 
Computing 
RG 
VG 
cos(ϕ) 
sin(ϕ) 
RG 
Amplitude 
detector 
 
 
Figure 2.  FVC method developed by Hamed and al. 
The phase ϕ between VD and VG is determined by 
synchronous detection. 
Real and imaginary parts of Z are determinated from ϕ 
and RG at each frequency by  
 
G
G
cos( ) R
.1 25
sin( )
5.0
X
R
cos( )
.1 25
.0 25
cos( )
5.0
R
ϕ
−
ϕ
=
ϕ
−
ϕ −
=
 
(3) 
C. Adaptive Parametric Modelisation (APM) 
1) Principle 
This model based method is represented in Figure 3. The 
dipole is considered as a system whose input is the voltage V 
and output is the current I. The transfer function of the dipole 
is then the admittance Y = 1/Z. An adaptive filter models in 
real time the dipole excited by a white noise. The spectral 
range is determined by the correlation time Tc of the white 
noise. 
 White noise 
+ 
- 
Dipole 
Admittance 
Y=1/Z 
A 
D 
Adaptative  
filter H(z) 
fS 
fS 
V 
I 
A 
D 
Integrator 
 
 
Figure 3.  Adapatative parametric modelisation 
The filter coefficients are identified with a classical LMS 
gradient algorithm. 
This approach requires the “a priori” knowledge of the 
function Y(s) where s is the Laplace variable. 
 
In this work, we are interested in the resonant dipole 
represented by a Butterworth van Dycke (BVD) structure 
(Figure 4). This structure corresponds to many transducers. It 
has a resonance frequency for which Z is minimal and a 
antiresonance frequency for which Z is maximal. So it is 
well suited to measure the accuracy of n impedanceanalyser. 
 
 
R1 
C0 
L1 
C1 
V 
I 
 
 
Figure 4.  Butterworth van Dyck model 
The admittance of this structure is  
 
1
R C s
C s
L
C s)
(C
R C C s
L C C s
)s(
Y
1 1
2
1
1
1
0
2
1 0 1
3
1 0 1
+
+
+
+
+
=
 
(4) 
This admittance has a global capacitive behaviour. To reduce 
the risk of divergence of the gradient algorithm, Mayer et al. 
[10] suggest to carry out an integration of Y(s). This way 
standardizes the admittance modulus outside the resonance 
zone and reduces the system order. 
2) Adaptive filter 
It is possible to exploit a model of adaptive finite impulse 
response filter (FIR). In this case good resonance tracking 
requires the use of a high order transverse structure. That is 
why we use a recursive adaptive structure. His general 
transfer function H(z) is 
30
CENICS 2011 : The Fourth International Conference on Advances in Circuits, Electronics and Micro-electronics
Copyright (c) IARIA, 2011.     ISBN: 978-1-61208-150-2

 
 
1
a z
z
a
b
b z
z
b
H(z)
1
1
N
N
0
1
1
N
N
+
+
+
+
+
+
=
−
−
−
−
L
L
 
(5) 
where z  is the variable of the Z-transform, N is the order 
and bj, ai are the coefficients of the filter. 
III. 
FPGA IN THE LOOP IMPLEMENTATION 
The design and implementation of digital architectures on 
FPGA target requires specific development tools. 
Initially, the complete system is modelled under 
Matlab/Simulink. Indeed, the Mathworks and Altera 
companies have developed jointly software tools for fast 
FPGA prototyping. 
 The analogue part is described with the 
SimPower System toolbox (Simulink). 
 The digital part is described with DSPBuilder 
toolbox (Altera). 
In a second step, the tool "Signal Compiler" of 
DSPBuilder generates the VHDL code of the digital 
architecture, which is implemented on the FPGA circuit. 
Finally, with the hardware in the loop (HIL) simulation, 
the FPGA architecture is tested in a virtual environment in, 
which the analogue components are modelled [11]. 
In Figure 5, we illustrate the design steps of the FPGA in 
the loop prototyping approach. 
 
 
DSP Builder diagram 
of the digital part 
Mixed simulation 
Validation 
VHDL code 
Generation 
Quartus II  
Synthesis and Fitting 
Configuration and 
programmation of 
FPGA 
Prototyping FPGA 
in the Loop 
Modification of 
the DSP Builder 
diagram 
SimPower 
System diagram 
of the analog part 
Yes 
No 
 
Figure 5.  The steps of prototyping an FPGA in the loop 
A. FPGA in the loop prototyping for the RM method 
For this method of EIS measurement, we have used 
voltage and current measurement blocks and RLC blocks 
from the SimPower System library in order to simulate the 
dipole. These components constitute the analogue part of the 
system (Figure 6). The digital part contains two rectifiers, 
two low-pass filters, one divider and one direct digital 
synthesizer (DDS) to generate the sinusoidal signal with 
frequency sweeping. 
 
 
ZD 
Dipole 
DDS 
Rectifier+
LP Filter  
Z 
+ 
- 
s 
+ 
i 
- 
+ 
v 
- 
RG 
Rectifier+
LP Filter  
Divider 
x 
 
SimPower System 
DSP Builder 
Implemented in FPGA 
 
 
Figure 6.  HIL scheme of the radiometric method 
B. FPGA in the loop prototyping for the FVC method 
Here, we don’t need a current measurement, we only use 
the voltage VD of the dipole in order to regulate it at VG/2 by 
feedback control (Figure 7). This choice allows to have the 
best sensibility 
d Z
dVD . 
 
 
VG 
VD 
RG 
Driver 
f 
R - X 
Computing 
 
R 
X 
sin(ωt) 
sin(ωt) 
cos(ωt) 
RG 
2ir0 
2Lr0 
r0 
Resistive Network RG 
Analog Part 
DDS 
Digital Part 
VD 
Z 
 
i=
i=
SimPower System 
DSP Builder 
Implemented in FPGA 
 
 
Figure 7.  HIL scheme of the FVC method 
31
CENICS 2011 : The Fourth International Conference on Advances in Circuits, Electronics and Micro-electronics
Copyright (c) IARIA, 2011.     ISBN: 978-1-61208-150-2

 
C. FPGA in the loop prototyping for the APM method. 
In this method, we must measure the voltage and the current 
of the tested dipole. The excitation signal is a white noise 
whose correlation time is Tc (Figure 8). 
 
 
Matlab-Simulink 
Implemented by FPGA 
z-1 
z-1 
z-1 
z-1 
z-1 
z-1 
z-1 
z-1 
b0 
b1 
b2 
b3 
b4 
a1 
a2 
a3 
a4 
Y(s) 
s
1
C 
C 
Integrator 
Dipole 
 
Figure 8.  HIL scheme of the adaptive parametric modelisation  
The coefficients ai and bj are updated using the gradient 
algorithm 
 
1 k j k
j
j
E
C V
b (k -1)
b (k)
−
+
=
 for 
4
j
0
≤ ≤
 
(6) 
 
k
2 k i
i
i
E
C I
a (k -1)
a (k)
−
+
=
 for 
4
i
1
≤ ≤
 
(7) 
where C1 and C2 are the adaptation constants 
Figure 9 shows the subsystem diagram for the computation 
of the coefficients. 
 
 
 
Figure 9.  Adaptive coefficient subsystem 
IV. 
RESULTS 
A. Range of  frequency analysis 
The Stratix II allows to use a sampling frequency up to 
100 MHz. The DDS synthesiser defines the frequency range 
of analysis. The structure we have adopted, can generate a 
sine excitation from DC to 5 MHz.  
B. Test of the three methods - Comparison 
The three methods RM, FVC and APM are used to analyse 
the impedance Z of a BVD structure corresponding to the 
dipole. The components values are given in Table I. 
TABLE I.  
VALUES OF THE BVD COMPONENTS 
L1 (mH) 
C1 (nF) 
R1 (kΩ) 
C0 (nF) 
486.4 
1.1 
2 
4.64 
 
These values correspond to an audio buzzer (7 kHz 
piezoelectric diaphragm of Murata Company). 
The impedance is analysed in the range [5 kHz - 10 kHz], 
where the electric resonance area of the dipole is located. 
The RM and FVC methods use a sweeping rate of 91.7 
kHz/s. Figures 10 and 11 represent the estimation curves of 
the real and imaginary parts (R and X) of Z obtained by 
each method. The curves are compared with the theoretical 
values RTH and XTH of the BVD impedance. 
 
 
0 
2 
4 
6 
8 
10 
12 
14 
f (kHz) 
R (kΩ) 
5 5.5
6 
6.5 7 
7.5 8 
8.5 9 
9.5 10 
APM 
FVC 
RM 
RTH 
 
 
Figure 10.  Real part of Z estimated by the three methods 
 
5 
5.5
6 
6.5 7 
7.5 
8 
8.5 9 
9.5 10 
-12 
-10 
-8 
-6 
-4 
-2 
0 
2 
f (kHz) 
X (kΩ) 
APM 
FVC 
RM 
XTH 
 
 
Figure 11.  Imaginary part of Z estimated by the three methods 
32
CENICS 2011 : The Fourth International Conference on Advances in Circuits, Electronics and Micro-electronics
Copyright (c) IARIA, 2011.     ISBN: 978-1-61208-150-2

 
Table II summarizes the main characteristics of these 
measures. The accuracy is determined by comparison with 
the theoretical values. 
TABLE II.  
ACCURACY AND DURATION OF THE MEASUREMENT OF  Z 
 
Accuracy 
(at resonance peak) 
Aanlysis duration 
RM 
99 % 
54.5 ms 
FVC 
97 % 
54.5 ms 
APM 
82 % 
200 ms 
C. Discussion 
In this test, the RM method presents the best results. 
However, this method has important practical limitations. 
A change in the calibre of RS is necessary if we want to 
maintain a sufficient signal/noise ratio over a large dynamic 
range of Z. The dipole should not be grounded, this is not 
always possible in many situations. The FVC method allows 
to solve the previous limitations. In addition, the modulus of 
Z can be estimated from RG. The feedback control must be 
stable and the analogue interface (digital resistive network) is 
more complicated. 
The APM method is difficult to be implemented, because 
a setup phase must be performed. It requires to know " a 
priori" the dipole model in order to choose correctly the 
order N of the adaptive filter, the spectral density (1/Tc) of 
the white noise and the sampling frequency fS 
The convergence of the algorithm is achieved in practice 
by researching a compromise between these parameters. In 
our test, the best results are obtained with N = 4, TC = 10-5 s 
and fS = 3.105 Hz. 
The analysis time is directly related to the time constant 
of adaptation, in our case the analysis time is about 0.2 s. 
The impedance measurement errors are generally low but 
still significant near the resonance peak. When all 
adjustments are made, this method becomes very interesting 
because it provides a reference model for instantly 
monitoring the changes in characteristics of the tested dipole. 
V. 
CONCLUSION 
Three 
methods 
for 
impedance 
analysis 
that 
are 
implementable on an FPGA target were presented. The 
traditional ratiometric method is the simplest but requires in 
practice a change of range for the current measuring shunt 
and does not allow a grounded transducer. The 2th method is 
an approach by automatic control of the series resistance to 
match the one of the transducer. This method allows the 
connection of the transducer to the ground without using an 
instrumentation amplifier. The last method is based on the 
parametric estimation of a model. The order of magnitude of 
the response time is 0.2. This method allows the 
determination of the impedance for any real-valued 
frequency thanks to the analytic model. In addition, the 
estimated adaptive filter model can be compared to a 
reference model in order to detect any drift in the 
transducer. However, this approach requires an “a priori” 
knowledge of the impedance type and a source of white 
noise. The presented methods were all implemented in an 
FPGA and some measurement results are given. A modified 
parametric estimation method based on the use of a 
pseudorandom binary sequences is under investigation. 
ACKNOWLEDGMENT 
The authors would like to thank the Yousef Jameel 
Group and Dr D. Refai. 
REFERENCES 
[1] 
D. M. Peairs, P. A. Tarazaga, and D. J. Inman, “Frequency range 
selection for impedance-based structural health monitoring,”. Journal 
of Vibration and Acoustics, vol. 129, no. 6, 2007 pp. 701–709. 
[2] 
Bhalla. S and Soh C. K. “Progress in Structural Health Monitoring 
and 
Non- 
Destructive 
Evaluation 
Using 
Piezo-Impedance 
Transducers,”. Smart Materials and Structures: New Research, Nova 
Science Publishers, Inc. , New York, 2007, pp. 177-228. 
[3] 
Giurgiutiu. V. and Zagrai. A. N, “Embedded Self-Sensing 
Piezoelectric Active Sensors for Online Structural Identification,” 
2002. 
[4] 
Giurgiutiu. V.and Zagrai. A.“Damage Detection in Simulated Aging-
Aircraft 
Panels 
Using 
the 
Electro-Mechanical 
Impedance 
Technique,”. Adaptive Structures and Materials Systems Symposium, 
ASME Winter Annual Meeting, November 5-10, 2000, Orlando, FL 
[5] 
D. M. Peairs, P. A. Tarazaga, and D. J. Inman, “Frequency range 
selection for impedance-based structural health monitoring,”. Journal 
of Vibration and Acoustics, vol. 129, no. 6, 2007, pp. 701–709. 
[6] 
C.L. Petersen “Low power portable device for high precision 
electrical impedance detection,’’. Sensa Wave technology Inc ,BC 
Canada 
[7] 
Lewis G. K., Lewis G. K, and Olbricht W., “Cost-effective broad-
band electrical impedance spectroscopy measurement circuit and 
signal analysis for piezo-materials and ultrasound transducers,’’. 
Meas. Sci. Technol., 2008, doi:10.1088/0957-0233/19/10/105102. 19, 
105102  
[8] 
Yang. Y, Wang. J, Yu. G, Niu. F, and He. P, “Design and preliminary 
evaluation of a portable device for the measurement of bioimpedance 
spectroscopy,”. Physiological Measurement 27, 2006, pp. 1293–
1310. 
[9] 
Hamed. A., Tisserand. E., Berviller. Y., and Schweitzer. P, “Fast 
FPGA Implementation of an Original Impedance Analyser,”. Sensors 
& Transducers journal, 2011, vol. 10, pp.191-205, ISSN 1726-5479, 
February  
[10] Mayer. D,. Atzrodt. H, Herold. S, and. Thomaier. M, “An approach 
for the model based monitoring of piezoelectric actuators,” 
Computers and Structures, vol. 86, no. 3–5, pp. 314–321, 2008. 
[11] Vera. A, Meyer-Baese. U, and. Pattichis. M, “An FPGA based rapid 
prototyping platform for wavelet coprocessors,”. International 
Conference 
on 
Independent 
component 
analyses, 
wavelets, 
unsupervised smart sensors, and neural networks, Orlando April 
2007, pp. 1-10. 
 
 
33
CENICS 2011 : The Fourth International Conference on Advances in Circuits, Electronics and Micro-electronics
Copyright (c) IARIA, 2011.     ISBN: 978-1-61208-150-2

