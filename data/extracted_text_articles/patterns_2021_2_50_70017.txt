Recovering Shape from Endoscope Image Using Eikonal Equation
Yuji Iwahori
Dept. of Computer Science
Chubu University
Kasugai, 487-8501 Japan
Email: iwahori@isc.chubu.ac.jp
Hiroyasu Usami
Dept. of Computer Science
Chubu University
Kasugai, 487-8501 Japan
Email: usami@isc.chubu..ac.jp
M. K. Bhuyan
Dept. of Electronics and Electrical Eng.
Indian Institute of Technology Guwahati
Guwahati, 781039 India
Email: mkb@iitg.ac.in
Aili Wang
Higher Education Key Lab.
Harbin University of Sci. and Tech.
Harbin, China 150006
Email: aili925@hrbust.edu.cn
Naotaka Ogasawara
Dept. of Gastroenterology
Aichi Medical University
Nagakute, 480-1195 Japan
Email: nogasa@aichi-med-u.ac.jp
Kunio Kasugai
Dept. of Gastroenterology
Aichi Medical University
Nagakute, 480-1195 Japan
Email: kuku3487@aichi-med-u.ac.jp
Abstract—This paper proposed a shape recovery approach
from Endoscope Image using Eikonal Equation. Photometric
constraint equation derived from the Lambert reﬂectance and
geometrical constraint equation derived from the relationship
between the neighboring points are used and these equations can
make a new approximation equation of Eikonal equation under
the point light source illumination and perspective projection.
The original endoscope image is transformed and generated to
the Lambertian image by removing the specular reﬂectance.
Framework of Fast Marching Method using the derived Eikonal
Equation can recover the 3D shape from endoscope image.
Usefulness was conﬁrmed using simulation and experiments.
Keyword: Shape, Endoscope, Eikonal Equation, Fast Marching Method
I. INTRODUCTION
Endoscope is used in the medical diagnosis to detect polyps
and the examinations are performed for the purpose of ﬁnding
abnormal parts, such as bleeding, inﬂammation in the internal
organs of the stomach and intestines (See Refs.[1][2]). Polyps
found by endoscope have a variety of sizes and shapes. This
paper proposed a new approach for a polyp shape and size
recovery by solving Eikonal Equation under the condition
of point light source illumination and perspective projection.
Shape is recovered using an extended Fast Marching Method
(FMM) approach. Proposed method is described in Section II.
In Section III, experimental results are shown with absolute
size and corresponding polyp shape. The approach provides
overall good performance for the supporting system of medical
diagnosis. Finally Conclusion is provided in Section IV.
II. PROPOSED METHOD
Endoscope image is obtained under the white light source.
Procedure of the proposed approach is shown as follows.
A. Removal of Specular Reﬂectance Component and Genera-
tion of Lambertian Image
Our previous approach proposed in Ref.[3] is applied to
remove the specular reﬂectance component and generation of
Lambertian image with uniform surface reﬂectance from the
original endoscope image. Converting the RGB (Red-Blue-
Blue) to HSV (Hue-Saturation-Value) representation, classi-
ﬁcation for reﬂectance using the H histogram, then uniform
reﬂectance image processing is performed using the ratio of
V based on the difference of reﬂectance. Procedures are as
follows.
Step1. Classiﬁcation using histogram of H
Step2. Calculate the V ratio between interest color points
and those neighboring points whose color is most
frequent color.
Step3. Equalization of reﬂectance using V ratio calculated
in Step2 and using the points, which are not used in
Step2 of interest color.
Step4. Equalization of reﬂectance for all color groups by
repeat Step2 and Step3.
B. 3D Shape Recovery
Photometric constraint equation and geometrical constraint
equation derived should become the same depth value Z
for both (See Ref.[4]). These equations can make a new
approximation equation of Eikonal equation under the point
light source illumination and perspective projection.
√
CV (−px − qy + f)
E(p2 + q2 + 1)
1
2
= Zk(f − pkxk − qkyk)
f − pkxt − qkyt
(1)
Here, t(trial) represents a trial point and k(known) repre-
sents a known point of depth Z. C represents the reﬂectance
43
Copyright (c) IARIA, 2021.     ISBN:  978-1-61208-850-1
PATTERNS 2021 : The Thirteenth International Conference on Pervasive Patterns and Applications

factor, (p, q) represent gradient parameters, (x, y) represent
image coordinate, f represents a focal length of the lens, E
represents the observed image intensity and V = f 2/(x2 +
y2 + f 2)
3
2 .
Expanding Eq.(1) gives
√
p2 + q2 + 1 = CV (f − pkx − qky)2(f − px − qy)
EZ2
k(f − pkxk − qkyk)2
(2)
Approximation of (f − pkx − qky) ≒ (f − px − qy) derives
p2 + q2 + 1 =
C2V 2(f − pkx − qky)6
E2Z4
k(f − pkxk − qkyk)4
(3)
Then the following equation is derived.
√
p2 + q2 =
√
C2V 2(f − pkx − qky)6
E2Z4
k(f − pkxk − qkyk)4 − 1
(4)
Depth Z can be obtained by FMM algorithm developed in
Ref.[5]. Here, it is possible to estimate the value of reﬂectance
parameter C using two images and feature points matching
to estimate the absolute size of polyp since absolute size is
important and it depends on the value of reﬂectance factor C.
Step1. SIFT (in Ref.[6]) or ORB (in Ref.[7]) feature points
extracted from blood vessels using two images and
movement ∆Z of endoscope camera is estimated.
Step2. Parameter C is estimated using ∆Z (See Ref.[6]).
Step3. Shape recovery is applied for each uniform Lamber-
tian image generated by Ref.[3].
III. EXPERIMENT
Simulation image for a hemisphere whose center is
(0, 0, 15) with the radius R = 5[mm], focal length f =
10[mm], reﬂectance factor C = 22950 is assumed and the
result is shown in Figure 1. 3D shape are recovered for
endoscope image as shown in Figure 2.
(a) Original Depth Map
(b) Recovered Depth Map
(c) Original Shape
(d) Recovered Shape
Fig. 1. Computer Simulation
(a) Input Image
(b) Uniform Lam-
bertian Image
　
(c) 3D Shape
Fig. 2. Recovered 3D Shape
IV. CONCLUSION
This paper proposed a method to recover 3D shape and size
from endoscope image using Eikonal Equation. Absolute size
recovered from estimated C becomes also important from two
images under endoscope motion. Further subject includes to
use the recovered shape to the undetected or misclassiﬁcation
of polyp for the support of medical diagnosis.
ACKNOWLEDGMENT
Iwahori’s research is supported by JSPS Grant-in-Aid Sci-
entiﬁc Research (C)(#20K11873).
REFERENCES
[1] S. Hwang, J. Oh, W. Tavanapong, J. Wong, and P. C. D Groen, ”Polyp
detection in colonoscopy video using elliptical shape feature”, IEEE
ICIP 2007, Vol. 2, pp. II–465, 2007.
[2] T. Ooto et al., ”Cost Reduction of Creating Likelihood Map for Auto-
matic Polyp Detection Using Image Pyramid”, ACIT/CSII/BCD 2017,
pp.204-209, 2017.
[3] N. Ikeda, H. Usami, Y. Iwahori, B. Kijsirikul, and K. Kasugai, ”Gener-
ating Lambertian Image by Removing Specular Reﬂection Component
and Difference of Reﬂectance Factor Using HSV”, Proc. of ITC-CSCC
2016, pp.547-550, 2016.
[4] K. Tatematsu et al., ”Shape from Endoscope Image based on Photomet-
ric and Geometric Constraints”, Procedia Computer Science, Elsevier,
Vol.22, pp.1285-1293, 2013.
[5] R. Kimmel and J. A. Sethian : “Optimal Algorithm for Shape from
Shading and Path Planning”, JMIV, Vol. 14, pp. 237-244, 2001.
[6] Y. Iwahori et al., ”Estimating Reﬂectance Parameter of Polyp Using
Medical Suture Information in Endoscope Image”, ICPRAM 2016,
pp.503-509, 2016.
[7] H. Toda et al., ”Shape Recovery of Polyp using Blood Vessel Detection
and Matching Estimation by U-Net”, IIAI AAI 2019, pp. 450-453, 2019.
44
Copyright (c) IARIA, 2021.     ISBN:  978-1-61208-850-1
PATTERNS 2021 : The Thirteenth International Conference on Pervasive Patterns and Applications

