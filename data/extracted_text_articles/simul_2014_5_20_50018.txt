Consistency of the Stochastic Mesh Method
Yuri Kashtanov
Faculty of Mathematics and Mechanics
Saint Petersburg State University
Russia
Email: y.kashtanov@spbu.ru
Abstract—A Monte Carlo method for pricing high-dimensional
American options is considered. The consistency of the stochastic
mesh method is studied. Some ”natural” estimators of this method
have inﬁnite variance. A modiﬁcation which gives consistent
estimators for a diffusion model is proposed. It is shown that
the variance of estimators is inverse proportional to the number
of points in each layer of the mesh.
Keywords–Optimal stopping; American option; Stochastic mesh.
I.
INTRODUCTION
Pricing of American options may be formulated as a prob-
lem of the theory of optimal stopping: if Sn is the price process
of the underlying asset and fn are the option payoffs then the
option price C has the expession [1] C = supτ<T Efτ(Sτ),
T being the expiry date, τ - an arbitrary Markov moment. In
the case when Sn is a high-dimensional process, numerical
methods with regular mesh are very time-consuming. Mark
Broadie and Paul Glasserman [2] suggested a stochastic mesh
method which does not depend on the dimension. In parallel,
Athanassios N. Avramidis and Heinrich Matzinger [3] formu-
lated general conditions under which estimators of the method
are statistically consistent. Using Malliavin calculus approach,
Vlad Bally and others [4] suggested analogous estimators for
a generalized Black-Scholes model; these estimators may be
transformed [5] to the formula (20) of the present paper.
This slight modiﬁcation of formula (5) allows to convert
the estimator with inﬁnite variance to the one with a ﬁnite
variance. The issue of the method consistency applying to
the general diffusion model was not investigated till now and
is the goal of the paper. Section 2 describes the stochastic
mesh method; in Section 3, theoretical assertions, concerning
consistency, are formulated; in Section 4, numerical examples,
which illustrate these results, are given; proofs are gathered in
the Appendix.
II.
THE STOCHASTIC MESH METHOD
Let prices of d securities Sn = (Sn1, . . . , Snd), Sn ∈ Rd =
X, be given at discrete moments tn = n∆t, where ∆t = T/N.
Assume also, that discounted prices are martingales that means
the following equalities are fulﬁlled
E(Sn+1,i | S1, . . . , Sn) = er∆tSni,
(1)
r being an interest rate, which is assumed to be constant.
Onwards, it will be more convenient to deal with sequences
ξni = ln Sni − rtn. Assume that ξn = (ξn1, . . . , ξnd) is a
Markov chain with values in X and pn(x, dy) are transitional
probabilities.
Let an American option be given with an expiration T
and discounted payoffs of the form fn = fn(ξn). Deﬁne
successively functions Yn(x):
YN(x) = fN(x),
Yn(x) = max (fn(x), En,xYn+1(ξn+1)) .
(2)
It is known [1] that the option price C satisﬁes C = Y0(ξ0).
For every time step n, a set of random points ¯xn =

xi
n
	M
i=1 (”mesh”) is constructed as a Markov chain with
transitional probabilities
¯qn(¯x, d¯y) = qn,1(¯x, dy1)...qn,M(¯x, dyM).
(3)
Make an assumption on probabilities qn,j(¯x, dy) that densities
ρn,j(¯x, x, y) = pn(x, dy)/qn,j(¯x, dy)
(4)
exist. For a shortage of further notations, introduce random
variables deﬁned on the mesh: Yn(j) = Yn(xj
n), ρn(x, j) =
ρn,j(¯xn−1, x, xj
n), ρn(i, j) = ρn(xi
n−1, j).
Recursively construct random sequence ˇYn(x): ﬁrst, set
ˇYN(x) = fN(x), then deﬁne
ˇYn(x) = max

fn(x), 1
M
M
X
j=1
ρn+1(x, j) ˇYn+1(j)

 ,
(5)
where using analogous notations ˇYn+1(j) = ˇYn+1(xj
n+1).
Introduce Fn – a σ-algebra generated by values ¯x1, . . . , ¯xn.
Denote a conditional expectation with respect to Fn as EFn.
Assume that for every n, random variables jn taking values
1, . . . , M with equal probabilities, are deﬁned and which are
independent in total and with respect to FN, then the last
equality can be rewritten in the form
ˇYn(x) = max

It follows in turn from (7) and (8) that under the condition
E[ρ1(x0, j)...ρn(jn−1, jn)Yn(jn)]2 < ∞,
n = 1, . . . , N;
(9)
the inequality
E( ˇY0 − C)2 ⩽ C/M
(10)
is fulﬁlled ant thereby ˇY0 is a consistent estimator for C.
In [2] some substantiation is given for using the average
distribution, which is deﬁned by the expression
qn,j(¯x, dy) = M −1 X
i
pn(xi, dy).
(11)
In some models (e.g. Black-Scholes), transitional probabilities
for several steps pk,n(x, dy) are known, in this case one can
use [2]
qn,j(¯x, dy) = p0,n(x0, dy).
(12)
The objective of the paper is to study the statistical con-
sistency of these and other estimators for the general diffusion
model.
III.
CONSISTENT ESTIMATORS
First, consider a case when xn are normal vectors in Rd
deﬁned by the sequence
xn+1 = xn + anεn+1 + bn,
(13)
an being d × m - matrices, εn – independent standard normal
vectors in Rm, An = ana∗
n, bn(i) = −0.5An(i, i). Denote
ψ(An, z) = (Anz, z) and suppose that
sup
||z||=1
ψ(An, z) ⩾ ¯A0 > 0,
(14)
then densities pk,n+1(x, y) exist for transition from point x at
the moment k to point y at the moment n + 1:
pk,n+1(x, y) = ckn exp(−0.5ψ(Σ−1
k,n, x + Bk,n − y)),
where ckn = [(2π)d det Σkn]−1/2, Σk,n = Pn
i=k Ai and
Bk,n = Pn
i=k bi. Suppose payoffs imply that
Yn(x) ⩽
X
i
ci(ekixi + 1).
(15)
Theorem 1. The inequality (10) for the estimator with
average densities (11) is valid under conditions (14), (15).
Proofs are given in the Appendix.
Now, consider the mesh generated according to the formula
(12). Note that it is approximately 2 times less time-consuming
for calculation than (11) but the variance of ˇY0 may be inﬁnite
if N is big enough. Really, let N ⩾ 3 then
E ˇY 2
0 ⩾ E [ρ2(j1, j2)ρ3(j2, j3)f3(j3)]2
=
1
M 3
Z
X3
p(x0, y1) p2(y1, y2)
p0,2(y0, y2)
p2(y2, z3)
p0,3(y0, y3)f 2
3 (y3)dy1dy2dy3.
Consider the case when d = 1 and an are constant, then after
integrating by y1, y2 receive
E ˇY 2
0 ⩾ c
Z
R
exp
 7y2
78a2

f 2
3 (ya
√
∆t + 3b∆t)dy.
(16)
If f3(x) > ε for x > K or x < −K with some ε, K > 0 then
the integral does not converge and thus the variance is inﬁnite.
Below, a modiﬁcation of this estimator with ﬁnite variance will
be constructed for a more general diffusion model.
Now, consider a discretization of a diffusion process ac-
cording to the Euler scheme:
xn+1 = xn + an(xn)εn+1 + bn(xn).
(17)
Suppose that for some ¯A0, ¯A1 the inequalities are fulﬁlled
¯A0|z|2 ⩽ (An(x)z, z) ⩽ ¯A1|z|2;
(18)
then |bn(x)| ⩽ ¯b for some ¯b.
Let the mesh be produced by transition probabilities
qn,j(¯x, dy) = qn(y)dy = cn exp(−|y−x0|2/(2s2n))dy. (19)
Consider a following modiﬁcation of the scheme (5) :
ˇYn(i) = max
 
fn

are martingales then egn(x) = gn(x). It is easy to verify that
the representation (21) takes place under K = d, correlation
matrices A(k)
n (x) = An(x) and b(k)
n (x) = bn(x) + An(x)ek.
IV.
NUMERICAL RESULTS
Consider a geometrical average option with payoff func-
tions fn = ((Sn1..Snd)1/d − K)+. In the case of Black-
Scholes model, the calculation may be reduced to a one-
dimensional American call with dividends and the solution
may be obtained with high accuracy either by a regular mesh or
by the analytical approximation [6]. Under parameters d = 5,
a = 0.3, r = 0.02, S = 100, K = 100, T = 1, the price of
American option in the continuous model is Ca = 4.63, which
is strictly greater than the price of the correspondent European
option Ce = 4.46. In discrete models the price of American
option increases from Ce to Ca with increasing N. As a control
variate, take the corresponding European call option.
TABLE I.
COMPARISON OF ESTIMATORS
Estimator, density
(5), (11)
(23), (19)
N
True
M
Av
Err
Av
Err
6
4.59
300
4.61
0.008
4.59
0.006
1200
4.60
0.004
4.59
0.0026
12
4.61
300
4.7
0.017
4.61
0.0055
1200
4.66
0.006
4.61
0.0023
24
4.62
300
4.86
0.04
4.63
0.005
1200
4.81
0.015
4.62
0.0025
The table includes the true price, estimates and statistical
errors, corresponding to 99% conﬁdence level by 50 realiza-
tions. It illustrates the assertion that the variance is inverse
proportional to M. It may be observed from the table (and is
known from the theory) that the estimator (5), (11) is biased
high and this bias increases with the number of time steps; to
compensate it one should increase the mesh size. Note also
that the ﬁrst estimator is approximately 2 times more time-
consuming than the second one.
Consider the same option in the following diffusion model
∆xni =
√
∆tσ(xn−1,i)[αεni + ρεn,d+1] − 0.5σ2(xn−1,i)∆t,
where α2+ρ2 = 1, ρ = 0.5, σ(x) being a decreasing function,
which varies from 0.6 to 0.1, σ(x0) = 0.3.
TABLE II.
CASE OF THE GENERAL DIFFUSION MODEL
s
0.2
0.43
0.5
M
Av
Err
Av
Err
Av
Err
300
7.13
0.012
7.19
0.009
7.21
0.012
600
7.13
0.008
7.18
0.007
7.19
0.009
1200
7.14
0.007
7.16
0.005
7.17
0.007
Rough 1-dimensional approximations give prices from 7.1
to 7.2. The simulation results for the estimator (19), (23) with
N = 12 and different values of the parameter s are presented
in the Table II. The value 0.43 is slightly greater than A1/
√
2,
which provides the variance ﬁniteness.
V.
APPENDIX
Proof of theorem 1. First, note that ρ1(x0, j) = 1 for every
j; further, EFN ρ2(j1, j) = 1 also for every j and by induction
we receive that the right part in (7) is equal to PN−1
n=0 |∆n(jn)|.
Therefore, to prove consistency it is sufﬁcient to show that for
every n < N the following integrals are ﬁnite:
Eρ2
n+1(jn, 1)Y 2
n+1(1) =
Z
X
dy Y 2
n+1(y)E
P
j p2
n+1(xj
n, y)
P
j pn+1(xj
n, y)
.
(24)
To estimate the expectation under the sign of the integral, prove
the following lemma:
Lemma. Let ηi, i = 1, . . . , M, be positive, independent,
similar distributed random variables, ζi = cη1+ε
i
ε > 0;
denote ¯η = M −1 P
j ηj, ¯ζ = M −1 P
j ζj, then
E¯ζ/¯η ⩽ 3Eζ/Eη.
Proof. From the equality
¯ζ
¯η =
¯ζ
Eη − 1
Eη
¯ζ
¯η (¯η − Eη)
(25)
the estimate follows:
E
¯ζ
¯η ⩽ Eζ
Eη + 1
Eη E
¯ζ
¯η |¯η − Eη| .
(26)
Further, from inequality P
j η1+ε
j
⩽ (P
j ηj)1+ε it follows that
¯ζ/¯η ⩽
 X
j
η1+ε
j

ε
1+ε .
(27)
Using the last estimate and then H¨older’s inequality receive
E
¯ζ
¯η |¯η − Eη|
⩽
E
 X
j
η1+ε
j

ε
1+ε |¯η − Eη|
(28)
⩽
E
ε
1+ε
 X
j
η1+ε
j

E
1
1+ε |¯η − Eη|1+ε .
Now use the following theorem ([7], c.79):
Let X1, . . . , Xn be independent random variables with zero
mean and ﬁnite absolute moments of order p (1 ⩽ p ⩽ 2); then
E

n
X
k=1
Xk

p
⩽

2 − 1
n

n
X
k=1
E|Xk|p.
Using this theorem one can estimate (28) by the value
M
ε
1+ε E
ε
1+ε η1+ε
2
M
ε
1+ε E
1
1+ε η1+ε = 2Eζ.
Substituting the obtained estimates in (26), one receive the
assertion of the lemma.
Now denote ηk,n+1(j) = pk,n+1(xk,j, y); then applying
lemma (with ε = 1) to expectation in (24), receive
E
P
j η2
n,n+1(j)
P
j ηn,n+1(j) ⩽ 3EEFn−1η2
n,n+1(1)
EFn−1ηn,n+1(1).
(29)
According to Chapman-Kolmogorov equations, the denomi-
nator is equal to P
j ηn−1,n+1(j). Calculate EFk−1ηm
k,n+1(1)
with m > 1:
EFk−1ηm
k,n+1(1) = eckn
X
j
e−ψ(eΣ−1
k−1,n, xj
k−1+Bk−1,n−y)/2,
105
Copyright (c) IARIA, 2014.     ISBN:  978-1-61208-371-1
SIMUL 2014 : The Sixth International Conference on Advances in System Simulation

where
eΣk−1,n = Ak−1 + 1
mΣk,n = Σk−1,n − m − 1
m
Σk,n.
(30)
It follows from (30) that eΣ−1
k−1,n = Σ−1
k−1,n(I − Dk,n)−1,
where Dk,n = (m − 1)/m Σk,nΣ−1
k−1,n, I being a unit d × d
matrix. Since ||Dk,n|| < 1, one can estimate the inverse matrix
eΣ−1
k−1,n ⩾ Σ−1
k−1,n(I + Dk,n). On the other hand, Dk,n ⩾ εI
with some value ε = εk,n,m > 0; therefore, an estimation from
below is eΣ−1
k−1,n ⩾ (1+ε)Σ−1
k−1,n. Particularly, it follows from
this estimate that
EFn−1η2
n,n+1(1)
EFn−1ηn,n+1(1) ⩽ C1
P
j η1+ε
n−1,n+1(j)
P
j ηn−1,n+1(j)
with ε = εn−1,n,2. The lemma may be applied to the obtained
expression as well, and after n iterations receive
E
P
j p2
n+1(xj
n, y)
P
j pn+1(xj
n, y)
⩽ Cnpε
0,n+1(x0, y).
Under condition (15) the integral in (24) is ﬁnite. Thus, the
proof is complete.
Proof of theorem 2. Introduce an additional notation
¯ρn(i, j) = ρn(i, j)/
X
k
ρn(i, k)
and in the same way as in (7) obtain
 ˇY0 − Y0
 ⩽
N−1
X
n=0
X
i1,...,in
¯ρ1(0, i1) . . . ¯ρn(in−1, in)|∆n(in)|,
where ∆n(i) = P
j ¯ρn+1(i, j)Yn+1(j) − En,xniYn+1(ξn+1).
Squaring both parts and taking into account that ¯ρn(i, j) is a
distribution by j, due to H¨older inequality obtain
E

VI.
CONCLUSION AND FUTURE WORK
It is shown in the paper that a simple modiﬁcation from
scheme (5) to schemes (20), (37) allows to prove the ﬁniteness
of the variance and, thus, consistency of the estimators in the
general diffusion model. Besides, unpleasant bias vanishes,
which allows to reduce the number of nodes in the mesh. The
next step may be the extension of results to the jump-diffusion
model, which is important for applications.
ACKNOWLEDGMENT
This work was supported by RFBR grant 14-01-00271.
REFERENCES
[1]
I. Karatzas, “On the pricing of American options. Applied Mathematics
and Optimization,” Applied Mathematics and Optimization, vol. 17,
1988, pp. 37–60.
[2]
M. Broadie and P. Glasserman, “A Stochastic Mesh Method for Pric-
ing High-Dimensional American Options,” Journal of Computational
Finance, vol. 7, 2004, pp. 35–72.
[3]
A. Avramidis and H. Matzinger, “Convergence of the stochastic mesh
estimator for pricing Bermudan options,” Journal of Computational
Finance, vol. 7, 2004, pp. 73–91.
[4]
V. Bally, L. Caramellino, and A. Zanette, “Pricing and Hedging American
Options by Monte Carlo Methods Using a Malliavin Calculus Approach,”
Journal of Monte Carlo Methods and Applications, vol. 11, 2005, pp. 97–
134.
[5]
Y.
N.
Kashtanov,
Financial
Mathematics
Models
and
Statistical
Simulation.
VVM, St.-Petersburg, 2013, ISBN: 978-5-9651-0741-4.
[6]
G. Barone-Adesi and R. E. Whaley, “Efﬁcient Analitic Approximation
of American Option Values,” Journal of Finance, vol. 42, 1987, pp. 301–
320.
[7]
B. von Bahr and C.-G. Esseen, “Inequalities for the rth absolute moment
of a some of random variables, 1 ⩽ r ⩽ 2,” Ann. Math. Statist, vol. 36,
1965, pp. 299–303.
107
Copyright (c) IARIA, 2014.     ISBN:  978-1-61208-371-1
SIMUL 2014 : The Sixth International Conference on Advances in System Simulation

