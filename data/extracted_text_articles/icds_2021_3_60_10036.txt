Blockchain for Smart Grid Flexibility 
Handling Settlements between the Aggregator and Prosumers 
 
 
Lasse Berntzen 
School of Business 
University of South-Eastern Norway 
Horten, Norway 
email: lasse.berntzen@usn.no 
Qian Meng 
School of Business 
University of South-Eastern Norway 
Horten, Norway 
email: qian.meng@usn.no 
Boban Vesin  
School of Business 
University of South-Eastern Norway 
Horten, Norway 
email: boban.vesin@usn.no 
Marius Rohde Johannessen  
School of Business 
University of South-Eastern Norway 
Horten, Norway 
email: marius.johannessen@usn.no 
 
Thomas Brekke  
School of Business 
University of South-Eastern Norway 
Horten, Norway 
email: thomas.brekke@usn.no 
Inessa Laur 
School of Business 
University of South-Eastern Norway 
Horten, Norway 
email: inessa.laur@usn.no 
Abstract—This paper shows how the Ethereum blockchain can 
register settlements between an aggregator and prosumers in a 
smart grid.  By providing flexible use of electricity to the 
aggregator, customers get rewarded. The flexibility is valuable 
for the aggregator since the power infrastructure may be used 
more efficiently.  Blockchain is an exciting technology for 
handling settlements which, however, also has some clear 
limitations. For example, the cost per transaction on the public 
Ethereum blockchain is too high compared to the value of the 
actual transactions.  A private blockchain is an alternative but 
removes some of the original benefits of using the public 
blockchain. The paper concludes that blockchain is a promising 
technology, and a private blockchain is more suitable for 
transactions containing minimal amounts. 
Keywords-smart grid; blockchain; Ethereum; smart contract; 
aggregator; flexibility; Smart-MLA. 
I. 
 INTRODUCTION 
Smart grids [1] are electric power grids supported by 
electronics that keep track of power consumption and 
production. Typically, smart meters [2] keep track of energy 
flow between producers, consumers, and prosumers. Smart 
meters normally connect to a service maintained by the 
Distribution System Operator (DSO).  
Prosumers refers to the combination of producers and 
consumers, with production coming from energy sources like 
solar panels. On sunny days, the energy production of a 
household or a building may exceed the consumption. Then 
the prosumer may sell excess energy to the grid. At other 
times, the household gets its electricity from the grid, as 
shown in Figure 1. 
The price of energy varies throughout the day.  The 
energy price is calculated based on demand and supply 
forecasts, and the pricing intervals typically differ from one 
hour down to ten minutes. 
 
Figure 1.  Prosumers 
Flexibility occurs when a household or building can delay 
the use of electricity to a timeslot when the price is lower.  A 
typical example is the charging of electric vehicles. Charging 
requires a rather large consumption over a relatively short 
period.  If the customer chooses the optimal time, charging 
will be less expensive. 
The next step is to transfer the flexibility to an aggregator.  
In this case, the customer defines some constraints, e.g., the 
electric car should be fully charged at 7 am.  The aggregator 
then selects the optimal time slots when the actual charging 
takes place.   
The flexibility is essential for grid management since it 
can reduce the chances of overloading the grid and delay 
investments in upgraded electric power infrastructure. 
The customer is rewarded for giving up control, either by 
favorable pricing or a discount on the electricity bill. 
Blockchain technology has the potential to have a 
significant impact on the energy sector.  Numerous use cases 
have been proposed, including wholesale and retail energy 
trading [3][4]. 
40
Copyright (c) IARIA, 2021.     ISBN:  978-1-61208-869-3
ICDS 2021 : The Fifteenth International Conference on Digital Society

The purpose of this paper is to present the Smart Multi-
Layer Aggregator (Smart-MLA) project and how blockchain 
technology can handle settlements between the aggregator 
and its customers (prosumers). 
Section II discusses the flexibility project, followed by a 
section explaining Blockchain technology. Section IV 
presents some related work, followed by a section showing 
our approach for the project. Finally, Section VI concludes 
and provides some input on future work. 
II. 
THE SMART MULTI-LAYER AGGREGATOR 
The Smart-MLA project [5] is an ERA-Net Smartgrid 
Plus research project with academic and industrial partners 
from Denmark, Norway, Romania, Sweden, and Turkey. The 
aim is to develop and demonstrate a cloud-based multi-layer 
aggregator solution to facilitate optimum demand response 
and grid flexibility for energy systems to utilize up to 100% 
renewable energy. The project implements three layers of 
flexibility aggregation, as shown in Figure 2. 
 
 
Figure 2.  The Smart-MLA layers 
On the lowest layer (shown in Figure 3), flexibility occurs 
within a household or a building. The main objective of this 
layer is to improve the awareness of the prosumers on the 
merits of flexibility at the prosumer level. Here, the customer 
sets constraints and the preferred scheduling for flexible 
appliances. Then, the proposed algorithm [6] optimizes the 
operation of the flexible appliances and comes up with the 
difference between the cost of using user-preferred and 
optimal schedules. The solution considers both production 
capacity (solar panels) and storage capacity (batteries) to 
obtain the best possible result. 
 
 
Figure 3.  Smart-MLA layer 1 
On the second layer (shown in Figure 4), the customer 
transfers the control of charging electric vehicles, heat pump, 
and other appliances to the aggregator. When the aggregator 
controls many households/buildings connected to the grid, 
the aggregator may optimize the power consumption for the 
whole smart grid. 
 
 
Figure 4.  Smart-MLA layer 2 
This layer includes settlements between the aggregator 
and the prosumers. In this layer, the grid is used as an on-
demand delivery service that may also buy back excess 
energy and reward the prosumer for transferring flexibility. 
The settlements are between the prosumers and the 
aggregator, as shown in Figure 5. The settlements are 
registered on the blockchain. 
 
 
Figure 5.  Settlements on layer 2 
The flexibility aggregated from the prosumers will be 
traded in the local flexibility market in coordination with the 
Distribution System Operator (DSO) on the upper layer.  The 
aggregator uses an iterative process based on schedules, 
prices, and bids for flexibility, as shown in Figure 6. 
 
 
Figure 6.  Smart-MLA layer 3 
Further details on the three-layer aggregator flexibility 
can be found in a separate paper [7]. 
41
Copyright (c) IARIA, 2021.     ISBN:  978-1-61208-869-3
ICDS 2021 : The Fifteenth International Conference on Digital Society

The settlements are made between the aggregator and the 
prosumers, and the aggregator and the DSO, as illustrated in 
Figure 7. 
 
 
 
Figure 7.  Settlements on layer 3 
Both types of settlements are registered on the 
blockchain.  The settlements include the amount of energy, 
time, period, and the two entities involved in the transaction. 
III. 
BLOCKCHAIN BASICS 
Blockchain technology was initially developed to handle 
cryptocurrency safely and transparently [8].  Bitcoin was the 
first cryptocurrency using blockchain as a platform. The 
blockchain is a decentralized, immutable ledger. The ledger 
is implemented as blocks of data chained together [9], as 
shown in Figure 8. Cryptographic techniques ensure that it is 
impossible to change the block's content when put on the 
blockchain [9]. The first block is called the genesis block. 
 
 
Figure 8.  The blockchain 
Each block contains a link to the previous block and also 
a hash value of the previous block. Each new block is 
encrypted (including the hash value of the previous block).  
A block cannot be altered after it is added to the blockchain. 
In that case, the whole blockchain becomes invalid [9]. 
Figure 9 shows the layout of the blocks and the block header. 
 
 
Figure 9.  The blockchain header 
A "Merkle" tree [9] secures the integrity of the 
transactions stored in the block. First, a hash value is 
calculated for each transaction. Hash values are then 
calculated for each pair of transactions, and the process is 
repeated until the root of the tree appears. Finally, the Merkle 
root hash is stored in the block header. The construction of 
the Merkle tree is illustrated in Figure 10. 
The block is added after validation.  The validation is 
done by so-called miners who solve a mathematical problem 
and get rewarded (with cryptocurrency) for solving the 
problem [9].  
A new block is distributed to many nodes in the network. 
A majority consensus protocol secures the integrity of the 
blockchain. Therefore, an attack needs to succeed with a 
majority of the nodes in the network, which is nearly 
impossible. 
If one or more nodes fail, the data is still obtainable from the 
other nodes. Thus, if there should be an inconsistency, the 
majority will win.  
 
 
 
Figure 10.  The Merkle tree 
A blockchain may be public or private. Everyone has 
access to the public blockchain and can examine the 
transactions that have been made.  The blockchain is semi-
anonymous; the user is identified with a binary address. A 
private blockchain may require permission to examine the 
transactions. 
IV. 
BLOCKCHAIN IN SMART GRIDS 
    In recent years, the centralized power grids have 
experienced significant changes and challenges as follows 
[10]: 
● 
The production is unpredictable and variable due to an 
increase in renewable energy sources. 
● 
The power transmission and distribution become more 
controllable 
and 
fault-tolerant 
due 
to 
network 
digitization. 
● 
Prosumers (entities that both produce and consume 
energy) have the active dual role of both producer and 
consumer. 
● 
Loads become more interactive and dynamic. 
     Blockchain as a decentralized and distributed technology 
secures suitable applications in the transition to smart grid 
infrastructure. The utilization of the blockchain in smart grids 
could offer various advantages to the electrical power system 
with increased security, improved data privacy, data 
transparency and immutability, removal of third-party 
control and trust, ubiquitous solution, and greater data 
accessibility. A lot of research has been done about 
blockchain technology applied to the power sector [11]. The 
integration of blockchain and renewable energy sources, 
energy storage devices, and electric vehicles into the 
electrical grid has been a broad research area [12]. 
Blockchain technology brought agreeable advantages and 
42
Copyright (c) IARIA, 2021.     ISBN:  978-1-61208-869-3
ICDS 2021 : The Fifteenth International Conference on Digital Society

created much interest in applying this technology in smart 
grids [13]. Blockchain applications in the smart grid could be 
divided into three parts of the smart grids as follows [14]: 
● Power generation: Blockchains and smart contracts can 
allow a generating unit to directly trade with a consumer 
or a retail energy supplier via autonomous trading 
agents, cutting out the middleman [15]. Blockchains 
could also provide innovative trading platforms for 
integrating 
small-scale 
renewables, 
distributed 
generation, and flexibility services [16]. 
● Power transmission and distribution: Blockchains enable 
independent power grid nodes, without prior trust in each 
other, to reach an agreement on the optimal power flow 
solution through simulation experiments on the 39-bus 
New England transmission system [17]. Blockchains 
also guarantee the origin of the energy from the voltage 
distribution across the network [18]. 
● Power consumption: Emerging blockchain technologies 
ensure the seamless and secure implementation of a 
decentralized 
demand-side 
management 
approach 
following optimized demand profiles, including battery 
devices, electric vehicles' charging [19].  
Among the examined research, a focused topic is about 
electric vehicles' connection to the smart grids. The random 
charging of these vehicles may give a heavy burden to the 
power grid. To solve this problem, blockchain technology is 
introduced. An electric vehicle integration scheme is 
proposed based on blockchain technology for reducing 
fluctuations in the grid [20]. It is suggested that a platform 
that integrates electric vehicles and charging stations enables 
a negotiation between them over blockchain [21]. It explains 
using blockchain technology to make electric cars find a 
close-by charging station [22]. To improve voltage stability 
of the grid while minimizing charging costs for electric 
vehicle users, an adaptive blockchain-based electric vehicle 
participation scheme is proposed to schedule electric vehicles 
charging/discharging demand to flatten the impact of 
consuming/injecting excess amount of energy at the level of 
the transformer substation [23]. The preservation of vehicle 
owners' privacy is also considered by a smart contract that 
allows vehicles to signal their demand and receive offers by 
charging stations using predefined regions without revealing 
their exact location [24]. The integration of electric vehicles 
with blockchain technology may secure the best location and 
price for electric vehicle users and ensure security and 
privacy [25]. It proposes a secure and efficient vehicle to grid 
energy trading framework based on blockchain and edge 
computing [26]. 
The following section will show how blockchain is used 
in the Smart-MLA project to handle settlements between the 
aggregator and the prosumers.  
V. 
BLOCKCHAIN IN THE SMART-MLA PROJECT 
One of the aims of the Smart-MLA project is to 
demonstrate the use of blockchain technology for 
settlements.  The reason for including blockchain was an 
increasing interest in using blockchain for applications other 
than the pure cryptocurrency transfer. In Smart-MLA, the 
communication is between the aggregator and prosumers 
connected to the smart grid and between the aggregator and 
the DSO. 
Ethereum [27] is a further development of blockchain 
technology introducing smart contracts. Smart contracts [28] 
are self-executing programs stored on the Ethereum 
blockchain that run when some predetermined conditions are 
met. It provides the possibility to do more than transfering 
amounts between actors. For example, smart contracts can be 
used for bidding processes between prosumers and the 
aggregator and between the aggregator and the DSO. 
Smart contracts are written in the Solidity programming 
language [29], an integrated part of the Ethereum blockchain 
technology. 
The demonstration of blockchain technology for 
settlements has been done as a set of activities: 
 
● 
Setting up a local blockchain using Ganache and Remix 
● 
Writing to and reading from the blockchain using web3 
● 
Setting up a test blockchain using the Ropsten test 
network 
● 
Using Nethereum to build applications using the .NET 
framework 
● 
Making a test API for settlements 
A. Local Blockchain 
The local blockchain was implemented by using 
Ganache. Ganache provides a free Ethereum test blockchain 
network and is part of the Truffle blockchain development 
framework [30]. Figure 11 shows the Ganache graphical user 
interface (GUI) with ten accounts set up on the local 
blockchain. 
 
 
 
Figure 11.  Ganache GUI 
43
Copyright (c) IARIA, 2021.     ISBN:  978-1-61208-869-3
ICDS 2021 : The Fifteenth International Conference on Digital Society

Ganache can be accessed from the Remix integrated 
development environment (IDE) [31]. Remix facilitates the 
writing, compilation, and deployment of smart contracts 
written in the Solidity language. The combination of Remix 
and Ganache was used to test the smart contracts. The smart 
contract validates senders and receivers, uses tariffs to 
compute correct amounts to be transferred, and checks if the 
sender has the necessary amount available. 
B. Using web3 
The web3 [32] library provides access to the Ethereum 
blockchain from programs. The library may be used with 
Ganache, the Ethereum test networks (e.g., Ropsten), or the 
public Ethereum network. 
C. Using the Ropsten test network 
Ropsten is one of four Ethereum test networks listed on 
the Ethereum website [33]. Like the public Ethereum 
network, Ropsten requires payments for making transactions.  
However, coins for payment are free and requested by 
sending a Twitter message to the network operator. 
D. Using Nethereum 
Nethereum [34] is a .NET library that makes it possible 
for .NET programs to write to and read from the Ethereum 
blockchain. User interfaces, as well as application program 
interfaces, may then be written in .NET code. 
E. Test API 
Finally, a test API was made to demonstrate how 
settlements may be done in practice.  The smart meter or an 
agent talking to the smart meter writes a record to the 
blockchain about a settlement.  The blockchain can also be 
accessed from the billing service and other services doing 
statistics and monitoring. Figure 12 shows the architecture of 
the settlement service. 
 
 
Figure 12.  The settlement service 
As shown earlier, the settlement records contain the 
amount of energy, time, period, and the two entities involved 
in the transaction.  The smart contract checks the validity of 
the sender and receiver; and if the sender has the necessary 
amount available. The smart contract may also create a 
competitive environment based on bidding between the 
aggregator and prosumers and between the aggregator and 
the DSO. 
VI. 
CONCLUSIONS AND FUTURE WORK 
The Smart-MLA project has demonstrated the use of 
blockchain for a specific smart grid application – registering 
settlements between an aggregator and the prosumers 
connected to the smart grid.  The demonstration showed some 
disadvantages of using blockchain for this purpose. 
To register a transaction on the real Ethereum blockchain 
requires a transaction fee.  The current transaction fee on the 
Ethereum network is around USD 4.00 (June 2021). 
Therefore, if blockchain is used to register car owner 
transfers, the transaction fee would be negligible compared 
to the transaction itself. 
However, the settlements between the aggregator and 
prosumers will be tiny amounts.  Even if aggregated for each 
hour or even each day, the transaction fee would create a 
considerable overhead for the transactions. 
Therefore, the public Ethereum blockchain should not be 
used for transactions involving minimal payments.  Also, 
aggregation does not solve the problem since the whole idea 
of using blockchain was to achieve full transparency of all 
transactions. 
The alternative is to set up a private blockchain.  In that 
case, the fees for registering will not have a real value.  But 
the infrastructure itself, mainly servers, will have a price tag.  
Blockchain is supposed to have a large number of copies on 
a distributed network. For a private blockchain, the number 
of nodes will be limited, and the blockchain will be more 
vulnerable to security attacks. 
A traditional system of record (e.g., a relational database) 
could handle settlements in a much more efficient way. 
However, the problem with a database is the centralization of 
physical control combined with the ability to delete or modify 
records. 
The blockchain excels in being immutable and 
transparent. 
The Smart-MLA project strives to demonstrate how 
aggregators may benefit from customer flexibility. The smart 
grid may be enhanced by letting prosumers trade with each 
other through a stock-market exchange. Prosumers with 
storage capacity may compete to buy energy from other 
prosumers for future sales. This will create an internal market 
within the smart grid.  The aggregator will then have to 
compete for excess energy produced by prosumers, 
optimizing the revenues for the prosumers.  Today, the 
aggregator decides the buying price in a monopolistic way. 
An internal market within the smart grid would remove the 
monopoly of the aggregator and make a sounder competitive 
environment. 
ACKNOWLEDGMENT 
This work was supported under the ERA-Net Smart Grids 
Plus scheme Grant number 89029 and funded through the 
Research Council of Norway grant number 295750 with the 
project title "Multi-layer aggregator solutions to facilitate 
optimum demand response and grid flexibility." 
 
 
44
Copyright (c) IARIA, 2021.     ISBN:  978-1-61208-869-3
ICDS 2021 : The Fifteenth International Conference on Digital Society

REFERENCES 
 
[1] J. C. Stephens, E. J. Wilson, and T. R. Peterson, "Smart Grid 
(R)evolution – Electric Power Struggles," Cambridge 
University Press, 2015. 
[2] C. Meinecke, "Potentiale und Grenzen von Smart Metering," 
Springer VS, 2016. 
[3] M. Gough, R. Castro, S.F. Santos, M. Shafie-khah, and J. P. S. 
Catalão, "A panorama of applications of blockchain 
technology to energy," in Blockchain-based Smart Grids, M. 
Shafie-khah, Ed. Elsevier/Academic Press, pp. 5-41, 2020. 
[4] C. Liu, X. Zhang, K.K. Chai, J. Loo, and Y. Chen, "A survey 
on blockchain-enabled smart grids: Advances, applications, 
and challenges," IET Smart Cities no. 3, pp. 56-78. 2021. 
[5] Smart-MLA Consortium. Multi-layer aggregator solutions to 
facilitate optimum demand response and grid flexibility 
(Smart-MLA).  Project web site. [Online] Available from 
https://smart-mla.stimasoft.com 2021.06.01 
[6] S. Teimourzadeh et al., "Enlightening customers on merits of 
demand-side 
load 
control: 
A 
simple-but-efficient-
platform," IEEE Access, vol. 8, pp. 193238-193247, 2020. 
[7] X. Jin,  S. Teimourzadeh, O. B. Tor, and Q. Wu, "Three-Layer 
Aggregator Solutions to Facilitate Distribution System 
Flexibility," in Flexibility in Electric Power Distribution 
Networks, H. H. Alhelou, E. Heydarian-Forushani, and P. 
Siano, Eds. CRC Press, ch. 8, 2021. 
[8] S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash 
System," 2008. [Online] https://bitcoin.org/bitcoin.pdf 2021-
05-01 
[9] D. Hellwig, G. Karlic, and A. Huchzermeier, "Build Your Own 
Blockchain - A Practical Guide to Distributed Ledger 
Technology," Springer Nature, 2020. 
[10] M. Foti and M. Vavalis, "What blockchain can do for power 
grids? " Blockchain: Research and Applications, vol. 2, pp. 1-
14, 2021. 
[11] A. S. Musleh, G. Yao, and S. M. Muyeen, "Blockchain 
Applications in Smart Grid – Review and Frameworks," in 
IEEE Access, vol. 7, pp. 86746-86757, 2019. 
[12] H. Farhangi, "The path of the smart grid," IEEE Power Energy 
Magazine., vol. 8, no. 1, pp. 18-28, 2010. 
[13] Z. Dong, F. Luo, and G. Liang, "Blockchain: A secure 
decentralized trusted cyber infrastructure solution for future 
energy systems," Journal of Modern Power Systems and Clean 
Energy, vol. 6, no. 5, pp. 958-967, 2018. 
[14] W. Su and A. Q. Huang, "The Energy Internet," Sawston, 
U.K.:Woodhead Publishing, 2018. 
[15] V. Grewal-Carr and S. Marshall, "Blockchain enigma paradox 
opportunity," 
[Online] 
Available 
from 
https://www2.deloitte.com/content/dam/Deloitte/uk/Documen
ts/Innovation/deloitte-uk-blockchain-full-report.pdf 
2021.05.01 
[16] M. Andoni et al., "Blockchain technology in the energy sector: 
A systematic review of challenges and opportunities," 
Renewable and Sustainable Energy Reviews, vol. 100, pp. 143-
174, 2019. 
[17] M. Foti, C. Mavromatis, and M. Vavalis, "Decentralized 
blockchain-based consensus for Optimal Power Flow 
solutions," Applied Energy, vol. 283, 2021. 
[18] M. L. Di Silvestre et al., "Transparency in transactive energy at 
distribution 
level," 
2017 
AEIT 
International 
Annual 
Conference, pp. 1-5, 2017. 
[19] S. Noor, W. Yang, M. Guo, K. H. van Dam, and X. Wang, 
"Energy Demand Side Management within micro-grid 
networks enhanced by blockchain," Applied Energy, vol. 228,  
pp. 1385-1398, 2018. 
[20] Z. Su et al., "A Secure Charging Scheme for Electric Vehicles 
with Smart Communities in Energy Blockchain," IEEE 
Internet of Things Journal, vol. 6, no. 3, pp. 4601-4613, 2019. 
[21] M. Pustišek, A. Kos, and U. Sedlar, "Blockchain based 
autonomous selection of electric vehicle charging stations," 
Proc. 2016 International Conference on Identification, 
Information and Knowledge in the Internet of Things (IIKI); 
pp. 217-222, 2016. 
[22] J. Kang et al., "Enabling localized peer-to-peer electricity 
trading among plug-in hybrid electric vehicles using 
consortium blockchains," IEEE Transactions on Industrial 
Informatics., vol. 13, no. 6, pp. 3154-3164, 2017. 
[23] C. Liu, K. K. Chai, X. Zhang, E. T. Lau, and Y. Chen, 
"Adaptive blockchain-based electric vehicle participation 
scheme in smart grid platform," IEEE Access, vol. 6, pp. 
25657-25665, 2018. 
[24] F. Knirsch, A. Unterweger, and D. Engel, "Privacy-preserving 
blockchain-based electric vehicle charging with dynamic tariff 
decisions," Computer Science – Research and Development. 
33, pp. 71-79, 2018. 
[25] Y. Hou et al., "A resolution of sharing private charging piles 
based on smart contract," Proc. 13th International Conference 
on Natural Computation, Fuzzy Systems and Knowledge 
Discovery (ICNC-FSKD), pp. 3004-3008, 2017. 
[26] Z.Y. Zhou, L. Tan, and G. Xu, "Blockchain and edge 
computing based vehicle-to-grid energy trading in energy 
internet," Proc. 2nd IEEE Conference on Energy Internet and 
Energy System Integration (EI2), pp. 1-5. 2018. 
[27] ethereum.org [Online] Available from: https://ethereum.org 
2021.06.01 
[28] D. Rossbach, "Smart Contracts in Blockchain," Amazon, 2018. 
[29] M. Mukhopadhyay, "Ethereum Smart Contract Development," 
Packt Publishing, 2018. 
[30] N. Bhaskar, "Truffle Quick Start Guide," Packt Publishing, 
2018. 
[31] ethereum.org 
[Online] 
Available 
from 
https://remix.ethereum.org 2021.06.01 
[32] Web3js 
[Online] 
Available 
from 
https://web3js.readthedocs.io/en/v1.3.4/ 2021.06.01 
[33] ethereum.org 
[Online] 
Available 
from 
https://ethereum.org/en/developers/docs/networks/ 2021.06.01 
[34] nethereum.com 
[Online] 
Available 
from 
https://nethereum.com 2021.06.01 
45
Copyright (c) IARIA, 2021.     ISBN:  978-1-61208-869-3
ICDS 2021 : The Fifteenth International Conference on Digital Society

