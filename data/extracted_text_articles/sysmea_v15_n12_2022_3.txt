 
 
 
 
  
 
Stock Trade Simulation Using an Average Based Trend Indicator  
with Heuristic Enhancements 
Yoshihisa Udagawa  
Faculty of Informatics, Tokyo University of Information Sciences 
Chiba-city, Chiba, Japan 
e-mail: yu207233@rsch.tuis.ac.jp 
 
 
Abstract— The spread of Covid-19 is making a serious impact 
on the world economy. As policies to maintain economic 
activities have been implemented in a timely manner, many 
stock markets have regained their stock prices to pre-Covid-19 
pandemic levels. This paper describes results of statistical 
analyses of stock price fluctuations in the vicinity of the 
declaration of a state of emergency following the Covid-19 
pandemic. Daily historical data concerning Dow Jones 
Industrial 
Average 
(DJIA), 
Nasdaq 
Composite 
Index 
(NASDAQ), France Stock Index (CAC), German Stock Index 
(DAX), Shanghai Composite Index (SSEC) and Nikkei Stock 
Average (Nikkei) are used for stock trade simulations. The 
results show that these stock prices plunged for approximately 
20 days before the trading day that marked the lowest price, 
and increased for the following 25 days. Through the analyses 
of the results, a technical indicator defined by the difference 
between a stock price and the moving average is devised to 
predict stock price trend reversals. A stock trade simulator is 
developed using the devised indicator to examine the degree of 
stock price prediction. The simulator is enhanced by heuristics 
using candlestick patterns to avoid large losses. Experimental 
results using ten years of stock price data from nine world 
major stock markets show that the simulator achieved the 
success rate of up to 74% with trade fees for purchasing a 
stock. Meanwhile, the success rate remains within 25% for 
selling a stock, because a margin loan for borrowing a stock 
squeeze profits. Although the developed simulator has some 
limitations, it provides a tool for measuring profitability 
among stock markets and analyzing a stock trade opportunity 
that leads to a significant profit and/or loss. 
 
Keywords— Covid-19 pandemic; Technical analysis; Global 
market comparison; Candlestick chart pattern, APAD. 
 
I. 
 INTRODUCTION 
This research paper is based on the previously reported 
contribution on analyses of the impact of Covid-19 pandemic 
on global stock prices [1]. More than two years have passed 
since the first Covid-19 pandemic was confirmed. But the 
spread of coronavirus is still continuing and the number of 
daily corona cases remains high. The spread of Covid-19 is 
forecasted to have a significant adverse impact on the global 
economy. While the global real Gross Domestic Product 
(GDP) grew by 2.9 percent in 2019, it was projected at –4.9 
percent in 2020 grew [2]. The Covid-19 pandemic had a 
more negative impact on activity in the first half of 2020 
than anticipated. Global growth was projected at 6% in 2021, 
moderating to 4.4% in 2022. While the vaccine is expected 
to be effective for economic recovery, there are concerns 
about the impact of the zero-tolerance Covid-19 policy in 
China [3]. 
World stock markets experienced a large crash in the first 
quarter of 2020. Concerns about a further plunge of stock 
prices prevailed over global markets. However, due to the 
economic policies of each country, stock prices of world 
markets have turned from falling to rising in Mar. 2020. 
Because it is rare for the major world stock price indexes to 
fall all at once and then recover, we expect to deepen our 
understanding of stock price movements and to find an 
indicator for signaling stock price trend reversals by 
analyzing stock price fluctuations regarding the declaration 
of a state of emergency on Covid-19 pandemic. 
It can be easily inferred that there is a difference in the 
degree of collapse and recovery reflecting the situation in 
each country. What is missing is a comparison of the stock 
price fluctuations of world markets from a statistical point of 
view. This study discusses a comparison of representative 
stock indexes of the U.S., European, and Asian markets [4]. 
Specifically, we focus on Dow Jones Industrial Average 
(DJIA), Nasdaq Composite Index (NASDAQ), France Stock 
Index (CAC), German Stock Index (DAX), Shanghai 
Composite Index (SSEC), and Nikkei Stock Average 
(Nikkei). Daily historical data are used for the research. 
Dimson et al. [5] recommend investing in the U.S. 
markets rather than emerging ones because of the growth 
rate of stock prices and the stability of the investment 
environment. Reference [6] compares profitability of the U.S. 
and Asian markets by simulations that find buy-timing using 
a candlestick pattern model consisting of six parameters. The 
results of the simulation shows that the profitability of the 
U.S. markets outperforms other markets. However, these 
studies were carried out before the spread of the Covid-19 
coronavirus.  
Ngwakwe [7] estimates how Covid-19 pandemics affected 
world stock indexes, i.e., Euronext 100, SSEC, DJIA, and 
S&P500. The results of analyses show that SSEC has 
resilience to Covid-19 pandemic with profit in stock values 
during the first fifty days into the pandemic, while the other 
indexes experience adverse impact from the Covid-19 
pandemic with a significant loss at that time period. All stock 
indexes experience a higher variability or fluctuation of stock 
market prices. 
20
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
Verma et al. [8] statistically analyze the impact of the 
Covid-19 outbreak on global economic development. The 
indicators used in the analyses include S&P500 stock index, 
crude oil, gold, and 20-year treasury bond. They find that 
S&P500 stock index experiences high uncertainty from Feb. 
2019 to Apr. 2020, i.e., the latest month of their research. 
Buszko et al. [9] deal with the problem of stability of stock 
prices during the Covid-19 pandemic. The K-means and the 
Ward clustering methods are applied to the Warsaw Stock 
Exchange (WSE), which is one of the most important 
markets in the Central and Eastern European countries 
(CEE). The paper proposes several indicators describing the 
stability of stock price fluctuations, and concludes that the 
indicators defined in terms of profitability, volume, and 
volatility leads to much better results than other indicators. 
This paper has two purposes. One is to analyze stock price 
fluctuations of approximately 245 trading days, or 
approximately one year, before and after the declaration of 
Covid-19 pandemic, and statistically compare degrees of 
impact on the world markets [1]. Through the analysis, we 
have devised an indicator for signaling a change of the 
direction of a price trend. The other purpose of this paper is 
to give definition of the devised indicator, and to discuss its 
prediction accuracy in terms of profits with experimental 
results using major global stock market’s daily price data. 
Obthong et al. [10] review studies on machine learning 
techniques and algorithms employed to improve the accuracy 
of stock price prediction. Of the ten studies compared, four 
show that prediction accuracies range from 54.41% to 
90.19%. Islam et al. [11] show a comparative study for stock 
price prediction using three different methods, namely 
autoregressive 
integrated 
moving 
average 
(ARIMA), 
artificial neural network (ANN), and geometric Brownian 
motion. Empirical results using S&P500 index show that the 
conventional statistical model ARIMA and the Brownian 
motion model provide better approximation than the ANN 
model for next-day stock price prediction. 
Stock trading consists of selling and buying pairs, and 
profits are fixed. What is lacking in these studies is 
experimental evaluations in terms of profits. Since an 
important objective of stock investment is to make a profit, a 
profit-focused evaluation is inevitable for the sake of traders. 
We come up with the idea of developing a simulator that 
implements both sell and buy timing, and performing 
experiments using global stock market data to examine the 
effectiveness of the simulator. 
The findings of this research are as follows: 
I. The extent of the stock market plunge and recovery at the 
time of the pandemic declaration is examined using daily 
stock data of the six major markets. All markets show 
uptrend reversals in stock prices within four business 
days, i.e., Mar. 18 to 23, 2020. 
II. The stock price best recovered in NASDAQ, followed by 
Nikkei and DJIA. Stock price recoveries in European 
markets lag behind that of U.S. and Asian markets. 
III. It is found that the trajectory of 25-day average of 
difference between a stock price and the 5-day average 
reverses on the lowest price day. We propose an indicator 
to predict trend reversal named APAD, an acronym for 
“Average of Price and 5-day Average Difference.” We 
developed stock trading simulators that use the APAD 
indicator to find trade opportunities and to measure the 
degree of profit. 
IV.  The simulator is enhanced by heuristics using 
candlestick chart patterns. A series of enhancements 
improves the success rate of simulated stock trades by 
approximately 8.5% in a long position. The results of 
experiments on ten years of stock price data from nine 
major markets in the world show that the simulators 
achieve the success rate of up to 74% with trade fees in a 
long position, while the success rate stays within 25% in 
a short position because a margin for borrowing a stock 
squeeze profits. 
The remainder of the paper is organized as follows. 
Section II gives the background of the candlestick chart and 
introduces 
indicators 
that 
characterize 
stock 
price 
fluctuations. Section III shows the extent of stock price 
plunges and recoveries regarding the Covid-19 pandemic 
declaration. Section IV statistically examines the indicators 
for characterizing stock price fluctuations. Section V deals 
with the development of the stock trade simulator using a 
devised indicator named APAD, and the enhancement of the 
simulator using candlestick pattern heuristics. Section VI 
concludes the paper with our plans for future work. 
 
II. 
CANDLESTICK CHART AND PRAMETERS 
This section introduces formations of a candlestick chart. 
The candlestick attributes to be analyzed are identified. 
A. Formation of Candlestick 
As depicted in Figure 1, a daily candlestick is formed 
with the market’s opening, high, low, and closing prices of a 
specific trading day [12][13]. The candlestick has a wide 
part, which is called real body representing the range 
between the opening and closing prices of the day of trading, 
as shown in Figure 1. The color of the real body represents 
whether the opening price or the closing price is higher. If 
the price rises, a hollow body is drawn suggesting bullish or 
buying pressure. Otherwise, a filled body is drawn 
suggesting bearish or selling pressure. 
 
 
Figure 1. Candlestick formation. 
 
The thin lines above and below the body, which are 
named shadows, represent the range of prices traded in a 
21
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
day. The high is marked by the top of the upper shadow and 
the low by the bottom of the lower shadow. 
B. Candlestick Chart and Parameters 
A candlestick chart is a graph in which candlesticks are 
arranged in order of market dates. It is used as a tool to get 
information on whether the current price is higher or lower 
than the historical stock price movements, and what kind of 
price movements have been made in a certain period of time. 
Moving averages form a line graph by connecting the 
average of closing prices over a certain period of time. The 
line graph is useful to decide whether stock prices are in a 
rising or falling trend by considering the relative position 
between the current stock price and the moving average. As 
for periods of time to compute averages, each country uses 
its own periods. For example, the short-term average is 
often calculated for 5 days, the medium-term average is for 
25 days, and the long-term average is for 75 days in Japan.  
Figure 2 illustrates indicators including the averages that 
formalize a candlestick chart. In accordance with the 
candlestick chart notation, the following six attributes or 
indicators are used for analysis. 
 
 
Figure 2. Candlestick chart and its parameters. 
 
(1) Amount of stock price change (the difference between 
a stock’s closing price on a trading day and its closing 
price on the previous trading day) 
(2) Length of candlestick body 
(3) Length of upper shadow 
(4) Length of lower shadow 
(5) Difference between the stock price of a trading day and 
the 5-day moving average 
(6) Difference between the stock price of a trading day and 
the 25-day moving average 
 
III. 
STOCK PRICE PLUNGE AND RECOVERY  
REGARDING COVID-19 PANDEMIC 
This section describes the process of data analysis to 
follow how this research is performed. Stock price 
fluctuations of the six markets are compared with the ratio of 
the stock price to the lowest stock price to measure impacts 
of Covid-19 on each market. 
A. Data Analysis Process 
Figure 3 overviews the data analysis process in this 
research that consists of the following operations. 
(1) Downloading daily historical data from a Web site, 
(2) Calculating the six attributes mentioned in Section II, 
(3) Extracting price data around the lowest price during 
Covid-19 pandemic, 
(4) Calculating the average and standard deviation of the 
six attributes. 
 
 
Figure 3. Overviews of data analysis process. 
 
Among the sites that provide global stock data, the Web 
site [4] provides daily stock data for more than 10 years in 
more than 40 markets. All data used in the research are 
downloaded manually from the site. 
Because the daily stock data only consist of close, open, 
high, low prices, and volume of stock trading, Java programs 
are developed for performing operations 2) to 4), and 
visualizing the candlestick chart. Excel is used for 
visualizing data of 3) and 4) in graphs. 
B. Comparison of Stock Price Fluctuations 
In order to understand overall structures of stock price 
fluctuations, we compare the stock price ratios to the lowest 
price that was recorded in Mar. 2020. Let CPr[n] be the 
closing price of a trading day n, and CPrMin be the lowest 
closing price recorded in Mar. 2020. The price ratio 
PrRatio[n] is calculated by the following formula; 
 
PrRatio[n]= (CPr[n] – CPrMin) * 100 / CPrMin 
(1) 
 
Figure 4 is a graph of the price ratio of the six markets’ 
stock prices to the lowest ones for 490 days, or 
approximately two years before and after the lowest. The 
lowest prices were recorded on one of the four business days 
from Mar. 18 to 23, 2020. Although the date of the lowest 
price slightly varies from market to market, stock prices 
continued to rise after hitting the lowest price in all markets. 
22
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
 
Figure 4. Ratio of stock index compared to the lowest price. 
 
Table I summarizes the stock price profiles compared to 
the lowest price. The lowest prices have been recorded from 
Mar. 18 to Mar. 23 in the six markets under comparison. 
Since Mar. 22, 2020 is Sunday, they show that the stock 
trends reversed from downtrend to uptrend in just 4 trading 
days in the six markets. The degree of plunge is 63.34% in 
DAX (Germany), followed by 62.76% in CAC (France), and 
58.95% in DJIA (US), as shown in the column “Highest 
price before Covid-19 pandemic.” The lowest decline was of 
22.95% in SSEC (China). 
 
TABLE I. SUMMARY OF STOCK PRICE INDICATORS  
COMPARED TO THE LOWEST PRICE 
 
 
A matter worthy of note is the degree of recovery from 
the lowest price. NASDAQ achieves the finest recovery of 
62.36% rise as the highest price ratio after the Covid-19 
pandemic is 105.45%, and the highest one before the 
pandemic is 43.09%. Following NASDAQ, Nikkei (Japan) 
comes back by 38.57% rise. The slowest recovery is 
recorded –1.73% in CAC, followed by 9.25% in DAX. 
From the stock price movements of the two markets, it can 
be inferred that the impact of the Covid-19 pandemic in 
Europe is larger than the other regions. 
 
IV. 
COMPARISON OF INDICATORS REGARDING  
STOCK PRICE FLUCTUATIONS 
This section presents the results of comparisons of the six 
indicators introduced in Section II with respect to the 
average and standard deviation in statistics. In order to 
compute the meaningful standard deviation, we calculate the 
average and standard deviation of the past 25 days [14] 
including the reference trading day. This period is 
commonly used for the calculation of the six attributes of a 
candlestick. 
A. Amount of Stock Price Change 
Figure 5 shows a graph of the 25-day moving averages 
and standard deviations of price changes of each stock 
market. As seen at the center part of Figure 5, the averages 
(in solid lines) of stock price changes plummet during 
approximately 20 days before the lowest trading day, i.e., 
around Feb. 20, 2020 in the five markets excluding SSEC. 
Stock price averages rally for approximately 25 days after 
the bottom, i.e., around Apr. 24, 2020.  
The standard deviations (in dashed lines) over this period, 
also increase in the range of 3.5 to 6 times of those of the 
other period reflecting the high volatility of price 
movements. 
 
 
Figure 5. Average and standard deviation of price change. 
 
Taking a closer look at the standard deviations, DJIA 
reaches the maximum of 6.00%, followed by NASDAQ of 
5.47%, CAC of 4.56%, DAX of 4.54%, Nikkei of 3.53%, 
and SSEC of 2.14%, which is considered to reflect the 
strength of the impact on each market. The standard 
deviations of each market have roughly doubled after the 
lowest price, i.e., the right part, compared to those before 
the lowest price, i.e., the left part, which suggests that 
unstable trading has continued for roughly 180 days after 
the lowest price day. 
B. Length of Candlestick Body 
Figure 6 shows the 25-day averages and standard 
deviations of the candlestick body lengths of the six stock 
markets. Figure 6 shows that the averages of SSEC are 
positive (plus) during the plunge period (–20 to 0), which 
means stock prices increase on average within a market day. 
The 25-day average of candlestick body lengths in 
NASDAQ is almost zero level during the plunge period. 
NASDAQ has consistently positive average during the 
period of stock price recovery (0 to 25), which means that 
the stock price continued to rise during trading hours. The 
four other markets experience remarkable negative averages, 
e.g., –1.39% in CAC, –1.15% in DAX, –0.967% in Nikkei, 
and –0.83% in DJIA at the lowest, suggesting that colored 
candlesticks are prominent. 
23
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
 
Figure 6. Average and standard deviation of candlestick body length. 
 
The largest standard deviation of 3.36% is marked in 
DJIA, followed by 3.07% in NASDAQ, 2.73% in Nikkei, 
2.54% in CAC, 2.44% in DAX, and 1.85% in SSEC. Trends 
of the average and standard deviation of SSEC are notably 
different from the other markets. 
C. Length of Upper and Lower Shadows 
Figures 7 and 8 illustrate the 25-day averages and 
standard deviations of the lengths of the upper and lower 
shadows. The two figures look similar, revealing that the 
lengths of upper shadows are apparently correlated with 
those of the lower shadows. 
 
 
Figure 7. Average and standard deviation of upper shadow length. 
 
 
Figure 8. Average and standard deviation of lower shadow length. 
 
In the five markets excluding SSEC, the averages and 
standard deviations of the upper and lower shadows increase 
sharply during the period from approximately 10 days 
before the lowest price to approximately next 25 days.  
Notably in the European markets of DAX and CAC, both 
the averages and standard deviations have surged about six 
times after the lowest price compared to these before the 
lowest price for the upper shadows, and about eight times 
for the lower ones. Those surges mean that rough price 
movements occur during the period. 
On the other hand, the Asian market is relatively stable. 
In SSEC, the averages and standard deviations are doubled 
after the lowest price than before for the upper shadows, and 
are tripled for the lower ones. Nikkei marks about three 
times higher for the upper shadows, and about five times 
higher for the lower ones. 
Figure 9 is a scatter plot of the lengths of upper and lower 
shadows in the Nikkei market. It illustrates that there is a 
strong correlation between the lengths of the upper and 
lower shadows. 
 
 
Figure 9. Scatter plot of upper and lower shadow length of Nikkei. 
 
The points surrounded by an ellipse correspond to the 
shadows that occur in the period between approximately 10 
days before and approximately 25 days after the lowest 
price. These points occupy a different portion of Figure 9 
from the rest of the points. R-squared (R2) in statistics is 
0.8422, which indicates that 84.22% of the upper shadow 
length can be explained by the lower shadow length, and 
vice versa. 
D. Difference Between Stock Price and 5-day Average 
Figure 10 shows the 25-day averages and standard 
deviations of the “difference between a stock price and 5-
day moving average” for the six markets. The 25-day 
averages of the difference sharply decrease about 20 days 
before the lowest price, and sharply increase until 25 days 
after the bottom. 
The standard deviation increased more than fourfold in 
the five markets except SSEC, during the period from about 
20 days before the lowest price to 25 days after the lowest 
price. High standard deviation around 2% continues in all 
24
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
markets nearly 80 days after the day recorded the lowest 
price. 
 
 
Figure 10. 25-day average and standard deviation of “difference between 
stock price and 5-day average.” 
 
In the five markets excluding SSEC, the day when the 25-
day average of the “difference between a stock price and 5-
day moving average” reverses the trend from downward to 
upward roughly coincides with a day when the stock price 
bottoms out. As for the standard deviations, they remain 
high in the five markets except SSEC for the 20 days 
following the lowest day. 
We investigate how the period for calculating the average 
of the “difference between a stock price and 5-day moving 
average” relates to the timing of the stock price reversal. 
Figure 11 shows the P-day average of the “difference 
between the 5-day average and the stock price” in 
NASDAQ, where P is 8, 12, 18, 25, 30, and 35. When P is 
12, 25, 30, and 35, the date when this average is at its 
minimum coincides with the date when the stock price is at 
its lowest. When P is 8 and 18, the P-day average begins to 
rise two days before the lowest price. 
 
 
Figure 11. P-day average of “difference between stock price  
and 5-day average” in NASDAQ. 
 
Figure 12 shows the results using Nikkei 225 stock data. 
When P is 12 and 18, the minimum value of the P-day 
average coincide with the day when the stock price reached 
its lowest price. On the other hand, when P is 25, 30, or 35, 
this average reached its minimum value on the next day 
when the stock price reached its lowest value. 
 
 
Figure 12. P-day average of “difference between stock price  
and 5-day average” in Nikkei. 
 
Although there are slight differences from stock market to 
market, this average can be used to predict a stock price 
reversal with an error of less than one day if P is greater 
than 25. This is an important finding and detailed analyses 
are discussed in Section V. 
 
E. Difference Between Stock Price and 25-day Average 
Figure 13 shows the 25-day averages and standard 
deviations of the “difference between a stock price and 25-
day moving average” for the six markets. This indicator 
shows a minimum value 4 to 14 days after the lowest stock 
price in the six markets, which indicates that this indicator is 
too slow to predict a stock trend reversal. 
 
 
Figure 13. 25-day average and standard deviation of “difference between 
stock price and 25-day average.” 
 
Again, in the five markets excluding SSEC, the averages 
and standard deviations fluctuate largely during a period 
between approximately 20 days before the day of the lowest 
price and the following 25 days. 
The standard deviation increased more than fivefold in 
the five markets except SSEC. Standard deviation close to 
25
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
4% continues in all markets nearly 80 days after the lowest 
price day. 
 
V. 
DEVELOPING STOCK TRADING SIMULATOR  
In this section, we propose a new trend reversal indicator 
based on the analysis described in Section IV. The 
definition of the indicator, and the configuration of stock 
trading simulators using the indicator are described. Stock 
trading simulation are performed using nine markets around 
the world for ten years. The results of the simulation are 
analyzed in terms of profits. 
A. Trend Reversal Indicator APAD 
As mentioned in Section IV-D, the 25-day average of 
“difference between a stock price and 5-day moving 
average” starts to rise just after the day when the lowest 
price is recorded. Based on the results of the analysis, we 
propose a trend reversal indicator named APAD, i.e., an 
acronym for “P-day Average of stock Price and N-day 
Average Difference.” Generally, APAD is defined using 
two parameters, P and N. P and N are arbitrary periods of 
market day. 
Let CPr[D] be the closing price of a trading day D, and 
CPr[1] represent the most recent trading day as defined in 
(1). Let PAD (D, N) represent a ratio of the difference 
between the closing price and the N-day average of a market 
day D to the closing price as defined by the following 
formula: 
 
 
 
APAD (D, N, P) is defined as the P-day average of PAD (D, 
N) as follows: 
 
 
 
Based on examination of Figure 10 through 12, N and P is 
set to five for calculating the fast APAD. P is set to twenty-
five for the slow APAD as defined by the following 
formulas: 
 
Fast APAD: APAD (D, 5, 5) 
 
 
(4) 
 
Slow APAD: APAD (D, 5, 25) 
 
 
(5) 
 
Since the APAD is a percentage price oscillator (PPO) 
[12] that calculates a difference relative to a closing price, 
the APAD can be applied to compare the world’s major 
stock markets. 
Figure 14 illustrates the candlestick chart for 30 days 
before and after Mar. 18, 2020 in the DAX market. The top 
three-quarters of this figure are used to draw candlesticks 
and the rest is used to draw the APDAs.  
The vertical lines in magenta color, usually centered, 
indicating the day of interest. Candlestick charts are 
displayed with 5-day and 25-day averages, in accordance 
with Japanese stock market conventions. APADs are shown 
in the lower one-quarter of Figure 14. The magenta line 
shows the fast APAD (D, 5, 5), and the blue line shows the 
slow APAD (D, 5, 25). 
 
 
Figure 14. Candlestick chart for 30 days before and after  
Mar. 18, 2020 in DAX market. 
 
The proposed two APAD lines go across up on Mar. 20, 
i.e., the two days after the lowest price is recorded. The two 
lines do not crossover on Mar. 5, which means to predict 
that stock prices will continue to fall. In other words, a 
short-term recovery from Feb. 28 to Mar. 5 is a “dead cat 
bounce,” i.e., a temporary recovery of stock prices during a 
prolonged decline period. 
The two lines also do not crossover during the decline 
from Mar. 27 to April 3, which suggests that Apr. 3 is a 
“buying on the dips” type of opportunity since the slopes of 
the fast and slow APAD lines increase on Apr. 3. The 
magenta line crosses down through the blue line on Apr. 17. 
However, the slope of the slow APAD is positive on Apr. 
17, which indicates that the uptrend of the stock price is 
continuing in the medium term of 25 days. During periods 
when the slope of the slow APAD is positive, no action 
should be taken for a down trend. 
Similar results have been obtained in the other markets. 
Regarding recovery from the plunge caused by Covid-19 
pandemic, it is confirmed that the fast and slow APAD lines 
forecast short-term trends properly. 
B. System Configuration for Stock Trading Simulator 
Figure 15 shows the configuration of stock trading 
simulators developed in this study. The CSV files storing 
the stock prices are manually downloaded from the global 
Web site [4]. Read_CSV_Data is a Java program that 
converts the CSV file into an in-memory data store. The 
data store provides all the data needed for analyses, 
including the price change, the body length of a candlestick, 
the moving average of stock prices, and the APADs, etc. 
A Java program named T2L (Trade Tracker for a Long 
position) is a simulator that tracks buying opportunities 
using APADs, and virtually performs stock trade in a long 
26
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
position. Meanwhile, a program named T2S (Trade Tracker 
for a Short position) is a simulator for a trade in a short 
position. T2L and T2S are independent programs, each 
generating a log file for further analysis using a spread sheet 
tool including Excel. A program named GUICC (GUI for 
Candlestick Chart) is a tool for drawing candlesticks, the 
moving averages and the APADs, etc. and is used to draw 
candlestick charts, e.g., Figure 14. 
 
 
Figure 15. Configuration of developed stock trading simulator. 
 
In the downloaded CSV file, the most recent stock prices 
are stored at the beginning of the file. Read_CSV_Data 
reads data from the beginning of the CSV file and stores the 
data in an internal array while maintaining the order. For 
example, the opening price stored in the CSV file is stored 
in an array named Open[] with the double data type. 
Open[1] memorizes the opening price of the most recent 
trading 
day. 
Since 
the 
NASDAQ 
market 
trades 
approximately 254 days per year, the opening price of the 
NASDAQ market ten years ago is stored in the vicinity of 
Open[2540]. An array named Mday[] with the int data type 
is used for storing market dates in integer, e.g., 20220430 to 
indicate Apr. 30, 2022. 
Figure 16 shows the basic structure of the developed 
simulator. The stock market to be analyzed corresponds to 
the name of the CSV file, e.g., NASDAQ.csv for NASDAQ 
composite index. Read_CSV_Data method reads the data 
from the specified CSV file. A method named FindIndex is 
a method that takes a market date as an argument and 
converts it to an index of an internal array. 
 
 
Figure 16. Basic structure of developed simulator. 
 
In this study, the start and end dates of the simulation are 
May 1, 2012 and Apr. 30, 2022, respectively. The variables 
IndexFrom and IndexTo store the indices of the internal 
array corresponding to the dates. These two variables are 
used as arguments of the T2L and T2S methods that perform 
simulations. 
 
C. Tracking Buy Opportunities using APAD 
1) 
Overall Algorithm for Buying Simulation 
Figure 17 shows the overall algorithm for the buying 
simulation. The T2L method has two parameters, i.e., 
IndexFrom and IndexTo. The parameter IndexFrom 
specifies the start date of a simulation. Strictly, the value of 
IndexFrom is the index value of arrays corresponding to the 
start date. Similarly, the parameter IndexTo specifies the end 
date of a simulation. 
 
 
Figure 17. Overall simulation algorithm in long position. 
 
When flg < 0 & Buy_Signal_B is True, the process of 
trading in a long position is started: 
• Set the variable traded_p, which indicates the trading 
price of the stock, to the average of the opening and 
closing prices. 
• Set the variable holding_day_cnt, which presents the 
number of days to hold a stock, to 0.  
• Set the variable flg to 1 for indicating a trade in a long 
position. 
Buy_Signal_B is a conditional expression that signals the 
start of a buy, and is defined using the APADs and 
candlestick patterns. The details are described in the 
following subsections. 
 
When flg > 0 & Sale_Signal_B is True, the trade is closed. 
• Set the profit of the trade to the variable diff using the 
expression: diff = ((Open[j] + Close[j]) / 2) – 
traded_p – buying_cost. 
• Set the cumulative profit to the variable profit using 
the substitution expression profit= profit + diff. 
• Set the variable flg to –1 to indicate the state for 
tracking buy opportunities. 
27
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
Sale_Signal_B are conditional expressions that suggests 
the end of a buying stock. The details are discussed in the 
following subsection. Buying_cost is a fee of cash trade, and 
is defined in the following Subsection 4). 
2) Criteria for buying stock in long position 
As observed in Section V-A, the good timing to buy stock 
is occurred when the slope of the fast APAD is positive or 
when the fast APAD crosses the slow APAD above it. 
Let APAD_F[j] be the fast APAD of a trading day j, and 
APAD_S[j] be the slow APAD. The larger the value of 
variable j, the more it represents the past, so j+1 indicates 
stock data of one market day earlier. 
The Buy_Signal_B is defined as follows: 
 
Buy_Signal_B= (b1 | (b2 & b3)) & b4; 
 
(6) 
 
b1= APAD_F[j] – APAD_F[j+1] > 0; 
 
(7) 
 
b2= APAD_F[j+1] – APAD_S[j+1] < 0; 
 
(8) 
 
b3= APAD_F[j] – APAD_S[j] > 0;  
 
(9) 
 
The Boolean variable b1 shows that the slope of the fast 
APAD is positive. B2 and b3 mean that the fast APAD goes 
across up the slow APAD. 
To improve the success rate in stock price simulation, it is 
necessary to reflect the characteristics of stock price 
fluctuations on the day of stock trading. Let Pchg[j] be the 
ratio of price increase, and Pbody[j] be the ratio of 
candlestick length to the closing price in percentages, 
respectively. The formula b4 including parameter values of 
0.15 and 0.40 is determined by a parameter tuning through 
experiments using the NASDAQ stock data. 
 
b4= Pchg[j] > 0.15 & Pbody[j] > 0.40; 
 
(10) 
 
The Boolean variable b4 means that the stock price rises 
on the day. The Boolean expression (6) must be True to 
begin the simulation in a long position. 
3) Criteria for selling stock in long position 
The accuracy of predicting a stock decline is generally 
less accurate than the accuracy of predicting its price 
increase [15]. Because of the difficulty of the prediction, we 
must rely on heuristics. The Boolean condition Sale_Signal 
_B in Figure 17 consists of several Boolean expressions that 
are derived by experiments using APAD and candlestick 
attributes. Specifically, Sale_Signal_B is defined as follows: 
 
Sale_Signal_B= b11 & ((b12 & b13 & b14 & b15) | b16);
 
(11) 
 
Let Avg5[j] be the 5-day average of stock price of a 
trading day j. The Boolean variable b11 is defined by the 
following expression, which indicates that the difference 
between the stock price and the 5-day moving average is 
less than 2%, which means that the stock price is close to 
the 5-day average. 
 
b11= (Close[j] – Avg5[j]) * 100/ Close[j] < 2.0; 
(12) 
The variables b12, b13, and b14 are conditions regarding 
APAD. The variable b12 is defined by the following 
expression, which indicates that the slope of the fast APAD 
for the previous day of the stock trade is positive. 
 
b12= (APAD_F[j+1] – APAD_F[j+2]) > 0.0; 
(13) 
 
The variable b13 is defined by the following expression, 
which indicates that the slope of the fast APAD on the 
trading day is negative. 
 
b13= (APAD_F[j] – APAD_F[j+1]) < 0.0;  
(14) 
 
The variable b14 specifies the slope of the slow APAD is 
negative, which indicates that stock prices are falling in the 
medium term of 25 days. 
 
b14= (APAD_S[j] – APAD_S[j+1]) < 0.0;  
(15) 
 
The variables b15 and b16 are conditions related to stock 
price fluctuations on the day of stock trading. The variable 
b15 is defined by the following formula, which specifies 
that the ratio of candlestick length to the closing price on the 
day is less than 0.3%, suggesting a bearish candlestick. The 
value of 0.3% is determined thorough experiments. 
 
b15= Pbody[j] < 0.3; 
 
 
 
(16) 
 
The variable b16 is calculated by the following formula, 
which indicates that if the stock price on the day is 0.2% 
lower than the traded price, the stock should be sell back.  
 
b16= ((Open[j] + Close[j]) / 2 – traded_p) *100 
/ traded_p < – 0.2; 
 
(17) 
 
B16 represents the degree of tolerance for loss. The 
tolerance values closer to zero gives better results in terms 
of profit, which suggests that traders in practice should be 
rigorous in losses. 
 
4) Calculating fee of cash trade 
Purchasing shares comes with trading fees. The stock 
trading with the lowest fee is offered by an online trading in 
a long position. A trading in a long position is initiated with 
the purchase of a stock in anticipation that its value will rise 
over time. The trading fees vary across brokers and an 
amount of a stock trade. Table II summarizes trading fees of 
some popular Japanese online brokers. This study assumes 
the trading fee is 0.1% of the traded stock price due to the 
fact that the fee is applicable to the trade with an amount 
between 1M JPY ( ≒ US$7,500) and 3M JPY ( ≒
US$22,500). 
 
TABLE II. TYPICAL TRADING FEES OF JAPANESE ONLINE BROKERS 
 
28
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
The following formula is used to calculate the fee in this 
study. 
 
buying_cost= traded_p * 0.001; 
 
 
(18) 
 
The T2L method performs simulations with and without 
fees in a long position. 
 
5) Experimental results using NASDAQ historical data 
Experiments using NASDAQ daily data are performed to 
confirm the profit characteristics of trading with the APADs. 
The period of the experiment is ten years, strictly between 
May. 1, 2012 and Apr. 30, 2022. Table III shows a sample 
of logging data in a long position. The log data include pairs 
of stock buy and sale dates, profits generated on each stock 
trade. Cumulative profit can be calculated by summing 
profits and can be used for drawing the cumulative profit 
graph shown later. Pairs of holding days of a stock and 
profits are used to draw scatter plots. 
 
TABLE III. SAMPLE OF STOCK TRADE LOG DATA. 
 
 
Table IV shows the total profits for the combination of 
parameters P and N of APADs using NSADAQ daily stock 
price data. The largest profit of US$20,940.8 is recorded 
when N is 3 and P is greater than or equal to 12. The second 
largest profit of US$20,641.4 is recorded when N is 5 and P 
is greater than or equal to 15. It is worth noting that profits 
are greater when N is an odd number than when it is an even 
number. 
 
TABLE IV. SIMULATED PROFITS REGARDING APAD PARAMETERS P AND N 
 
Table V shows the number of trades for the combination 
of parameters P and N. In general, the number of trades 
decreases as the parameter N increases, which means that 
values of APAD (D, N, P) are less sensitive to individual 
stock price fluctuations. For the parameter P being greater 
than or equal to 15, the number of trades is 355 when 
parameter N is 3, and 276 when parameter N is 5. The 
number of trades is 22.2% lower for parameter N of 5 than 
for parameter N of 3. This indicates that a value of 5 for the 
parameter N is more suitable than a value of 3 in terms of 
the number of trades, although slightly less profitable. In the 
following experiments, the value of the parameter N is set to 
5 and the value of the parameter P is set to 25, which is 
consistent with the usage of moving average practice in 
Japan. 
 
TABLE V. TRADE COUNTS REGARDING APAD PARAMETERS P AND N 
 
 
Figure 18 depicts the cumulative profits and the cumulative 
fees. The simulator generates profits in all periods since 
cumulated profits exceed cumulated fees. As the graph 
shows, the simulated profit can be divided into three periods 
according to the degree of profit. The first period is from the 
beginning of the simulation to the day of the lowest price, 
indicated by the arrow ⇧, i.e., approximately Mar. 23, 2020. 
The simulator makes an average profit of about $43.87 per 
trade including fees.  
The second period is from the date of the lowest price to 
the date about a year later, indicated by the arrow ⇩. The 
simulator earns an average profit of $257 per trade including 
fees. The last period is from the last day of the second period 
to April 30, 2022, i.e., the last day of the simulation. The 
simulator generates an average profit of about $157 per trade 
including fees.  
The average profit in the second period is noticeably larger 
than those in the other periods, which suggests an impact of 
monetary policy. Trades in the vicinity marked by the arrow 
⇧ result in a loss of approximately US$900, which motivates 
us to improve the simulator. 
Linear regression formulas with the R-squared are added 
near the line graphs. R2 is a statistical measure of how 
closely the data are fitted to the regression line. All R2s are 
greater than 0.9351, which indicates that the developed 
simulator makes profits in proportion to the number of trades 
throughout the simulation period. 
29
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
 
Figure 18. Cumulative profit and cumulative fee in long position. 
 
Figure 19 is a scatter plot of all trades in a long position 
with the fee using the NASDAQ historical stock data. The 
lower left point in Figure 19 corresponds to the trade with 
the largest loss, meanwhile the top right dot shows the most 
profitable trade. 
 
 
Figure 19. Scatter plot of trades in long position with fees. 
 
Figure 20 is a candlestick chart that coincidentally 
contains the most profitable trade and the most lossy one. 
The most lossy trade begins on Mar. 13, 2020 indicated by 
vertical lines in orange color. The most profitable one starts 
on Mar. 24, 2020 indicated by vertical lines in magenta 
color. 
 
 
Figure 20. Candlestick chart including profitable and lossy trades. 
The trade on Mar. 13, 2020 is put into action because (7) 
and (10) are True. Since the stock price drops significantly 
the next day, (17) is set to True, and the simulator swiftly 
buys back the stock, however, resulting in the worst loss of 
US$601.60. 
The trade on Mar. 24, 2020 is performed because 
conditions (7), (8), and (9) are True. After that, the 
simulator continues to hold on the stock as the price keep 
exceeding the buying price. Since the fast APAD falls 
below the slow APAD on May 1, 2020, the Boolean 
conditions (12), (13), (14), (15), and (16) are set to True. 
The simulator sells back the stock, and bringing the best 
profit of US$1,328.80. Meanwhile, the simulator refrains 
from trading on Apr. 22, 2020 because (15) is False, i.e., the 
slow APAD is positive. 
D. Enhancing decision of buying opportunities 
1) 
Enhancement to avoid lossy trade 
Stock prices sometimes move in anomalous ways for a 
day or so, often causing a loss-making trade. Candlestick-
based trade decision processes are augmented to help the 
simulator avoid trades with large losses in a practical way. 
Figure 21 shows an enhanced algorithm for simulating in 
a long position. The condition CandlePattern_Avoid_Buy is 
added after the condition of Buy_Signal_B. CandlePattern 
_Avoid_Buy consists of several candlestick patterns that 
signal for avoiding a buy of a stock. All patterns must be 
False for a trade in a long position to be started. Typical 
patterns of CandlePattern_Avoid_Buy are described below. 
 
 
Figure 21. Overall simulation algorithm enhanced  
by candlestick pattern in long position. 
 
As observed in Figure 20, the slope of the fast APAD 
becomes positive on Mar. 13, 2020. However, the stock 
purchase on this day results in unsuccessful. According to 
the candlestick charting, the price fluctuation on this day 
corresponds to the falling window candlestick pattern, 
which predicts stock prices continue to fall [13]. Let 
Pgap[j] be the ratio of the gap to the closing price of the 
trading day in percentage. This pattern is implemented by 
the disjunction of the two Boolean conditions below: 
30
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
cb1= Pbody[j+1] < 0.3 & Pgap[j] > 0.58;  
(19) 
 
cb2= Pgap[j] > 2.0; 
 
 
 
(20) 
 
The Boolean variable cb1 is calculated by the previous 
day’s candle being less than 0.3% suggesting downtrend, 
and the gap on the stock trading days being more than 
0.58%. This is a weak upward stock price movement 
accompanied by a gap in a downtrend, meaning that the 
stock price movements are difficult to predict. The variable 
cb2 is set to True when a gap is greater than 2.0%, which is 
a rare large gap, and shows signs of avoiding a stock trade. 
The values of 0.58, 0.3 and 2.0 are experimentally 
determined through trial and error using the NASDAQ stock 
data. 
Other pattern that should be avoided for buying a stock 
occurred on Mar. 17, 2020 as shown in Figure 20, indicated 
by vertical lines in cyan color. The opening and closing 
prices of a stock are nearly within the range of the prior 
day’s opening and closing prices. This pattern is named the 
bullish piercing pattern, and is considered to be a weak 
reversal signal [13]. Since the slope of the fast APAD turns 
slightly positive on Mar. 17, 2020, it is necessary to 
implement a process that takes into account the bullish 
piercing pattern in order to avoid the trade on the day. The 
variable cb3 checks the pattern. Parameter values are 
heuristically 
determined 
thorough 
experiments 
using 
NASDAQ daily data. Abs means a function that calculates 
the absolute value of an argument. 
 
cb3= Abs((Open[j+1] – Close[j]) * 100 / Close[j]) < 0.2   
& Pbody[j+1] < –3.0 & Pbody[j] > 3.0 
(21) 
 
Figure 22 shows a gap-related pattern that is scarcely 
mentioned in the literature [12][13]. The pattern observed 
on May 3, 2019 in NASDAQ. 
 
 
Figure 22. Sample of gap-related pattern. 
 
The pattern consists of a three-days’ bearish candlesticks 
followed by a bullish candlestick with a significant gap. 
This pattern is spotted by the following formula: 
 
cb4= Pbody[j+3] <0 & Pbody[j+2] <0 & Pbody[j+1] < 0  
& Pbody[j] > 0.75 & Pgap[j] > 0.5 
 
(22) 
 
The values of 0.75 and 0.5 are determined through 
experiments. The slope of the fast APAD turns positive on 
the day. So, without a decision using the candlestick pattern, 
the simulator buys stocks and incurs a loss of US$84.00 
including trading fees. Several other candlestick patterns to 
avoid buying stocks are incorporated into the developed 
simulator. 
 
2) Experimental results using NASDAQ historical data 
Table VI compares the main characteristics of the 
simulators before and after the improvement. First of all, the 
number of trades decreases from 276 to 223.  
 
TABLE VI. SUMMARY OF EXPERIMENTAL RESULT IN LONG POSITION 
 
 
The success rate of trading in the study is defined by the 
following formula: 
 
Success rate= 
the number of profitable trades 
/ the total number of trades 
 
(23) 
 
The number of profitable trades indicates the number of 
trades with positive profit. The total number of trades is 276. 
Success rate of trades is 68.12% (= 188 / 276) without the 
trading fee, and is 65.94% (= 182 / 276) with the fee. 
After the enhancement using candlesticks, the success 
rate increases from 65.94% to 74.44% (= 166 / 223) with 
the fee. Net profit increases from US$20,641.42 to 
US$22,524.10. It is noteworthy that the maximum loss is 
significantly reduced from US$–601.70 to US$–221.30 with 
the trade fee after the enhancement. 
Figure 23 shows the cumulative profit and the cumulative 
trade fee. Comparison with Figure 18 shows that there is no 
noticeable drop in the graphs. All R2s are greater than 
0.9523, maintaining significant correlation between the 
cumulative profit and the number of trades. 
 
31
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
 
Figure 23. Cumulative profit and cumulative fee after enhancement. 
 
Figure 24 shows a scatter plot of trades with the fee after 
enhancement. In comparison with Figure 19, it can be seen 
that the number of trades that resulted in a loss are 
decreased significantly, while the number of the profitable 
trads is roughly the same before and after the enhancement. 
 
 
Figure 24. Scatter plot of trades with fees after enhancement using 
candlestick pattern. 
 
Figure 25 shows a histogram of the number of holding 
days of a stock and the number of occurrences. 
 
 
Figure 25. Histogram of the number of holding days in long position. 
 
A trade within two days’ stock holding period often 
results in a loss, because the stock price moves contrary to 
trader’s expectations. Figure 25 indicates that the proposed 
enhancement using candlestick patterns has the effect of 
noticeably reducing the number of stock trades with one-
holding day, i.e., from 84 to 51. 
 
E. Tracking Sell Opportunities using APAD 
1) 
Overall Algorithm for Selling Simulation 
Figure 26. shows the overall algorithm for the selling 
simulation, or simulation in a short position. The T2S 
method has two parameters, i.e., IndexFrom and IndexTo. 
Strictly, the value of IndexFrom is the index value of arrays 
corresponding to the simulation start date. Similarly, the 
value of IndexTo specifies the end date of the simulation. 
 
 
Figure 26. Overall simulation algorithm in short position. 
 
When the Boolean condition flg > 0 & Sale_Signal_S is 
True, the process of trading in a short position is started: 
• Set the variable traded_p, which indicates the trading 
price of the stock, to the average of the opening and 
closing prices. 
• Set the variable holding_day_cnt, which represents 
the number of days to hold the traded stock, to 0.  
• Set the variable flg to –1 to indicate the trade in a 
short position. 
When flg < 0 & Buy_Signal_S is True, the trade is 
closed. 
• Set the profit of the trade to the variable diff using 
the expression: diff = traded_p – ((Open[j] + 
Close[j]) / 2) – selling_cost. 
• Set the cumulative profit to the variable profit using 
the substitution expression profit= profit + diff. 
• Set the variable flg to 1 to indicate the state for 
tracking sell opportunities. 
Sale_Signal_S 
and 
Buy_Signal_S 
are 
Boolean 
expressions that signals the start, and the end of the trade in 
a short position, respectively. The details are discussed in 
the following sections. 
 
2) Criteria for selling stock in short position 
In the following formulas, parameter values are 
experimentally determined using the NASDAQ stock data. 
32
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
Let CP_5avg[j] be the difference between the closing price 
and the 5-day average of a trading day j in percentage. 
CP_25avg[j] is for the 25-day average that is defined in 
analogy with CP_5avg[j]. The Sale_Signal_S is defined as 
follows: 
 
Sale_Signal_S= s1 & s2 & s3 & s4 & s5 & (s6 | s7) (24) 
 
s1= (Pbody[j] + Pchg[j] + CP_5avg[j]) < –1.2; 
(25) 
 
s2= (CP_5avg[j] + CP_25avg[j]) > –9.0; 
 
(26) 
 
s3= CP_5avg[j] < 2.0; 
 
 
 
(27) 
 
s4= Pbody[j] < 0.6; 
 
 
 
(28) 
 
s5= APAD_F[j]> 0.2 & APAD_S[j] < 1.0;  
(29) 
 
s6= (APAD_F[j] – APAD_F[j+1]) < 0; 
 
(30) 
 
s7= (APAD_S[j] – APAD_S[j+1]) < 0; 
 
(31) 
 
The Boolean variable s1 indicates the price notably falls 
on the trading day. The variable s2 means that the stock 
price is within a certain range from the moving averages, i.e., 
the stock price is not in the bottom range. S3 is True if the 
stock price is less than 2% of the 5-day average. S4 
represents that the ratio of the length of the body of a 
candlestick to the stock price is less than 0.6%, i.e., a slight 
price increase at most in a trading day. 
The Boolean variables s5, s6, and s7 are those concerning 
the APADs. S5 is set to True if the fast APAD is greater 
than 0.2 and if the slow APAD is less than 1.0, which 
suggests a weak trend of price increase. The variables s6 
and s7 are True if the slopes of the fast APAD and the slow 
APAD are negative, which indicates a downtrend. 
 
3) 
Criteria for buying stock in short position 
The timing to buy the traded stock back in a short 
position, i.e., Buy_Signal_S in Figure 26, is defined as 
follows: 
 
Buy_Signal_S= (s11 | s12 | s13); 
 
s11= (trade_p – (Open[j] + Close[j]) / 2) * 100 
/ trade_p < –0.5;  
(32) 
 
s12= Pchg[j+1]>0.0 & Pchg[j]>0.0 
& Pbody[j] > 0.4; 
(33) 
 
s13= Pchg[j] > 1.2 & Pbody[j] > 0.8; 
 
(34) 
 
The Boolean variable s11 is set to True if the current 
stock price is 0.5% higher than the traded value. The 
condition is essential to keep losses small. S12 is set to True 
if the stock price rises for two consecutive days and the 
length of the candlestick on the trading day is greater than 
0.4%. S13 is set to True if the stock price is greater than 
1.2% and the candlestick length is greater than 0.8%. The 
variable s12 and s13 are used to check whether the stock 
price for the day increase notably. 
 
4) Calculating margin interest in short position 
In a short selling trade, a trader must borrow a stock from 
an investment firm with a payment of margin interest. The 
leverage of trades is set to one in order to maintain the same 
conditions regarding the amount of the trades in long and 
short positions. Margin interest slightly vary across brokers. 
Typically, it consists of an annual interest rate and a fixed 
one. In this study, the margin interest is calculated using the 
following formula: 
 
(Stock price) * (2.80% / 365 * M + 1.15%)  
(35) 
 
M is the total number of days for borrowing stocks. 
1.15% indicates the fixed rate. 
 
5) Experimental results using NASDAQ historical data 
The line graphs in Figure 27 present the cumulative profit, 
net profit, and the margin interest calculated by (35) in a 
short position. The graph of profit in this figure can be 
approximated by three segmented lines. The first segment is 
the period from the beginning of the simulation to the 78th 
trade marked by X, which corresponds to Sep. 17, 2018. 
The second segment ranges from the 79th trade to the 114th 
trade marked by the arrow ⇩, which corresponds to Mar. 18, 
2021, approximately one year after the date of the lowest 
price. The day of the lowest price marked by the arrow ⇧ is 
located roughly in the middle of the second segment. The 
third segment is the period from the 115th trade to the last 
trade, namely Apr. 25, 2022. 
The minimum value of R-squared is 0.5534 that shows 
the degree of approximation is worse than a long position. 
This suggests that trades in a short position is less stable 
than those in a long position. The cumulated net profit is 
always negative because the margin calculated by (35) 
squeezes the profit generated by the simulator. 
 
 
Figure 27. Cumulative profit, net profit, and margin interest  
in short position. 
 
Figure 28 shows a scatter plot of simulated trades in a 
short position with the margin interest using the NASDAQ 
33
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
daily stock data. Significant losses are incurred in the trades 
in which the number of days to hold stock is one. 
 
 
Figure 28. Scatter plot of trades in short position with margin interest. 
 
The trade with the largest amounts of profit, which starts 
on Dec. 4, 2018 and ends on Dec. 26, 2018, is represented 
by the dot in the upper right corner of Figure 28. Figure 29 
shows the candlestick chart of this lucrative trade. 
 
 
Figure 29. Candlestick chart including successful trades. 
 
The decision to buy the stock back based on the slope of 
the fast APAD and candlestick patterns is working 
profitably in this trade. It is noteworthy that Dec. 12, 2018, 
marked by the two dashed vertical lines, is not a day to buy 
the stock back although the slope of the fast APAD turns to 
positive. The variable s13 defined by (34) is False, because 
the length of the candlestick body on Dec. 12, 2018 is –
0.4%. 
F. Improving decision of selling opportunities 
1) 
Improvement to avoid lossy trade 
Similar to the simulation in a long position, the 
simulation of short selling can be improved using 
candlestick patterns. Figure 30 shows an overall algorithm 
enhanced 
by 
candlestick 
pattern. 
The 
condition 
CandlePattern_Avoid_Sale is added after checking the 
Sale_Signal_S. 
CandlePattern_Avoid_Sale 
consists 
of 
several candlestick patterns that signal for avoiding a short 
sale of a stock. All patterns must be False for a trade in a 
short position to be performed. 
 
 
Figure 30. Overall simulation algorithm improved  
by candlestick pattern in short position. 
 
Figure 31 shows a temporary-drop pattern that occurs 
after about a week of stock price rally, which is scarcely 
mentioned in the literature [12][13]. The pattern observed 
on Nov. 10, 2020 when the slope of the fast APAD changes 
the direction from up to down. This pattern is also observed 
on May 21, 2020, Jan. 3, 2019, Feb. 23, 2016, etc. Since this 
is a temporary decline, short selling on this day lead to 
losses. 
 
 
Figure 31. Temporary-drop pattern after strong rally. 
 
The following Boolean condition cs1 is implemented in 
our simulator to avoid short selling on a temporary-drop 
after noticeable stock price rally. Unfortunately, because the 
condition involves more than six candlesticks, it is difficult 
be defined by a Boolean expression, and it needs to be 
processed by a program. 
 
cs1= (Prices rise more than four days in the past six days)  
& (The amount of drop on the day is less than half of the 
cumulative increase in the past six days) 
(36) 
34
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
 
The Doji candlestick [12][13], which has the opening 
price and the closing prices are equal or almost the same, is 
a sign of indecision. Our simulator is also implemented to 
refrain from a selling stock on the Doji candlestick. In 
addition, several other candlestick patterns to avoid a lossy 
buying stock trade are enhanced to the simulator. 
 
2) Experimental results using NASDAQ historical data 
Table VII summarizes the main characteristics of the 
simulators before and after the improvements in a short 
position. The number of trades decreases from 134 to 107, 
while the success rate increases from 67.91% to 71.03% 
without the margin interest, and from 24.63% to 25.23% 
with the margin interest. While profits decline slightly from 
US$3,503.68 to US$3,340.08, losses reduce notably from 
US$–4,984.35 to US$–3,270.74 with the margin interest. 
 
TABLE VII. Summary of experimental results in short position 
 
 
Figure 32 shows line graphs of the cumulative profit, net 
profit, and margin interest in a short position after the 
improvement using candlesticks. The graph of cumulated 
profit in Figure 32 can be approximated by three segmented 
lines. The trade dates separating the three segments are the 
same as in Figure 27. The improvement boosts the net profit. 
However, the cumulative profits remain negative for most of 
the period. 
 
 
Figure 32. Cumulative profits and margin interest after improvement 
in short position. 
 
Figure 33 shows a scatter plot of simulated trades with 
the margin interest after the improvement. Improvements 
have reduced the number of non-profitable trades, but not 
sufficient. There are a lot of loss-making trades of which 
stock holdings are one to seven days. 
 
 
Figure 33. Scatter plot of trades with margin interest after improvement 
in short position. 
 
Figure 34 shows a histogram of the number of holding 
days of a stock and the number of occurrences.  
 
 
Figure 34. Histogram of the number of holding days in short position. 
 
Similar to the histogram of a long position shown in 
Figure 25, the proposed improvement using candlestick 
patterns leads to a reduction in the number of lossy-making 
trades with a one-day holding period, i.e., from 58 to 45. 
G. Experiments using stock data of major stock markets 
Stock trade simulations are performed over the ten years’ 
stock data using the nine markets, i.e., NASDAQ and Dow 
Jones Industrial Average (U.S.), Bovespa (Brazil), CAC 
(France), DAX (Germany), Nikkei 225 (Japan), S&P ASX 
(Australia), Sensex (India), and SSEC (China). 
Table VIII shows the success rates for each market in both 
long and short positions, and with and without the fee or 
margin interest. Because this simulator is customized for the 
NASDAQ market, NASDAQ achieves the highest success 
rate of 74.44% with the fee in a long position. As for a short 
position, the Bovespa market has the highest success rate of 
34.44% with the margin interest, followed by NASDAQ’s 
success rate of 25.23%. 
35
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
Table VIII. Success rates for each market in long and short positions 
 
 
Figure 35 shows the line graphs of the cumulative profits 
with the fee for each market in a long position. Since stock 
prices in each market have risen significantly over the ten-
year period of the simulation, the ratio of the profits, i.e., the 
Y-axis in Figure 35, is calculated by dividing the amount of 
profit by the average stock price of the market. 
In NASDAQ, for example, the 25-day average price at 
the beginning of the simulation, i.e., May 1, 2012, is 
US$3,031.64. The 25-day average price at the end of the 
simulation, i.e., Apr. 30, 2022, is US$13,394.16. The 
average stock price of NASDAQ is US$8,212.90 by 
calculating the average of these two prices. The maximum 
ratio of the amount of profit to the average stock price is 
275.5% as shown in Figure 35. 
All graphs in Figure 35 show an upward trend. 
Cumulative profit in NASDAQ become larger with 
increasing slope after Covid-19 pandemic. Cumulative 
profit in SSEC rapidly increases in the period from the 63rd 
to the 95th trades, which correspond to Oct. 28, 2014 and 
Mar. 30, 2016, respectively. The other graphs are roughly 
linear. This indicates that the proposed simulator constantly 
generates profits in the nine markets over the ten-year 
simulation period. 
 
 
Figure 35. Line graph of profit for each market in long position. 
Figure 36 shows the line graphs of the profits with the 
margin interest for each market in a short position. As the 
Bovespa’s success rate of 34.44% suggests, Bovespa 
apparently achieves higher profits than NASDAQ. Other 
markets take losses. 
 
 
Figure 36. Line graph of profit for each market in short position. 
 
The prediction accuracy of the developed simulator is still 
insufficient for a short position, as large portions of the 
graphs in Figure 36 are in the negative region. 
 
VI. 
CONCLUSION AND FUTURE WORK 
This paper describes the results of analyses of stock price 
fluctuations in European, U.S. and Asian markets with 
special focus on the effect of Covid-19 pandemic. In general, 
thanks to the timely implementation of monetary measures 
of each country, all stock prices under study have kept rising 
after the lowest price recorded in Mar. 2020. 
Observed in the 490 business days, i.e., approximately two 
years, NASDAC see a 62.36% increase in its stock price 
compared to its highest price before the declaration of 
Covid-19 pandemic. CAC (France) decreased by –1.73%, 
followed by 9.25% increase in DAX (Germany). Analyses of 
the average and standard deviation of the six attributes of a 
candlestick chart reveal that CAC and DAX are deemed to 
experience a larger impact on stock prices than the other 
markets. 
We propose a trend reversal indicator named APAD, an 
acronym for “Average of Price and 5-day Average 
Difference.” The indicator is devised in the process of 
investigating how the difference between the stock price and 
5-day average is related to the reversal of stock trends 
affected by Covid-19 pandemic. 
Since the APAD is an indicator based on a 5-day average, 
the APAD can be difficult to deal with short-term 
fluctuations over one or two days. Candlestick chart patterns 
are used to compensate for this shortcoming. We developed 
a stock trading simulator that implements the APAD 
enhanced 
by 
heuristic 
candlestick 
chart 
patterns. 
Experiments using ten years of stock price data from nine 
major stock markets in the world were conducted, and 
analyzed the profit characteristics. 
36
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
 
 
  
 
It is confirmed that the simulator achieved the success rate 
of up to 74.44% in NASDAQ including fees in a long 
position. However, as for in a short position, the success rate 
remains within 25.23% percent, because the approximately 
1.15% margin interest to borrow stocks squeezes profits. 
We are planning researches to improve the success rate 
and profitability of the developed simulator through the 
addition of candlestick patterns and the sophisticated use of 
the APADs. Further experiments using stock price data from 
various global markets and individual companies are planned 
to verify the functionality of the proposed simulators. 
 
REFERENCES 
[1] Y. Udagawa, “Analyzing Impact of COVID-19 Pandemic on 
Global Stock Prices,” The Seventh International Conference on 
Big Data, Small Data, Linked Data and Open Data 
(ALLDATA 2021), IARIA, pp. 23-29, ISBN: 978-1-61208-
842-6, Apr. 2021. 
[2] A. Chudik, K. Mohaddes, M. H. Pesaran, M. Raissi, and A. 
Rebucci, 
“Economic 
consequences 
of 
Covid-19: 
a 
counterfactual 
multi-country analysis,” 
Available 
from: 
https://voxeu.org/article/economic-consequences-Covid-19-
multi-country-analysis/ Oct. 2020. 
[3] “World Economic Outlook,” International Monetary Fund, 
https://www.imf.org/en/Publications/WEO/ Apr. 2022. 
[4] “Major 
World 
Market 
Indices,” 
Available 
from: 
https://www.investing.com/indices/major-indices/ Apr. 2022. 
[5] E. Dimson, P. Marsh, and M. Staunton, “Should you invest in 
emerging markets?” London Business School, Available from: 
https://www.london.edu/ think/emerging-markets/ Apr. 2019. 
[6] Y. Udagawa, “Statistical Analysis of Stock Profits to Evaluate 
Performance of Markets,” The Sixth International Conference 
on Big Data, Small Data, Linked Data and Open Data 
(ALLDATA 2020), IARIA, pp. 14–21, ISBN: 978-1-61208-
775-7, Feb. 2020. 
[7] C. C. Ngwakwe, “Effect of COVID-19 Pandemic on Global 
Stock Market Values: A Differential Analysis,” Acta 
Universitatis Danubius. Œconomica, No 2, Vol 16, pp. 255-
269, 2020. 
[8] P. Verma, A. Dumka, A. Bhardwaj, A. Ashok, M. C. Kestwal, 
and P. Kumar, “A Statistical Analysis of Impact of COVID-
19on the Global Economy and Stock Index Returns,” Springer 
Nature journal Computer Science, 2:27, pp. 13, Jan. 2021. 
[9] M. Buszko , W. Orzeszko, M. Stawarz, “COVID-19 pandemic 
and stability of stock market - A sectoral approach,” PLoS 
ONE 16(5): e0250938, pp. 1-26, doi:10.1371/journal.pone. 
0250938, May, 2021. 
[10] M. Obthong, N. Tantisantiwong, W. Jeamwatthanachai, and G. 
Wills, “A Survey on Machine Learning for Stock Price 
Prediction: 
Algorithms 
and 
Techniques,” 
The 
second 
International Conference on Finance, Economics, Management 
and IT Business, pp. 63-71, doi:10.5220/0009340700630071, 
Feb. 2020. 
[11] M. R. Islam and N. Nguyen, “Comparison of Financial 
Models for Stock Price Prediction,” Journal of Risk and 
Financial 
Management, 
13(8), 
pp. 
1-19, 
doi:10.3390 
/jrfm13080181, Aug. 2020. 
[12] “Technical Analysis,” Cambridge Univ., Available from: 
http://www.mrao.cam.ac.uk/~mph/Technical_Analysis.pdf, pp. 
1-179, Feb. 2011. 
[13] S. Nison, “Japanese Candlestick Charting Techniques,” 
Second edition, New York Institute of Finance, 2001. 
 
[14] S. Glen, “Statistics How To, T-Distribution/Student’s T: 
Definition, 
Step 
by 
Step 
Articles,” 
https://www. 
statisticshowto.com/probability-and-statistics/t-distribution/ 
2020. 
[15] Y. Udagawa, “Developing a Stock Trading Simulator Using 
Candlestick Chart Patterns for Estimating Profitability of 
Global Markets,” The Eighth International Conference on Big 
Data, Small Data, Linked Data and Open Data (ALLDATA 
2022), IARIA, pp. 1-7, ISBN: 978-1-61208-945-4, Apr. 2022. 
 
37
International Journal on Advances in Systems and Measurements, vol 15 no 1 & 2, year 2022, http://www.iariajournals.org/systems_and_measurements/
2022, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

