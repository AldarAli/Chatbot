RBF-metamodel driven multiobjective optimization  
and its application in focused ultrasonic therapy planning 
Tanja Clees, Nils Hornung, Igor Nikitin, Lialia Nikitina, Daniela Steffes-lai 
Department of High Performance Analytics 
Fraunhofer Institute for Algorithms and Scientific Computing 
Sankt Augustin, Germany 
Tanja.Clees|Nils.Hornung|Igor.Nikitin|Lialia.Nikitina|Daniela.Steffes-lai@scai.fraunhofer.de 
 
 
Abstract—We consider bi-objective optimization problem from 
noninvasive tumor therapy planning. The therapy uses 
magnetic resonance tomography for the location of the target 
region and focused ultrasound for the destruction of tumor 
cells. Experimentally validated physical models are used to 
construct numerical simulation including nonlinear wave 
propagation, absorption in soft tissue, heat transfer and a 
hierarchical structure of the biological materials. The resulting 
cumulative thermal dose inside the target region should be 
maximized, providing a maximal level of tumor destruction, 
while the thermal dose outside the target region should be 
minimized, to decrease the influence to healthy organs. 
Metamodeling with radial basis functions is used for 
continuous representation of optimization objectives. The 
problem possesses nonconvex Pareto front. Detection of 
nonconvex Pareto fronts is especially difficult, this is a point 
where many simple algorithms fail. In this paper we consider 
different approaches to this problem: sequential linear 
programming (SLP), sequential quadratic programming (SQP) 
and generic 1- or 2-phase nonlinear programming (NLP). We 
show the ability of the algorithms to process such case and 
compare the efficiency of different approaches.  
Keywords-complex computing in application domains; 
medical computation and graphics; advanced computing in 
simulation systems; advanced computing for statistics and 
optimization. 
I. 
 INTRODUCTION 
Focused ultrasonic therapy is a noninvasive therapy using 
magnetic resonance tomography for identification of tumor 
volume and focused ultrasound for the destruction of tumor 
cells. Numerical simulation becomes an important step for 
the therapy planning. Efficient methods for the focused 
ultrasonic simulation have been presented in paper [1]. It 
uses a combination of Rayleigh-Sommerfeld integral for near 
field 
and 
angular 
spectrum 
method 
for 
far 
field 
computations, which allows determining the pressure field in 
heterogeneous tissue. The bioheat transfer equation is used to 
determine the temperature increase in therapy region. 
Thermal dose is defined according to cumulative equivalent 
minutes metric (CEM, [2]) or Arrhenius model [3] as a 
functional of temperature-time dependence in every spatial 
point in therapy region. These methods have been 
accelerated by GPU based parallelization and put in the basis 
of software FUSimlib (www.simfus.de), developed by our 
colleagues at Fraunhofer Institute for Medical Image 
Computing. 
3D visualization is used for interpretation of simulation 
results, in particular, for detailed inspection of MRT images 
(magnetic resonance tomography), corresponding material 
model and spatial distribution of the resulting thermal dose, 
see Fig. 1. Stereoscopic 3D visualization in virtual 
environments based on modern 3D-capable beamers with 
DLP-Link technology (Digital Light Processing), described 
in more details in [4] is especially suitable for this purpose. 
Such commonly available beamers do not require special 
projection screens and can turn every regular office to a 
virtual laboratory providing full immersion into the model 
space. 
We 
use 
3D 
visualization 
software 
Avango 
(www.avango.org), 
an 
object-oriented 
programming 
framework for building applications of virtual environments. 
Our interactive application overlays three voxel models: 
original MRT sequence, material segmentation and resulting 
thermal dose. The user can mix the voxel models together, 
interactively changing their levels of transparency, set 
breathing phase, cut the model with a clipping plane, etc. 
For continuous representation of optimization objectives 
from a discrete set of simulation results we use 
metamodeling with radial basis functions (RBF). It 
represents the interpolated function f(x) as a linear 
combination of special functions Φ() depending only on the 
distance to the sample points xk: 
 
 
f(x) = ∑ k=1..Nexp ck Φ(|x-xk|)  
(1) 
 
 
The coefficients ck in (1) can be found from known 
function values in sample points f(xk) by solving a 
moderately sized linear system with a matrix Φkn =Φ(|xk-xn|). 
A suitable choice for the RBF is the multi-quadric function 
Φ(r)=(b2+r2)1/2, 
which 
provides 
nondegeneracy 
of 
interpolation matrix for all finite datasets of distinct points 
and all dimensions [5]. RBF interpolation can be extended 
by adding polynomial terms, allowing reconstructing exactly 
polynomial (including linear) dependencies and generally 
improving precision of interpolation. Adaptive sampling and 
hierarchy of metamodels with appropriate transition rules are 
used for further precision improvement. RBF metamodel is 
directly applicable for interpolation of high dimensional 
bulky data, e.g. complete simulation results can be 
interpolated at a rate linear in the size of data, and even faster 
71
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-419-0
ADVCOMP 2015 : The Ninth International Conference on Advanced Engineering Computing and Applications in Sciences

in combination with PCA-based dimensional reduction 
techniques.  The precision can be controlled via cross-
validation procedure. So enhanced RBF metamodel is a part 
of our software tool for design parameter optimization 
DesParO [6-8]. 
The objective of therapy planning is a maximization of 
thermal dose inside the target zone (TDin) and minimization 
of thermal dose outside (TDout). As usual in multi-objective 
optimization, the optimum is not an isolated point but a 
hypersurface (Pareto front, [9]) composed of points 
satisfying a tradeoff property, i.e. none of the criteria can be 
improved without simultaneous degradation of at least one 
other criterion. Thus, for a two-objective problem, the Pareto 
front is a curve on the plot (TDin, TDout) bounding the 
region of possible solutions. Efficient methods have been 
previously developed for determining the Pareto front. 
The simplest way is to convert multi-objective 
optimization to single objective one, by linearly combining 
all objectives into a single target function  
 
 
t(x)= ∑ wi fi(x)  
(2) 
 
with user-defined constant weights wi. Maximization of the 
target function (2) gives one point on Pareto front, while 
varying the weights allows to cover the whole Pareto front. 
In this way only convex Pareto fronts can be detected, 
because nonconvex Pareto fronts produce not maxima but 
saddle points of the target function.  
There are methods applicable also for nonconvex Pareto 
fronts. Nondominated set algorithm (NDSA) finds a discrete 
analogue of Pareto front in a finite set of points. For two 
points f and g in optimization criteria space the first one is 
said to be dominated by the second one if fi ≤ gi holds for all 
i=1..Ncrit. A point f belongs to nondominated set if there 
does not exist another point g dominating f. There is a 
recursive procedure [10] finding all nondominated points in a 
given finite set. The drawback of the algorithm is an 
extremely large number of samples necessary to populate 
multidimensional regions for good approximation of Pareto 
front. 
Normal boundary intersection method (NBI) [11] 
provides a good heuristics for sampling of Pareto front. The 
idea is to find individual minima of objectives, to construct 
their convex hull, to sample it e.g. with Delaunay 
tessellation, to build normals in tesselation points and finally 
to intersect them with the boundary of par → crit mapping. 
The approach has problems e.g. at Ncrit>2, when non-Pareto 
points or not all Pareto points are covered, or if the number 
of minima >Ncrit, when several local Pareto fronts can be 
mixed together. 
Meanwhile, practical applications just require an 
elementary algorithm performing a local improvement of 
current design towards the optimum. Being iterated such 
algorithm proceeds towards Pareto front. For definiteness, an 
improvement direction in the space of objectives can be 
fixed, e.g. every step all objectives are improved by a given 
increment. 
The 
algorithm 
stops 
when 
the 
further 
improvement in the given direction is not possible. Normally 
it happens when the solver reaches the Pareto front. Convex 
or nonconvex Pareto fronts can encounter and the algorithm 
should work equally efficient for both. The improvement can 
also stop on a non-Pareto boundary point. In this case it is 
allowed to return the other point on Pareto front, which does 
not necessarily belong to the original improvement direction.  
In further sections we consider different approaches for 
this algorithm: sequential linear programming (SLP), 
sequential quadratic programming (SQP) and generic 1- or 
2-phase nonlinear programming (NLP). We also consider a 
question of scalarization, i.e. a possibility to reformulate the 
multiobjective 
optimization 
problem 
as 
constrained 
optimization with a single objective, which allows to employ 
available NLP solvers for its solution. 
II. 
USING SEQUENTIAL LINEAR PROGRAMMING 
Linearizing the mapping y=f(x) using Jacoby matrix 
Jij=∂yi/∂xj, let’s consider a polyhedron of possible variations 
 
 
Πε: ∆y=J∆x , ∆y ≥ ε > 0 , -δ ≤ ∆x  ≤ δ,  
(3) 
xmin ≤ x+∆x ≤ xmax  , ymin ≤ y+∆y ≤ ymax 
 
Here we require that all criteria ∆y are improved, 
parameter variations ∆x are bounded in a trust region [-δ,δ] 
for linear approximation, while parameters and criteria 
satisfy bounding box or other polyhedral restriction in xy-
space. By requiring in (3) that a maximally possible 
improvement of criteria in Πε is achieved, we formulate a 
linear program which can be solved e.g. by simplex method 
[12] and repeated sequentially:  
 
Algorithm SLP: 
   Solve LP: max ε, s.t. (∆x,∆y)∈Πε 
   Repeat steps x+∆x → x until convergence.  
 
The algorithm terminates at Pareto front, where no further 
improvements are possible. 
 
Property: in general position LP-optimum is achieved in 
corners of polyhedron Πε. 
 
E.g. ∆y=ε correspond to linear trajectories in y-space, 
|∆x|=δ correspond to linear trajectories in x-space. Therefore, 
the method tends to generate linear trajectories in certain 
projections. 
SLP above is formulated for the case dim(x)=dim(y). At 
dim(x)<dim(y) multiobjective problem is ill defined, i.e. full 
dimensional regions in parameter space become Pareto 
equivalent. At dim(x)>dim(y) there are unstable directions 
from Ker(J): J∆x=0, i.e. there are ∆x not influencing ∆y. 
These directions can be suppressed by additional condition 
J⊥∆x=0, where J⊥ is orthogonal complement to J, 
constructed e.g. with Gram-Schmidt algorithm. 
 
Example: let’s consider a fold transform: |y|=2|x|/(1+|x|2) 
shown on Fig. 3 for 2D case. An upper right arc corresponds 
to a global Pareto front (PF) max y1,y2. There is also a 
72
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-419-0
ADVCOMP 2015 : The Ninth International Conference on Advanced Engineering Computing and Applications in Sciences

degenerate local PF at y1,2=-0, corresponding to an image of 
x1,2=-∞. 
SLP algorithm generates trajectories shown by red lines 
on Fig. 3, in x-space in the left column and in y-space in the 
right column. The algorithm reconstructs correctly both 
global and local PF, shown by blue points on the images. 
The 
bottom 
closeups 
demonstrate 
piecewise 
linear 
trajectories described above. Particularly, there is a dashed 
linear trajectory in y-space tending to non-Pareto part of the 
boundary (nPF), which at a certain moment switches from 
∆y=ε corner to |∆x|=δ corner, becomes curved and finally 
stops at PF. 
III. 
USING SEQUENTIAL QUADRATIC PROGRAMMING 
Polyhedron Π0 is defined as above (with ε=0). Let v be a 
fixed search direction in y-space, ε is a constant. The 
following quadratic program [15] tries to perform ∆y=εv 
steps if possible in Π0: 
 
Algorithm SQP: 
   Solve QP: min ||∆y-εv||2, s.t. (∆x,∆y)∈Π0 
   Repeat steps x+∆x → x until convergence.  
 
Property: in general position QP-optimum can be achieved 
inside Π0, in corners of Π0 or on edges/faces of Π0. 
 
In the first case ∆y=εv linear trajectories will be 
generated in y-space, in the second case |∆x|=δ linear 
trajectories will be generated in x-space, in the third case the 
trajectories become nonlinear. 
IV. 
USING 1-PHASE NONLINEAR PROGRAMMING 
Nonlinear target function in the form t(x)=∑ wi criti
p
  
under certain conditions can detect nonconvex Pareto fronts. 
Here the target function is represented by a scaled Lp-norm 
with weights wi ≥0, ∑ wi =1. Fig. 2 left shows level curve 
for 2D target function for different p. One has a straight line 
at p=1, a quadric at p=2, a superquadric at p>2 and a corner 
at p=∞. 
 
Property: nonlinear target function can be used to detect 
nonconvex PF, if the curvature of the level curve exceeds 
the curvature of PF. 
 
Also at higher dimensions, considering the level set (LS) 
tangent to PF, performing Taylor expansions of LS and PF: 
z=uTMu+o(u2), where u,z are respectively parallel and 
normal components to a common tangent hyperplane to LS 
and PF, and requiring zLS≥zPF, one can reformulate the 
property above as positive definiteness for the difference of 
curvature matrices MLS-MPF. 
Note that L∞ =max is applicable in any case (minmax 
method [13]), but the corresponding NLP will be 
nonsmooth. Practically, one can use large finite p, it is also 
convenient to normalize yi in [0,1] and take a log of target 
function for numerical stability. In this way one achieves so 
called scalarization of multiobjective optimization, i.e. 
conversion of multiobjective problem to a single objective 
one. As a result, the problem becomes solvable with 
standard NLP-solvers, e.g. ipopt [14]. Here one can impose 
any additional constraints, e.g. require that y(x) ≤ c. By 
putting c=y0 one ensures that the result is better in all 
criteria than a starting point and finds only a corresponding 
segment of PF. One can also leave c=∞ and vary wi to cover 
the whole PF. 
 
Algorithm NLP1(c): 
     minimize t(x)=log ∑ (wiyi)p, s.t. y(x) ≤ c. 
V. 
USING 2-PHASE NONLINEAR PROGRAMMING 
The following algorithm combines the concepts of linear 
search from NBI and optimization of nonlinear target 
function. The first phase performs the linear search in a 
given direction v in y-space towards PF and the second 
phase tries to perform further improvement (if possible). 
The problem is solvable with two calls to ipopt. 
 
Algorithm NLP2: 
NLP2.1: maximize t, s.t. y(x)=y0+tv;  result y1; 
NLP2.2: call NLP1(y1); result y2. 
 
Properties (see Fig. 2 right): 
if y1 ∈ PF, phase 2 quits immediately; 
if y1 ∈ non PF boundary, trajectory is bounced to PF. 
 
In NLP2.2 not the whole PF is targeted, but a smaller 
part ∆PF possessing better criteria than y1. Here one can use 
smaller p, while even for too curved PF the result y2 will be 
still better than y0 and y1. 
VI. 
APPLICATION IN FOCUSED ULTRASONIC THERAPY 
PLANNING 
A generic workflow for ultrasonic therapy simulation 
has been described in our paper [16]. Numerical simulation 
with FUSimlib software uses 512 x 512 x 256 voxel grid. 
Ultrasound has been focused in the center of the target zone 
for the neutral breath state. The result after 10 seconds of 
exposure time (200 steps x 0.05sec) has a form of spatial 
distributions of pressure amplitude, temperature and thermal 
dose. Fig. 1 top-right shows a typical result for thermal dose 
on slice 97/256 near the focal point.  The frequency of 
transducer is taken as optimization parameter controlling 
focused ultrasonic therapy simulation. The other one, initial 
particle speed, is proportional to an acoustic intensity 
emitted by the transducer [1]. As optimization objectives the 
thermal dose inside and outside the target zone have been 
defined as sums of the thermal dose over corresponding 
voxels, ∑TDin / ∑TDout.  The variation range of 
optimization parameters was regularly sampled with 25 
simulations, from which 16 fall in the region of interest, 
shown on Fig. 4 by red points. RBF metamodel constructed 
73
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-419-0
ADVCOMP 2015 : The Ninth International Conference on Advanced Engineering Computing and Applications in Sciences

on simulation results is used to oversample the region by 
green points, from which discrete method NDSA selects 
Pareto front, shown by blue points. We see that Pareto front 
is of nonconvex type. Magenta lines show application of 
three continuous methods described above. The trajectories 
generated by SLP and NLP2 coincide in every detail. Even 
bouncing from non-PF boundary works similar, although 
the mechanisms of this bouncing are different. NLP1 with 
p=8 and w1=0.01,0.15,0.27,0.5,0.99 produces the other set 
of trajectories. Table I shows a summary of problem 
characteristics. SLP provides the best performance for the 
given application case. On the other hand, NLP is easier for 
integration with existing scalar solvers. In NLP class, NLP1 
is faster than NLP2 for bounced trajectories, otherwise 
NLP2 is faster. Numerically NLP2 (with small p) is less 
singular than NLP1 (with large p) and therefore is more 
robust for detection of strongly curved Pareto fronts.  
TABLE I.  
BI-OBJECTIVE OPTIMIZATION IN FOCUSED 
ULTRASONIC THERAPY PLANNING, PROBLEM CHARACTERISTICS 
Parameter bounds: 
frequency   0.25…0.75 MHz 
ini.speed    0.23...0.282 m/s 
Timing per solution 
@ 3GHz Intel i7: 
Criteria bounds: 
∑TDin       0…3000 eq.min 
∑ TDout    0…6000 eq.min 
SLP      7ms 
NLP1   16ms 
NLP2   13ms+12ms 
 
VII. CONCLUSION 
Several 
algorithms 
of 
continuous 
multiobjective 
optimization applicable for detection of nonconvex Pareto 
fronts have been discussed: sequential linear programming 
(SLP), sequential quadratic programming (SQP) and generic 
1- 
or 
2-phase 
nonlinear 
programming 
(NLP1,2). 
Scalarization, i.e. reformulation of the multiobjective 
optimization problem as constrained optimization with a 
single objective, allows to employ available NLP solvers for 
its solution. The algorithms have been applied to realistic 
test case in focused ultrasonic therapy planning. In the given 
problem SLP possesses the best performance, while NLP is 
easier for integration with existing scalar solvers. NLP1 is 
faster than NLP2 for bounced trajectories, otherwise NLP2 
is faster. Numerically NLP2 is less singular than NLP1 and 
is therefore more robust for detection of strongly curved 
Pareto fronts. All these optimization methods provide real-
time performance necessary for interactive planning of 
focused ultrasonic therapy. 
REFERENCES 
 
[1] J.Georgii et al, Focused Ultrasound - Efficient GPU 
Simulation Methods for Therapy Planning, in Proc. Workshop 
on Virtual Reality Interaction and Physical Simulation 
VRIPHYS, Lyon, France, 2011, J. Bender, K. Erleben, and E. 
Galin (Editors), Eurographics Association 2011, pp. 119-128. 
[2] S.Nandlall et al, On the Applicability of the Thermal Dose 
Cumulative Equivalent Minutes Metric to the Denaturation of 
Bovine Serum Albumin in a Polyacrylamide Tissue Phantom. 
Proc. 8th Int. Symp. Therapeutic Ultrasound (AIP), 1113:205-
209, 2009. 
[3] J.A.Pearce, Relationships between Arrhenius models of 
thermal dose damage and the CEM 43 thermal dose. Energy-
based Treatment of Tissue and Assessment V (Proceedings of 
SPIE), editor: Ryan, T.P., 7181, 2009. 
[4] T. Clees et al, Focused ultrasonic therapy planning: 
Metamodeling, optimization, visualization, J. Comp. Sci. 5 
(6), Elsevier 2014, pp 891-897. 
[5] M.D.Buhmann, 
Radial 
Basis 
Functions: 
theory 
and 
implementations, Cambridge University Press, 2003. 
[6] G. van Bühren et al, Aspects of adaptive hierarchical RBF 
metamodels for optimization, Journal of computational 
methods in sciences and engineering JCMSE 12 (2012), Nr.1-
2, pp.5-23. 
[7] T.Clees et al, Analysis of bulky crash simulation results: 
deterministic and stochastic aspects, in N.Pina et al (Eds.): 
Simulation and Modeling Methodologies, Technologies and 
Applications, AISC 197, Springer 2012, pp.225-237.  
[8] T.Clees, I.Nikitin, L.Nikitina, Nonlinear metamodeling of 
bulky data and applications in automotive design, in M. 
Günther et al (eds), Progress in industrial mathematics at 
ECMI 2010, Mathematics in Industry (17), Springer, 2012, 
pp. 295-301. 
[9] M.Ehrgott, 
X.Gandibleux 
(Eds.), 
Multiple 
criteria 
optimization: state of the art annotated bibliographic surveys, 
Kluwer 2002. 
[10] H. T. Kung, F. Luccio, and F. P. Preparata. On finding the 
maxima of a set of vectors. Journal of the ACM, 22(4):469–
476, 1975. 
[11] G.Eichfelder, 
Parametergesteuerte 
Lösung 
nichtlinearer 
multikriterieller 
Optimierungsprobleme, 
Friedrich–
Alexander-Universität Erlangen–Nürnberg, Dissertation 2006. 
[12] G.Dantzig, Linear programming and extensions. Princeton 
University Press and the RAND Corporation, 1963. 
[13] D.Müller-Gritschneder, Deterministic Performance Space 
Exploration of Analog Integrated Circuits considering Process 
Variations and Operating Conditions, Technische Universität 
München,  Dissertation 2009. 
[14] A.Wächter, Short Tutorial: Getting Started With Ipopt in 90 
Minutes, IBM Research Report, 2009. 
[15] R.Fletcher, Practical Methods of Optimization, Wiley 2000. 
[16] T. Clees et al, Multi-objective Optimization and Stochastic 
Analysis in Focused Ultrasonic Therapy Simulation, in Proc. 
of SIMULTECH 2013, pp.43-48, SCITEPRESS, 2013.
 
 
 
74
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-419-0
ADVCOMP 2015 : The Ninth International Conference on Advanced Engineering Computing and Applications in Sciences

 
 
 
 
 
Figure 1.  Focused ultrasonic therapy planning and its software components.  
 
           
 
 
Figure 2.  Scalarization of multiobjective optimization problem. On the left: algorithm NLP1; on the right: algorithm NLP2. 
 
75
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-419-0
ADVCOMP 2015 : The Ninth International Conference on Advanced Engineering Computing and Applications in Sciences

 
Figure 3.  Pareto front detection for 2D fold transform. 
 
 
 
Figure 4.  Nonconvex Pareto front in focused ultrasonic therapy planning, comparison of different methods. 
76
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-419-0
ADVCOMP 2015 : The Ninth International Conference on Advanced Engineering Computing and Applications in Sciences

