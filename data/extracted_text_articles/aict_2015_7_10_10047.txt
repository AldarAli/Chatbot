0HDQ2SLQLRQ6FRUH0HDVXUHPHQWV%DVHGRQ(0RGHO'XULQJD9R,3FDOO
A Single Comparison On-line and Off-line 
 
Edgard Silva, Leandro Galv√£o, Edjair Mota 
Institute of Computing ‚Äì ICOMP 
Federal University of Amazonas ‚Äì UFAM 
Manaus ‚Äì Brazil 
e-mail: {edgard, galvao, edjair}@icomp.ufam.edu.br 
Yuzo Iano 
Department of Communications ‚Äì DECOM 
University of Campinas ‚Äì UNICAMP 
Campinas ‚Äì Brazil 
e-mail: yuzo@decom.fee.unicamp.br
 
$EVWUDFW¬≤ 7KLV SDSHU SUHVHQWV WKH 0HDQ 2SLQLRQ 6FRUH
026PHDVXUHPHQWVUHVXOWVRIDQLQSXWVWDJHRIDQDGDSWLYH
VSHHFKEDVHGRQ4XDOLW\RI([SHULHQFH4R(FRQWUROGXULQJD
9RLFH2YHU,QWHUQHW3URWRFRO9R,3FDOO4R(LVSHULRGLFDOO\
GHWHUPLQHG E\ PHDQV RI D PRGLILHG YHUVLRQ RI (PRGHO DQG
UHFRUGHGLQDORJILOH$WWKHHQGZHFRPSDUHGWKHUHVXOWVWR
32/4$3HUFHSWXDO2EMHFWLYH/LVWHQLQJ4XDOLW\$VVHVVPHQW
DQGSURYHWKDWFRQWLQXRXVO\PHDVXUHPHQWVDUHFRUUHFWDQGFDQ
EHXVHGLQWKHIXWXUHUHDOWLPH4R(FRQWUROOHUWREHEXLOG
.H\ZRUGV4XDOLW\RI([SHULHQFH4R(9RLFHRYHU,QWHUQHW
3URWRFRO9R,3$GDSWLYHFRQWUROV\VWHP026VSHHFKTXDOLW\
&RGHF6ZLWFKLQJ
I. 
 INTRODUCTION 
Present in our personal and professional activities, speech 
signals transmissions over computer networks (VoIP - Voice 
over Internet Protocol) have gained wide acceptance by 
general Internet users. In a VoIP application, the main goal is 
to transfer voice signals over the IP network. In order to 
achieve this, the voice is digitized and packetized at the 
sender, and next, the result of the packaging is transmitted 
over the IP network to the receiver. In the receiver, the voice 
signals are unpacked from the received packets and then are 
decoded. After this, the results are played out to the listener 
[1]. However, VoIP is subject to several degradations, both 
at the application layer or the network layer, such as 
compression of the encoder, the delay end-to-end packet 
loss, jitter and bandwidth levels. Thus, to keep and attract 
new users, the quality of the provision of VoIP services need 
to be measured and optimized to ensure user satisfaction [2].  
Quality provision assurance is one of the problems not 
solved yet, although VoIP enjoys the progress made in the 
last two decades [3]. In recent years, researchers developed 
Quality of Service (QoS) Control mechanisms to improve 
the use of network resources and user's terminal to minimize 
speech quality degradation. Some of these mechanisms seek 
to adapt the voice stream or other VoIP parameters, 
according to significant changes in network end users 
preferences, or providing requirements of service providers.  
The speech quality can be measured subjectively or 
objectively. 
Subjective 
evaluation 
involves 
12-24 
participants individually listening to an audio stream of 
several seconds and classifying the audio quality on a scale 
of 1 (poor) to 5 (excellent). These ratings form a single Mean 
Opinion 
Score 
(MOS), 
as 
specified 
in 
ITU-T 
Recommendation P.800 [4]. This evaluation is costly and 
time-consuming and it cannot be done in real-time if one 
considers these characteristics. Thus, various techniques 
have been proposed to estimate objectively MOS (without 
human perception), such as POLQA [5] and E-model [6]. 
POLQA [5] is a perceptual technique that compares off-
line two signals to generate the MOS: a reference signal (for 
example, captured at the sender) and the degraded signal (for 
example, captured at the receiver). The requirement makes 
the approach unsuitable for live call monitoring. On the other 
hand, the technique of E-model specified in ITU-T Rec. 
G.107 [6] is a noninvasive method that uses the network 
metrics monitored locally and the equipment impairment 
factor to estimate the quality of the call, so it can be used for 
monitoring live calls. A problem with the E-model is that 
only the ITU-T provides the equipment impairment factor 
specified in ITU-T Rec. G.113 [7]. For a range of other 
commonly used codecs not specified by the ITU-T Rec. 
G.113 [7], the equipment impairment factor is not provided.  
Adaptive control systems in general respond to changes 
in their internal state or external environment with guidance 
of an underlying control system. VoIP systems are likely to 
need dynamic adaptation to deal with the complex dilemma 
between voice quality and impairment. This is necessary due 
to the nature of decentralized control of IP networks and the 
stochastic nature of data packets delivery. While existing 
solutions for QoS control of VoIP show some performance 
improvement and have feedback, they do not provide explicit 
focus on the control loop [8]. Measurable QoS relates 
directly to the state of the network, while QoE relates 
directly the quality level perception that users have. This 
perception will play a key role in the decision of making a 
VoIP application success or failure [9]. 
In this paper, our intention is to obtain measurements in 
real-time, of QoE of a VoIP transmission. In the future, our 
intention is be to develop a robust controller for a codec in 
command of a bidirectional audio stream. 
The outline of the paper is as follows. The next section 
briefly surveys the issue concerning the adaptation during a 
VoIP call. Section III presents the methodology we followed 
to get measures of the metrics of interest. This section also 
presents details about the scenarios for testing and the 
measurements results while Section IV discusses the 
findings. A brief concluding section presents our ongoing 
research. 
132
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-411-4
AICT 2015 : The Eleventh Advanced International Conference on Telecommunications

II. 
BACKGROUND 
The studies conducted by Karapantazis [3], Manousos 
[10], Costa [11], Qiao [12], Myakotnykh [13] and Viana [14] 
show that adaptation during a VoIP call (e.g., codec, 
packing, redundancy) can significantly improve the speech 
quality. However, as pointed out by Carvalho [15], these 
works often focus on parameter setting and little or nothing 
are based on the advances of research in adaptive systems.  
Aktas et al. [16] compares the speech quality of a set of 
standard VoIP codecs given different network conditions and 
propose an adaptive end-to-end based codec switching 
scheme based on packet loss, jitter, and available bandwidth 
as the factors that define the current network condition.  
Costa and Nunes [17] describe an adaptive codec 
switching technique that starts to monitor and analyze the 
quality of the voice, changing to a lower or higher codec rate 
according to predefined threshold values for each codec.  
Haytham Assem [1] presents and evaluates an algorithm 
that performs the selection of the most appropriate audio 
codec given prevailing conditions on the network path 
between the endpoints of a voice call.  
Bringing together contributions from the fields of VoIP 
and adaptive control systems, this project proposes a well-
founded solution to the problem of real-time control of the 
quality of speech on VoIP calls and introduces the method of 
measurement and results the input signal of the proposed 
controller. For this, it is necessary to define what to measure 
and how to measure these parameters of the controller input.  
III. 
METHODOLOGY 
The method to be employed in this work is to improve 
the diagnostic module developed in [15]. The diagnostic 
module is composed of agents of monitoring and analysis. It 
uses the RTCP XR reports (RTP Control Protocol Extended 
Reports) [18]. These reports carry information about the 
instantaneous quality of a VoIP call, such as loss, delay and 
ambient noise, codec impairment, all this used in a function 
that calculates the E-model for instant call quality.  
As a testbed, we used 64-bit machines with Ubuntu 10.04 
operating system (newer versions proved inefficient for 
preliminary tests and incompatible with the Intel IPP 7.7.1, a 
codec library used in the experiments) to implement the 
PJSIP 1.10, a free library of multimedia communication and 
open code written in the C language that implements the 
protocols based on standards such as SIP, SDP, RTP, among 
others [19]. 
We had in the first instance, a machine (sender) directly 
connected to another machine (receiver) as proof of concept 
for local testing and controlled conditions.  
At all stages of this experiment, we recorded logs files of 
transmission (sent file) and received (received file) files for 
analysis in Section VII. We transmitted the same file 
multiple times in different test scenarios and test multiple 
files with different contents in order to compare the 
measurements of the systems (internal measurements) and 
the result of the global measurements (POLQA).  
We have two kinds of moments of measurements: during 
a VoIP call (punctual) and the cumulative average at the end 
of a VoIP call (global).  
This paper presents the results of measurements 
performed during a call, the procedure and the results 
graphically.  
During a VoIP call, there are two applications for point 
measurements, which are results of the measurements 
provided by the E-model routine implemented in PJSIP via 
RTCP-XR: 
‚Ä¢ 
Communication Performance: the instantaneous 
value of the QoE during an analysis interval of a 
VoIP call. 
‚Ä¢ 
Control: (Specifically in this study, the control 
application is not enabled). 
We have the E-model (Rec. ITU-T G.107 [6]) among the 
methods of timely measurement of quality of speech most 
used. Its measurement procedure consists of collecting 
parameters of voice stream, which serve as input to a set of 
equations that return as a result the R factor, whose value 
ranges from 0 (worst) to 100 (best) as a measure of quality 
speech evaluated. This result is mapping from R factor (0-
100) to MOS (1-5) by (1). 
¬ö
 


 

 

 
(1) 
Typically, the result of E-model is transformed to a scale 
of MOS [4] as presented in Table I. 
At the end of the VoIP call, we received a file (received 
file) for a given file transmitted (sent file) in a given 
situation, to be used for measuring the overall quality of the 
call during the analysis presented in Section IV, and a score 
between 1 and 5 is generated, including a confidence 
interval.  
IV. 
ANALYSIS OF RESULTS 
Having two types of metrics (punctual/local and 
global/external) we had two stages of analysis.  
Quality measurement based on QoE will be held along 
the VoIP call. The measurement data quality along the VoIP 
call will be determined by a series of calls, with the same 
uploaded file (sent file), with and without the controller 
application enabled. Then, the results will be compared each 
other. A graphic of the call quality over time will be 
generated (in seconds) (Q √ó t) for both situations, 
considering the uncertainty range for each measurement 
point in the various transmissions.  
The signal received by the listener (received file) will be 
recorded and compared off-line with the transmitted signal 
(sent file) with a perceptual objective method of measuring 
quality of speech and should be as close as possible to the 
subjective quality scores obtained in subjective tests hearing. 
 
 
133
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-411-4
AICT 2015 : The Eleventh Advanced International Conference on Telecommunications

TABLE I.  
MEAN OPINION SCORE VALUE [16] 

V. 
CONCLUSIONS AND FUTURE WORK 
This paper presented the results of measurements of input 
parameters of an adaptive control system of quality of speech 
based on QoE during a VoIP call. 
The QoE varies along a voice transmission depending on 
factors like packet loss, jitter and bandwidth in addition to 
the equipment impairment factor. It is possible to measure 
these values and transform them into a single value (R 
factor). The R factor and the value of MOS Quality can be 
used as input variables in our adaptive control system. They 
vary over time and its measurement was easily implemented. 
This will lead our control system to make a decision to 
change or not the encoder and when this change will be 
made in order to impact as little as possible the 
communication. The current encoder itself represents one of 
the input parameters in the control system; all of that seeks to 
minimize the encoder changes in order to maintain the best 
quality experience for the users. 
The system will choose a new codec according to the 
trend of monitored variables. Machine learning can be used 
as new encoders appear on the market. Three factors must be 
considered: a) when to switch the codecs, b) the codec used 
and the codec chosen to replace it and c) the reasons that led 
to the decision by the choice of the new codec.  
The next steps of this work will be the extent of 
equipment impairment factor for no ITU codecs, such as 
Speexs, for example. Moreover, add to library encoders 
available, the Opus [8][24] wideband codec.  
ACKNOWLEDGMENT 
We would like to thank the School of Technology (EST) 
of the State University of Amazonas (UEA), the Foundation 
for Research Support of the State of Amazonas (FAPEAM), 
the Department of Communications of the Faculty of 
Electrical and Computer Engineering of the University of 
Campinas (UNICAMP), FAPESP, CAPES and CNPq for 
support in developing this work. 
REFERENCES 
[1]  A. Haytham, M. Adel, D. Malone, B. Jennings, J. Dunne, and P. 
O‚ÄôSullivan, ‚ÄúA Generic Algorithm for Mid-Call Audio Codec 
Switching,‚Äù in 




 ! ! "$#&%
'()#+*&%
,
-.#*/102-.()3465&-
78,
#:9<;*&/
,
%
=>-
?
 @$7!'(A,
'#+BA'DCE'A#&%
(A,
BGFH*#+*.I&'JK'#&%2L
9KCMFONMPRQ	STVU)W , Ghent, Belgium, 
May 2013.  
[2]  D. Rodrigues, E. Cerqueira, and E. Monteiro, ‚ÄúQoE Assessment of 
VoIP in Next Generation Networks,‚Äù in 
M(-BX''AY	,
#.I&4Z-
?[%
5'[TVQ&%
5




 ! ! \$#&%
'()#*%
,
-V#*/]C^-V#
?'(6'A#&BA'_-V#`FH*#+*.I&'JK'#&%]-
?F_;+/
%
,
Ja'AY	,
*
*+#Y:F_-+b+,
/
'cPK'V%
d<-.(634e*+#Ygf'(6h.,
BA'A4Aij0,
()'Y&k
0,
()'./
'464eF_;+/
%
,
Ja'AY	,
*
PK'.%
d<-.(634M*#+Ylf'(6h.,
BX'4MFH*#+*.I+'Ja'#&% , Venice, Italy, October, 2009.  
[3]  S. Karapantazis and F.-N. Pavlidou, ‚ÄúVoIP: A comprehensive survey 
on a promising technology,‚Äù 
C]-.J7M;&%
'(aPK'V%
d<-.(634)m vol. 53, 2009, pp. 
2050‚Äì2090.  
[4]  ITU-T, ‚ÄúRec. P.800: Methods for subjective determination of 
transmission quality,‚Äù Geneva (Switzerland), 08/1996. 
[5]  ITU-T, ‚ÄúRec. P.863: Perceptual objective listening quality assessment 
(POLQA),‚Äù Geneva (Switzerland), 01/2011. 
[6]  ITU-T, ‚ÄúRec. G.107: The E-model, a computational model for use in 
transmission planning,‚Äù Geneva (Switzerland), 07/2002. 
[7]  ITU-T, ‚ÄúRec. G.113: Transmission impairments due to speech 
processing Appendix I: Provisional planning values for the equipment 
impairment factor Ie,‚Äù Geneva (Switzerland), 10/2001. 
[8]  J.-M. Valin, K. Vos, and T. B. Terriberry, ‚ÄúDefinition of the Opus 
Audio Codec, RFC6716,‚Äù September 2012. [Online]. Available: 
http://www.rfc-base.org/txt/rfc-6716.txt. [retrieved: Feb. 2014]. 
[9]  M.-D. Cano and F. Cerdan, ‚ÄúSubjective QoE analysis of VoIP 
applications in a wireless campus environment,‚Äù 
n+'./
'VB-.JaJo;.#	,
BA*&%
,
-V#
fX=4%
'Ja46m vol. 49, 01 January 2012, pp. 5-15.  
[10] M. Manousos, S. Apostolacos, I. Grammatikakis, D. Mexis, D. 
Kagklis, and E. Sykas, ‚ÄúVoice-quality monitoring and control for 
VoIP,‚Äù 
$#%
'(6#'.%&C^-.J7M;&%
,
#I+m vol. 9, no. 4, July-Aug 2005, pp. 35-42.  
[11] N. Costa and M. S. Nunes, ‚ÄúDynamic Adaptation of Quality of 
Service for VoIP Communications,‚Äù vol. 2, no. 2 and 3, 2009, pp. 
155-166.  
[12] Z. Qiao, L. Sun, N. Heilemann, and E. Ifeachor, ‚ÄúA new method for 
VoIP quality of service control use combined adaptive senter rate and 
priority 
marking,‚Äù 
in 

  ! p
#%
'(6#*%
,
-.#*/qC^-V#
?'(6'A#&BA'r-.#
C]-.JaJa;#,
BX*%
,
-V#+4 , 2004.  
[13] E. S. Myakotnykh and R. A. Thompson, ‚ÄúAdaptive Rate Voice over 
IP Quality Management Algorithm,‚Äù 

#%
'(6#*%
,
-.#*/[s-;()#*/j-V#
N]Y+hA*#&BA'A4<,
#n'./
'VB-.JaJo;.#	,
BA*&%
,
-.#46m vol. 2, 2009, pp. 98-110.  
[14] B. d. A. Vianna, N. T. Moura, C. V. N. d. Albuquerque, V. E. F. 
Rebello, and C. Boeres, ‚ÄúadaMOS: Algoritmo MOS-Adaptativo para 
Fontes VoIP,‚Äù in 
0a'.bFG'AY	,
*et
Su`!(-BA'A'AY	,
#I&4H-
?v%
5+'DTQ%
5vwM()*.xV,
/
,
*#
fX=J7^-.4X,
;J\-V#oF_;+/
%
,
Ja'AY	,
*l*#+Y%
5+'<d]'Vb , New York, NY, USA, 2006.  
[15] L. S. G. d. Carvalho, ‚ÄúAdaptive Management of Speech Quality 
Between VoIP Terminals,‚Äù PhD thesis, Universidade Federal do 
Amazonas (UFAM), Manaus, 2011. 
[16] I. Aktas, F. Schmidt, E. Weing√§rtner, C.-J. Schnelke, and K. Wehrle, 
‚ÄúAn Adaptive Codec Switching Scheme for SIP-Based VoIP,‚Äù in 
TVQ&%
5
$#%
'()#*%
,
-V#*/\C^-.#
?V'()'#+BA'AmvP< o0aQNMPyQ	STQ+m*#+Y"z+%
5{C]-V#
?'(6'A#&BX'm
(;f.FON^|]nlQSTVQ , St. Petersburg, Russia, Jan. 2012.  
[17] N. Costa and M. S. Nunes, ‚ÄúAdaptive Quality of Service in Voice 
over IP Communications,‚Äù 
M(-BX''Y,
#I&4y-
?q%
5'}QS+SV~],
?%
5
$#%
'()#*%
,
-V#*/^C]-V#
?V'(6'A#&BX'G-.#GPK'V%
d<-.()3,
#I¬Ä*#+Y`f+'()h,
BA'4HL
6CP<f¬ÄQSS.~)W , 
Abril 2009m pp. 19-24.  
[18] T. Friedman, R. Caceres, and A. D. Clark, ‚ÄúRTP Control Protocol 
Extended Reports (RTCP XR). Request for Comments (RFC) 3611,‚Äù 
November 
2003. 
[Online]. 
Available: 
https://tools.ietf.org/html/rfc3611. 
[19] B. Prijono and P. Ismangil, ‚ÄúPJSIP,‚Äù [Online]. Available: 
http://www.pjsip.org/. [retrieved: Feb. 2015]. 
[20] G. Ewing, K. Pawlikowski, and D. McNickle, ‚ÄúAkaroa-2: Exploiting 
network computing by distributing stochastic simulation,‚Äù in 
M(X-BX''AY	,
#.I&4j-
?¬Å%
5+'RT.U+%
5¬Å M;(-$7!'*#:f	,
Ja;&/
*%
,
-.#¬ÅFG;&/
%
,
k
BV-V#
?'(6'A#&BX' , 
Warsaw, Poland, 06/1999.  
[21] R Core Team, ‚ÄúR: A Language and Environment for Statistical 
Computing,‚Äù R Foundation for Statistical Computing, 2013. [Online]. 
Available: http://www.R-project.org. [retrieved: Feb. 2015]. 
[22] O. Project, ‚ÄúOpen Speech Repository,‚Äù [Online]. Available: 
http://www.voiptroubleshooter.com/open_speech/american.html. 
[retrieved: Feb. 2015]. 
[23] Linux Foundation, ‚ÄúNetem: Network Emulator,‚Äù 19 November 2009. 
[Online]. 
Available: 
http://www.linuxfoundation.org/collaborate/workgroups/networking/n
etem. [retrieved: Feb. 2015]. 
[24] IETF, ‚ÄúDefinition of the Opus Audio Codec, RFC6716,‚Äù IETF, 09 
2012. [Online]. Available: http://www.rfc-base.org/txt/rfc-6716.txt. 
[retrieved: Feb. 2015]. 
[25] H. M√ºller, M. Pezz√®, and M. Shaw, ‚ÄúVisibility of control in adaptive 
systems,‚Äù in 
M(-BX''AY	,
#I¬É¬Ç¬Ñ¬Öff.$f¬Ét
SV¬Ü{M(-BX''AY	,
#.I&4g-
?¬á%
5+'>Q#+Y
,
#&%
'()#+*&%
,
-V#+*&/gdK-V(634)5-
7¬à-V#¬â¬ÇE/
%
()*+k
/
*+($I&'Vk
4BX*/
'¬ä4-
?%
d]*+()'Vk
,
#%
'A#+4X,
h'
4
=4X%
'Ja4 , New York, NY, USA, 2008. 
135
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-411-4
AICT 2015 : The Eleventh Advanced International Conference on Telecommunications

