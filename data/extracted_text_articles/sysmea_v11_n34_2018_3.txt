259
International Journal on Advances in Systems and Measurements, vol 11 no 3 & 4, year 2018, http://www.iariajournals.org/systems_and_measurements/
2018, © Copyright by authors, Published under agreement with IARIA - www.iaria.org
On the Design, Construction and Calibration of Dual-Probe Heat-Pulse
Soil Moisture Sensor:
Towards an Industrial Solution
Antonio Valente∗, Arata Andrade Saraiva†, N. M. Fonseca Ferreira‡, and Salviano Soares§
∗INESC TEC - INESC Technology and Science
†CEUMA
and University of Tr´as-os-Montes and Alto Douro
and State University of Piaui-Piripiri, Brazil
Vila Real, Portugal
and University of Tr´as-os-Montes and Alto Douro,
Email: avalente@utad.pt
Vila Real, Portugal
ORCID: 0000-0002-5798-1298
Email: aratasaraiva@gmail.com
ORCID: 0000-0002-3960-697X
‡INESC TEC - INESC Technology and Science
§IEETA - UA
and Institute of Engineering of Coimbra,
and University of Tr´as-os-Montes and Alto Douro,
Polytechnic Institute of Coimbra,
Vila Real, Portugal
Coimbra, Portugal
Email: salblues@utad.pt
Email: nunomig@isec.pt
ORCID: 0000-0001-5862-5706
ORCID: 0000-0002-2204-6339
Abstract—There is a need for a multi-functional probe for small-
scale measurements of different soil properties measured within
identical soil volumes. Dual Probe Heat Pulse (DPHP) sensors are
an economical solution for this since they measure simultaneously
temperature, volumetric water content, and soil thermal proper-
ties: diffusivity and volumetric heat capacity. However, all DPHP
sensors to date have very complex manufacturing processes. This
paper aims to design and build a DPHP sensor based only on a
Printed Circuit Board (PCB) board, which comprises the probes
and all supporting electronics leading to a low cost and simple
manufacturing process. The proposed system includes signal-
processing circuits, a microcontroller, and communicates by a
Serial Digital Interface at 1200 baud protocol (SDI-12). The
sensor needs a one-time two calibrations: distance from heater to
temperature sensor calibration using agar solution; and sensor
calibration in soil using Tottori Dune sand. Both calibration
processes showed a reasonably good agreement between measured
and ﬁtted data. In conclusion, results also show that it is possible
to build the multi-functional DPHP sensor in a low cost process,
and this was the ﬁrst time that a multi-functional probe was build
using a Printed Circuit Board (PCB) as support.
Keywords–soil moisture sensor; soil thermal properties; dual-
probe; heat-pulse sensor; thermal conductivity; thermal sensors.
I.
INTRODUCTION
The heat pulse-based soil moisture sensors, of which stand
out Dual Probe Heat Pulse (DPHP) sensors, are an economical
solution for soil moisture measurements. This paper is an
extension of [1] and focuses the construction and calibration of
PCB based soil moisture sensor based on the DPHP method.
The DPHP-based sensor has two elements, the heater and
the temperature sensor, separated by a short distance, r, as
depicted on Figure 1. The heater and the temperature sensor
are placed in a physical support, the heater probe and the
temperature sensor probe, respectively. A voltage pulse, with
ﬁnite duration t0, is applied to the heater element causing the
heat to ﬂow in all directions around the heater element. Heat
Temperature Probe
Heater Probe
DPHP
Sensor
x-y plane (Soil)
r
Heater
Temperature
Sensor
Heater
Temperature
Sensor
Figure 1. Dual Probe Heat Pulse method.
‘traverses’ the surrounding soil and the temperature rise will
be measured by a sensor on the temperature probe.
Most sensors use needles as heating element and tem-
perature sensing element. There are very few cases where
the sensor is not directly connected to a data-logger, that
is, all the inspection, control and processing is not done in

260
International Journal on Advances in Systems and Measurements, vol 11 no 3 & 4, year 2018, http://www.iariajournals.org/systems_and_measurements/
2018, © Copyright by authors, Published under agreement with IARIA - www.iaria.org
the sensor itself, but in an external element - the data-logger
(which implies, almost always, a dedicated data-logger for
each sensor).
The use of needles, and the control, acquisition and pro-
cessing, external to the sensor, has made this method difﬁcult
to use in the ﬁeld. Therefore, in this work we resolve these
shortcomings.
In particular, we make the following contributions:
•
Place all the electronics near the probes (heating and
temperature probes). This contribution (Section IV),
although already achieved by [2], uses only a tem-
perature probe, making the construction of the sensor
simpler at the expense of measuring the ﬂow of water
in the soil.
•
We present a new form of sensor construction which
uses the PCB, also used for the rest of electronics,
as a support for the temperature and heating probes
(Section IV). This is a great achievement as it will
enable the industrial production of the sensor at a
reduced cost.
•
All calculations of the model used (Section III) are
performed inside of the on-board microcontroller.
•
Two calibration types: calibration of the distance be-
tween the heater element and the temperature sensor
(for this calibration process it was used agar); and
calibration of the sensor using Tottori Dune sand as
soil type whose physical characteristics are widely
reported [3]–[5]. The results of the calibrations (Sec-
tion V) showed good results of the model used.
The rest of this paper is organized as follows. Section III
describes the models implemented for the calculation of the
soil thermal properties and volumetric water content. Sec-
tion IV details all the fabrication process of the DPHP sen-
sor, calibration method of the distance between heater and
temperature sensor, and SDI-12 communication commands
implemented. Section V addresses the sensor calibration re-
sults and shows sensor prototypes. The acknowledgement and
conclusions close the article.
II.
RELATED WORK
Since Campbell [6], much research has been done and
reported that the heat pulse technique is an economical tech-
nique to measure soil thermal properties and soil moisture
content [2], [4]–[21]. Although it is an economical method,
for several reasons the sensors that use the DPHP method have
not yet left the research laboratories.
Some works mention ﬁeld use, such the work described
in [11]. However, the sensors developed were prepared for
use in the laboratory and were subsequently used in the
ﬁeld. This solution leads to some problems such as accidental
and continuous heating of the dual-probe heat-pulse sensors
during a ﬁeld test, causing the heater element resistance to be
damaged, as reported in [11].
As mentioned, in almost all developed sensors [2], [4]–
[16] uses needles as housings for the heat source and the
temperature sensor. Normally, the heating probe is composed
of a needle where a conductive wire (with a high resistivity,
suitable for producing resistances for heating - 0.062 mm
Evanohm enameled wire) is inserted inside. A single very ﬁne
wire is threaded into the needle four times creating two turns.
The heater wire was spliced onto copper leads to form the
connections to the resistance forming the heater element.
The probe with the temperature sensor is elaborated in the
same way, by inserting inside the needle and the longitudinally
centering the temperature sensor (thermocouple or thermistor).
Both needles are then ﬁlled with an epoxy glue of high thermal
conductivity and low electrical conductivity. Therefore, the use
of this process is laborious and difﬁcult, if not impossible, for
industrialization.
Other authors have attempted, without known success, to
develop soil moisture sensors based on the heat pulse without
the use of needles. In this group, there are the works of [17]–
[19], [21] who developed microelectronics to try to improve
the manufacturing process and in other works a button-shaped
sensor was developed [16], [20]. The button-shaped sensor
also use the same kind of wire (very thin) and in one of the
works [16] a needle is used which is folded into a ring type
shape. This needle, which is the heater element, uses the same
assembly method described above.
Most of the work done with DPHP sensors uses data-
loggers to acquire data from temperature probe, to control
heat pulse duration and to perform calculations. A recent
work [2] that presents a novel design of a multifunctional
penta-needle thermo-dielectric sensor with advantage for in-
situ and simultaneous determination of water content (θv),
thermal conductivity (λ), and thermal diffusivity (κ) in porous
media, overcomes this problem but still uses needle type
probes.
In conclusion, of all the literature consulted, no sensor was
found based on the heat pulse method that uses the supporting
PCB for the reading, control and communication electronics, as
well as support of the elements heater and temperature sensor.
This fact allows us to think that this is the ﬁrst time that this
process is used, being a good basis for industrial production
of this type of sensors.
III.
THEORY
There are some models to describe the operation of sensors
based on the DPHP method. The simpler model, described by
Campbell [6], considers that the heat source is an inﬁnite line
and the heat pulse is released instantaneously. Other models [7]
increase the constraints of the model of Campbell, considering
that the heat pulse is ﬁnite, that the source line is ﬁnite and,
ﬁnally, that it is not a source line, but a cylinder. Of these
models the most common is the model which considers the
ﬁnite heat pulse generated by an inﬁnite source line [7]. In the
present work, this will be the adopted model due to its pre-
cision and relative ease implementation in a microcontroller-
based system. The solution for conducting radial heat from a
short-duration, t0 , heat pulse away from an inﬁnite source
line, for t > t0 is
∆T(r, T) =
q′
4πκρc

Ei

−r2
4κ(t − t0)

− Ei
−r2
4κt

(1)
where, ∆T is change in temperature (◦C), r is radial distance
from the line source (m), t is time (s), q′ is the energy input

261
International Journal on Advances in Systems and Measurements, vol 11 no 3 & 4, year 2018, http://www.iariajournals.org/systems_and_measurements/
2018, © Copyright by authors, Published under agreement with IARIA - www.iaria.org
per unit length of heater per unit time (W m−1), ρc is the volu-
metric heat capacity (J m−3 ◦C−1), κ is the thermal diffusivity
(m2 s−1) of the medium surrounding the heater, and −Ei(−x)
is the exponential integral [22]. The thermal diffusivity (κ) and
volumetric heat capacity (ρc) can be determined from heat-
pulse measurements using the single-point method [8], or a
nonlinear curve ﬁtting where (1) is ﬁtted to measured ∆T(r, t)
data [10]. It was showed that accuracy in ρc will be limited
by the accuracy of r, and accuracy in κ will be limited by the
accuracy of both r and time of maximum temperature change,
tM [8]. The single-point method makes use of the fact that
the temperature response at some distance r from the heater
displays a maximum, so that we can take the derivative of (1)
with respect to time, set the result equal to zero, and obtain the
time, tM, to the maximum temperature change (∆TM). This
yields an expression for estimating κ where
κ = r2
4


1
(tM−t0) −
1
tM
ln

tM
tM−t0



(2)
which is a function of r, tM and t0. Rearrangement of (1)
yields an expression for estimating ρc, for t > t0,
ρc =
q′
4πκ∆TM

Ei

−r2
4κ(tM − t0)

− Ei
 −r2
4κtM

(3)
where κ is obtained from (2). To minimize errors, the single-
point method requires an accurate measurement of r and times
tM and t0. For ρc estimation, in addition to κ from (2) and r,
are needed accurate measurements of q′ and ∆TM. Volumetric
heat capacity ρc of soil can be determined as the sum of the
heat capacities of the individual constituents and considering
that the air is ignored and solids deﬁned to include the mineral
and organic matter fractions then soil water content θv can be
deﬁned as a function of volumetric heat capacity [23],
θv = ρc − ρbcs
(ρc)w
(4)
where ρ is density, c speciﬁc heat, θv volumetric water content,
and the subscripts b, s and w indicates bulk, average properties
of the solids (minerals+organic matter), and water, respectively.
Since (ρc)w is known, measurements of ρc obtained with
the sensor can be used together with estimates (or preferably
measurements) of soil bulk density (ρb) and speciﬁc heat (ρs)
to obtain θv.
IV.
MATERIALS AND METHODS
The developed sensor is a complete solution and this
approach, together with the non-use of needles for the heating
and temperature probes, is new. Next, all details of the sensor
construction, as well as its ﬁrmware, the communication pro-
tocol and as referred to in the previous section the knowledge
of the true value of r (reﬀ) through calibration in agar, will be
explained in detail.
A. Sensor System Description
In Figure 2 is depicted the electronic layout of the
sensor system, the core unit is on-board 16 bit microcon-
troller (PIC24F32KA301) with very low power consumption,
12-channel 12 bit Analog-to-Digital Converter (ADC), serial
communications modules (UART - Universal Asynchronous
Receiver-Transmitter, SPI - Serial Peripheral Interface, and
I2C - Inter-Integrated Circuit), and hardware Real-Time Clock
(RTC) Calendar with alarms. The temperature sensor probe
consists of a 10 kΩ (NCP15XH103F03RC) thermistor, a pre-
cision (0.1 %) voltage reference of 2.048 V (LM4128) and
a 24 bit ADC (MCP3421). The heating probe consists of a
series of 15 resistors of 1 Ω, controlled by an electronic switch
composed of transistors. The system power is from the SDI-
12 power (6 V to 12 V) that feeds a dual DC regulator: 2 V
to 5 V for powering the heat pulse (LM1117), and 3.3 V for
the rest of the system (MIC5219). The voltage control of the
ﬁrst DC-DC converter is achieved with a pulse (Pulse With
Modulation - PWM pulse) controlled by the microcontroller.
The microcontroller controls the heat pulse through the
transistors switch to enable/disable the power to the heater.
To determine accurately the value of q′ (heat input per unit
length per unit time), average current through the heater was
determined by sampling the voltage across a 0.18 Ω resistor
(1 %) in series with the heater 15 Ω resistor (15 × 1 Ω), and
the voltage across resistance series of the heater and current
measure resistor. The value q′ is determined by
q′ = Vheater × Iheater ×
1
lheater
(5)
where Vheater is the measured voltage across the heater,
Iheater is the current through the heater given by Iheater =
VR=0.18/0.18 Ω (VR=0.18 is the measured voltage across
the 0.18 Ω resistor), and lheater is the length of the heater
(0.0353 m). All voltages measured for q′ calculations, are per-
formed by microcontroller internal ADC (12 bit). Temperature
from the temperature probe was measured by sampling the
voltage drop across the thermistor in series with a 10 kΩ
(0.1 %) resistor. This was done on the 24 bit ADC to ensure
sufﬁcient sampling accuracy for determining temperature.
B. Sensor Construction
The prototype of the developed sensor, as shown in Fig-
ure 3, is based on the printed circuit board (PCB) as substrate.
In the PCB are welded all the components necessary for
the operation of the sensor. The design of the PCB was
made in the form of a fork with two ‘rods’ that form the
ADC
Micro
Controller
DC/DC
+3.3V +5V
SDI-12
POWER
DATA
REF
+2.048V
JTAG
Heater Element
Thermistor
24-bit
Figure 2. Sensor overview

262
International Journal on Advances in Systems and Measurements, vol 11 no 3 & 4, year 2018, http://www.iariajournals.org/systems_and_measurements/
2018, © Copyright by authors, Published under agreement with IARIA - www.iaria.org
heating probe and the temperature probe. The thermistor in
the temperature probe is placed in a thermally insulated tab.
The distance between these two elements were designed to
be 6 × 10−3 m. However, this distance has to be calibrated
because as previously described an error in this parameter
contributed signiﬁcantly to the error in the determination of
κ and ρc [9].
The process of mounting the sensor is as follows:
•
Manufacture of PCB board;
•
Assembly of all electric components, except for the
ﬁrst resistance of the heating element due to the mold;
•
Sealing, using a mold as depicted on Figure 4, with
thermoplastic molding resin to achieve high quality
sealing and protection of components of the main
circuit. Overtec 820 15 Hotmelt Glue Gun, from
Techsil Limited, UK, was used with the respective
polyamide resin OverTec 5 FR;
•
Missing resistor placement;
•
Placement of an epoxy adhesive in the heating element
(in all resistors forming it) and in the thermistor.
As can be seen from the description of the process used
for the elaboration of the prototype, it can be turned into an
industrial process.
C. Firmware
The developed ﬁrmware, after all the initialization, enters
into sleep mode waiting for a SDI-12 command. After a aM!
command the ﬁrmware will perform a complete measurement
as presented on Figure 5.
For the implementation of the exponential integral in (3)
in order to obtain the ρc value, the Chebyshev approximations
for the Exponential Integral Ei(x) were used [24]. The im-
plementation was elaborated in C and can be executed in the
microcontroller used (16 bit with 32 kB of program memory
and 2 kB of SRAM).
Heater Element
Temperature Sensor
(Thermistor)
Main Circuit
Figure 3. Sensor 3D view.
Placed after
Molding
Low Pressure
Injection Mold
Temperature Sensor
(Thermistor)
Heater Element
Main Circuit
Figure 4. 3D view of the construction details.
1: repeat
▷ Read soil temperature before applying heat
2:
StartTemperature ← temperature
3: until time < 12 s
4: HeatPulse ON (5 V)
5: repeat
▷ Read heat power
6:
HeatV oltage ← voltage
7:
HeatCurrent ← current
8: until time < 8 s
9: HeatPulse OFF
10: Calculate q′ using (5)
11: repeat
▷ Read Temperature Increase
12:
▷ (3 samples/second)
13:
∆T ← temperature − StartTemperature
14:
DetectMaxTemperature (∆TM, tM)
15: until time < 120 s
16: Calculate κ using (2)
17: Calculate ρc using (3)
18: Calculate θv using (4)
19: Enter SLEEP mode (760 s)
Figure 5. Firmware algorithm
The presented values for the heater voltage (5 V), the
heating duration (8 s) and the time allowed for the next
measurement are the defaults. These values can be change as
described next.
D. Digital Communications
The sensor uses SDI-12 protocol for digital communication
of sensor data and change sensor parameters. SDI-12 is a
standard to interface battery powered data recorders with
micro-processor based sensors designed for environmental data
acquisition. All SDI-12 communications are transmitted using
American Standard Code for Information Interchange (ASCII)
at 1200 baud with 7 data bits and an even parity bit. The
standard also speciﬁes a communications protocol that allows
sensors to remain in a low-power sleep state until awoken by

263
International Journal on Advances in Systems and Measurements, vol 11 no 3 & 4, year 2018, http://www.iariajournals.org/systems_and_measurements/
2018, © Copyright by authors, Published under agreement with IARIA - www.iaria.org
TABLE I. SDI-12 SENSOR COMMANDS
Command
Description
Command
Description
?!
Return address of the sensor
aI!
Return sensor identiﬁcation
aAb!
Change actual address to new ’b’ address
aXGQ!
Return heating power, q′, value
aM!
Start all measurements
aXGV!
Return heater applied voltage
aM1!
Start soil temperature measurement
aXSVn.n!
Assign heater voltage (from 2.0 to 5.0 V)
aD0!
Read measurements data
aXGT!
Return maximum temperature rise, ∆TM
aHB!
Raw data of temperature curve
aXGH!
Return heat duration, t0
aXGP1!
Return soil volumetric water content, θv
aXGI!
Return heater current
aXGP2!
Return soil thermal diffusivity, κ
aXGR!
Return spacing, r, value
aXGP3!
Return soil volumetric heat capacity ρc
aXSRn.nnn!
Assign new spacing value (from 5.500 to 6.500 mm)
aXGB!
Return soil bulk density, ρb
aXSHnn!
Change heat duration (from 6 to 30 s)
aXSBm.nn!
Set soil bulk density (from 0.90 to 2.00 103 kg m−3)
a serial break signal sent by the master. The ﬁrst character of
each command is a unique sensor address, a, that speciﬁes
with which sensor the recorder wants to communicate.
Table I lists all the commands that the sensor will respond
to. In addition to the standard commands it was necessary to
implement a set of extended commands (with an X after the
address) in order to conﬁgure the sensor and obtain individual
readings of some parameters. These extended commands use
letter G after the X to get extra data from the sensor (heater
voltage, heating power, heater current, spacing between heater
and temperature sensor, maximum temperature rise, time of the
maximum temperature rise, soil bulk density, and individual
sensor parameters readings: soil volumetric water content,
soil thermal diffusivity, and volumetric heat capacity), and a
letter S to set new values for heater applied voltage and heat
duration, to new spacing value, and to set new bulk density.
Access to metadata is also available as presented in version
1.4 of the SDI-12 speciﬁcation [25]. For calibration and
whenever necessary, the raw values (16 bit unsigned ﬂoating
point format) of the temperature curve can be requested using
the High Volume Binary Command (aHB!).
E. Probe Distance Calibration
The measurement of κ and ρc are highly sensitive to
effective separation distances, r, between the heater element
on heater probe and the thermistor on temperature sensor
probe [9]. Thus, calibration of this distance was crucial for ac-
curate measurements. The calibration was performed by insert-
ing the sensor in a gel that was made from a 4 × 10−3 kg L−1
agar solution, Figure 6. The agar has equal thermal properties
as water, yet does not create heat convection as would occur
by heating liquid water [6].
The measured temperature response in agar solution was
used to calibrate the sensor separation distance for each ther-
mistor by ﬁtting the measured temperature change to (1) using
known values of volumetric heat capacity (4174 kJ m−3 K)
and thermal diffusivity (1.436 × 107 m2 s−1) of water, as
showed on Table II.
TABLE II. THERMAL PROPERTIES OF WATER AT 20 ◦C.
Physical Parameter
Value
ρw (kg m3)
998.2
cw (J kg1 K−1)
4181.6
Cw (kJ m3 K−1)
4174
κw (m2 s−1)
1.4×10−7
F. Sensor Calibration
In this study, the developed soil moisture sensor has
calibrated in laboratory conditions with a constant temperature
of 20 ◦C using Tottori Dune sand because it allows for rapid
saturation and drainage across a wide water content range.
Physical properties are listed in Table III. In this study the
method used for water content determination was the gravimet-
ric method. The mass of water present in the sample is given
Figure 6. Probe distance calibration in agar solution

264
International Journal on Advances in Systems and Measurements, vol 11 no 3 & 4, year 2018, http://www.iariajournals.org/systems_and_measurements/
2018, © Copyright by authors, Published under agreement with IARIA - www.iaria.org
Figure 7. Sensor calibration with Tottori sand.
by the difference in mass between the wet and dry sample.
Water content by mass is deﬁned as the mass of water
divided by the mass of dry soil. The conversion into volumetric
equivalent can be done by multiplying the gravimetric water
content by the dry bulk density of the sample (ρs), with a
knowledge of water density (ρw). The volumetric water content
was calculated using
θ = mw − md
md
ρb
(6)
where ρb (kg L−3) is the dry bulk density to which the material
is packed, and mw (kg) and md (kg) are the wet and dry soil.
TABLE III. PHYSICAL PROPERTIES OF TOTTORI DUNE SAND. AFTER [4]
Physical Parameter
Value
ρb (kg m3)
1630
cs (J kg−1 K−1)
795.0
The soil, Tottori Dune sand, is oven dried (105 ◦C) for
24 hours in order to get the dry soil. Then, soil was
packed uniformly into a plastic container and was weighted
(md=0.600 kg) and a measure was taken (dry soil measure-
ment, θv =0.00 m3 m−3), as shown in Figure 7. After that,
water is applied until saturation was achieved (weight of the
wet soil was 0.732 kg). For this type of soil, saturation was
achieved with θv = 0.36 m3 m−3 using (6) and data from
Table III. With the soil sample at saturation a measurement
was made, followed by three more measurements as the soil
sample was drying in the air.
The values of sample weight, soil gravimetric water content
(θG), and soil volumetric water content (θv) are summarized
on Table IV.
TABLE IV. SOIL WEIGHT VALUES AND CALCULATED VOLUMETRIC
WATER CONTENT
Soil Weight (kg)
θG (kg kg−1)
θv (m3 m−3)
0.600
0.000
0.000
0.630
0.050
0.082
0.650
0.083
0.136
0.700
0.167
0.273
0.732
0.220
0.359
V.
RESULTS AND DISCUSSION
Since this work is only about a description of the design
and the construction of the sensor, only the results about the
sensor assembly and the calibration of the distance between
the probes will be discussed.
A. Printed Circuit Board
The developed Printed Circuit Board (PCB) is shown in
Figure 8. In order to optimize the space provided by the
supplier (Seeed Studio, China) that is 100 mm × 100 mm,
it was possible to place three sensors with mechanical joints
that after welding all components will be cut. This process also
reduces costs by 1/3 of PCB production, with the production
of 30 PCB for about 15 e.
B. Assembled Sensor
Figure 9 shows the assembled sensor without the thermo-
plastic molding resin and the ﬁnal version of the sensor. The
sensor is small in size, compact, robust and easy to use. The
ﬁnal product is comparable to commercial versions of other
soil moisture sensors using other measuring methods, such as
the EC-5, 5TE and 5TM probes from Decagon Devices Inc.,
USA.
This type of sensor (DPHP sensor) compares with capac-
itive type of sensor in terms of accuracy (±3 % [26]), and is
very different from very low-cost resistive sensor. Resistive
sensors give only qualitative estimation of the moisture con-
tent [26].
C. Probe Distance Calibration
The probe distance calibration was determined by obtaining
ﬁve sensor readings in agar solution with an interval of 1 h be-
tween readings and with heating power of q′ = 51.65 W m−1.
Figure 10 presents the measured temperature response as
a function of measurement time of one of these readings.
The measured temperature data was ﬁtted using the non-
linear least-squares Marquardt-Levenberg algorithm. There is
a good agreement between measured and ﬁtted data. The
ﬁtted values of effective separation distance, reﬀ, for all 5
readings are presented in Table V. The average value of reﬀ is
5.534 × 10−3 m. The differences between the designed PCB
layout value (6 × 10−3 m) and effective distances are likely
caused by unprecise placement of the components (heater
and/or thermistor) because they are hand welded. In an in-
dustrial process this error could be minimized and lead to two
kinds of sensors: agar calibrated and uncalibrated lowering the
costs.
It can also be observed in Figure 10 that, compared to
other works [4], [8], [27], just to mention a few, which uses

265
International Journal on Advances in Systems and Measurements, vol 11 no 3 & 4, year 2018, http://www.iariajournals.org/systems_and_measurements/
2018, © Copyright by authors, Published under agreement with IARIA - www.iaria.org
Figure 8. Developed Printed Circuit Board
data-logger for reading and control of the DPHP sensor, this
prototype presents a better resolution (18 bit against 13 bit
of must data-loggers) and a better sampling rate (1 sample/s
against 3 samples/s). This will give a better precision on
calculating ∆TM and tM. We can also observe a good signal
to noise ratio (∆TM = 0.3728 ◦C for a value of 100 % of
θv, agar ⇒ water) even for a lower heat power (51.65 W m−1
against 60 W m−1 - minimum found in literature [8]). This
low power (could be less and adjusted depending on θv values
- lower values less power) is very important in order to use
the sensor in wireless systems (Internet of Things - IoT).
a
b
c
d
Figure 9. Developed prototypes of the DPHP sensor. a) Diapason; b)
Prototype for debug without protective resin; c) Final prototype with
protective resin; d) Decagon 5TE.
TABLE V. CALIBRATION OF THE EFFECTIVE SPACING, reﬀ
Sensor Readings
r(m)
reff(m)
#1
0.006
0.005566
#2
0.005522
#3
0.005521
#4
0.005512
#5
0.005551
Average
0.005534
D. Sensor Calibration
For sensor calibration the sensor was connected to an
Arduino development board according to the wiring diagram
of Figure 11. The SDI-12 listed commands from Table I can
be sent through the serial port (USB) and the Arduino software
(using the Arduino library for SDI-12 communications [28])
is responsible for converting to the SDI-12 protocol for the
sensor.
The calibration of the sensor was done according to the
method described in Section IV-F. When the values indicated
on the scale were in accordance with the desired values, three
sensor readings were taken with half an hour interval between
 0
 0.05
 0.1
 0.15
 0.2
 0.25
 0.3
 0.35
 0.4
 0.45
 20  25  30  35  40  45  50  55  60  65  70  75  80  85  90  95  100  105  110  115  120
max [66.46; 0.3728]
Temperature rise (oC)
Time (s)
 
Temperature data (∆T)
fitted curve
Figure 10. Measured temperature rise after the heat pulse in agar solution
compared to the analytic modeled data (solid line).
Sensor
to +12V Power Supply
GND
Data
to PC
Arduino
Figure 11. Sensor to Arduino connections for SDI-12 protocol conversion.

266
International Journal on Advances in Systems and Measurements, vol 11 no 3 & 4, year 2018, http://www.iariajournals.org/systems_and_measurements/
2018, © Copyright by authors, Published under agreement with IARIA - www.iaria.org
TABLE VI. OBTAINED AND CALCULATED VALUES FROM FIRMWARE IN THE SENSOR
Obtained Values
Calculated Values
θv from calibration (m3 m−3)
∆TM (◦C)
tM (s)
κ (m2 s−1)
ρc (J m−3 ◦C−1)
θv from sensor (m3 m−3)
0.000
1.130410
17.8317
6.8981
1.3150
0.0042
0.082
0.908076
1.6370
0.0816
0.136
0.788853
1.8844
0.1396
0.265
0.613252
2.4239
0.2684
0.359
0.525757
2.8273
0.3668
each one. Readings are made by sending the command 0M!
followed by the command 0XGP2!, sent after the time indi-
cated in the response to the command 0M1 (130 s).
The results obtained for the ﬁve calibration points presented
in Table IV, are represented in Figure 12.
As can be seen, for the Tottori Dune sand measurement
range (0 m3 m−3 to 36 m3 m−3), the temperature rise value
is only 0.65 ◦C. In order to obtain, in comparative terms, a
precision close to commercial capacity-based sensors (3 %),
the accuracy of the temperature reading should be better than
0.05 ◦C which is the accuracy achieved by the developed
sensor.
During the acquisition of temperature, and according to
the algorithm presented in Figure 5, the maximum value
of the temperature rise, ∆TM, and the time at which this
maximum happens, tM, were obtained from temperature reads
and microcontroller timer. With these values and using the
equations (2), (3) and (4), the values presented in Table VI
were calculated o microcontroller ﬁrmware.
It is important to note that the values of tM, and conse-
quently the value of κ (by (2)), can be veriﬁed that κ is only
dependent on tM since t0, the time of the heat pulse, and r, the
distance between the heater element and sensor are constant
and this last was subjected to a calibration process to minimize
errors) are constant for the same type of soil. In this way, the
ﬁrmware obtains the tM value through a sliding average.
To verify the accuracy of the water content measurements,
Figure 13 compares the results of water content from the
sensor and calibration samples obtained with the method
explained on Section IV-F. It is possible verify that the values
for the sensor tted a linear relationship with R2 = 0.9995
and RMSE = 0.003 m3 m−3 over the entire range of θv
from dry to saturation. With the mention two-step calibration
the developed sensor achieved high-accuracy water content
measurements.
 0
 0.2
 0.4
 0.6
 0.8
 1
 1.2
 20
 25
 30
 35
 40
 45
 50
 55
 60
 65
 70
 75
 80
 85
 90
 95
 100
Temperature rise (oC)
Time (s)
 
θv = 0.00
 0
 0.2
 0.4
 0.6
 0.8
 1
 1.2
 20
 25
 30
 35
 40
 45
 50
 55
 60
 65
 70
 75
 80
 85
 90
 95
 100
Temperature rise (oC)
Time (s)
 
θv = 0.08
 0
 0.2
 0.4
 0.6
 0.8
 1
 1.2
 20
 25
 30
 35
 40
 45
 50
 55
 60
 65
 70
 75
 80
 85
 90
 95
 100
Temperature rise (oC)
Time (s)
 
θv = 0.13
 0
 0.2
 0.4
 0.6
 0.8
 1
 1.2
 20
 25
 30
 35
 40
 45
 50
 55
 60
 65
 70
 75
 80
 85
 90
 95
 100
Temperature rise (oC)
Time (s)
 
θv = 0.27
 0
 0.2
 0.4
 0.6
 0.8
 1
 1.2
 20
 25
 30
 35
 40
 45
 50
 55
 60
 65
 70
 75
 80
 85
 90
 95
 100
Temperature rise (oC)
Time (s)
 
θv = 0.36
Figure 12. Measured temperature rise after the heat pulse in Tottori sand for ﬁve moisture contents.

267
International Journal on Advances in Systems and Measurements, vol 11 no 3 & 4, year 2018, http://www.iariajournals.org/systems_and_measurements/
2018, © Copyright by authors, Published under agreement with IARIA - www.iaria.org
 0
 0.05
 0.1
 0.15
 0.2
 0.25
 0.3
 0.35
 0.4
 0
 0.05
 0.1
 0.15
 0.2
 0.25
 0.3
 0.35
 0.4
y = 1.0105
x + (0.0018)
RMSE: 0.0026
R2: 0.9996
Sensor water content (m3 m−3)
Calibration water content (m3 m−3)
 
Sensor data
fitted curve
Figure 13. Comparison of volumetric water content measured by the sensor
and the calibration water content.
VI.
CONCLUSION AND FUTURE WORK
This paper presents a novel design and an industrial process
to build a DPHP sensor based on PCB board as substrate. The
process is based on four steps and two-step calibration process:
in agar for probe distance determination, and using Tottori
Dume sand for sensor validation. The prediction accuracy of
soil volumetric water content, θv by the developed sensor
was validated as 0.003 m3 m−3 for Tottoti Dune sand with
θv varying from dry to saturation.
Results also show that it is possible to build the multi-
functional DPHP sensor in a low cost industrial process (PCB
and assembly). This was the ﬁrst time that a soil moisture
sensor, based on heat-pulse method, was build using a PCB
as support. Further work must be done to ﬁnd out the sensor
accuracy, test sensor readings variations with soil type, and
perform in-ﬁeld and long-term stability tests.
Future work must needed to study the thermal properties
determined under various thermal conditions to ﬁnd any impact
of the ambient temperature on the performance of the sensor.
Also, the use of several sensors connected on the same data-
logger must be evaluated on power consumption and commu-
nications stability.
The authors are producing about 48 sensors for use in the
ﬁeld and connected through SDI-12 to two data loggers with
battery and solar support. The results of this study will be
published in future work.
In addition, as the sensor has a PCB as substrate, pads can
be placed to measure soil moisture using the capacitive method
and to measure soil Electrical Conductivity (EC). This process
may lead to a system with sensory fusion. The capacitive
method, with lower energy consumption, would be the main
method to be used and once or twice a day an acquisition by
the heat pulse method would be made. By using, for example,
a complementary ﬁlter, sensory fusion would be performed. In
this way, it could have a precise sensor, of low cost and with
less energy consumption.
ACKNOWLEDGMENT
This work is ﬁnanced by the ERDF
European Regional
Development Fund through the Operational Programme for
Competitiveness and Internationalisation - COMPETE 2020
Programme within project “POCI- 01-0145-FEDER-006961”,
and by National Funds through the FCT - Fundac¸˜ao para a
Ciˆencia e a Tecnologia (Portuguese Foundation for Science
and Technology) as part of project UID/EEA/50014/2013.
REFERENCES
[1]
A. Valente, A. A. Saraiva, N. F. Ferreira, and S. Soares, “On the design
and construction of dual-probe heat-pulse soil moisture sensor: Towards
an industrial solution,” in ALLSENSORS 2018, vol. 1, 2018, pp. 43–48.
[2]
W. Sheng, K. Rumana, M. Sakai, F. Silfa, and S. B. Jones, “A Multi-
Functional Penta-Needle Thermo-Dielectric Sensor for Porous Media
Sensing,” IEEE Sensors Journal, vol. 16, no. 10, 2016, pp. 3670–3678.
[3]
M. Inoue, J. imnek, S. Shiozawa, and J. Hopmans, “Simultaneous
estimation of soil hydraulic and solute transport parameters from
transient inﬁltration experiments,” Advances in Water Resources,
vol.
23,
no.
7,
2000,
pp.
677
–
688.
[Online].
Available:
http://www.sciencedirect.com/science/article/pii/S0309170800000117
[4]
Y. Mori, J. W. Hopmans, A. P. Mortensen, and G. J. Kluitenberg,
“Multi-functional heat pulse probe for the simultaneous measurement of
soil water content, solute concentration, and heat transport parameters,”
Vadose Zone Journal, vol. 2, no. 4, 2003, p. 561.
[5]
Y. Mori, J. Hopmans, A. Mortensen, and G. Kluitenberg, “Estimation
of vadose zone water ﬂux from multi-functional heat pulse probe
measurements,” Soil Sci. Soc. Am. J., vol. 69, no. 3, 2005, pp. 599–606.
[6]
G. S. Campbell, K. Calissendorff, and J. H. Williams, “Probe for
measuring soil speciﬁc heat using a heat pulse method,” Soil Sci. Soc.
Am. j., vol. 55, 1991, pp. 291–293.
[7]
G. J. Kluitenberg, J. Ham, and K. L. Bristow, “Error analysis of the
heat-pulse method for measuring soil volumetric heat capacity,” Soil
Sci. Am. J., vol. 57, 1993, pp. 1444–1451.
[8]
K. Bristow, G. Kluitenberg, and R. Horton, “Measurement of soil
thermal properties with a dual-probe heat-pulse technique,” Soil Sci.
Soc. Am. j., vol. 58, 1994, pp. 1288–1294.
[9]
G. J. Kluitenberg, K. L. Bristow, and B. S. Das, “Error analysis of
the heat pulse method for measuring soil heat capacity, diffusivity, and
conductivity,” Soil Sci. Soc. Am. J, vol. 59, 1995, pp. 719–726.
[10]
S. Welch, G. Kluitenberg, and K. Bristow, “Rapid numerical estimation
of soil thermal properties for a broad class of heat-pulse emitter
geometries,” Measurement Science & Technology, vol. 7, no. 6, 1996,
pp. 932–938.
[11]
J. Tarara and J. Ham, “Measuring soil water content in the laboratory
and ﬁeld with dual-probe heat-capacity sensors,” Agronomy Journal,
vol. 89, no. 4, 1997, pp. 535–542.
[12]
T. Ren, K. Noborio, and R. Horton, “Measuring soil water content,
electrical conductivity, and thermal properties with a thermo-time do-
main reﬂectometry probe,” SOIL SCIENCE SOCIETY OF AMERICA
JOURNAL, vol. 63, no. 3, 1999, pp. 450–457.
[13]
K. Bristow, G. Kluitenberg, C. Goding, and T. Fitzgerald, “A small
multi-needle probe for measuring soil thermal properties, water content
and electrical conductivity,” Computers and Electronnics in Agriculture,
vol. 31, no. 3, 2001, pp. 265–280.
[14]
T. Ren, T. E. Ochsner, and R. Horton, “Development of thermo-time
domain reﬂectometry for vadose zone measurements,” Vadose Zone
Journal, vol. 2, 2003, pp. 544–551.
[15]
A. Valente, R. Morais, C. Couto, and J. Correia, “Modeling, simulation
and testing of a silicon soil moisture sensor based on the dual-probe
heat-pulse method,” Sensors and Actuators A:Physical, vol. 115, no.
2-3, 2004, pp. 434–439.
[16]
T. Kamai, G. J. Kluitenberg, and J. W. Hopmans, “Design and Nu-
merical Analysis of a Button Heat Pulse Probe for Soil Water Content
Measurement,” Vadose Zone Journal, vol. 8, no. 1, 2009, pp. 167–173.
[17]
A. Valente, J. Cunha, J. Correia, and C. Couto, “A silicon probe with
integrated microelectronics for soil moisture measurements,” in Proc.
of WCCA 2001, 2001, pp. 440–446.

268
International Journal on Advances in Systems and Measurements, vol 11 no 3 & 4, year 2018, http://www.iariajournals.org/systems_and_measurements/
2018, © Copyright by authors, Published under agreement with IARIA - www.iaria.org
[18]
A. Valente, C. Couto, and J. Correia, “On-chip integrated silicon bulk-
micromachined soil moisture sensor based on the DPHP method,” in
Transducers ’01: Eurosensors XV, vol. 1, 2001, pp. 316–319.
[19]
A. Valente, R. Morais, C. Couto, and J. H. Correia, “Modeling and
simulation of a silicon soil moisture sensor based on the DPHP
method for agriculture,” EUROPEAN CONFERENCE ON SOLID-
STATE TRANSDUCERS, no. 2, 2003, pp. 564–567.
[20]
A. Valente, S. Soares, R. Morais, J. M. Baptista, and M. Cabral, “Button
heat-pulse sensor for soil water content measurements,” Proceedings
- 1st International Conference on Sensor Device Technologies and
Applications, SENSORDEVICES 2010, 2010, pp. 180–182.
[21]
A. Valente, R. Morais, J. Boaventura, and C. Jos´e, “A multi-chip-
module micro-system for soil moisture,” in EFITA 2003 Conference,
no. July, Debrecen, Hungary, 2003, pp. 547–551.
[22]
M. Abramowitz and I. Stegum, Handbook of Mathematical Functions.
Dover Publ., 1972.
[23]
G. Campbell, “Soil physics with basic, transport models for soil plant
systems,” Elsevier, 1985.
[24]
W.
J.
Cody
and
H.
C.
Thacher,
“Chebyshev
approximations
for the exponential integral ei(x),” Mathematics of Computation,
vol.
23,
no.
106,
1969,
pp.
289–303.
[Online].
Available:
http://www.jstor.org/stable/2004423
[25]
SDI-12 Support Group, “SDI-12 a Serial-Digital Interface standard
for microprocessor-based sensors,” SDI-12 Support Group, Version
1.4,
May
2017,
[retrieved:
January,
2018].
[Online].
Available:
http://www.sdi-12.org/speciﬁcation.php?ﬁle id=1
[26]
P. Aravind, M. Gurav, A. Mehta, R. Shelar, J. John, V. S. Palaparthy,
K. K. Singh, S. Sarik, and M. S. Baghini, “A wireless multi-sensor
system for soil moisture measurement,” in 2015 IEEE SENSORS, Nov.
2015, pp. 1–4.
[27]
J. M. Tarara and J. M. Ham, “Measuring soil water content in the
laboratory and ﬁeld with dual-probe heat-capacity sensors,” Agronomy
Journal, vol. 89, no. 4, 1997, pp. 535–542.
[28]
S.
W.
R.
Center.
Arduino
library
for
SDI-12
communica-
tions. [Online]. Available: https://github.com/EnviroDIY/Arduino-SDI-
12/issues/17 (2013) Last visited on 2018-11-26.

