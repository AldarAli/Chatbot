A Battery Charging Smart System using a Power Management Algorithm and 
Adaptive Impedance 
Nicusor Nistor, Laurentiu Baicu and Bogdan Dumitrascu. 
Department of Electronics and Telecommunications,  
”Dunarea de Jos” University of Galati 
47 Domneasca Street, 800008 Galati, Romania 
email: nicusor.nistor@ugal.ro 
 
 
Abstract—The 
paper 
proposes 
an 
original 
method 
experimented by the authors, in order to optimize the charging 
process for rechargeable batteries. The method involves: 
testing, adapting and implementing the on board charging 
function, depending on each type of battery used. First of all, 
the method proposes an algorithm for the identification of the 
battery internal resistance, which depends on the wear and 
tear of the battery. Also, the battery charging dynamics will be 
created according to its wear status. This is of particular 
importance in the maximum power transfer especially for 
batteries with high specific power. Secondly, each battery must 
be charged taking into account the type of chemical reaction 
used by the manufacturer in the battery construction process. 
For this, we will test the dynamics of the discharging in a short 
time interval and adapt the load to each type of battery 
differently. The entire process will be implemented and 
controlled by a microcontroller. The proposed solution is not a 
new approach, the subject being of great interest especially in 
the automotive industry, but two of distinct solutions will be 
implemented cumulatively during the same optimization 
process. 
Keywords-smart battery charging; power management; 
adaptive impedance; internal resistance; dynamic charging 
function;  microcontroller based. 
I. 
 INTRODUCTION  
In this paper, a type of battery charger is proposed that 
uses an initial battery test to determine the charging function 
for the charging battery, each time a battery is connected. 
Efficient charging and dynamic change of the resistance 
introduced by the power generator during the charging 
process is considered.  
Although the subject was closely addressed by a 
multitude of researchers in the field, the topic being current 
and interesting in the field of industrial technology and home 
automation [1], [2] and [4]. This research consists of 
proposing the realization of a battery charger made in the 
original variant in which the maximum power transfer and 
the reduction of the losses to the load is taken into account. 
The steps that have been implemented in carrying out the 
intelligent charging process are the following: connecting a 
new battery to the circuit terminals, testing the nominal 
voltage and its internal resistance by means of a controlled 
discharge for a short period of time, calculating an onboard 
current-voltage actuation function such that in small areas 
the generator's resistance should be adaptive and equal to the 
internal resistance of the battery, and the implementation of 
this function in real time during charging. The role of the 
initial testing of battery in efficient charging process was 
mentioned in [3], [5]. 
The entire process is implemented in 8-bit process 
microcontroller with analog read and writes hardware 
capabilities and precise time interval implementation. 
Additionally, two functional blocks have been created, the 
adaptive driver circuit and discharging and testing battery, 
electronic blocks that realize the interface of the process with 
the microcontroller. The two blocks play the role in 
implementation of the entire algorithm. The physical and 
mathematical aspects of the problem were taken into 
account, equations describing the maximum value of the 
power transfer theorem and the inversion with respect to the 
composition of the real variable functions. 
In this paper, we have explained a general case of the 
proposed solution with details of the software model, 
experimental aspects of the solution including graphs of 
variations of the current, voltage and resistance. In section II 
the solution proposed by us was described, following that in 
section III some experimental and graphical results will be 
highlighted. In section IV the conclusions are presented. 
II. 
PROPOSED SOLUTION 
A schematic block of the proposed smart battery charger 
is presented in Fig. 1. The proposed solution consists of a 
power source generator providing power to an adaptive 
control circuit driver that charges the battery; the 
microcontroller applies control signals to the adaptive 
control driver circuit, based on the charge feedback and the 
results obtained from the discharging and testing battery 
circuit. 
 
Figure 1.  Block schematic of the proposed solution 
46
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-740-5
EMERGING 2019 : The Eleventh International Conference on Emerging Networks and Systems Intelligence

From a theoretical point of view, we consider that a 
battery charger has to be energy efficient among other 
functions. We consider the case where we need to charge 
multiple battery elements with high energy density, like car 
batteries, where the energy transfer to the battery involves 
additional costs when the charging process has a low 
efficiency. 
If we consider a simple circuit with generator, 
rechargeable battery and a measurement resistor (pull-down 
resistor), we can get the formula for the maximum power 
transfer while charging in the following form: 

0
2
0
0
0
2
0
R
R
R
R
U
R
U
P
d
d
R
Batt











where:   
-PBatt  is the power delivered to the battery,  
-Ud  is the voltage applied to the adaptive driver circuit 
-Ug  is the voltage applied to the battery 
-R0  is the internal resistance of the battery 
-Rd  is the variable resistance of adaptive driver 
If we consider this function of a real variable (the internal 
resistance of the battery, R0): 

R0 
P
P
Batt
Batt 

We observe that this function has an extreme point (in 
this case a maximum) when the first derivative of the 
function is 0. After the first derivative is applied, we obtain: 






4
0
2
2
0
2
0
0
R
R
R
R
U
dR
R
dP
d
d
d
Batt




And this condition happens when: 




0
0
0
0
R
R
dR
R
dP
d
Batt



 
(4) 
In our proposed solution the internal resistance of the 
battery (R0) is calculated onboard at the start of the charging 
process, after the tests performed by the microcontroller. The 
tests consist of fast discharge over very short time intervals, 
using the experimental circuit from Fig. 2. 
The internal resistance of the battery has been calculated 
based on the numerical differentiation using following 
formula: 

1
1
0






n
n
n
n
dis
dis
i
i
u
u
di
du
R


where
udis idis
,
 represents the values for the discharge 
voltage and discharge current during t internal resistance test 
of the battery. 
 
Figure 2.  Discharging and testing circuit 
The software used for this step was implemented in C 
and written on an Atmega 328p. A simplified excerpt is 
presented below:   
 
float v1[m] = {1,2,3,…m};  
float v2[n] = {1,2,3,…n}; 
float v3[p]= {1,2,3,…p};                          
void setup ()  
{ 
float value = 0; 
variable "value"  
float value2 = 0; 
for(int i=0; i< m; i++) 
    {value=v1[i]; 
value2=v2[i];        
value=value-(value-1)/value2-(value2-1);            
v3[i]=value;    
    } 
 
A schematic of the section for the numerical 
differentiation is presented in Fig. 3. 
 
 
Figure 3.  Schematic of the numerical differentiation section 
47
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-740-5
EMERGING 2019 : The Eleventh International Conference on Emerging Networks and Systems Intelligence

After the value of the internal resistance of the battery is 
determined, the dynamic charging function can be 
calculated. The implementation of the charging function is 
done using a dynamic adaptor with variable conductance. 
The configuration of the adaptive controlled driver circuit is 
presented in Fig. 4.  
 
Figure 4.  Design of adaptive 
voltage controlled driver circuit 
The electric circuit contains an active element whose 
transconductance and dynamic resistance introduced in the 
circuit can be controlled by a command voltage applied to 
the command pin of the active element in order to achieve 
dynamic charging. The input of the circuit is connected to 
the constant voltage generator and the output provides 
control of the output resistance, by controlling the output 
voltage and current. 
The formula for the adaptive impedance implementation 
of the battery with the power circuit is depending on forms: 

out
out
d
I
U
R

 


And the differential form in the discrete case to implement 
is: 

n
n
n
n
out
out
d
i
i
u
u
di
du
R






1
1


Both the resistance of battery and of the generator must be 
equal. For this to happen we propose the next form of 
charging function: 

)]
(
[
arg
0
dis
dis
e
ch
out
out
d
i
inv u
F
R
I
U
R







where
)]
(
[
inv udis idis
is the mathematical invert of the short-
circuit resistance curve, obtained by recording the data 
during the controlled discharge tests. 
 
The software used for this step was implemented in C and 
programmed on an Atmega 328. A simplified excerpt is 
presented below:   
 
float v1[m] = {0,1,2,3,…m};  
float v2[n];  
 
void setup ()  
{ 
float 
value = 0; 
for(int i=0; i< m; i++) 
    {value=v1[i];        
value=sqrt(value*value-2*value+6); 
v2[i]=value; 
        } 
 
The schematic for the charging function is presented in 
Fig. 5: 
 
Figure 5.  Schematic of the charging function 
 
III. 
EXPERIMENTAL DATA AND RESULTS 
In this section, experimental data and graphs are 
presented and the implementation of the proposed method. 
Using the discharging and testing block, controlled by the 
microcontroller, several short experiments (200-500 ms) 
have been performed and the values of the short-circuit 
voltage and current have been recorded. The Li-Ion battery 
of 3.7V, type 18650 was considered and experimental data 
obtained are presented in Table I. 
Using the data from Table 1, recorded in a 300 ms long 
test, the graph from Fig. 6 has been generated. The graph 
contains three variations represented in red, green and blue. 
The line with a negative slope represented in blue is the 
current-voltage variation during the discharge and was 
generated using data from Table 1, consisting of 48 distinct 
values. It is noted that both the voltage and current drop 
during the discharge. The red line with zero slope represents 
the internal resistance of the battery and was obtained using 
numerical differentiation of the voltage and current. 
 
 
 
48
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-740-5
EMERGING 2019 : The Eleventh International Conference on Emerging Networks and Systems Intelligence

 
TABLE I.  
EXPERIMENTAL DISCHARGING DATA 
I[A] 
U[V] 
 
I[A] 
U[V] 
 
I[A] 
U[V] 
0.84 
3.87 
 
0.712 
3.772 
 
0.584 
3.675 
0.832 
3.864 
 
0.704 
3.766 
 
0.576 
3.669 
0.824 
3.858 
 
0.696 
3.76 
 
0.568 
3.663 
0.816 
3.852 
 
0.688 
3.754 
 
0.56 
3.657 
0.808 
3.846 
 
0.68 
3.748 
 
0.552 
3.65 
0.8 
3.84 
 
0.672 
3.742 
 
0.544 
3.644 
0.792 
3.833 
 
0.664 
3.736 
 
0.536 
3.638 
0.784 
3.827 
 
0.656 
3.73 
 
0.528 
3.632 
0.776 
3.821 
 
0.648 
3.724 
 
0.52 
3.626 
0.768 
3.815 
 
0.64 
3.718 
 
0.512 
3.62 
0.76 
3.809 
 
0.632 
3.711 
 
0.504 
3.614 
0.752 
3.803 
 
0.624 
3.705 
 
0.496 
3.608 
0.744 
3.797 
 
0.616 
3.699 
 
0.488 
3.602 
0.736 
3.791 
 
0.608 
3.693 
 
0.48 
3.596 
0.728 
3.785 
 
0.6 
3.687 
 
0.472 
3.589 
0.72 
3.779 
 
0.592 
3.681 
 
0.47 
3.583 
 
 
 
 
 
 
 
 
 
 
Figure 6.  Discharge voltage and current 
Numerical differentiation of the experimental data has 
led to the determination of the value of the internal resistance


.0 76
R0
 
The green curve with a hyperbolic variation represents 
the implicit variation of the current and the voltage measured 
at the terminals of the battery determined in short-circuits 
conditions and influenced by the internal resistance of the 
battery.  
During this short test the internal resistance was constant. 
It implies that during the invers process, the charging 
process, the charging voltage and current has to follow a 
similar curve but with inverted variation. 
The curvature and type of variation will determine the 
charging function. The shape of the variation of the specified 
mathematical function, of the current and voltage during the 
discharge was obtained using a second order polynomial 
interpolation, in this case. 

16.24
24.28
12.47
)
(
2



dis
dis
dis dis
i
i
i
u


Assigning to function the mathematical invert along the first 
bisector we can calculate analytical the inverse function. In 
this example it has the next form. 

.0 088
.0 02
2
.0 973
)
(
arg
arg
arg



e
ch
e
ch
e
ch
u
u
i


During our experiment after the completion of the test to 
determine the internal resistance of the battery, we will not 
perform onboard implementation of the analytical calculated 
function from (10) because it involves floating point 
operations and extra calculations, instead we will use the 
numerical invert of function, and for the experimental curve 
by simply inversing the experimental data obtained during 
the discharge process, controlled using the equation: 
 
( )
)]
[ (
X Y
Inv Y X



which becomes: 
)
(
)]
(
[
arg
arg
arg
e
ch
e
ch
dis
dis
e
ch
u
i
i
inv u
F


 
The algorithm involves the determination of the internal 
resistance of the battery by performing a fast discharge test, 
before the start of the charging process, and the 
determination of the voltage-current variation curve for 
which the internal resistance of the battery stays constant and 
it is the basis for functional inversion of the charging voltage 
and current of the battery that does not change the internal 
resistance.  
The difference is that the charging process will last 
longer than the discharge process. The time variable 
described in the discharge experiment is implemented using 
an optimized process controlled by the microcontroller. 
In the following, several experimental results are 
presented for repeated charging of the same battery. We are 
presenting in Table II the experimental data of approximate 
600 seconds of battery charging, in voltage and current 
variations. We used the same Li-Ion battery of 3.7V, 18650 
types.  
Fig. 7 presents the results of the voltage charging solution. 
Using the microcontroller controlled charging the voltage 
was rising with values in the [3.971-4.031V] interval. The 
function for the implementation of adaptive impedance was 
represented in red, and it represents the correction applied to 
the adaptive driver circuit by the microcontroller. 
49
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-740-5
EMERGING 2019 : The Eleventh International Conference on Emerging Networks and Systems Intelligence

The current variation between (0.083 - 0.108) Amps, are 
presented in Fig. 8, during the charging process and the 
variation of the adaptive driver.  
 
 
TABLE II.  
EXPERIMENTAL CHARGING DATA 
 
U[V] 
I[A] 
 
U[V] 
I[A] 
 
U[V] 
I[A] 
3.971 
0.108 
 
4.000 
0.098 
 
4.016 
0.090 
3.974 
0.106 
 
4.001 
0.097 
 
4.017 
0.090 
3.977 
0.105 
 
4.002 
0.097 
 
4.018 
0.090 
3.979 
0.104 
 
4.003 
0.096 
 
4.019 
0.090 
3.981 
0.103 
 
4.004 
0.096 
 
4.020 
0.089 
3.983 
0.103 
 
4.005 
0.095 
 
4.021 
0.089 
3.985 
0.102 
 
4.005 
0.095 
 
4.022 
0.089 
3.987 
0.102 
 
4.006 
0.094 
 
4.023 
0.088 
3.988 
0.101 
 
4.007 
0.094 
 
4.024 
0.088 
3.990 
0.101 
 
4.008 
0.093 
 
4.025 
0.087 
3.991 
0.101 
 
4.009 
0.093 
 
4.025 
0.087 
3.992 
0.100 
 
4.010 
0.092 
 
4.026 
0.086 
3.993 
0.100 
 
4.011 
0.092 
 
4.026 
0.086 
3.994 
0.100 
 
4.012 
0.091 
 
4.027 
0.085 
3.995 
0.099 
 
4.013 
0.091 
 
4.028 
0.085 
3.996 
0.099 
 
4.014 
0.091 
 
4.029 
0.084 
3.998 
0.099 
 
4.015 
0.091 
 
4.030 
0.084 
3.999 
0.098 
 
4.015 
0.090 
 
4.031 
0.083 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

Figure 7.  Charging graph of voltage in time  
 
In Fig. 8 we are also highlighting the variation of adaptive 
resistance in time obtained in adaptive driver circuit. The 
variations of resistance of the adapter block are the answer 
due to the variations of internal resistance during the 
charging in time of the chemical element (battery). 
 
 
Figure 8.  Charging graph of curent in time 
IV. 
CONCLUSION AND FUTURE WORK 
In this paper the possibility of using a microcontroller 
controlled battery charger is discussed. The method is based 
on theoretical considerations and numerical calculation and 
implementation. The experimental results show that the 
process can be carried out with high efficiency by controlling 
the conductance during the charging period using the 
adaptive circuit and an initial battery resistance test. Only 
one type of battery was tested, but the authors want to test 
and implement the method on several types of batteries and 
at various stages of wear. With the results obtained we will 
develop in a future project a model of functional charging in 
minimum time and maximum efficiency. 
REFERENCES 
[1] H.C. Lin, Y.J. He and C.W. Liu, “Design of an Efficient 
Battery Charging System Based on Ideal Multi-state 
Strategy”, 2016 International Symposium on Computer, 
Consumer and Control (IS3C), Aug. 2016, pp. 956-959 , doi: 
10.1109/IS3C.2016.242. 
[2] D. Xu, L. Wang and  J. Yang, “Research on Li-ion Battery 
Management System”, 2010 International Conference  on Electrical 
and Control Engineering, Wuhan, Nov. 2010, pp. 4106-4109, 
doi: 10.1109/iCECE.2010.998. 
[3] W. Han and L. Zhang, “Charge transfer and energy transfer analysis 
of battery charge equalization”, 2015 IEEE International Conference 
on Automation Science and Engineering (CASE), Gothenburg, Aug. 
2015, pp. 1137-1138, doi: 10.1109/CoASE.2015.7294250. 
[4] J.-S. Moon, J. H. Lee, I.-Y. Ha, T.-K. Lee and  C. Yuen, “An efficient 
battery charging algorithm based on state-of-charge estimation for 
electric vehicle”, 2011 International Conference on Electrical 
Machines and Systems, Beijing, Nov. 2011, pp. 1-6, doi: 
10.1109/ICEMS.2011.6073783. 
[5] S.-W. Luan, J.-H. Teng, D.-J. Lee, Y.-Q. Huang and C.-L. 
Sung, "Charging/discharging monitoring and simulation 
platform for Li-ion batteries," TENCON 2011 - 2011 IEEE 
Region 10 Conference, Bali, Nov. 2011, pp. 868-872, doi: 
10.1109/TENCON.2011.6129
 
50
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-740-5
EMERGING 2019 : The Eleventh International Conference on Emerging Networks and Systems Intelligence

