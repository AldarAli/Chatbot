Indoor/Outdoor Route Estimation Method Based on
Global Map Matching Using BLE Beacons and GPS
Shinsuke Kajioka‚àó, Takanori Saito‚Ä† and Daisuke Yamamoto‚Ä°
Department of Computer Science
Nagoya Institute of Technology
Gokisocho, Showa, Nagoya, Aichi 466-8555, Japan
‚àókajioka@nitech.ac.jp, ‚Ä†t.saito.536@nitech.jp, ‚Ä°daisuke@nitech.ac.jp
Abstract‚ÄîIn recent years, devices, such as smartphones and
Bluetooth Low Energy (BLE) beacons, equipped with BLE
functionality have become increasingly widespread, resulting in
a proliferation of services that use BLE beacons to estimate
location. However, most existing research on location estimation
using BLE beacons is limited to indoor locations, and few
methods are available to accommodate both indoor and outdoor
locations. This study proposes a method that combines data from
BLE beacons and Global Positioning System (GPS) to estimate
continuous path of human movement across both indoor and
outdoor areas. This enables not only highly accurate estimation
of indoor and outdoor routes but also flexible route estimation
by expanding ‚Äúindoor‚Äù and ‚Äúoutdoor‚Äù routes to include ‚Äúsemi-
outdoor‚Äù routes: for example, supplementary BLE beacons are
placed near high-rise buildings or in semi-outdoor areas where
GPS signals are weak to improve the accuracy of estimation. For
achieving such estimation, the proposed method joints maps on
adjacent floors or indoor/outdoor. To validate the effectiveness
of the proposed method, a prototype system for achieving this
functionality is developed and experiment is conducted. The
results of the experiment indicates that the proposed method
produces better results of route estimation.
Index Terms‚Äîmap matching, BLE beacon, GPS, geographical
information systems
I. INTRODUCTION
Devices, such as smartphones and beacons, equipped with
Bluetooth Low Energy (BLE) functionality have become in-
creasingly popular in recent years. As a result, BLE-based
services, particularly location-estimation services using BLE
beacons (hereafter referred to as ‚Äúbeacons‚Äù) are steadily gain-
ing popularity. As shown in Figure 1, the Nagoya Institute
of Technology, to which the authors belong, has installed
approximately 1,600 BLE beacons in all classrooms and
hallways on campus [1], providing a smartphone service that
can manage class attendance by receiving BLE beacon signals.
BLE beacons are also expected to operate reliably even during
power outages and disasters because of their low installation
costs, stand-alone operation, low power consumption, and
ability to operate for more than five years on dry cell batteries.
Owing to these factors, studies estimating indoor location
using BLE beacons have proliferated.
As a method of beacon-based location estimation, we have
proposed a global map matching method [2] that uses bea-
This work was supported by JSPS KAKENHI Grant Numbers JP19H04115
and JP21K19766.
‚ñ†BLE Beacon
Fig. 1. A floor plan illustrated with locations of installed BLE beacons and
candidate paths. A total of 1,600 BLE beacons are installed in all classrooms
on campus and an attendance management system uses installed locations of
BLE beacons.
cons to estimate users‚Äô routes and stays. This is a route-
and-stay estimation method that uses two networks, a route
network for schematically representing a person‚Äôs movement
path and a beacon network for schematically representing the
location relationship of beacons. By integrating and filtering
beacon signals received using a smartphone, the system esti-
mates users‚Äô routes and stays. On the contrary, most existing
BLE beacon-based location estimation methods, including
our method, are limited to indoor locations. BLE beacons
have also received attention in estimating pedestrian traffic
and can be used to analyze people flows for marketing,
urban planning, evacuation drills, etc. For example, if there
is an evacuation drill in an urban area, people will move to
evacuation centers (parks, etc.) through various locations, such
as building interiors, underground malls, and outdoors. If these
indoor/outdoor routes could be estimated with high accuracy,
this would contribute to better evacuation and urban planning.
At present, most research on location estimation using BLE
beacons is for indoor use; however, there is little research
on integration BLE beacons with Global Positioning System
(GPS), which is used outdoors. Studies using BLE beacons
typically estimate position considering the radio reception
strength as input data, while studies using GPS typically
61
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-079-7
GEOProcessing 2023 : The Fifteenth International Conference on Advanced Geographic Information Systems, Applications, and Services

estimate routes on the road network considering latitude and
longitude as input data (routes are more abstract than a series
of positions, and depending on the application, more useful).
The combination of GPS and BLE beacons is inherently
difficult because of the different data formats, methods, and
estimation targets.
This study proposed a method that combines BLE beacon
and GPS data to estimate an overall optimal path of human
movement across both indoor and outdoor areas. This will
not only enable highly accurate estimation of indoor and
outdoor routes but also enable flexible route estimation by
adding ‚Äúsemi-outdoor‚Äù to ‚Äúindoor‚Äù and ‚Äúoutdoor‚Äù routes, for
example, by placing supplementary BLE beacons near high-
rise buildings or in semi-outdoor areas where GPS signals are
weak, to improve estimation accuracy.
While it is standard practice to estimate a route after
estimating location, we propose a method that estimates routes
directly with high accuracy without estimating location. In
other words, by specializing on route estimation, the system
provides high accuracy and solves various problems that arise
in practical use. This may contribute to the development of
geographic information systems, including positioning infor-
mation.
The rest of this paper is organised as follows: Section
II shows related work on route estimation based on GPS
data, Section III describes the definitions of the proposed
system, Section IV discusses the proposed route estimation
method, Section V shows evaluative experiment of the pro-
posed method, and Section VI concludes this study.
II. RELATED WORK
There has been significant research on route estimation
based on GPS data. There are two main methods: one based
on incremental map matching and the other based on global
map matching.
Brakatsoulas et al. [3] provides an example of an incre-
mental map-matching-based method. Two similarity indices,
distance and orientation, were used to evaluate candidate links.
Lou et al. [4] provides an example of a global map matching
method. This study proposed ST-matching, which can perform
high-accuracy map matching under low sampling rates with
sampling intervals of 2 min or more. Score matching considers
spatial and temporal scores and applies the Viterbi algorithm
based on the scores for each candidate point and scores
between candidate points. Newson and Krumm [5] proposed
a globally optimal map matching based on a hidden Markov
model.
In [6], a smartphone application was created to conduct a
stamp rally at an event site, using booths scattered throughout
the site as checkpoints. To realize user behavior analysis, they
estimated indoor and outdoor routes using GPS and beacons.
However, it lacked the high-level integration of the method
proposed herein.
In [2], the authors conducted a study on beacon-based global
map matching to estimate users‚Äô travel routes and stays. The
Collect movement logs
Generate candidate points series
Estimate beacon node series
on beacon network
Estimate path node series
on path network
GPS
ID, RSSI,
timestamp
BLE Beacons
[latitude, longitude], 
accuracy, timestamp
Movement logs
Candidate points series
Beacon node series
Estimated route
Smartphone function
Beacon network
Create beacon/path 
networks
of each floor
Beacon network
Path network
Path network
Beacon network
Path network
Database
System manager
Server functions
Path node sequence
Fig. 2.
Route estimation procedure of the proposed system. A smartphone
function collects both GPS data and BLE beacons as movement logs. Server
functions process the movement logs and derive a path node sequence as
an estimated route. System manager should create beacon/path networks
beforehand.
authors proposed BST-matching, an improved version of ST-
matching [4] for beacons, which determines candidate user
locations at a given time based on beacon signal strength and
uses the Viterbi algorithm for route estimation.
In [7], beacons were used for route estimation indoors, and
GPS was used outdoors where beacons were not installed to
extend the scope of possible route estimation.
Ito and Kawaguchi [8] described the process of estimating a
user‚Äôs indoor and outdoor travel paths using the optimal avail-
able positioning technology for the surrounding environment
in which the user was moving. By defining in advance which
positioning technologies are available in the road network
and switching the information used for estimation, it becomes
possible to use complex information for route estimation.
Several methods based on machine learning have also been
proposed. Xiao et al. [9] proposed a method for location
estimation using BLE beacons in 3D space using Auto
Encoder. Urano et al. [10] proposed a method for indoor
BLE beacon location estimation based on Long Short-Term
Memory (LSTM). Unlike our work, these do not mention the
fusion of BLE beacons and GPS.
III. PROPOSED SYSTEM
This section presents the definitions of the movement log
and the path and beacon network.
A. Configuration of the Proposed System
Figure 2 shows the procedure structure of the proposed
system. System manager should prepare beacon and path
networks of each floor or exterior beforehand. First, the log
collection function collects movement logs from GPS and BLE
beacon signals on a smartphone. The collected movement logs
are stored and carried them to the route estimation server.
62
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-079-7
GEOProcessing 2023 : The Fifteenth International Conference on Advanced Geographic Information Systems, Applications, and Services

TABLE I
BEACON LOG FORMAT.
ItemName
Type
Description
Beacon ID
integer
Beacon ID
RSSI
double
RSSI
Timestamp
ISODate
Timestamp
TABLE II
GPS LOG FORMAT.
ItemMame
Type
Description
latlon
Position
Location coordinates expressed
as latitude and longitude
Accuracy
double
Accuracy
Timestamp
ISODate
Timestamp
The route estimation server converts the movement logs
into a time-series of sets of candidate points, which is then
converted into a series of beacon nodes in the beacon network.
Subsequently, the series of beacon nodes on the beacon
network is transformed into a series of path nodes on the path
network, and the estimated route of user movement is output.
B. Movement Logs
In this study, to estimate routes, BLE beacon data and GPS
data are stored as movement logs using smartphones carried
by users.
The movement log has two fragments of information in
chronological order: the beacon log and GPS log. The beacon
log format is presented in Table I, and the GPS log format
is presented in Table II. The beacon log consists of the
beacon‚Äôs ID, Received Signal Strength Indicator (RSSI), and
a timestamp. The GPS log consists of latitude and longitude
coordinates, accuracy, and a timestamp.
C. Path and Beacon Network
Similar to our previous method [2], this study uses two
networks, path and beacon, as shown in Figure 3. A beacon
network represents beacon installation as a graph, with nodes
located at beacon positions. The path network represents the
actual candidate routes that users will take, regardless of the
beacon position.
The conventional method deals only with indoor path and
beacon networks, whereas the proposed method necessitates
the construction of both indoor and outdoor networks. In this
study, indoor and outdoor networks were created separately
and connected using stairway nodes and ingress/egress nodes,
as described below. These nodes function as connecting nodes
in the conventional method [2].
The network is edited using our previously developed in-
door/outdoor network editing system [11].
Stairway nodes are used to connect building floors. An
example of a stairway node is shown in Figure 4. The
corresponding stairway nodes on each adjacent floor have the
same coordinate. They are installed at the landing of a staircase
in an indoor map and have the effect of connecting maps on
adjacent floors.
Fig. 3. Path and beacon network. ‚ÄúPN node‚Äù and ‚ÄúBN node‚Äù indicate a node
on path network layer and beacon network layer, respectively.
Building A 1F stairway node
Building A 2F stairway node
Fig. 4. Example of a stairway node. The red circle indicates the stair node
connecting the first and second floors.
Ingress/egress nodes are nodes that connect indoor net-
works to outdoor networks. An example of corresponding
ingress/egress nodes are shown in Figure 5. The corresponding
ingress/egress nodes on the same location of each map have the
same coordinate. Ingress/egress nodes are positioned between
building interiors and exteriors to connect corresponding maps
on adjacent indoor/outdoor.
IV. ROUTE ESTIMATION METHOD
In this section, we propose a method to estimate indoor and
outdoor routes taken by users using GPS and BLE beacon
movement logs as well as the path and beacon network.
A. Combination and Filtering of Movement Logs
In general, BLE beacon signals and GPS signals are prone
to interference from buildings and obstacles. Therefore, their
accuracy is likely to vary based on location and time of day.
Therefore, in this section we present a method for combin-
ing and filtering movement logs as a preprocessing step before
performing the estimation.
When combining movement logs, logs are arranged in
chronological order from beginning to end, and from the
resulting divided i logs, only the information with the highest
accuracy is retained. The combination process is shown below:
Note that i = 3 in this study.
1) The movement log was split into i parts in chronological
order.
63
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-079-7
GEOProcessing 2023 : The Fifteenth International Conference on Advanced Geographic Information Systems, Applications, and Services

Exterior ingress/egress node
Interior ingress/egress node
Fig. 5.
Example of an ingress/egress node. The red circle indicates the
ingress/egress node connecting the outdoor and indoor.
2) If there were multiple beacon logs with the same major
value among the divided i beacon logs, the one with the
highest RSSI value was selected.
3) From the separated i GPS logs, the log with the highest
accuracy was selected.
4) The i movement logs were combined, and the time after
combination was considered to be the newest time.
Subsequently, we explain filtering: Filtering removes move-
ment logs below a specified threshold from the combined
movement logs. The filtering procedure is shown below: The
RSSItype value was set to -75 when type is ‚Äòindoor‚Äô and -79
when type is ‚Äòcorridor‚Äô.
1) The type of the beacon location was obtained from the
information in the movement log, based on a correspon-
dence table.
2) If the RSSI in the beacon log was lower than that of
the threshold RSSItype, the information was considered
unreliable and was removed from the movement log.
3) If the accuracy in the GPS log was lower than that of the
threshold ACCtype, it was removed from the movement
log.
B. Creating a Candidate Point Cloud Series
This section describes the method for converting the move-
ment logs to candidate point cloud series using the combina-
tion and filtering processes. A candidate point set represents
a set of nodes in the beacon network that can exist at time t,
and a candidate point set series represents a series of data that
arranges candidate point sets in chronological order.
Two types of movement logs are included: beacon and GPS.
The candidate point cloud therefore includes two groups of
candidate points, one generated from beacon logs and the other
from GPS logs.
The following is the procedure for converting beacon logs to
candidate point clouds: At time t, beacon nodes corresponding
to the top k beacons with the highest RSSI form the candidate
point group.
The following is the procedure for converting GPS logs
to candidate point clouds: Beacon nodes are obtained within
a circle of radius R centered on the latitude and longitude
coordinates estimated using GPS at time t. Subsequently, the
Time ùë°!
ùëê!
!
ùëê!
"
ùëê!
#
ùëê!
$
Time ùë°"
ùëê"
!
ùëê"
"
ùëê"
#
ùëê"
%
Time ùë°&
ùëê&!
ùëê&"
ùëê&#
ùëê&
'
Candidate point 
group at time ùë°!
Candidate point 
group at time ùë°"
Candidate point 
group at time ùë°#
ùëê!
! ‚Üí ùëê"
$
ùëê!$ ‚Üí ùëê"
%
Fig. 6.
Example candidate point graph. The graph is used for determining
estimated path.
top k beacon nodes closest to the estimated location are
selected as the candidate point group at that time.
Finally, the set of candidate points generated from both
beacon and GPS logs are combined to determine the set of
candidate points at time t.
C. Estimating Routes From Candidate Point Cloud Series
In this section, we propose a method based on BST match-
ing [2] for estimating a user‚Äôs travel path from a candidate
point cloud series and beacon network.
Figure 6 shows an overview of determining estimated path.
The scores between each candidate point and candidate point
at time t are computed. For each candidate point group, the
path with the lowest overall score P is the path obtained by
the Viterbi algorithm; this is the estimated path.
Score P is expressed as follows:
P = argmax (c1, c2, ¬∑ ¬∑ ¬∑ , cn)
(
N

cj
1

+
n
X
i=2
F

TABLE III
NUMBER OF BEACONS INSTALLED IN THE EXPERIMENTAL ENVIRONMENT.
Location
Number of installed beacons
Bldg. 52, 1st floor
11
Bldg. 52, 2nd floor
32
Bldg. 23, 1st floor
25
Bldg. 23, 2nd floor
22
The beacon-based score N

cj
i

of a candidate point cj
i is the
reciprocal of distance dB and is expressed as follows:
N

cj
i

= 1
dB
The GPS-based score N

F-score
0
Fig. 8. Average results from the experiment.
TABLE IV
RESULTS OF A T-TEST. COMPARISON OF EACH METHOD AND M1.
Route 1
Route 2
Route 3
m2
0.007
0.051
0.019
m3
0.054
0.009
0.092
m4
0.007
0.003
0.002
m5
0.000
0.012
0.000
(m3), it is more effective to use data based on the evaluation
equation, as in our proposed method.
A t-test was conducted for each route to observe if there was
a significant difference between m1 and the other methods.
Table IV lists the results of these t-tests. In all cases, the
results were below the 0.1 significance level, supporting the
superiority of the proposed method m1. The significance level
was not below 0.05 for several items. This can be attributed
to the fact that only six movement logs were collected. In
future, we would like to increase the number of experiments,
repeating the experiment to show significance.
Tables V and VI list the execution time results and the
number of nodes at that time, respectively. Table V shows that
m4, which uses only beacons for estimation, took the shortest
computation time, while m1 took the longest. Note that m4
also has the smallest number of nodes in the candidate point
graph used for estimation of all methods, while m1 has the
highest number of nodes, as shown in Table VI. Thus, it can
be concluded that the computation time required was based
on the number of nodes used for estimation.
Of the five estimation methods, m1, m3, and m5, which
required longer computation timed, are likely to generate large
numbers of candidate points using GPS data. The number
of nodes in the candidate point graph therefore increased
compared to m2 and m4, which have shorter computation
times, resulting in longer computation times.
VI. CONCLUSION AND FUTURE WORK
In this study, we proposed a route estimation method based
on global map-matching that uses both BLE beacons and
GPS. By using BLE beacons with GPS, it is possible to
estimate routes that cross indoor and outdoor areas. We also
TABLE V
COMPUTATIONAL TIME TAKEN TO ESTIMATE.
[ms]
m1
m2
m3
m4
m5
Route 1
13575
5993
12205
1164
11701
Route 2
24889
8326
19315
1018
23903
Route 3
23655
14663
20383
841
20423
TABLE VI
NUMBER OF NODES IN THE CANDIDATE POINT GRAPH USED FOR
ESTIMATION.
m1
m2
m3
m4
m5
Route 1
508
331
469
110
398
Route 2
937
476
848
152
785
Route 3
803
607
757
92
671
implemented a prototype system for achieving this feature
and conducted an evaluative experiment using the prototype
system. The results of the experiment indicated that using the
BLE beacon and GPS-based scores produced better results.
In the future, we will attempt to increase the accuracy of the
method. In addition, because the evaluation in this study was
conducted using only a small amount of data, we want to
conduct a larger-scale demonstration experiment in future.
REFERENCES
[1] S. Kajioka, T. Mori, T. Uchiya, I. Takumi, and H. Matsuo, ‚ÄúExperiment
of indoor position presumption based on RSSI of bluetooth LE beacon,‚Äù
in Proceedings of the IEEE 3rd Global Conference on Consumer
Electronics (GCCE 2014), pp. 337‚Äì339, 2014.
[2] D. Yamamoto, R. Tanaka, S. Kajioka, H. Matsuo, and N. Takahashi,
‚ÄúGlobal map matching using BLE beacons for indoor route and stay
estimation,‚Äù in Proceedings of the 26th ACM SIGSPATIAL, pp. 309‚Äì
318, 2018.
[3] S. Brakatsoulas, D. Pfoser, R. Salas, and C. Wenk, ‚ÄúOn map-matching
vehicle tracking data,‚Äù in Proceedings of VLDB, pp. 853‚Äì864, 2005.
[4] Y. Lou, C. Zhang, Y. Zheng, X. Xie, W. Wang, and Y. Huang, ‚ÄúMap-
matching for low-sampling-rate gps trajectories,‚Äù in Proceedings of
SIGSPATIAL GIS 2009, pp. 352‚Äì361, 2009.
[5] P. Newson and J. Krumm, ‚ÄúHidden Markov map matching through noise
and sparseness,‚Äù in Proceedings of the ACM SIGSPATIAL 2009, pp. 336‚Äì
343, 2009.
[6] K. Urano, K. Hiroi, K. Kaji, and N. Kawaguchi, ‚ÄúA location estimation
method using BLE tags distributed among participants of a large-
scale exhibition,‚Äù in Adjunct Proceedings of the 13th International
Conference on Mobile and Ubiquitous Systems: Computing Networking
and Services, pp. 124‚Äì129, 2016.
[7] M. Ficco, F. Palmieri, and A. Castiglione, ‚ÄúHybrid indoor and outdoor
location services for new generation mobile terminals,‚Äù Personal and
Ubiquitous Computing, vol. 18, pp. 271‚Äì285, 2014.
[8] S. Ito and N. Kawaguchi, ‚ÄúWireless LAN based hybrid positioning sys-
tem using bayesian inference and access point selection,‚Äù Transactions
of the Institute of Electrical Engineers of Japan. C, vol. 126, no. 10,
pp. 1212‚Äì1220, 2006.
[9] C. Xiao, D. Yang, Z. Chen, and G. Tan, ‚Äú3-D BLE indoor localization
based on denoising autoencoder,‚Äù IEEE Access, vol. 5, pp. 12751‚Äì12760,
2017.
[10] K. Urano, K. Hiroi, T. Yonezawa, and N. Kawaguchi, ‚ÄúAn end-to-end
BLE indoor localization method using LSTM,‚Äù Journal of Information
Processing, vol. 29, pp. 58‚Äì69, 2021.
[11] S. Kajioka, T. Saito, D. Yamamoto, and N. Takahashi, ‚ÄúA web-based
geospatial adjacency graph construction tool for indoor/outdoor bea-
cons,‚Äù in Proceedings of the IEEE 10th Global Conference on Consumer
Electronics (GCCE 2021), pp. 1‚Äì2, 2021.
66
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-079-7
GEOProcessing 2023 : The Fifteenth International Conference on Advanced Geographic Information Systems, Applications, and Services

