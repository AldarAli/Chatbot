A Energy Balancing Control Strategy for Microgrid with Storage Systems 
Jing Tianjun, Niu Huanna, Wang Jiangbo, Yang Rengang  
College of Information and Electrical Engineering 
China Agricultural University 
Beijing, China 
jtjy11@cau.edu.cn 
 
Abstract— In a microgrid, there is usually an energy storage 
system, while there is no continuous energy supply. The 
storage system does not only be used as a power supply in 
islanded state, but also could be taken as the demand side 
management devices in grid-connected state. In this paper, a 
system energy managing strategy is proposed. It can balance 
the energy in autonomous state, and manage power in grid-
connected state under time-of-use pricing. Next, the droop 
control and economic dispatch method are introduced into the 
power management strategies to improve the power supply 
reliability and perform peak load shaving for maximum 
benefits. Finally, a simulation is shown to analyze the benefit 
from the strategies. And the applications of the economic 
dispatch method are discussed in the results under different 
operating conditions and market policies. 
Keywords-microgrid; storage system; energy balancing. 
I. 
 INTRODUCTION  
For electric loads that are described as the unpredictable 
fluctuation with obvious difference between peak and off-
peak load, power system planners must consider the 
maximum load in the plan of the electric systems expansion. 
In order to utilize the existing equipment sufficiently and 
reduce the distribution equipments investment, electric 
administrative department usually take measures of ‘peak 
load shaving’ (also called time-of-use pricing (TOU), load 
control and management, etc.) to solve this problem. Now, it 
is available to store electrical energy on a large scale with the 
development of energy storage devices and control methods. 
Microgrid are the distribution networks comprising 
various distributed generators (DGs) and storage devices that 
can operate either interconnected or isolated from the main 
distribution grid, as in [1]. The microgrid voltage could 
cover the whole distribution networks, but only the low-
voltage is considered in this paper. Storage devices in 
microgrid can be controlled flexibly to minimize microgrid 
operation. Some power management strategies are presented, 
as in [2, 3], for optimal economic operation of the microgrid, 
including making power and planning, according to the 
prediction for PV power production and the load forecasting. 
It could reduce the costs of microgrid and optimise battery 
charge states. Sortomme and El-Sharkawi [4] used particle 
swarm optimisation to achieve optimal dispatch of 
controllable loads and generators as well as effectively 
utilizing the battery storage of each microgrid. Kim et al. [5] 
proposed a cooperative control strategy of energy storage 
system and micro sources for stabilizing the microgrid in 
islanded operation mode [6-8], consisting of the centralized 
controller 
and 
local 
controllers 
interconnected 
with 
communication bus [9-11]. Now the storage system has been 
used to microgrid control, but has not yet been used to 
energy balancing control. 
A detailed analysis of the generic control scheme for 
energy storage system (ESS) is presented. Based on the 
analysis, this paper proposes a coordinated control strategy, 
using a ω-P/V-Q and P-ω/Q-V droop control method, to 
avoid the real and reactive power coupling problem cased by 
the high R/X line impedance ratio [12-14].  An economic 
dispatch method for energy storage systems, under time-of-
use pricing, is presented to maximise benefits, and the spare 
economic benefits of ESS is considered. 
In the paper, the control strategies of the ESS in both 
grid-connected and island mode is proposed. And then, the 
ESS dispatch method based the control strategies is 
discussed. At last, the dispatch method is tested in the case 
study. 
II. 
CONTROL STRATEGIES OF THE ESS 
A. The ESS in a microgrid system 
ESS plays a vital role in the reliable operation of a 
microgrid. Figure 1 shows a single-line diagram of a typical 
distributed ESS in a microgrid. The centralized control 
system of the ESS comprises local micro source controllers 
(MCs) and central controller. The MC uses local information 
to control the voltage and the frequency of the ESS in 
transient operation.  
PCC
Load 
manager
P1
0/Q1
0
MC1
...
...
Communication bus 
Power points setting
（Pn
0/Qn
0）
Energy availability,
Voltage/frequency
Market 
info
Optimization module 
of ESS
Micro-grid energy management 
system
Data exchange
P2
0/Q2
0
P3
0/Q3
0
AC
DC
+
-
battery
Utility 
grid
AC
DC
+
-
AC
DC
+
-
MC2
MC3
ESS 
management 
module
battery
battery
 
Figure 1. Typical ESS structure in a microgrid 
72
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-259-2
ENERGY 2013 : The Third International Conference on Smart Grids, Green Communications and IT Energy-aware Technologies

The MC also follows the demands from the central 
controller to optimize the operation. The decentralized 
control method for the parallel operation of inverters 
working in island mode is the frequency and voltage droop 
method, and the power management strategies are based on 
local measured signals without communications assistance. 
The ESS management module is responsible for the dispatch 
of the ESS and the maximization of the ESS’s value. The 
dispatch method is related to the structure and operation 
modes of the microgrid, and has an effect on the microgrid 
stability. The proposed hierarchical control system of ESS is 
shown in Figure 1. The battery storage inverter with island 
detection function changes the control scheme based on the 
microgrid mode of operation, i.e. islanded or grid-connected, 
and the ESS management module sends dispatch commands 
to the local controllers according to the amount of available 
energy, electricity price and system electric parameters. 
B. Control methods of the ESS in grid-connected mode  
In the grid-connected mode, the utility grid is expected to 
supply the difference in real/reactive power. Similar to a 
conventional utility system, each DG unit can be controlled 
to generate pre-specified real and reactive power components 
(PQ-bus) or generate pre-specified real power and regulate 
its 
terminal 
voltage 
(PV-bus). 
Optimization 
power 
management of the ESS can help to minimize the tie line 
power (peak shaving), and maximize the ESS’s value under 
TOU price. 
Figure 2 shows a block representation of a generic 
control system of the ESS inverter in grid-connected mode. 
A signal processing block and a phase locked loop (PLL) 
block are used to process the measured currents and voltages 
of the ac-bus and to estimate the local frequency. The 
frequency estimation is used to synchronization and to track 
relative angle of the inverter reference frame. Controls of the 
real/reactive power are implemented in a dq0 reference 
frame that determines d- and q-axis components of the ac-
side currents. The power set-point is determined by the ESS 
power management module. 
+
-
+
-
Pc,Qc
ea,eb,ec
ia,ib,ic
VSC
Idc
PWM
dq
abc
dq
abc
L
id*
id
PCC
iq*
iq
Qc*+
-
kp+ki /s
Qc
Pc* +
-
kp+ki /s
Pc
kp+ki /s
kp+ki /s
-
+
+
+
-
-
Vd
Vq
ed
eq
wL
wL
id
iq
 
Figure 2. P-Q control scheme for the ESS 
The dispatch method of ESS power management module 
in grid-connected mode is based on electricity price, to 
achieve economic benefit maximization of ESS and load 
peak shaving. A ω-P/U-Q droop method of ESS control is 
shown in Figure 3.  
ωn
 Q*=f(eabc)
 P*=f(ωn)
 Q and P 
control
Q*
P*
 ea eb ec
 ia ib ic
 
Vinv(a) 
Vinv(b) 
Vinv(c) 
Outer loop: Droop Characteristics
Inner loop: Q and P Control 
 ea eb ec
PLL
ωn
 
Figure 3. ω-P / V-Q droop controller for ESS in grid-connected mode 
The method in Figure 3 improves the microgrid stability. 
The outer loop determines the set points for P*and Q*, 
according to the frequency measured by PLL and voltages of 
ac-side. The droop characteristics can be mathematically 
represented as  
0
0
0
0
1/
(
)
1/
(
)
n
wn
n
n
n
Vn
n
n
P
K
w
w
P
Q
K
U
U
Q
 


 


  
（1） 
where Kwn and KVn are the droop characteristic slope for the 
nth battery unit, ω0 and U0 are the reference frequency and 
reference voltage of the microgrid, respectively, and the Pn
0 
and Qn
0 represent the initial real/reactive power generation 
assigned to the unit, respectively. The inner loop utilizes 
independent real/reactive power control method to ensure the 
output power to be the pre-specified P* and Q*. The control 
method is similar to the one used in conventional power 
systems for the correct load sharing among generators 
feeding to ac system, and can help to support the frequency 
and voltage of the microgrid.  
P(kW)
ω(rad/s)
ω0
0
P0
t2
P0
t1
ωn
Pn
Q(kVar)
V(volt)
Qn
Vn
V0
0
Q0
t1
Q0
t2
 
Figure 4. Frequency and voltage droop control characteristics  
This droop method of ESS can also be applied in 
islanded microgrid with a slack bus to minimize the 
dynamics and system oscillations. The frequency and voltage 
droop control characteristics are shown in Figure 4. 
C. Control method of the ESS in islanded mode 
In grid-connetcted mode, the ESS power management 
discussed in this paper can be applicable to other controllable 
sources as well, and the unstable sources are controlled based 
on optimal power generation schemes to deliver maximum 
available power. Whereas in islanded mode, the microgrid 
central controller is responsible to the regulation of the 
charge and discharge power of ESS, output power of DG 
units, and load shedding, to match generation and load 
73
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-259-2
ENERGY 2013 : The Third International Conference on Smart Grids, Green Communications and IT Energy-aware Technologies

demand. The objective of the ESS control system is to 
maintain the system frequency and the voltage magnitude, 
rather than load peak shaving. 
The power control system of ESS encompasses real 
power generation control and the reactive power control 
block. The P-f and Q-V droop characteristic is introduced as 
the primary control to share load and regulate the voltage 
without communication among the fast acting inverters. This 
cooperative control method of ESS and micro sources is 
chosen because none of the inverters can dominantly support 
the frequency and voltage of the system in islanded 
microgrid. Base on mainly inductive line impedance between 
the inverters, the frequency control is coupled with the real 
power flow control, and the inverter voltage is controllable 
through Q.  
Figure 5 shows a block representation of a generic 
control system of the ESS inverter in islanded microgrid. 
The control structure of parallel voltage sources converter 
adopted droop method encompasses two control loops, as 
shown in Figure 6. The outer loop determines the reference 
ω* and E*, and expressed as in (2). 
0
0
0
0
(
)
(
)
n
wn
n
n
n
Vn
n
n
w
K
P
P
w
E
K
Q
Q
E
 


 


                       （2） 
where Kwn and KVn are the droop characteristic slope for the 
nth battery unit, ω0 and U0 are the reference frequency and 
reference voltage of the microgrid, respectively, and the Pn
0 
and Qn
0 represent the initial real/reactive power generation 
assigned to the unit, respectively. The inner loop controls the 
ac-bus frequency and the voltage of converter according to 
ω* and E*. In islanded microgrid, the output real/reactive 
power of ESS inverters is vary depending on the ωn and En, 
not pre-specified, and the cardinal control objective is 
reliability of power supply, rather than the economic 
dispatch of ESS. 
+
-
Pc,Qc
ia,ib,ic
VSC
Idc
PWM
sinwt
coswt
PI
L
P,Q,En
ea,eb,ec
P-f droop 
control
Q-V droop 
control
w0
w*
E*
V0
P
Q
En
Bus
dq
abc
min
max
 
Figure 5. V-f control scheme for the ESS 
P and Q 
Calcu-
lator
 ea eb ec
 ia ib ic
 E*=f(Q)
 ω*=f(P)
Q
P 
 E and ω 
control
E*
ω*
 ea eb ec
 ia ib ic
 
Vinv(a) 
Vinv(b) 
Vinv(c) 
Outer loop: Droop Characteristics
Inner loop: E and ω Control 
 
Figure 6. P-ω/ Q-V droop controller for ESS in islanded mode 
However, when the traditional droop method is 
implemented in a low voltage microgrid, the different 
inverter output impedances and the high R/X line impedance 
ratio lead to severe real and reactive power control coupling 
and system stability concerns. So the droop method should 
be improved. This paper presents the combination control 
strategy of ω-P/V-Q droop and P-ω/Q-V droop method to 
solve the real/reactive power coupling problem and improve 
the stability performance. In the distributed storage system 
structure shown in Figure 1, the MC1 adopts P-ω/Q-V droop 
control method after the transition from grid-connected mode 
to islanded mode, while the other MCs adopts ω-P/V-Q 
droop control regardless of the microgrid mode of operation. 
This combination control strategy uses the system frequency 
and voltage as a communication means without causing 
real/reactive power coupling problem in islanded operation. 
III. 
ECONOMIC DISPATCH OF THE ESS 
The objective of the microgrid energy management 
module is to generate suitable set-points for the storages and 
micro sources in such a way that economically optimised 
power dispatch will balance the certain load demand. The 
output of the ESS management module defines the direction 
and amount of the power flow between storages, especially 
in grid-connected mode, to realize the maximum economic 
benefits of the ESS. The economics of the ESS in islanded 
microgrid are particular complex, because it related to other 
controllable sources and loads. But in grid-connected mode, 
the ESS can be dispatched according to the TOU price. Thus, 
the energy stored in the ESS is used as the state variable. 
Time stages are calculated with unit 1h, and most stage more 
than 1hour. Energy stored in the batteries is expressed as 
follows. 
,
,
,
1
,
,
,
*
*
( if the ESS is charging )
*
*
     ( if the ESS is discharging )
         ( if the ESS is idle )
1/
0
n t
n
n t
n t
n t
n
n t
n t
C
n
D
Q
A
P
T
Q
Q
A
P
T
Q
A






 









 （3） 
where Qn,t is the energy stored in the nth storage units at hour 
t, Pn,t is the real power of the nth storage units output at hour 
t, An is the nth storage units charging/discharging 
efficiency(ηC:charging factor, ηD:discharging factor).  
The ESS sells stored energy at high price and shaves the 
peak loads of the large system, and stores it when the 
electricity is abundant and cheap. The objective function for 
each hour intervals and the physical constraint are expressed 
as in (4), and it aimed at maximizing the generation benefit.  
,
,
1
1
min
,
max
min
,
max
min
,
max
min
,
max
(
)
*
*
*
. .
T
N
n t
t
n t
t
n
n t
n t
n t
n t
MaxF P
c
P
T
Q
Q
Q
P
P
P
s t
V
V
V
f
f
f



















 
(4) 
74
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-259-2
ENERGY 2013 : The Third International Conference on Smart Grids, Green Communications and IT Energy-aware Technologies

Where ct is the electricity price at time t, △T is the time 
stage, T is total number of hours, and N is total number of 
storages. The constraints in optimization module includes 
unit capacity, rated power, and the variation of the V and f of 
the system, because of the applied of droop control. 
The ESS increases the reliability of power supply by 
supporting certain loads demand in microgrid, when the 
utility electric grid is unavailable. Thus, the benefits of the 
emergency reserve of the ESS should be calculated. The 
benefits encompass the spinning reserve capacity Crsc,n and 
the reserve electricity Crsp,n. The spinning reserve capacity 
benefit is related to both the remaining capacity of the 
battery and the rated power of the ESS inverters. And it can 
be expressed as in (5). 
rp n
rp
rsoc
rsc n
P
Q
C
,
,
*
*


  
(5) 
Prp is the rated power of the ESs inverter, ρrp,n is the price 
of the spinning reserve capacity. Consumers that chose the 
reserve services should pay the reserve capacity fee 
according to the load no matter grid failures occur or not. 
When the grid failures occurs, the consumers should pay the 
reserve electricity benefit as  
D
rsoc
rsp n
rsp n
Q
C


*
,
,


  
(6) 
Thus, the total reserve benefits of the ESS is expressed as  
rsp n
rh
rsc n
r n
C
P
C
C
,
,
,
%*


 
(7) 
Where ρrsp,n is the price of the reserve electricity, Prh% is the 
probability of the grid failure happens. The objective 
function of the ESS dispatch module taking account of the 
reserve benefits is expressed as  
n
r
T
t
N
n
n t
t
n t
C
T
P
c
P
MaxF
,
1
1
,
,
*
*
)
(


 


 
(8) 
IV. 
CASE STUDY 
In this section, it takes a 500Ah/600V lithium batteries 
system rated power 100kW as a study case to analyse the 
economic dispatch in the paper. The energy management of 
a distributed storage system in a grid-connected microgrid is 
formulated as a linear programming problem. The market 
prices of a day is given in Table 1, and the parameters is set 
as follows, ηC=ηD=0.9, Qmin=90kWh，Qmax =300kWh, Pmax 
=100kW, and the initial remaining energy of the batteries is  
Qs =90kWh. Ignoring the reserve benefits, it can be noted 
that benefits can be made only if ESS efficiency is greater 
than the off-peak/peak price ratio, i.e. 
on peak
peak
off
C
D
P
P


/
*
 ＞

 
 (9) 
TABLE I. Electricity TOU PRICE 
Time/h 
0-8 
8-12 
12-14 
14-18 
18-22 
22-24 
Price 
25% 
100% 
50% 
100% 
75% 
50% 
When 1kWh power is stored from the grid in the off-peak, 
no more than 1 kWh can be return to the grid in the peak, 
because of the convert loss. So, the benefit ratio for the 
storage should be higher than the loss. 
TABLE II. POWER SETTINGS OF THE ESS 
Time/h 
0-8 
8-12 
12-14 
14-18 
18-22 
22-24 
Pt/kW 
29.2 
-47.2 
100 
-40.5 
0 
0 
According to formula 4, the power set points of the ESS 
of the day are given in Table 2, and the benefits of the ESS is 
192.7 standard kWh per day calculated as follow. 





T
t
n t
t
n t
kWh
T
P
c
P
MaxF
1
,
,
192 7.
*
*
)
(
. 
TABLE III.  POWER SETTINGS OF THE ESS INCLUDING RESERVE SERVICE 
Time/h 
0-8 
8-12 
12-14 
14-18 
18-22 
22-24 
Pt/kW 
18.7 
-37.5 
75 
-37.5 
0 
0 
If the reserve benefits is considered, the parameters is set 
as follows, ρrp,n=0.1%, ρrsp,n=150%, Prh%=0.5%, Qrsoc 
=60kWh, and the available capacity for dispatch under 
market price is Qa = Qmax -Qrsoc –Qmin. According to formula 
8, the power set points of the ESS of the day is given in 
Table 3, and the benefits of  the ESS offering reserve service 
is 151.4 standard kWh per day calculated as follow. 
kWh
C
T
P
c
P
MaxF
n
r
T
t
N
n
n t
t
n t
=151 4.
*
*
)
(
,
1
1
,
,





 
V. 
CONCLUSION 
In this paper, the detailed control method analysis of the 
ESS is presented in island and grid-connected mode. The 
droop control method can be applied in both modes 
operation to improve the grid transient performance. 
Mathematic model for analyzing the economic effect of the 
energy storage system is proposed under the TOU price. 
Also, the reserve benefits of the ESS are also taken into 
account in this model. The ESS management module can 
make an optimal dispatch schedule according to the 
electricity price to maximize benefits. 
ACKNOWLEDGMENT 
The authors would like to thank the support from the 
National High Technology Research and Development 
Program ("863"Program) of China (No. 2012AA050217). 
REFERENCES 
[1] A. G. Tsikalakis and N. G. Hatziargyriou, “Centralized Control for 
Optimizing Microgrids Operation,” IEEE Trans. Energy Convers., 
vol. 23, no. 1 , March. 2008, pp. 241-248. 
[2] C. Chen, S. Duan, T. Cai, B. Liu, and G. Hu, “Smart Energy 
Management System for Optimal Microgrid Economic Operation,” 
IET Renew. Power Gener., vol. 5, no. 3, May. 2011, pp. 258-267. 
[3] H. Kanchev, D. Lu, F. Colas, V. Lazarov, and B. Francois, “Energy 
Management and Operational Planning of a Microgrid with a PV-
Based Active Generator for Smart Grid Applications,” IEEE Trans. 
Ind. Electron., vol. 58, no. 10, October. 2011, pp. 4583-4592. 
[4] E. Sortomme and M.A. El-Sharkawi, “Optimal Power Flow for a 
System of Microgrids with Controllable Loads and Battery Storage,”. 
IEEE/PES Power Systems Conf. and Exposition,March.2009, pp. 1–5. 
[5] J. Kim, J. Jeon, S. Kim, C. Cho, J. H. Park, H. Kim, and Y. Nam, 
“Cooperative Control Strategy of Energy Storage System and 
Microsources for Stabilizing the Microgrid during Islanded 
Operation,” IEEE Trans., Power Electron., vol. 25, no. 12, 2010, pp. 
3037-3048. 
[6] M. C. Chandorkar, D. M. Divan, and R. Adapa, “Control of Parallel 
Connected Inverters in Standalone AC Supply Systems,” IEEE Trans. 
Ind. Applicat. vol. 29, no. 1, January. 1993, pp. 136-143. 
[7] K. D. Brabandere, B. Bolsens, J. V. D. Keybus, A. Woyte, J. Driesen, 
“A Voltage and Frequency Droop Control Method for Parallel 
75
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-259-2
ENERGY 2013 : The Third International Conference on Smart Grids, Green Communications and IT Energy-aware Technologies

Inverters,” IEEE Trans. Power Electron., vol. 22, no. 4, July. 2007, pp. 
1107–1115. 
[8] L. Yan and W. Yun, “Power Management of Inverter Interfaced 
Autonomous Microgrid Based on Virtual Frequency-Voltage Frame,” 
IEEE Trans. Smart Grid, vol.  2, no. 1, March. 2011, pp. 30-40. 
[9] C. Marnay, M. Stadler, A. S. Siddiqui, R. Firestone, and B. Chandran, 
“Optimal Technology Selection and Operation of Commercial-
Building Microgrids,” IEEE Trans. Power syst., vol. 23, no. 3, 2008, 
pp. 975-982. 
[10] F. Katiraei and M. R. Iravani, “Power Management Strategies for a 
Microgrid With Multiple Distributed Generation Units,” IEEE Trans. 
Power syst., vol. 21, no. 4, November. 2006, pp. 1821-1831. 
[11] F. Katiraei, M. R. Iravani, and P. W. Lehn, “Small-signal Dynamic 
Model of a Micro-grid including Conventional and Electronically 
Interfaced Distributed Resources,” IET Gener. Trans. Distrib., vol. 1, 
no. 3, 2007, pp. 369-378. 
[12] Y. Guan, W. Wu, and X. Guo, ”Control Strategy for Three-phase 
Inverters 
Dominated 
Microgrid 
in 
Autonomous 
Operation,” 
Proceedings of the CSEE, vol. 31 no. 33, November. 2011, pp. 52-60. 
[13] X. Yang and J. Su,”Voltage Control Strategies for Microgrid With 
Multiple Inverters,” Proceedings of the CSEE 32 no. 7, March. 2012, 
pp. 7-13. 
[14] Y. Li and C. Kao, “An accurate power control strategy for power 
electronics-interfaced distributed generation units operating in a low 
voltage multibus microgrid,” IEEE Trans. Power Electron., vol. 24,  
no. 12 , 2009, pp. 2977–2988. 
 
 
 
76
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-259-2
ENERGY 2013 : The Third International Conference on Smart Grids, Green Communications and IT Energy-aware Technologies

