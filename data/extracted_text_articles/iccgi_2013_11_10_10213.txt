A Design of Hybrid Automatic Repeat Request Scheme based on FlexRay used for 
Smart Hybrid Powerpack 
 
Leilei Shi, Jekwang Choi and Hunmo Kim 
Department of Mechanical Engineering 
Sungkyunkwan University 
Suwon, Korea 
skkushileilei@126.com, bugs2020@naver.com, kimhm@me.skku.ac.kr 
 
 
Abstract—FlexRay is an automotive communication protocol, 
which is developed by core members of the FlexRay 
consortium (BMW, Bosch, DaimlerChrysler, Freescale, GM, 
NXP Semiconductors and Volkswagen). Nowadays, it is set to 
become widely used in the automotive industry where it will 
replace traditional networking schemes such as Controller 
Area Network (CAN). However, in the FlexRay, it just uses the 
Cyclic Redundancy Check (CRC) code to detect the errors. In 
this paper, we design of a Hybrid Automatic Repeat Request 
(HARQ) scheme which combines the CRC code with Reed-
Solomon (RS) code. Smart Hybrid Powerpack (SHPP) is an 
electro-hydraulic system, which is combined with advanced 
technology like fault tolerant, intelligent control, smart phone 
remote control and monitoring. This paper will apply the 
FlexRay into the SHPP system using the HARQ scheme. 
Simulation result shows good performance by using HARQ 
scheme comparing with CRC code only. 
Keywords-FlexRay; HARQ; SHPP 
I. 
 INTRODUCTION 
FlexRay is a communication network for distributed 
automotive systems. It is an option for upgrading existing 
network systems using traditional CAN in the automotive 
industry as well as other industrial control applications. 
Because of the dual channels for fault tolerance which can 
communicate the same information and improve the fault 
tolerance ability, it could also be used for new applications in 
industrial automation, where safety and reliability in a work 
environment can be guaranteed [1].  
The FlexRay protocol has been designed to carry 
information at a rate of 10Mbits/s by each channel, which 
means that an equivalent data rate of 20Mbits/s can be 
achieved. The FlexRay frame format consists of header 
segment (5 bytes), payload segment (0-254 bytes) and trailer 
segment (3 bytes). The frame trailer segment contains a 24-
bits CRC code. FlexRay frame format is shown in Fig. 1, 
which is a standard [2]. 
Hydraulic systems have been widely used in industrial 
applications because of their durability, high power-to-
weight ratio, reliability and large force and torque, etc. [3]. 
Two types of hydraulic transmission system are commonly 
used in industry, namely valve controlled and pump 
controlled hydraulic system [4]. Valve control hydraulic 
system has the main fault of the low energy efficiency. The 
loss of energy is due to the leakage from the pump bypass 
valves or transfer of energy into heat via throttle losses at the 
control valves.  
 
Figure 1.  FlexRay frame format 
At the range of pump controlled hydraulic systems, the 
concept of Electro Hydraulic Actuator (EHA) has been 
popular because that the EHA acts as a Power-Shift which 
shifts the power from high-speed electric motor to the high-
force of hydraulic cylinder by bi-directional piston pump. 
Thus, the EHA creates a sleeker, cleaner way to produce 
hydraulic power with higher energy efficiency [3].  
SHPP is an electro-hydraulic system which combines the 
EHA system with advanced technology like fault tolerance, 
intelligent control, smart phone remote control and 
monitoring. The whole structure of SHPP system is shown in 
Fig. 2.  
 
Figure 2.  SHPP system structure 
In the SHPP, for sensor part, some sensor fault tolerant 
technology will be done. The sensors include position sensor, 
219
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-283-7
ICCGI 2013 : The Eighth International Multi-Conference on Computing in the Global Information Technology

pressure sensor and temperature sensor. For network part, 
FlexRay error control coding will be made in this SHPP 
system. Some intelligent control methods like fuzzy control, 
adaptive fuzzy control will be tried in the SHPP. These 
control methods are smart technology recovering from faults 
like noises, disturbances and so on. The most advanced 
technology is that smart phone will act a good role in the 
system, including monitoring and control by the smart phone. 
All these advanced technology will make the SHPP system 
smart, intelligent, safe and accurate. 
In this paper, we suggest using the FlexRay in the SHPP 
and the system can be more reliable and safe. Furthermore, 
based on the FlexRay protocol we design of a HARQ 
scheme as the fault tolerant logic to improve the error 
correction ability. The rest of this paper is organized as 
follows: Section 2 will introduce proposed HARQ scheme 
for SHPP system. Section 3 will show the MATLAB 
simulation result. Conclusions of this paper will be 
represented in the last section. 
II. 
DESIGN OF HARQ SCHEME FOR SHPP 
A. CRC Code and RS Code 
In the HARQ scheme, CRC code and R-S code are used 
to design the fault tolerant logic. CRC code is used to detect 
errors after R-S decoding. In this paper, we use the CRC-24 
code as the error detecting code. The generator polynomial 
g(x) is written as (1) shows to us [2]. 
 
2 4
22
19
1 8
16
1 4
1 3
(
g x )
x
x
x
x
x
x
x







  
    
11
10
8
7
6
3
1
x
x
x
x
x
x
x







          
                  
R-S code is one of the error correcting codes. It can 
efficiently correct not only random errors but also burst 
errors. R-S code is a non-binary cyclic code with symbols 
made up of m-bit sequences, where m is any positive integer 
having a value greater than 2. R-S (n, k) codes on m-bit 
symbols exist for all n and k for the following relation as (2) 
[5]. 
0
2
2
m
k
n




                     
 
In (2), k is the number of data symbols being encoded, 
and n is the total number of code symbols in the encoded 
block. The relation between n and k can be given as (3) [5]. 
( ,
)
(2
1, 2
1
2 )
m
m
n k
t




                  
 
In (3), t is the symbol-error correcting capability of the 
code. It means that the code is capable of correcting any 
combination of t or fewer errors and t can be expressed as (4) 
[5]. 
) / 2
(
k
n
t


                         
 
In this paper, we use RS (15, 9) code with 4-bit in each 
symbol; so, the error probability of this R-S code is 3 
symbols, which means it can correct 3 symbol errors or 
fewer symbol errors successfully. 
B. Proposed HARQ Scheme 
The algorithm of the proposed HARQ scheme is shown 
as seen in Fig. 3. First, the signal from main controller will 
be changed to data.  In the receiver, the R-S code will decode 
the coded data and then do CRC decoding. By using the R-S 
(15, 9) code, 3 symbols errors or less than 3 symbols errors 
will be corrected perfectly. Then, the CRC codes will check 
whether the R-S codes corrected all the errors successfully. If 
there is no error detected by CRC codes, the signals will be 
sent to the SHPP.  
 
Figure 3.  Proposed HARQ scheme 
C. System Modeling of Brushless DC Motor Drive System 
In this paper, we only use the brushless DC Motor 
(BLDCM) drive modeling. After that, we will adapt to EHA 
system based on this paper result.  First step is to make the 
BLDCM drive modeling for error control coding between 
Main controllers and Motor drive. The BLDCM system 
model is developed considering armature voltage and load 
torque as two inputs, angular velocity and Motor position as 
two outputs. In order to simplify the model, all the stator 
phase windings are assumed to have equal resistance per 
phase and constant self and mutual inductances, iron loss is 
negligible, 
motor 
flux 
is 
unsaturated 
and 
power 
semiconductor devices are ideal. The line to line voltage 
equation in the motor can be represented as, [6] 
 
( )
( )
( )
( )
e t
dt
L dI t
I t R
t
V
 b


               ( 
 
where V(t) is input voltage of phase, I(t) is armature current 
of phase, eb(t) is back-emf of phase, R is armature resistance 
of phase, L is armature inductance of phase. The BLDCM 
generates three phase voltages by the line to line voltage 
220
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-283-7
ICCGI 2013 : The Eighth International Multi-Conference on Computing in the Global Information Technology

equation. The phase currents, phase voltages and phase 
back-emfs are assumed to be equal. The total resistance 
opposing the phase current will be twice the resistance per 
phase.  
For linear analysis, we assume that the torque developed 
by the motor is proportional to the current the armature 
current and the air-gap flux. Thus, the motor torque equation 
can be expressed as, [6] 
 
( )
( )
I t
K
t
T
T
M

                                  (6) 
 
where TM (t) is the motor torque in N-m, KT is the torque 
constant in N-m/A,  I(t) is the armature current in A. 
 Since the sum of all the opposing torques due to 
mechanical elements of motor and load torque is equal to the 
torque developed by the motor, the cause-and-effect 
equations for the motor circuit can be written as, [6]  
 
( )
( )
( )
( )
w t
B
dt
dw t
J
t
T
t
T
M
M
L
M



             (7) 
 
( )
( )
K w t
t
e
b
b

                                   (8) 
 
where TM (t) and TL (t) are torque developed by motor and 
load torque, w(t) is the rotor angular velocity in rad/s, Kb is 
back-emf   constant in N-m/A, eb(t) is the back-emf in N-
m/A.  
III. 
RESULTS 
In this paper, motor control method is a PID control in 
the BLDCM drive system and we assume that speed control 
system is designed without load conditions because we 
focused on the network system between Main controller and 
BLDCM drive system. The PID controllers are most suited 
for control systems with fixed system dynamics and no 
parameter variations during the operating conditions. The 
PID controller can be easily implemented for the BLDCM 
drive system to improve its performance. The simulink 
model using PID controller is shown in Fig. 4.  
 
Figure 4.  Simulink model using PID controller 
 To make the BLDCM drive system using PID control 
method, we decide parameters of the BLDCM. Parameters 
of the BLDCM are shown in Table I [6]. 
TABLE I.  
PARAMETERS OF THE BLDCM 
Parameters 
Values 
Stator resister, R(Ω) 
0.57 
Stator inductance, L(m-H) 
1.5 
Inertia, JM(kg-㎡) 
0.000023 
Torque constant, KT(N-m/A) 
0.082 
Back-emf constant, Kb(N-
m/A) 
0.082 
 
The gain parameters of PID controller are determined 
using the Ziegler Nichols Tuning method [7] and found to 
be 
Kp=0.2051, 
Ki=29.52 
and 
Kd=0.00053326. 
The 
simulation of BLDCM drive control system is carried out 
using MATLAB software. We determine that the reference 
rotor speed is 414.63rad/s. The response of the BLDCM 
speed control system with PID controller is shown in Fig. 5. 
 
Figure 5.  Response of the BLDCM control system with PID controller 
For error control coding between the Main controller 
and the Motor drive system, we convert the rotor speed to 
the rotor speed voltage as (8) and we calculate the rotor 
voltage is 34V.  
Fig. 6 shows the input voltage of the Speed controller, 
when the error is 3 symbols with CRC code only. The 
voltage is always 50V but the desired voltage is 34V. In the 
simulation, we assume the noise is forever existed and the 
error pattern is sure, which means even retransmission is 
made, the errors never change. When errors happen, CRC 
code can just detect the errors and retransmit the signal. It 
costs time and the errors could not be processed well forever.  
Because of the shortage in the CRC code, when some 
errors are always existed in the channel, the retransmission 
is needed all the time. If the system is critical, it will have 
big problem. So we need some other methods to cover the 
CRC shortage. In the below, we add the RS code in the 
channel, which means HARQ scheme is used. 
221
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-283-7
ICCGI 2013 : The Eighth International Multi-Conference on Computing in the Global Information Technology

 
Figure 6.  The input voltage of Speed controller (Error is 3 symbols with 
CRC code only) 
Fig. 7 shows the simulink model of error control coding 
with HARQ scheme. The error control coding consists of 
mainly three parts that are Encoder, Channel and Decoder. 
Display 1 shows the corrected error symbols by RS code. 
Display 2 shows the CRC decoding result: “0” means no 
error and “1” means have errors.  
 
Figure 7.  Simulink model of error control coding with HARQ scheme 
Fig. 8 shows the input voltage of Speed controller, when 
the error is 3 symbols with HARQ scheme. The voltage is 
always 34V. In the simulation, we assume the error pattern 
is same with CRC code only case. Because the use of RS 
(15, 9) code, 3 symbol errors are corrected well and it 
doesn’t need retransmission anymore. 
Comparing Fig. 6 with Fig. 8, we know that HARQ 
scheme shows better performance than CRC code only. The 
error signal 50V is covered to 34V, which means the small 
error pattern is processed well by HARQ scheme. 
Furthermore, it does not need retransmission and can save 
time for the system.  
 
Figure 8.  The input voltage of Speed controller (Error is 3 symbols with 
HARQ scheme) 
IV. 
CONCLUSIONS 
In this paper, we applied the HARQ scheme based on 
FlexRay used for SHPP system. In the system modeling part, 
BLDCM control system with PID controller is done. In the 
error control coding part, HARQ scheme performs well in 
the system fault tolerance. With the RS code, some burst 
error or small bits error can be corrected well. When errors 
are bigger than the ability which RS code can correct, we 
will use other methods like retransmission or second channel 
to cover the errors. Our final goal is to make the real SHPP 
system based on fault tolerant and use adaptive fuzzy control.  
ACKNOWLEDGMENT 
This research is supported by the Software Fusion 
Component Development of the Korea Evaluation Institute 
of Industrial Technology grant funded by the Korea 
government Ministry of Trade, Industry and Energy. The 
authors gratefully appreciate their support during this work. 
 
REFERENCES 
[1] R. Shaw and B. Jackman, “An Introduction to FlexRay as an 
Industrial Network,” IEEE Inter. Symp. On Industrial 
Electronics (ISIE 2008), IEEE Press, Jul. 2008, pp. 1849-
1854. 
[2] FlexRay Consortium: FlexRay Communication System 
Protocol Specification Version 3.1, October 2010. 
[3] K. K. Ahn, D. N. C. Nam, D. Q. Truong, and J. I. Yoon, 
“Position control of Electro-hydraulic actuator (EHA) Using a 
novel back stepping controller,” Journal of The Korean 
Society for Fluid Power & Construction Equipments, vol. 9, 
no. 3, Sep. 2012,  pp. 16-22. 
[4] Y. A. Chinniah, “Fault Detection In the Electrohydraulic 
Actuator Using Extended Kalman Filter,” PhD thesis, 
University of Saskatchewan,  Saskatoon,  Canada, March 
2004. 
[5] L. L. Shi, Q. Li, M. B. Park, and H. M. Kim, “A Design of 
Fault Tolerant Logic on Experiments for Brake-by-Wire 
222
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-283-7
ICCGI 2013 : The Eighth International Multi-Conference on Computing in the Global Information Technology

System,” Eurobake 2012 Conference Proceedings, FISITA, 
April 2012, ISBN: 978-0-9572076-0-8. 
[6] R. Shanmugasundram, K. M. Zakaraiah and N. Yadaiah, 
“Modeling, simulation and analysis of controllers for 
brushless direct current motor drives,” Journal of Vibration 
and 
Control, 
May 
2012, 
pp. 
1-15, 
doi: 
10.1177/1077546312445200. 
[7] W. H. Kwun and O. K. Kwun, Automatic Control 
Engineering, First Edition, Fifth Print, CMG Publishing 
Group, 2009, ISBN: 978-89-7088-423-3. 
 
223
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-283-7
ICCGI 2013 : The Eighth International Multi-Conference on Computing in the Global Information Technology

