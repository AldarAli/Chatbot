A Multi-Objective Optimization Method on Consumer’s Beneﬁt
in Peer-to-peer Energy Trading
Mitsue Imahori, Ryo Hase and Norihiko Shinomiya
Graduate School of Engineering
Soka University
Tokyo, Japan 192–8577
Email: shinomi@soka.ac.jp
Abstract—In recent years, many countries have been promoting
the shift from centralized energy systems to distributed ones for
clean energy utilization. Direct energy trading among consumers
has drawn increasing interest in the development of efﬁcient
utilization of distributed energy systems. However, a part of
consumers might not be able to receive electricity from their
preferred suppliers since some suppliers have limited capacity
of supplying electricity. This occasion leads to a decrease in the
consumer’s beneﬁt. Existing studies are mainly focused on not
the equity of prosumer’s beneﬁt but the efﬁciency of resource
allocation. Therefore, a mechanism that satisﬁes not only balance
between supply and demand but market participants’ preferences
is required. In this paper, a multi-objective optimization problem
as market mechanism is proposed to improve both the equity
of consumer’s beneﬁt and the efﬁciency of resource allocation.
For solving the proposed optimization problem, six Evolutionary
Algorithms (EAs) are selected. Simulation results show that the
selected EAs can be classiﬁed into two types: (i) algorithms
optimizing both the efﬁciency of resource allocation and the
equity of consumer’s beneﬁt and (ii) algorithms optimizing only
one of the two objectives.
Keywords–Peer-to-Peer Energy Trading; Evolutionary Algo-
rithm; Multi-objective Optimization Problem; Graph Theory.
I.
INTRODUCTION
Many countries have been encouraging people to utilize
distributed energy systems such as solar and wind power gener-
ations for environmental issues. Existing energy systems have
been relying on fossil fuels heavily because this kind of energy
systems can supply electricity to a great number of consumers
with fewer electric outage. However, such energy systems emit
a large amount of greenhouse gas, which leads to a factor
contributing to global warming. Therefore, many countries
have legislated policy to enhance the rate of renewable energy
utilization.
One of the efforts of governments in many countries is to
enact Feed-In Tariff (FIT), which aims at spreading renewable
energy systems widely to general households. Consumers who
own energy generators are called prosumers [1] because they
do not only consume electricity but also produce it. FIT
guarantees that public utilities purchase excess electricity from
consumers at a ﬁxed rate in a certain period. FIT leads
consumers to be able to have the outlook for the return
on installation costs of renewable energy systems. Therefore,
renewable energy systems have drawn increasing interest in
general households, and the number of prosumers has been
increasing year by year.
For efﬁcient excess electricity utilization, energy market
frameworks have been proposed by governments in many
countries. For example in Japan, one of the methods is Virtual
Power Plant (VPP) that aggregates capacities of heterogeneous
distributed energy resources. Another example is Demand Re-
sponse (DR) which is a change in consumption of consumers
to match demand for electricity with supply. In VPP and
DR, there are aggregators who join a local energy market as
third party to manage prosumer’s energy resources. However,
in these methods, transparency of trading is unclear, and an
intermediate margin is incurred due to a third party such as an
aggregator.
In order to cope with the issues described above, direct
energy trading among consumers and prosumers that is re-
garded as Peer-to-Peer (P2P) energy trading has been gathering
attention. Fig. 1 represents present energy trading, and Fig. 2
shows P2P energy trading. As shown in Fig. 1, consumers
can trade electricity with the only one public utility in present
energy trading. On the other hand, as shown in Fig. 2,
consumers can trade electricity with not only the public utility
but other consumers in P2P energy trading. Energy trading
without a third party is expected to increase transparency of
trading and reduce electricity rates. P2P energy trading would
make consumers motivated to exchange electricity with others,
and efﬁcient electricity utilization in a local energy market will
be realized. Nowadays, the feasibility of P2P energy trading
will improve with the advent of blockchain technology.
Fig 1. Present energy trading.
Fig 2. Peer-to-peer energy trading.
However, if P2P energy trading is implemented in prac-
56
Copyright (c) IARIA, 2020.     ISBN:  978-1-61208-771-9
ICONS 2020 : The Fifteenth International Conference on Systems

tical markets, a couple of issues might occur due to market
constraints. In P2P energy trading, candidates for consumer’s
trading partner will be diversiﬁed, and each consumer will have
preferences for market participants. Consumers will decide
their trading partners based on their preferences. There is
a special constraint that must meet supply and demand for
electricity in energy markets. If each market participant acts
to maximize their beneﬁt in markets and decides their trading
partner arbitrarily, balance between supply and demand for
electricity might collapse because of breaking the market
constraints. Furthermore, if each market participant decides
their trading partners under the market constraints, some
consumers might not be able to trade electricity with their
desirable partners since prosumers have limited capacity of
supplying electricity. These occasions lead to a decrease in
the consumer’s beneﬁt. Therefore, a mechanism that satisﬁes
not only balance between supply and demand but market
participant’s preference is required.
For P2P energy trading realization, many studies have
been conducted to consider P2P trading models. Jiawen et
al. propose an auction mechanism that determines optimal
electricity rates and the amount of electricity traded between
sellers and buyers in an electric vehicle market in [2]. In [3],
Muhammad et al. present a smart home model for minimizing
the total of payment to the public utility and eliminating
inequalities of energy. Pourya et al. formulate an economic
dispatch problem for reducing operation costs in a community
microgrid in [4]. Yue et al. evaluate some P2P energy sharing
mechanisms based on multi-agent simulation frameworks that
might bring both economic and technical beneﬁt in [5]. Chao
et al. present a two-stage aggregated control for maximizing
economic beneﬁt of each prosumer in [6]. In [7], Wayes
et al. present a price discrimination method that is able to
conduct envy-free energy trading and to maximize the total
of consumer’s beneﬁt. These studies described above analyze
not the equity of consumer’s beneﬁt but only the efﬁciency of
resource allocation in P2P trading markets.
Therefore, our study proposes a P2P energy trading model
and analyzes trading focusing on each consumer’s beneﬁt be-
sides an overall market. In P2P trading, consumer’s production
and demand vary over time, and their beneﬁt is anticipated
changing complicatedly. Our model is denoted by Time-
Varying Graph (TVG) [8] to represent time-varying consumer’s
behavior. Furthermore, a multi-objective optimization problem
as market mechanism is formulated to investigate beneﬁt of
each consumer. Since P2P energy trading has not been applied
to a practical market, electricity trading should be investigated
more carefully.
This paper is structured as follows. Section II explains the
deﬁnitions of our energy trading model with a time-varying
graph. Section III formulates a multi-objective optimization
problem and demonstrates the simulation results. Section IV
concludes this paper and expresses future works.
II.
MODEL REPRESENTATION
This section introduces our P2P energy trading model by
utilizing notation of graph theory. An optimization problem is
formulated to investigate P2P energy trading.
A. P2P energy trading model as graphs
Our electricity market model is composed of two kinds of
participants that are a public utility and consumers. The set of
all participants is expressed by V . Public utility is denoted by
vp ∈ V . Since energy trading among only consumers will not
be able to provide for all demand, it is assumed that there is
a public utility in our model for covering all electricity deﬁcit
and excess electricity. Consumer is represented by vi ∈ V (i =
1, 2, . . . , |N|) and varies its behavior between seller and buyer
according to time. If a consumer has excess electricity, the
consumer can be seller. On the other hand, if a consumer runs
out of generated electricity, the consumer can be buyer. Some
consumers might not have own energy generators, and their
production should be set to zero in this case. VS ⊂ V indicates
the set of consumers who are sellers, and VB ⊂ V expresses
the set of consumers who are buyers.
Consumer vi changes its behavior depending on its produc-
tion and consumption of electricity in P2P trading markets.
Consumers must trade electricity during time span T . Con-
sumer’s production and consumption at each time t ∈ T are
represented by pt
i ∈ R and ct
i ∈ R respectively. If pt
i > ct
i, vi
will be seller and can supply electricity to other participants.
Conversely, if pt
i < ct
i, vi will be buyer and can purchase
electricity from other participants. Furthermore, if pt
i = ct
i, vi
will be neither seller or buyer and does nothing in markets at
t.
In order to model a P2P trading market considering time-
varying consumer’s behavior, TVG is utilized. A P2P trading
model at each time is represented by TVG that consists of
four types of vertices: the white vertices behaving as sellers,
the black vertices behaving as buyers, the gray vertex doing
nothing in the markets, and the blue vertices expressing public
utilities. The set of arcs is denoted by A, and each arc of TVG
at t is represented by (vi, vj) ∈ At. Arc (vi, vj) expresses the
relationship where vj can purchase electricity with vi. Each
arc must connect two vertices. The direction of the arrows
represents electricity ﬂow. TVG in Fig. 3 is expressed as
G = (V, A, T ). By using this model, consumer’s beneﬁt can
be investigated in detail at each time.
Fig 3. Time-Varying Graph G.
An underlying graph indicates relationships among market
participants where they can trade electricity with each other
over a trading period as a sort of footprints of TVG. Fig. 4
that consists of the blue vertices expressing a public utility and
the orange vertices representing consumers is represented by
an underlying graph of G in Fig. 3. The set of edges is denoted
by E, and each edge of the underlying graph is represented
by (vi, vj) ∈ E. Edge (vi, vj) denotes the relationship where
vj can purchase electricity from vi. Underlying graph in Fig.
57
Copyright (c) IARIA, 2020.     ISBN:  978-1-61208-771-9
ICONS 2020 : The Fifteenth International Conference on Systems

4 is expressed by G = (V, E). Since an underlying graph is
ﬁnalized by aggregating TVG, the cumulative beneﬁt of each
consumer can be analyzed in this model.
Fig 4. An underlying graph G.
B. Constraints of trading volume
Each consumer has capacity of supplying and purchasing
electricity depending on its production and consumption. The
amount of electricity traded between vi and vj is represented
by x: (VS ∪{vp})×(VB ∪{vp}) → R, and x is called trading
volume. Each arc (vi, vj) ∈ At has capacity where vi can
supply electricity to vj up to the maximum trading volume.
Capacity of (vi, vj) ∈ At is denoted by the function cap :
(VS ∪ {vp}) × (VB ∪ {vp}) × T → R. The trading volume on
each arc must satisfy the following constraints:
0 ≤ xt (vi, vj) ≤ capt (vi, vj)
(vi ∈ VS, vj ∈ VB, t ∈ T ) ,
(1)
0 ≤ xt (vi, vp) ≤ capt (vi, vp)
(vi ∈ VS, t ∈ T ) ,
(2)
0 ≤ xt (vp, vj) ≤ capt (vp, vj)
(vj ∈ VB, t ∈ T ) .
(3)
Funcion cap is calculated by different formulae depending
on trading pairs. Excess electricity of seller vi is deﬁned as
pt
i −ct
i, and electricity deﬁcit of buyer vj is deﬁned as ct
j −pt
j.
If both vi and vj are prosumers, capacity of (vi, vj) at t is set
as
capt (vi, vj) = min
((
pt
i − ct
i
)
,
(
ct
j − pt
j
))
.
Since a public utility covers all consumer’s electricity deﬁcit,
it is assumed that the public utility can supply electricity to all
consumers. Therefore, capacity of (vp, vj) at t is deﬁned as
capt (vp, vj) = ct
j − pt
j.
Moreover, since the public utility covers all consumer’s excess
electricity, it is assumed that the public utility can purchase
electricity from all consumers. Therefore, capacity of (vi, vp)
at t is deﬁned as
capt (vi, vp) = pt
i − ct
i.
Sellers must sell electricity which is equal to the amount
of own excess electricity to others. Buyers must purchase
electricity which is equal to the amount of own electricity
deﬁcit from others. The above constraints are expressed by
∑
vj∈VB∪{vp}
xt(vi, vj) = pt
i − ct
i
(vi ∈ VS, t ∈ T ) ,
(4)
∑
vi∈VS∪{vp}
xt(vi, vj) = ct
j − pt
j
(vj ∈ VB, t ∈ T ) .
(5)
C. Rate
Consumers behaving as seller and a public utility have
rates when dealing with their electricity. Seller vi ∈ VS offers
the unit of electricity with rate ri ∈ R to buyers vi ∈ VB.
When vi supplies electricity xt(vi, vj) to vj, vj must purchase
electricity at xt(vi, vj) · ri from vi. Public utility vp offers
the unit of electricity to buyers with rate rs ∈ R, where it is
assumed that rs ≥ ri. When vp supplies electricity xt(vp, vj)
to vj, vj must purchase electricity at xt(vp, vj) · rs from vp.
Public utility vp purchases electricity at rate rb ∈ R from
sellers, where it is assumed that ri ≥ rb. When vi supplies
electricity xt(vi, vp) to vp, vp must purchase electricity at
xt(vi, vp) · rb from vi.
D. Reservation price
Each consumer has a reservation price in energy trading.
The reservation price of buyers is the maximum price where
buyers can purchase electricity from others. Conversely, the
reservation price of sellers is the minimum price where sellers
can supply electricity to others. The reservation prices of
consumers are represented by the function ω: V × T → R. ω
is calculated from different formulae depending on consumer’s
behavior. Thus, the reservation prices are expressed by the
following formulae:
ωt (vi) =
{(pt
i − ct
i) · rb
(pt
i > ct
i) ,
(ct
i − pt
i) · rs
(pt
i < ct
i) .
Since each consumer must deal electricity with the only public
utility in present electricity trading, ωt(vi) is set as a price
offered by the public utility in this paper.
E. Consumer’s beneﬁt
Consumers can beneﬁt from trading when they trade
electricity with more favorable partners than current ones.
Consumer’s beneﬁt is represented by the function π: V → R.
π is also calculated from different formulae depending on
consumer’s behavior. Seller’s beneﬁt is deﬁned as the dif-
ference between the total income and the reservation price
of sellers. Consumer’s income is represented by the function
ζ : Vs × Vb × T → R. The total of each seller’s income is
deﬁned as
ζt (vi) =
∑
vj∈VB
xt (vi, vj) · ri + xt (vp, vi) · rs.
If a consumer behaves as seller, consumer’s beneﬁt is deﬁned
as
πt (vi) = ζt (vi) − ωt (vi) .
Conversely, buyer’s beneﬁt is deﬁned as the difference
between the reservation price of buyers and the total of
expenditure. Consumer’s expenditure is represented by the
function η: Vs×Vb×T → R. The total of buyer’s expenditure
is deﬁned as
ηt (vj) =
∑
vi∈VS
xt (vi, vj) · ri + xt (vp, vj) · rs.
58
Copyright (c) IARIA, 2020.     ISBN:  978-1-61208-771-9
ICONS 2020 : The Fifteenth International Conference on Systems

If a consumer behaves as buyer, buyer’s beneﬁt is deﬁned as
πt (vj) = ωt (vj) − ηt (vj) .
Since all of the consumers must not suffer from monetary
deﬁcits caused by electricity trading in our model, it is assumed
that πt(vi) ≥ 0, πt(vj) ≥ 0. This research focuses on P2P
trading in one local energy market, that is, a public utility
will be negligibly affected by energy trading. Therefore, public
utility’s beneﬁt is not considered.
F. Problem formulation
In order to investigate consumer’s beneﬁt, a multi-objective
optimization problem is formulated. One of the objectives
is to maximize the total of consumer’s beneﬁt. The other
objective is to minimize the standard deviation of consumer’s
beneﬁt. This problem is expected to obtain solutions with the
high efﬁciency of resource allocation and the high equity of
prosumer’s beneﬁt. The problem is deﬁned as follows.
maximize
∑
vi∈VS∪VB
πt(vi).
minimize
√∑
vi∈VS∪VB(π − πt(vi))2
|N|
.
subject to (1), (2), (3), (4), and (5),
where the objective functions are optimized at each time t.
Constraints (1), (2), and (3) indicate that the amount of
electricity traded between participants on each arc is less than
or equal to capacity of each arc. These constraints also show
that the amount of electricity traded between participants is
not a negative value. Constraint (4) represents that the total of
seller’s trading volume is equal to the amount of own excess
electricity, and constraint (5) expresses that the total of buyer’s
trading volume is equal to the amount of own electricity deﬁcit.
III.
EXPERIMENTAL RESULTS
To obtain solutions optimized by the multi-objective op-
timization problem, a simulator is developed with Platypus
[9] that is a framework for evolutionary computing in Python.
The following six selected Evolutionary Algorithms (EAs) as
metaheuristics methods are utilized in our simulation.
•
Non-dominated
Sorting
Genetic
Algorithms-I
I (NSGA-II)
•
Generalized Differential Evolution-III (GDE3)
•
Optimized MultiObjective Particle Swarm Optimiza-
tion (OMOPSO)
•
Speed-constrained Multiobjective Particle Swarm Op-
timization (SMPSO)
•
Strength Pareto Evolutionary Algorithm-II (SPEA2)
•
ϵ-MultiObjective Evolutionary Algorithm (ϵ-MOEA)
The reason for utilizing metaheuristics algorithms is that they
are expected to be able to apply for an expanded market with
a large number of participants.
A. Conditions
In our simulation, parameters were determined in reference
to the electricity market in Japan. The public utility supplies
electricity to consumers at 29.05 yen per kWh and purchases
electricity from consumers at 8.05 yen per kWh. Consumers
supply electricity to other consumers at 18.55 yen per kWh,
it comes from the average between the public utility’s of-
fering rate and purchasing rate. Seller’s production pi and
consumption ci are set to 549 Wh and 502 Wh respectively.
Buyer’s production pi and consumption ci are set to 455 Wh
and 502 Wh respectively. The number of iterations is set to
1,000. Since the optimization problem was solved every one
hour for deciding trading partners, trading for 1000 hours was
determined in the experiments. In each round of simulations,
the number of samples is set to 10000, and the population is
set to 100. For OMOPSO and ϵ-MOEA, ϵ is set to 0.05.
With the assumed market, a simulation was conducted with
each of the following four patterns:
•
3 sellers and 0 buyer (Pattern 1)
•
2 sellers and 1 buyer (Pattern 2)
•
1 seller and 2 buyers (Pattern 3)
•
0 seller and 3 buyers (Pattern 4)
B. Results and discussion
In Pattern 1 and Pattern 4, there is only one kind of
solutions that both the total of consumer’s beneﬁt and the
standard deviation are zero in all selected EAs. This paper
introduces only the results of Pattern 2 because the results
of Pattern 3 have a tendency similar to Pattern 2. Since EAs
obtained Pareto solutions, this research randomly extracted one
of the Pareto solutions at each time.
Fig. 5 depicts the solutions obtained by NSGA-II in Pattern
2. The results of SMPSO, SPEA2 and ϵ-MOEA have a ten-
dency similar to NSGA-II. In Fig. 5, the horizontal axis depicts
the total of consumer’s beneﬁt, and the vertical axis shows the
standard deviation of consumer’s beneﬁt. Simulation results
show that NSGA-II discovered various kinds of solutions under
the same conditions. Figs. 6 and 7 show each of the two
objective functions at each time in Fig. 5. In Fig. 6, the
horizontal axis depicts t, and the vertical axis shows the total of
consumer’s beneﬁt. In Fig. 7, the horizontal axis depicts t, and
the vertical axis shows the standard deviation of consumer’s
beneﬁt. These results show that the solutions are dense toward
the optimal area, and NSGA-II tended to ﬁnd solutions on the
Pareto front. As shown from the results, NSGA-II facilitates
deciding ideal trading depending on methods to select solu-
tions.
Fig. 8 represents the solutions obtained by OMOPSO in
Pattern 2. The results of GDE3 have a tendency similar to
OMOPSO. The horizontal and vertical axes in Fig. 8 depict
the same as Fig. 5. Simulation results show that OMOPSO
found solutions optimized for only one of the two objective
functions in most cases. Figs. 9 and 10 show each of the
two objective functions at each time in Fig. 8. The horizontal
and vertical axes in Fig. 9 depict the same as Fig. 6, and the
horizontal and vertical axes in Fig. 10 represent the same as
Fig. 7. As shown in Fig. 9, the solutions are dense in the
59
Copyright (c) IARIA, 2020.     ISBN:  978-1-61208-771-9
ICONS 2020 : The Fifteenth International Conference on Systems

upper part and the lower part of the ﬁgure. The solutions in
the upper part show the maximum total of consumer’s beneﬁt.
On the other hand, the solutions in the lower part show that
all consumers could not obtain beneﬁt at that time. Fig. 10
also shows that the solutions are dense in the upper part and
the lower part of the ﬁgure. The solutions in the lower part
show that the variation in consumer’s beneﬁt is zero, that is,
they are the best solutions in terms of the equity of consumer’s
beneﬁt. On the other hand, the solutions in the upper part show
that consumer’s beneﬁt with the low equity is obtained. As
shown from the results, when only one objective function is
optimized, the other objective function is likely to be inferior
in this algorithm.
Fig 5. Solutions obtained by NSGA-II in Pattern 2.
Fig 6. Total of consumer’s beneﬁt obtained by NSGA-II.
Fig 7. Standard deviation obtained by NSGA-II.
Fig 8. Solutions obtained by OMOPSO in Pattern 2.
Fig 9. Total of consumer’s beneﬁt obtained by OMOPSO.
Fig 10. Standard deviation obtained by OMOPSO.
IV.
CONCLUSION AND FUTURE WORK
This research proposed the P2P trading model with time-
varying consumer’s behavior and the multi-objective opti-
mization problem was formulated to investigate consumer’s
beneﬁt. Simulation results show that OMOPSO and GDE3
tended to ﬁnd solutions optimized for only one of the two
objective functions, and the other algorithms such as NSGA-I
I, SMPSO, SPEA2 and ϵ-MOEA tended to discover solutions
dense on the Pareto front. As shown from the results, NSGA-II,
SMPSO, SPEA2 and ϵ-MOEA facilitate deciding ideal trading
depending on methods to select solutions. As future work,
a method to select solutions obtained by the multi-objective
optimization problem should be considered to allocate energy
that consumers can obtain beneﬁt equitably.
60
Copyright (c) IARIA, 2020.     ISBN:  978-1-61208-771-9
ICONS 2020 : The Fifteenth International Conference on Systems

REFERENCES
[1]
A. Tofﬂer and H. Tofﬂer, “Revolutionary Wealth, ”Knopf, 2006.
[2]
J. Kang, R. Yu, X. Huang, S. Maharjan, Y. Zhang, and E. Hossain,
“Enabling Localized Peer-to-Peer Electricity Trading Among Plug-
in Hybrid Electric Vehicles Using Consortium Blockchains, ” IEEE
Transactions on Industrial Informatics, IEEE, vol.13, pp. 3154-3164,
2017.
[3]
M. R. Alam, M. St-Hilaire, and T. Kunz, “An optimal P2P energy
trading model for smart homes in the smart grid, ”Energy Efﬁciency,
Springer, vol.10, pp. 1475-1493, 2017.
[4]
P. Shamsi, H. Xie, A. Longe, and J. Joo, “Economic Dispatch for an
Agent-Based Community Microgrid, ”IEEE, vol. 7, pp. 2317 - 2324,
2016.
[5]
Y. Zhou, J. Wu, and C. Long, “Evaluation of peer-to-peer energy sharing
mechanisms based on a multiagent simulation framework, ” Applied
Energy, ELSEVIER, pp.993-1022, 2018.
[6]
C. Long, J. Wu, C. Zhang, L. Thomas, M. Cheng, and Nick Jenkins,
“Peer-to-Peer Energy Trading in a Community Microgrid,”IEEE Power
& Energy Society General Meeting, 2017.
[7]
W. Tushar, C. Yuen, D. B. Smith and H. V. Poor, “Price Discrimination
for Energy Trading in Smart Grid: A Game Theoretic Approach,”IEEE
Transactions on Smart Grid, vol. 8, no. 4, pp. 1790-1801, 2017.
[8]
A. Casteigts, P. Flocchini, W. Quattrociocchi, and N. Santoro, “Time-
Varying Graphs and Dynamic Networks,”Ad-hoc, Mobile, and Wireless
Networks, International Conference on Ad-Hoc Networks and Wireless,
Springer, pp.346-359, 2011.
[9]
“Platypus - Multiobjective Optimization in Python,” https://platypus.r
eadthedocs.io/en/latest/ (Last visited: October. 24, 2019)
61
Copyright (c) IARIA, 2020.     ISBN:  978-1-61208-771-9
ICONS 2020 : The Fifteenth International Conference on Systems

