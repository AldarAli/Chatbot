Fault Detection using NLMS Adaptive Filtering  
for a Wastewater Treatment Process 
 
Mihaela Miron 
Faculty of Automation, Computers, 
Electrical Engineering and Electronics 
Dunarea de Jos University of Galati 
Galati, Romania 
Mihaela.Miron @ugal.ro 
Anisia Culea-Florescu 
Faculty of Automation, Computers, 
Electrical Engineering and Electronics 
Dunarea de Jos University of Galati 
Galati, Romania 
Anisia.Florescu @ugal.ro 
Mihai Culea 
Faculty of Automation, Computers, 
Electrical Engineering and Electronics 
Dunarea de Jos University of Galati 
Galati, Romania 
Mihai.Culea@ugal.ro 
 
Abstractâ€”In this paper, a method based on adaptive filtering is 
proposed for actuator, sensor and toxicity faults detection in a 
biological wastewater treatment process. Improving water 
quality in such treatment plants is an important and growing 
problem 
so 
monitoring 
performance 
and 
conditions, 
optimization and fault diagnosis for biotechnological processes 
are as important as fault detection. Such detection is 
performed here using state-parameter estimation where the 
detection algorithm compares the outputs of an analytical 
model with those estimated by the normalized least mean 
square adaptive filter in order to calculate the residual value 
for each output of the process. Numerical examples are 
presented in order to illustrate the performance of the 
proposed method. 
Keywords- wastewater treatment process; adaptive Kalman 
filter; fault detection; process diagnosis. 
I. 
INTRODUCTION 
Improving the quality of waters in the wastewater 
treatments plants has become more and more important due 
to the fact that the population is continuously increasing. The 
environment and especially general population health 
depends on it. As a result, monitoring performances and 
conditions, 
optimization 
and 
fault 
diagnosis 
for 
biotechnological processes are novelty topics in the current 
scientific research. 
So far in literature several methods for fault detection and 
isolation of different types of faults have been proposed [1]-
[10]; however, there are limitations in the case of monitoring 
complex and dynamical processes as Wastewater Treatment 
Processes (WWTPs). 
The main challenge of this work was to propose a simple 
and fast method to detect different types of faults which can 
occur in the wastewater treatment process. Subsequently, in 
order to detect actuator, sensor and biological faults, this 
paper proposes a method based on adaptive filtering which is 
monitoring the changes in residuals of the model parameters. 
Many adaptive algorithms have been developed over 
time based on two different approaches, namely the 
statistical approach and the deterministic approach, each with 
specific advantages and disadvantages [11] [12]. This paper 
presents a fault detection algorithm which uses one of the 
popular Normalized Least Mean Square (NLMS) algorithm 
for state estimation. This approach proves to be fit for 
WTTPs since adaptive filtering algorithm has to address the 
classical compromise between fast convergence/tracking and 
low misadjustment [13] [14]. 
The paper structure is the following: Section 2 presents 
the analytical model of the wastewater treatment process; 
Section 3 presents the NLMS adaptive filter used to estimate 
the WWTP outputs; Section 4 presents the fault detection 
approach and the residuals obtained for sensor, actuator or 
toxicity faults; Section 5 is dedicated to results and 
discussion about fault detection performance and the last one 
highlights the paperâ€™s conclusions. 
II. 
THE WASTEWATER TREATMENT PROCESS 
The mathematical model of the Wastewater Treatment 
Process (WWTP) on which this study is based is described 
by the following equations [7]-[10]. 
 
ğ‘‘ğ‘‹
ğ‘‘ğ‘¡ = (ğœ‡(ğ‘¡) âˆ’ ğœ‡ğ‘ (ğ‘¡))ğ‘‹(ğ‘¡) âˆ’ ğ·(ğ‘¡)(1 + ğ‘Ÿ)ğ‘‹(ğ‘¡) + 
 
+ğ‘Ÿğ·(ğ‘¡)ğ‘‹ğ‘Ÿ(ğ‘¡)ï€ 
ï€¨ï€±ï€©ï€ 
with: 
 
ğ· =
ğ¹ğ‘–ğ‘›
ğ‘‰ ï€ 
ï€¨ï€²ï€©ï€ 
where: 
X(t) â€“ biomass concentration,  
ğœ‡(ğ‘¡) â€“ specific growth rate, 
ğœ‡ğ‘ (ğ‘¡) â€“ decay coefficient for biomass, 
D(t) â€“ dilution rate is : ğ· =
ğ¹ğ‘–ğ‘›
ğ‘‰  
r â€“ recirculating rate, 
Xr(t) â€“ recirculated biomass concentration, 
Fin â€“ influent flow, 
V â€“ bioreactor volume, 
 
ğ‘‘ğ‘†
ğ‘‘ğ‘¡ = âˆ’
ğœ‡(ğ‘¡)âˆ’ğœ‡ğ‘ (ğ‘¡)
ğ‘Œ
ğ‘‹(ğ‘¡) âˆ’ ğ·(ğ‘¡)(1 + ğ‘Ÿ)ğ‘†(ğ‘¡) + ğ·(ğ‘¡)ğ‘†ğ‘–ğ‘› ï€¨ï€³ï€© 
where: 
S(t) â€“ substrate concentration,  
Y â€“ yield coefficient, 
40
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-740-5
EMERGING 2019 : The Eleventh International Conference on Emerging Networks and Systems Intelligence

ğœ‡ğ‘šğ‘ğ‘¥ â€“ maximum specific growth rate, 
Sin â€“ influent substrate concentration, 
ï€ 
ğ‘‘ğ·ğ‘‚
ğ‘‘ğ‘¡ = âˆ’
(1âˆ’ğ‘Œ)(ğœ‡(ğ‘¡)âˆ’ğœ‡ğ‘ (ğ‘¡))ğ‘‹(ğ‘¡)
ğ‘Œ
âˆ™ 103 âˆ’ ğ·(ğ‘¡)(1 + ğ‘Ÿ)ğ·ğ‘‚(ğ‘¡) +
+60ğ›¼ğ‘Š(ğ‘¡)(ğ·ğ‘‚ğ‘ ğ‘ğ‘¡ âˆ’ ğ·ğ‘‚(ğ‘¡)) + ğ·(ğ‘¡)ğ·ğ‘‚ğ‘–ğ‘›ï€ 
ï€¨ï€´ï€©ï€ 
where: 
DO(t) â€“ dissolved oxygen concentration,  
Doing â€“ influent dissolved oxygen concentration,  
DOsat â€“ saturation value of dissolved oxygen, 
W(t) â€“ aeration rate, 
ğ›¼ â€“ oxygen transfer rate, 
ğ‘‘ğ‘‹ğ‘Ÿ
ğ‘‘ğ‘¡ = ğ·ğ‘ (ğ‘¡)(1 + ğ‘Ÿ)ğ‘‹(ğ‘¡) âˆ’ ğ·ğ‘ (ğ‘¡)(ğ›½ + ğ‘Ÿ)ğ‘‹ğ‘Ÿ(ğ‘¡) âˆ’ 
             âˆ’0.5ğ·ğ‘ (ğ‘¡)(1 + ğ›½)ğ‘‹ğ‘Ÿ(ğ‘¡)ï€ 
ï€¨ï€µï€©ï€ 
where: Ds is the dilution rate of the sludge  
 
ğ·ğ‘  =
ğ·âˆ™ğ‘‰
ğ‘‰ğ‘  ï€ 
ï€¨ï€¶ï€©ï€ 
with Vs â€“ sludge volume and ğ›½ the rate of the sludge in 
excess. 
 
ğœ‡(ğ‘¡) = ğœ‡ğ‘šğ‘ğ‘¥
ğ‘†(ğ‘¡)
ğ¾ğ‘ +ğ‘†(ğ‘¡) âˆ™
ğ·ğ‘‚(ğ‘¡)
ğ¾ğ·ğ‘‚+ğ·ğ‘‚(ğ‘¡)ï€ 
ï€¨ï€·ï€©ï€ 
where: Ks is the saturation constant of the substrate and KDO 
is the saturation constant of dissolved oxygen. 
III. 
ADAPTIVE FILTER USING NORMALIZED LEAST 
SQUARE (NLMS) ALGORITHM 
As a general note, the adaptive filters are self-adjustable 
systems which adapt to various conditions and situations 
therefore are used in a wide range of areas. The common trait 
of the applications where the adaptive filters provide a good 
solution is based on minimizing the mean squared error 
between the filter output and a desired signal. 
The filterâ€™s parameters are updated using a set of 
measured data which are used as input for the adaptive 
filtering algorithm. The algorithm adjusts filterâ€™s parameters 
so that the difference between the input and the output is 
minimized either statistically or deterministically and these 
approaches give us applications for modelling, reverse 
modelling, prediction or interference cancelling.  
This paper uses the adaptive filter as a predictor and, in 
this context, it estimates the current value of the signal ğ‘¥Ì‚(ğ‘›) 
based on the past values ğ‘¥(ğ‘› âˆ’ 1), ğ‘¥(ğ‘› âˆ’ 2), â€¦ , ğ‘¥(ğ‘› âˆ’ ğ‘). 
Using the linear combinations of N successive samples of the 
input signal, the algorithm tries to estimate the output of the 
desired signal d(n), which is a forward version of the 
adaptive filter input signal.  
The filter is assumed to be finite impulse response (FIR) 
filter of length L with coefficients ğ’˜ = (ğ‘¤1 â€¦ ğ‘¤ğ¿)ğ‘‡, input 
signal ğ±(ğ‘› âˆ’ 1) = (ğ‘¥(ğ‘› âˆ’ 1) â€¦ ğ‘¥(ğ‘› âˆ’ ğ‘))ğ‘‡
and 
output 
defined by: 
 
ğ‘¥Ì‚(ğ‘›|ğ—ğ‘›âˆ’1) = âˆ‘
ğ‘¤ğ‘˜
âˆ—
ğ‘€
ğ‘˜=1
 ğ‘¥(ğ‘› âˆ’ 1)ï€®ï€ 
ï€¨ï€¸ï€©ï€ 
where ğ—ğ‘›âˆ’1 is a N-dimension for input samples. 
The desired signal is: 
 
ğ‘‘(ğ‘›) = ğ‘¥(ğ‘›) 
ï€¨ï€¹ï€© 
and predicted error is defined by equation: 
 
ğ‘’(ğ‘›) = ğ‘¥(ğ‘›) âˆ’ ğ‘¥Ì‚(ğ‘›|ğ—ğ‘›âˆ’1). 
ï€¨ï€±ï€°ï€© 
By minimizing error e(n), an optimal predictive signal 
input is made. 
If NLMS algorithm is used, it can be expressed by the 
following equation [15]: 
ï€ 
ğ°Ì‚(ğ‘› + 1) = ğ°Ì‚(ğ‘›) + ğœ‡sgn(ğ‘’(ğ‘›)) ğ±(ğ‘› âˆ’ 1)ï€ 
ï€¨ï€±ï€±ï€©ï€ 
where Î¼ is the adaptation [15]. 
IV. 
FAULT DETECTION APPROACH 
A model-based fault detection approach is proposed in 
this paper in order to identify anomalies which can occur in 
the WWTP process. The detection algorithm uses the 
residual values of each output and by comparing it with a 
threshold value it can be established when a fault occurs in 
the system. 
As in other studies [9]-[12], the residual ğ‘…(ğ‘˜) is obtained 
as a difference between the estimated output ğ‘¦Ì‚ğ‘(ğ‘–) of the 
process and the output of the analytical model, ğ‘¦ğ‘š(ğ‘–) 
 
ğ‘…(ğ‘˜) =
1
ğ‘ âˆ‘
(ğ‘¦Ì‚ğ‘(ğ‘–) âˆ’ ğ‘¦ğ‘š(ğ‘–))2
ğ‘˜
ğ‘–=ğ‘˜âˆ’ğ‘+1
ï€ 
ï€¨ï€±ï€²ï€©ï€ 
where: 
N = number of samples,  
R(k) = the value of the residue over the last N samples, 
 ğ‘¦Ì‚ğ‘(ğ‘–) - estimated output of the process by the adaptive filter, 
ğ‘¦ğ‘š(ğ‘–) â€“ output of the analytical model. 
The detection efficiency is obtained through the binary 
signal ğ¸  which is generated by using a ğ‘‚ğ‘… function 
described below: 
ğ¸(ğ‘–) =
{1 ğ‘–ğ‘“ğ‘…(ğ‘–) > É›ğ‘‹||ğ‘…(ğ‘–) > É›ğ‘†||ğ‘…(ğ‘–) > É›ğ·ğ‘‚||ğ‘…(ğ‘–) > É›ğ‘‹ğ‘Ÿ
0 ğ‘’ğ‘™ğ‘ ğ‘’                                                                                   
ï€¨ï€±ï€³ï€©ï€ 
This function detects a fault even if the selected threshold 
is not exceeded by the residual value on a particular output. 
It is necessary for the residuals to exceed at least one time 
one of the four thresholds in order to correctly detect the 
presence of a fault in the process. 
A. Fault detection scheme 
As presented in [7]-[10] the input parameter ğ·ğ‘‚ğ‘–ğ‘›  is 
considered to be constant. The fault detection scheme is 
shown in Figure 1. A model of the supervised process, in this 
case an analytical model, is used to provide the same 
41
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-740-5
EMERGING 2019 : The Eleventh International Conference on Emerging Networks and Systems Intelligence

evolution of the output as the process outputs if the same 
values of the inputs are applied. The model outputs are 
compared with the estimated outputs of the NLMS adaptive 
filter in order to generate the residuals. 
 
Figure 1. The fault detection scheme 
B. Fault detection parameters 
As several other studies presented [7]-[10], the 
algorithm's decision parameters are:  
- sensibility threshold value ğœ€ which is compared with the 
residual value ğ‘… in order to establish if the conditions of a 
fault occurrence are met. 
- number of samples ğ‘, on which the residual value, ğ‘… is 
obtained. 
C. Method validation by numerical simulations 
Several experiments were carried on in order to find the 
optimal values for the parameters ğ‘ and ğœ€ and to achieve the 
best performances of the detection approach. 
1) Fault of the recirculation pump 
The deviations caused by the recirculation pump fault 
can be seen in Figure 2. When this actuator fault occurs in 
the process, the recirculation rate value becomes zero (ğ‘Ÿ = 0 
when ğ‘ğ‘¡ âˆˆ [3500, 3899]). The residuals are obtained for 
each output of the system when ğ‘ = 10, ğ‘ = 20, ğ‘ = 40. 
 
 
Figure 2. The outputs, ğ‘‹, ğ‘†, ğ·ğ‘‚, ğ‘‹ğ‘Ÿ deviations caused by the recirculation 
pump fault (ğ‘‹ = 0 over 3500 to 3899 samples) 
Figures 3 â€“ 5 show the residuals obtained in both cases, 
when the system operates in normal conditions (the residual 
values are close to zero) and when the recirculation pump 
fails around sample no. 3500 (the residual value is increasing 
due to process output deviation caused by the pump 
malfunction). 
 
Figure 3. The residue, ğ‘… for partial fault of the recirculation pump when 
ğ‘ = 10 
 
Figure 4. The residue, ğ‘… for partial fault of the recirculation pump when 
ğ‘ = 20 
 
Figure 5. The residue, ğ‘… for partial fault of the recirculation pump when 
ğ‘ = 40 
42
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-740-5
EMERGING 2019 : The Eleventh International Conference on Emerging Networks and Systems Intelligence

2) Fault of the biomass sensor 
In general, a WWTP plant is equipped with many 
important sensors for monitoring the process performances 
and conditions [1]. Here, a fault of the biomass sensor is 
simulated over 400 samples. The output deviations caused by 
this fault are shown in Figure 6. As previously, the residuals 
ğ‘… are generated for each output of the process when ğ‘ =
10, ğ‘ = 20, ğ‘ = 40. 
 
 
Figure 6. The outputs, ğ‘‹, ğ‘†, ğ·ğ‘‚, ğ‘‹ğ‘Ÿ deviations caused by the biomass sensor 
fault (ğ‘‹ = 0 over 3500 to 3899 samples) 
 
Figure 7. The residue, ğ‘… for toxicity fault when ğ‘ = 10 
From Figures 7 â€“ 9, it can be observed that the residual 
value ğ‘…  is big compared with the process and the 
measurement noise. So, in this case, tweaking ğ‘ value to a 
smaller size will avoid generating false alarms. 
 
 
Figure 8. The residue, ğ‘… for toxicity fault when ğ‘ = 20 
 
Figure 9. The residue, ğ‘… for toxicity fault when ğ‘ = 40 
3) Toxicity shock fault 
A fault caused by a toxic shock suffered by the 
microorganismâ€™s culture, presented in Figure 10, was 
simulated by reducing the value of the maximum specific 
growth rate ğœ‡ğ‘šğ‘ğ‘¥  by half, over ğ‘ğ‘¡ âˆˆ [3500, 3899]). Figure 
11 â€“ 13, shows the residual values at different iterations of 
parameter ğ‘ (ğ‘ = 10, ğ‘ = 20 and ğ‘ = 40).  
Simulation results show that depending on the value of 
N, the measurement and process noise is reduced, which 
could cause a lower value of the threshold and a possible 
increasing of the detection time. Therefore, a compromise 
must be made when choosing the detection parameters in 
order to achieve good results. 
43
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-740-5
EMERGING 2019 : The Eleventh International Conference on Emerging Networks and Systems Intelligence

 
Figure 10. The outputs, ğ‘‹, ğ‘†, ğ·ğ‘‚, ğ‘‹ğ‘Ÿ deviations caused by the toxicity fault 
(ğœ‡ğ‘šğ‘ğ‘¥/2 over 3500 to 3899 samples) 
 
 
Figure 11. The residue, ğ‘… for toxicity fault when ğ‘ = 10 
 
Figure 12. The residue, ğ‘… for toxicity fault when ğ‘ = 20 
 
Figure 13. The residue, ğ‘… for toxicity fault when ğ‘ = 40 
V. 
RESULTS AND DISCUSSION  
In all the previously presented cases of simulated faults 
the value of N is set to 10, which corresponds to the criteria 
of choosing the detection parameters described in section IV. 
Also the sensibility thresholds for each output are: É›ğ‘‹ = 4 â‹…
10âˆ’4, É›ğ‘† = 2 â‹… 10âˆ’4, É›ğ·ğ‘‚ = 0.1, É›ğ‘‹ğ‘Ÿ = 5.5 â‹… 10âˆ’4. 
Further, the detection efficiency ğ¸ (Figures 14 â€“ 17) is 
obtained for all types of faults analyzed in the previous 
section: recirculation pump fault, biomass sensor fault and 
toxicity fault. 
 
Figure 14. Fault simulated over ğ‘ğ‘¡ âˆˆ [3500, 3899] 
 
Figure 15. Alarm signal for recirculation pump fault detection 
(detection over ğ‘ğ‘¡ âˆˆ [3506, 3958], after ~36 min) 
 
 
Figure 16. Alarm signal for biomass sensor fault detection (detection 
over ğ‘ğ‘¡ âˆˆ [3543, 4405], after ~4â„) 
 
44
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-740-5
EMERGING 2019 : The Eleventh International Conference on Emerging Networks and Systems Intelligence

 
Figure 17. Alarm signal for toxicity fault detection (detection over 
ğ‘ğ‘¡ âˆˆ [3504, 4619], after ~24 min) 
The best detection time of the proposed algorithm was 
obtained in the case of toxicity fault, after approximately 24 
minutes. 
The fault detection algorithm simulation was run on a 
computer having the following specifications: Intel Core i3-
6100U with 2.30GHz, 4 GB RAM memory and 500GB 
SSD. The detection performances are displayed in 
approximately 30 seconds. 
VI. 
CONCLUSIONS 
This paper proposes a model-based fault detection 
method for a wastewater treatment process. The detection 
algorithm compares the outputs of the analytical model with 
the ones estimated by the NLMS adaptive filter in order to 
calculate the residual value for each output of the process.  
The alarm decision, occurring when a fault appears in the 
system, is enabled based on the detection parameters values 
(threshold ğœ€ and number of samples ğ‘). The results obtained 
are promising when compared with other studies [1] [2] and 
[8] [9] presenting aspects of sensor and actuator faults 
detection in WWTP.  
Moreover, this paper analyses the case of a toxicity shock 
fault detection that could damage the microorganismâ€™s 
culture 
and 
cause 
erraticism 
in 
these 
types 
of 
biotechnological processes.  
REFERENCES 
[1] C. Lee, S. W. Choi, and I. B Lee, â€œSensor fault diagnosis in a 
wastewater 
treatment 
processâ€, 
Water 
Science 
and 
Technology, vol. 53, pp. 251â€“257, 2006.  
[2] F. Nejjari, V. Puig and L. Giancristofaro, S. Koehler, 
"Extended Luenberger Observer-Based Fault Detection for an 
Activated Sludge Process", Proceedings of the 17th World 
Congress The International Federation of Automatic Control, 
pp. 9725-9730, July 6-11, 2008. 
[3] I. Baklouti, M. Mansouri, H. Nounou, M. Ben Slima and A. 
Ben Hamida, "Fault detection in a wastewater treatment 
plant," 
2017 
International 
Conference 
on 
Advanced 
echnologies for Signal and Image Processing (ATSIP), Fez, 
2017, pp. 1-5.  
[4] I. Baklouti, M. Mansouri, A. Ben Hamida, H. Nounou and M. 
Nounou, "Novel Fault Detection Approach of Biological 
Wastewater Treatment Plants," 2018 IEEE International 
Conference on Systems, Man, and Cybernetics (SMC), 
Miyazaki, Japan, 2018, pp. 2669-2674.  
[5] L. Corominas, K. Villez, D. Aguado, L. Rieger, C. RosÃ©n et 
al., "Performance evaluation of fault detection methods for 
Wastewater 
Treatment 
Processes", 
Biotechnology 
and 
bioengineering, vol. 108, no. 2, pp. 333-344, 2011. 
[6] I. Baklouti, M. Mansouri, A. B. Hamida, H. Nounou and M. 
Nounou, "Monitoring of wastewater treatment plants using 
improved univariate statistical technique", Process Safety and 
Environmental Protection, vol. 116, pp. 287-300, 2018. 
[7] 
M. Miron, L. Frangu, G. Ifrim and S. Caraman, â€œModeling 
of a Wastewater Treatment Process Using Neural Networksâ€, 
20th International Conference on System Theory, Control 
and Computing - ICSTCC 2016, October 13-15, Sinaia, 
Romania, pp. 210, 2016. 
[8] 
M. Miron, L. Frangu and S. Caraman â€Actuator fault 
detection using extended Kalman filter for a wastewater 
treatment processâ€, 21st International Conference on System 
Theory, Control and Computing, October 19 - 21, Sinaia, 
Romania, pp. 583-588, 2017. 
[9] M. Miron, L. Frangu and S. Caraman, "Fault detection 
method for a wastewater treatment process based on a neural 
model", 5th International Symposium on Electrical and 
Electronics Engineering (ISEEE), October 20 â€“ 22, Galati,  
Romania, pp. 1-6, 2017. 
[10] M. Miron, L. Frangu and S. Caraman, â€œArtificial neural 
network approach for fault recognition in a wastewater 
treatment processâ€, 22nd International Conference on System 
Theory, Control and Computing, October 10 - 12, Sinaia, 
Romania, pp. 634-639, 2018. 
[11] S. Haykin, Adaptive Filter Theory , 4th edn. (Upper Saddle 
River, NJ, Prentice-Hall, 2002) 
[12] A. H. Sayed, Fundamentals of Adaptive Filtering. Hoboken, 
NJ: Wiley, 2003 
[13] Q. Chai, B. Furenes and B. Lie, "Comparison of state 
estimation techniques, applied to a biological wastewater 
treatment process, IFAC Proceedings Volumes, Volume 40, 
Issue 4, 2007,pp. 357-362. 
[14] J. Dhiman, S. Ahmad and K. Gulia, "Comparison between 
Adaptive filter Algorithms (LMS, NLMS and RLS)", 
International Journal of Science, Engineering and Technology 
Research (IJSETR), Volume 2, Issue 5, May 2013, pp. 1100-
1103. 
[15] J. Benesty, C. Paleologu and S. Ciochina, On Regularization 
in Adaptive Filtering. Ieee Transactions nn Audio, Speech, 
and Language Processing, vol. 19, no. 6, pp. 1734-1742, 
august 2011 
 
45
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-740-5
EMERGING 2019 : The Eleventh International Conference on Emerging Networks and Systems Intelligence

