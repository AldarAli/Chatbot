Indoor Localization by Map Matching Using One Image of Information 
Board 
Kento Tonosaki, Yoshihiro Sugaya, Tomo Miyazaki, Shinichiro Omachi 
Department of Communications Engineering, Graduate School of Engineering 
Tohoku University 
Sendai, Japan 
e-mail: {sea, sugaya, tomo, machi}@iic.ecei.tohoku.ac.jp 
 
 
Abstract—Indoor navigation systems have not become common 
like an outdoor navigation system, because we cannot correctly 
receive the signals from Global Positioning System (GPS) 
satellites in indoor environments, and indoor map databases are 
unavailable in most locations. Existing indoor localization 
methods and navigation systems have problems such as 
management and deployment cost, and limitation of available 
places. In this paper, we present a novel method of indoor 
navigation using an information board and several functions of 
a smartphone. Our framework does not require large-scale 
preparations and expenses for owners of buildings unlike 
existing methods, and is available wherever an information 
board exists. This method comprises image analysis and map 
matching. The former is to analyze the picture of information 
board taken by a smartphone and estimate the passageway 
region from the image. The latter gives us real-time localization 
in the map by using inertial sensors in the smartphone after the 
input of current places by the user at two different positions.  
Keywords- indoor positioning; particle filter; map matching. 
I. 
 INTRODUCTION 
There are two keys of indoor navigation; positional 
information and a map. GPS is now contributing outdoor 
localization, and in combination with an outdoor map 
database, such as Google Maps, it provides us a good outdoor 
navigation system. Many modern mobile devices such as 
smartphones have a built-in GPS receiver. Therefore, we can 
easily use applications for outdoor navigation. 
On the other hand, localization using GPS is inaccurate in 
indoor environment. GPS positioning is performed by using 
the signals from some satellites, but the signals cannot arrive 
at the receiver in indoor environment. Indoor localization is a 
hot topic now, and various systems are developed; Wi-Fi, 
radio-frequency identification (RFID), ultrasound, camera 
image, inertial measurement unit (IMU), and so on. However, 
these methods do not have decisive superiority that can be 
considered as a de facto standard because they require some 
infrastructure and it limits available places. Another approach 
is pedestrian dead reckoning (PDR) making use of several 
inertial sensors embedded in smartphones as well as GPS 
receiver. Owing to no expenses except for smartphone, we 
can estimate relative position at a low price. The drift of 
gyroscope is the main cause of error in PDR estimation, then 
by the combination with other methods, accuracy of 
localization can be improved [1][2]. 
Moreover, the absence of indoor map database makes 
construction of indoor navigation system more difficult. 
Although "Google Maps" provides several indoor maps, 
there are not many available places. In some place, e.g., 
Tokyo Station and Narita Airport in Japan, a special 
application for navigation of each place is offered. However, 
it requires for users to install the special application on their 
smartphone to use the navigation. 
In this paper, we propose a novel framework of indoor 
navigation system using an information board with a floor 
map (Figure 1) and several functions in smartphone. Since 
information boards exist in many buildings, we can easily 
obtain a map by taking a picture of the information board with 
smartphone’s camera. In addition, we can estimate the 
current position without infrastructure by using PDR with 
inertial sensors.  
The usage scenarios of our approach are as follows. First, 
a user takes a photo of the map on the information board with 
his/her smartphone; note that the information boards are 
usually installed at the entrance of malls or the side of 
elevators. After the picture is analyzed, the user taps the point 
on the map displayed on the screen corresponding to his 
current place.  Then, the user walks a little, and taps the 
screen where the point corresponds to the current position 
again. By using the information obtained by the two taps, the 
reduced scale and orientation of the map could be estimated, 
and inertial sensors enable to estimate current position of the 
user. 
Figure 1.  Examples of information board 
22
Copyright (c) IARIA, 2016.     ISBN:  978-1-61208-465-7
PATTERNS 2016 : The Eighth International Conferences on Pervasive Patterns and Applications

II. 
PASSAGEWAY REGION ESTIMATION 
We considered that passageway regions are necessary at 
least to implement a demonstration of the indoor navigation. 
We develop a method to estimate passageway region from an 
image of information board, and we show the method in this 
section. 
The estimation is conducted using two conditions that 
many of information boards meet. These are based on our 
survey of 104 information boards throughout Japan, and 
about 92% of them fulfill two conditions: (1) the color of 
passageways is different from any shops’ colors, (2) only one 
color is used for passageways in a map. The proposed method 
consists of labeling and passageway label estimation. 
A. Labeling 
According to the conditions, it is considered that 
segmentation of a map picture based on its color information 
is useful for the estimation of passageway regions. 
At first, we create a segmentation image with mean shift 
[3] and an edge image with the Canny method [4] from the 
original image. Then, we scan the segmentation image from 
upper left. When we find unlabeled pixel (𝑖, 𝑗), we also 
search the pixel (𝑘, 𝑙) satisfying (1) in 4-neighborhood pixels 
around (𝑖, 𝑗) except for edge pixel, and assign the same label. 
Although we can do labeling only using the segmentation 
image, which is obtained by mean shift, the labeling results 
are not sufficient. Therefore, we use the edge image together 
with segmentation image to improve the accuracy of labeling. 
If the area size of label is smaller than the threshold 𝜏𝑙, we 
give them no label. 

{
|𝑅(𝑖, 𝑗) − 𝑅(𝑘, 𝑙)| ≤ 𝜏𝑑
|𝐺(𝑖, 𝑗) − 𝐺(𝑘, 𝑙)| ≤ 𝜏𝑑
|𝐵(𝑖, 𝑗) − 𝐵(𝑘, 𝑙)| ≤ 𝜏𝑑


𝑅(𝑖, 𝑗), 𝐺(𝑖, 𝑗) and 𝐵(𝑖, 𝑗) are red, green and blue values of 
the pixel (𝑖, 𝑗), respectively. The symbol 𝜏𝑑 is a threshold. 
B. Passageway Region Estimation 
After labeling, we estimate the labels of passageway 
region. A set of passageway labels often contains larger areas 
than shop ones, and according to the above-mentioned 
conditions, only one color different from every shop labels’ 
colors is used for passageway labels. We estimate the 
passageway region by using these conditions. 
At first, we decide the first passageway labels (FPL), 
which is the most likely passageway label, and we estimate it 
along the flow chart (Figure 2). We assumed that 𝐿1 or 𝐿2 or 
both are the passageway labels, where 𝐿1 is the first largest 
label and 𝐿2  is the second. We compare the label sizes 
because we suppose that the passageway region would be 
much bigger than any shop’s regions. If 𝐿1 > 𝛼𝐿2, FPL is 𝐿1. 
Otherwise, we compare the label colors in consideration that 
the passageway region in the map are divided by some lines 
such as arrows. If the Euclidian distance between the color 
averages of 𝐿1  and 𝐿2  in RGB color space is lower than 
threshold 𝜏𝑐, FPL is the combination of 𝐿1 and 𝐿2. Otherwise, 
we compare the sizes of bounding boxes of them, and we 
consider that the larger one is passageway region. 
After FPL is decided, we search other passageway labels 
using color information of FPL. We compare the average 
color of FPL and other labels, and when Euclidian distance 
between them in RGB color space is lower than threshold 𝜏𝑐, 
they are determined as the passageway label. 
III. 
PARTICLE FILTER AND MAP MATCHING 
In this method, the scale and the orientation of a map are 
unknown because the map is a picture of information board. 
To estimate them to a certain extent, the user taps the screen 
to show where they are in the map at two different positions. 
In addition, a map of information board is inaccurate, owing 
to noises and distortions resulting from light reflection and the 
direction of taking the picture. We employ map matching with 
particle filter (PF), which can cope with these problems 
flexibly. 
PF is a method to estimate a state in non-linear and non-
Gaussian state place model, and is sometimes implemented to 
apply map filtering technique [2][5][6]. PF is the algorithm by 
Monte-Carlo method composed of propagation, correction 
and re-sampling. To obtain an observation 𝑧𝑡 at time 𝑡, the 
state 𝑠𝑡|𝑡−1 at time 𝑡 estimated by the state 𝑠𝑡−1 at time 𝑡 − 1 
(particle) and its likelihood (weight) are generated using 
pseudorandom number, and 𝑧𝑡  is decided with particles’ 
distribution and weights. 
In our model, particles are updated only after each step 
event. The 𝑘-th step event 𝑠𝑡𝑒𝑝𝑘 is represented by step time 
𝑡𝑘 , step length 𝑙𝑘  and heading direction ℎ𝑘  in global 
coordinate system (GCS). These parameters are computed by 
the method of SmartPDR [7] by using accelerometer, 
magnetometer and gyroscope in a smartphone. In our method, 
each particle has a state 𝑠𝑘 after the 𝑘-th step event, and 𝑠𝑘 is 
Candidate 
The first largest label: 𝑳𝟏 
The second largest label: 𝑳𝟐 
 
 
 
Output: 
𝐿1 
Output: 
𝐿1, 𝐿2 
Output: 
𝐿1 
Output: 𝐿2 
Yes 
Yes 
Yes 
No 
No 
No 
Size: 
𝐿1 > 𝛼𝐿2 
 
Color: 
| 𝑳𝟏 − 𝑳𝟐 | < 𝜏𝑐 
 
Rectangle: 
𝐿1 > 𝐿2 
 
Figure 2.  Flow chart of the method to decide the first passageway labels 
23
Copyright (c) IARIA, 2016.     ISBN:  978-1-61208-465-7
PATTERNS 2016 : The Eighth International Conferences on Pervasive Patterns and Applications


s𝑘 = [𝑥𝑘, 𝑦𝑘, 𝑚𝑝𝑝𝑘, 𝜃𝑘].

Here, (𝑥𝑘, 𝑦𝑘 ) is a particle’s position in image coordinate 
system (ICS), but we possess them with not integer but float. 
The parameter 𝑚𝑝𝑝𝑘 (meter-per-pixel) is the length in GCS 
per one pixel, and 𝜃𝑘 is the heading direction ℎ𝑘 when the 
device turns toward x-axis of ICS. 
A. Particle Initialization 
We show the method to create an initial distribution 
𝑝(𝑠0|∅) of the state 𝑠0 at the step event 𝑘 = 0. Let the two 
coordinates pointed by the user be (𝑥𝑡𝑎𝑝,𝑛
𝐼𝐶𝑆
′, 𝑦𝑡𝑎𝑝,𝑛
𝐼𝐶𝑆
′)(𝑛 = 1,2), 
which is in ICS. Because the designation of the points is 
performed with the user’s visual, there may be an error 
between the designated position and the user’s real position 
(𝑥𝑡𝑎𝑝,𝑛
𝐼𝐶𝑆 , 𝑦𝑡𝑎𝑝,𝑛
𝐼𝐶𝑆 )(𝑛 = 1,2) . Assuming that the probability 
distribution of the error is a Gaussian distribution with 
standard deviation 𝜎𝑡𝑎𝑝 , this probability distribution 
𝑃(𝑥𝑡𝑎𝑝,𝑛
𝐼𝐶𝑆 , 𝑦𝑡𝑎𝑝,𝑛
𝐼𝐶𝑆 ) is  

𝑃(𝑥𝑡𝑎𝑝,𝑛
𝐼𝐶𝑆 , 𝑦𝑡𝑎𝑝,𝑛
𝐼𝐶𝑆 ) = 𝑁(𝑥𝑡𝑎𝑝,𝑛
𝐼𝐶𝑆
′, 𝜎𝑡𝑎𝑝2)𝑁(𝑦𝑡𝑎𝑝,𝑛
𝐼𝐶𝑆
′, 𝜎𝑡𝑎𝑝2) 
where 𝑁(𝜇, 𝜎2) is an error model generated using a Gaussian 
distribution with a mean 𝜇 and a variance σ2. 
When step events between two taps are detected 𝑘′ times, 
the motion on 𝑥-axis and 𝑦-axis in GCS is represented as 

[𝑥𝑚𝑜𝑣𝑒
𝐺𝐶𝑆
𝑦𝑚𝑜𝑣𝑒
𝐺𝐶𝑆 ] = ∑
𝑙𝑠 [cos ℎ𝑠
sin ℎ𝑠]
𝑘′
𝑠=1


The moving length 𝑙𝑚𝑜𝑣𝑒  and the direction 𝜃𝑚𝑜𝑣𝑒  between 
two taps are 

𝑙𝑚𝑜𝑣𝑒＝√(𝑥𝑚𝑜𝑣𝑒
𝐺𝐶𝑆 )2 + (𝑦𝑚𝑜𝑣𝑒
𝐺𝐶𝑆 )2


𝜃𝑚𝑜𝑣𝑒 = atan2(𝑦𝑚𝑜𝑣𝑒
𝐺𝐶𝑆 , 𝑥𝑚𝑜𝑣𝑒
𝐺𝐶𝑆 ).

Where the function atan2(𝑦, 𝑥) is defined as 

atan2(y, x) = 2 tan−1 (
𝑦
√𝑥2+𝑦2+𝑥)

We can also calculate the length 𝑙𝑡𝑎𝑝 and the direction 𝜃𝑡𝑎𝑝 
in ICS between two taps with a similar equation. 
Therefore, the initial state s0
(𝑖) = [𝑥0
(𝑖), 𝑦0
(𝑖), 𝑚𝑝𝑝0
(𝑖), 𝜃0
(𝑖)] 
of 𝑖-th particle is decided with the following equations. 
𝑥0
(𝑖) = 𝑥𝑡𝑎𝑝,2
𝐺𝐶𝑆 (𝑖) 
𝑦0
(𝑖) = 𝑦𝑡𝑎𝑝,2
𝐺𝐶𝑆 (𝑖) 
𝑚𝑝𝑝0
(𝑖) = 𝑙𝑚𝑜𝑣𝑒/𝑙𝑡𝑎𝑝
(𝑖)  
𝜃0
(𝑖) = 𝜃𝑚𝑜𝑣𝑒 − 𝜃𝑡𝑎𝑝
(𝑖)  
(8) 
 
B. Particle Propagation 
The particle’s state 𝑠𝑘 after the 𝑘-th step event 𝑠𝑡𝑒𝑝𝑘 is 
created by a posterior distribution 𝑝(𝑠𝑘|𝑠𝑘−1, 𝑠𝑡𝑒𝑝𝑘) with the 
previous state 𝑠𝑘−1 and 𝑠𝑡𝑒𝑝𝑘 . With paying attention that  
x𝑘
(𝑖) and  y𝑘
(𝑖) are coordinates in ICS, the state sk
(𝑖) = 𝑠𝑘|𝑘−1
(𝑖)
 of 
𝑖th particle is decided as follows. 
𝑚𝑝𝑝𝑘
(𝑖) = 𝑚𝑝𝑝𝑘−1
(𝑖) + 𝑁(0, 𝜎𝑚𝑝𝑝
2) 
𝜃𝑘
(𝑖) = 𝜃𝑘−1
(𝑖) + 𝑁(0, 𝜎𝜃
2) 
𝑥𝑘
(𝑖) = 𝑥𝑘−1
(𝑖) + 𝑙𝑘 cos(ℎ𝑘 − 𝜃𝑘
(𝑖))/𝑚𝑝𝑝𝑘
(𝑖) 
𝑦𝑘
(𝑖) = 𝑦𝑘−1
(𝑖) + 𝑙𝑘 sin(ℎ𝑘 − 𝜃𝑘
(𝑖))/𝑚𝑝𝑝𝑘
(𝑖) 
(9) 
Here, 𝑁(0, 𝜎𝑚𝑝𝑝
2)  and 𝑁(0, 𝜎𝜃
2)  are error models of 
𝑚𝑝𝑝𝑘
(𝑖)  and 𝜃𝑘
(𝑖)  based on Gaussian distributions with 
deviations 𝜎𝑚𝑝𝑝
2 and 𝜎𝜃
2, respectively. These models also 
affect the moving length and direction.  
C. Correction and Re-Sampling 
In this paper, we assume that users go to their destination 
along a passageway, namely users do not go out of the 
passageway region from navigating start to end. Hence, we 
estimate user’s position with map matching using 
passageway region created by the proposed method. In our 
method, map matching is applied to compute particles’ 
weight, and the weight w𝑘
(𝑖) of the 𝑖-th particle 𝑠𝑘|𝑘−1
(𝑖)
 is 
w𝑘
(𝑖) = { 0
1/𝑀   𝑖𝑓 (𝑥𝑘
(𝑖), 𝑦𝑘
(𝑖)) 𝑖𝑠 𝑛𝑜𝑡 𝑝𝑎𝑠𝑠𝑎𝑔𝑒𝑤𝑎𝑦 𝑟𝑒𝑔𝑖𝑜𝑛
𝑜𝑡ℎ𝑒𝑟𝑤𝑖𝑠𝑒
, 



where, 𝑀 is the number of particles after the correction. The 
output of the current position is the average of 𝑀 particles. 
Re-sampling is the process that reallocates all the 
particles. In our method, re-sampling is based on random 
sampling, but each particle has the same weight before re-
sampling. Therefore, a particle after re-sampling is decided 
from 𝑀 particles randomly. 
IV. 
EXPERIMENT 
The proposed method has several thresholds and 
parameters, and we set them shown as Table I, which were 
decided by the preliminary experiments. 
 
 
Symbol 
Value 
Symbol 
Value 
𝜏𝑑 
3 
𝜎𝑡𝑎𝑝 
25 
𝜏𝑐 
15 
𝜎𝜃 
5π/180 
α 
2 
 
 
Symbol 
Value 
𝜏𝑙 
1/500 of the image size 
𝜎𝑚𝑝𝑝 
1/60 of 𝑚𝑝𝑝𝑘−1
(𝑖)  
 
TABLE I.  SYMBOLS AND VALUES 
24
Copyright (c) IARIA, 2016.     ISBN:  978-1-61208-465-7
PATTERNS 2016 : The Eighth International Conferences on Pervasive Patterns and Applications

A. Passageway Region Estimation 
We conducted passageway region estimation using the 
proposed method. We applied the method to 92 pictures of 
information boards satisfying two conditions described in 
Section II except for some pictures with extremely low 
quality. In the method, an estimated passageway region 
consists of a set of labels and it has gaps at boundaries 
between each region of labels. To remove them, we applied 
erosion and dilation to each region, so that we can create 
passageway region more suitable for the position estimation.  
Figure 3 shows examples of the results. We subjectively 
evaluated whether passageway region could be estimated to 
a certain extent, and we found that the estimation went well 
on 77% of information boards. We conducted the experiment 
using 92% of images that meet two conditions mentioned in 
Section II; therefore it means that the proposed method could 
estimate passageway region for about 70% of information 
boards. 
The failures to obtain passageway region were mainly 
caused by labeling mistakes (Figure 3(b)) and failure to get 
FPL (Figure 3(c)). The former means that passageway and 
shop regions were mistakenly connected when labeling. The 
failure often happened when a shop label had similar color to 
passageway label and their edges are unclear. The latter 
means that a label unrelated to passageway region became 
FPL. The failure happened when FPL was not decided using 
sizes and colors. 
B. Localization 
We evaluated whether the proposed method can estimate 
positions by map matching with a picture of information 
board. The experiments were conducted on B1 floor in 
Jozenji-Dori building of Sendai Mitsukoshi (Fig. 3(a)). The 
proposed system was implemented on Sony Xperia S Tablet, 
and the sampling rate of each inertial sensors is 15 Hz. The 
users held the device on their right palm. The application for 
the experiment indicates the estimated path where the user 
walked in real time after tapping at two different position. We 
set the number of particles as 2000. We conducted the 
experiments four times. 
Figure 4 shows examples of the results. A successful case 
is Figure 4(a), where the step events are totally 245 (11 steps 
between 2 taps). A failure case is Figure 4(b), where the step 
events are totally 218 (9 steps between 2 taps). Estimation 
error increased at the left area of the map in both cases. Of 
the four experiments, we succeed two times and failed two 
times. 
Figure 3.  Results of passageway region estimation:  
original images (left) and estimated passageway region (right) 
(a) 
(b) 
(c) 
Figure 4. Result of the paths estimated using PDR and map matching: 
gray points are 2 tapped positions, red are user’s estimated position 
and blue lines are real path. 
 
(a) 
(b) 
25
Copyright (c) IARIA, 2016.     ISBN:  978-1-61208-465-7
PATTERNS 2016 : The Eighth International Conferences on Pervasive Patterns and Applications

We consider that the error was caused by the way to 
decide a current position. Now, the position is computed as 
the average of particle’s positions before re-sampling, 
however, in case that particles are divided into two or more 
clusters, the output has a large error even if one of the clusters 
lies at the correct position. 
V. 
CONCLUSION 
In this paper, we proposed an indoor localization method 
using information board and several functions in smartphone. 
To estimate passageway region, we apply labeling to the 
picture of information board based on its color and edge, and 
make use of label information. Furthermore, we developed a 
method to estimate position on passageway region using PDR 
and map matching with PF. Through our experiments, we 
confirmed that the proposed method can accurately estimate 
passage region from 70% of information board, and the 
analysis results are useful for map matching with particle 
filter. 
At the same time, we found out some problems. The 
method of labeling and passageway label estimation cannot 
obtain satisfactory results from some information boards. In 
reference to this, labeling results depend on the ambience 
when taking the picture. It is necessary to develop the method 
to analyze the picture resistant to light reflection. We were 
pointed out that using Lab color space might bring better 
results when labeling because the color space is designed to 
approximate human vision. Moreover, the labeling method is 
time consuming and requires high machine performance. 
Therefore, we are considering use of servers for the map 
picture analysis.  
Furthermore, the proposed method has great limitation, 
and the method to decide a position from a distribution of 
particles has a room to be improved; we can track only on the 
passageway. To estimate the position on both passageway 
and shops, we would have to improve not only the method of 
map matching but also the method to analyze the picture of 
information board. Additionally, we have only confirmed 
whether the proposed method can trace the pass the user 
walks. It is necessary to evaluate our localization method 
quantitatively. They are remained as future works. 
ACKNOWLEDGMENT 
A part of this research was supported by JSPS KAKENHI 
Grant Number 15K12014. This research was also supported 
in part by JST, CREST. 
REFERENCES 
[1] V. Renaudin, O. Yalak, P. Tomé, and B. Merminod, “Indoor 
navigation of emergency agents,”, Europian Journal of 
Navigation, vol. 5, no. 3, pp. 36-45, 2007. 
[2] F. Zampella, A. R. J. Ruiz, and F. S. Granja, “Indoor 
Positioning 
Using 
Efficient 
Map 
Matching, 
RSS 
Measurements, and an Improved Motion Model, “ IEEE Trans. 
on Vehicular Technology, vol. 64, pp. 1304-1317, no. 4, April 
2015. 
[3] D. Comaniciu and P. Meer, “Mean shift: A robust approach 
toward feature space analysis,” IEEE Trans. on PAMI, vol. 24, 
no. 5, pp. 603-619, 2002. 
[4] J. Canny, “A Computational Approach To Edge Detection,” 
IEEE Trans. on PAMI, vol. 8, no. 6, pp. 679-714, 1986. 
[5] C. Ascher, A. Kesseler, M. Wankerl, and G. F. Trommer, 
“Dual IMU Indoor Navigation with Particle Filter based Map-
Matching on a Smartphone,” Int. Conf. on IPIN, September 
2010, pp. 1-5. 
[6] O. Woodman and R. Harle, “Pedestrian Localisation for Indoor 
Environments,” in Proc. 10th Int. Conf. UbiComp, 2008, pp. 
114–123. 
[7] W. Hang and Y. Han, “SmartPDR: Smartphone-Based 
Pedestrian Dead Reckoning for Indoor Localization,” IEEE 
Sensor Journal, vol. 15, pp 2906-2916, no. 5, May 2015.  
26
Copyright (c) IARIA, 2016.     ISBN:  978-1-61208-465-7
PATTERNS 2016 : The Eighth International Conferences on Pervasive Patterns and Applications

