Solving Stationary Gas Transport Problems
with Compressors of Piston and Generic Type
Anton Baldin
Fraunhofer Institute for Algorithms
and Scientiﬁc Computing
Sankt Augustin, Germany
email: Anton.Baldin@scai.fraunhofer.de
Kläre Cassirer
Fraunhofer Institute for Algorithms
and Scientiﬁc Computing
Sankt Augustin, Germany
email: Klaere.Cassirer@scai.fraunhofer.de
Tanja Clees
University of Applied Sciences
Bonn-Rhein-Sieg and Fraunhofer Institute
for Algorithms and Scientiﬁc Computing
Sankt Augustin, Germany
email: Tanja.Clees@scai.fraunhofer.de
Bernhard Klaassen
Fraunhofer Institute for Algorithms
and Scientiﬁc Computing
Sankt Augustin, Germany
email: Bernhard.Klaassen@scai.fraunhofer.de
Igor Nikitin
Fraunhofer Institute for Algorithms
and Scientiﬁc Computing
Sankt Augustin, Germany
email: Igor.Nikitin@scai.fraunhofer.de
Lialia Nikitina
Fraunhofer Institute for Algorithms
and Scientiﬁc Computing
Sankt Augustin, Germany
email: Lialia.Nikitina@scai.fraunhofer.de
Sabine Pott
Fraunhofer Institute for Algorithms
and Scientiﬁc Computing
Sankt Augustin, Germany
email: Sabine.Pott@scai.fraunhofer.de
Abstract—In this paper, modeling of piston and generic type
gas compressors for a globally convergent algorithm for solving
stationary gas transport problems is carried out. A theoretical
analysis of the simulation stability, its practical implementation
and veriﬁcation of convergence on a realistic gas network have
been carried out. The relevance of the paper for the topics of the
conference is deﬁned by a signiﬁcance of gas transport networks
as an advanced application of simulation and modeling, including
the development of novel mathematical and numerical algorithms
and methods.
Index Terms—simulation and modeling; mathematical and
numerical algorithms and methods; advanced applications; gas
transport networks
I. INTRODUCTION
In this paper, we will continue the study of globally
converging methods for solving stationary network problems
on the example of gas transport networks. Differently from
our previous works, where the gas compressors of the most
common turbine type were considered, in this paper, we
investigate compressors of piston and generic type. In our work
[1], we introduced the concept of generalized resistivity of
network elements and formulated stability conditions for the
algorithm solving the corresponding network problems. In the
works [2] [3] [4] we have considered in detail the modeling
of gas compressors of the turbine type. For these compressors,
individually calibrated characteristics and data resampling on
a regular grid were used. Now we consider compressors of
piston and generic type, which are characterized by the exis-
tence of analytical solutions and a simpler representation of
control equations. This simulation extends our system MYNTS
(Multi-phYsics NeTwork Simulation) [5].
Globally convergent methods in applications to electric
networks were formulated in [6], as well as in a more general
form for piecewise linear systems in [7] [8] and for general
smooth systems in [9]. Modeling of gas networks is described
in detail in [10] [11]. This modeling is based on the nonlinear
friction law in pipes [12] [13] and empirical approximations
for the equation of state of a real gas [14] [15] [16].
In this paper, in Section II, we recall the general concepts
of element resistivity and describe their physical meaning in
more detail. In Section III, we will look at compressors of
piston type and in Section IV – of generic type. In Section V,
we will carry out a numerical solution of a realistic network
problem with compressors of the described types.
II. TRANSPORT VARIABLES IN STATIONARY NETWORK
PROBLEMS
Network problems of a stationary type are described by a
system of equations that includes linear Kirchhoff equations
of the form P Qi = 0, which describe the conservation
of ﬂows in network nodes, and equations of elements of
the form f(Pin, Pout, Q) = 0, in the general case, non-
linear, introduced on each edge of the network graph. Here
the transport variables Pin/out are used – nodal variables
for the input and output of the element, for gas networks –
pressure values, Q – the ﬂow through the element. In gas
problems, ﬂows are considered in different normalizations,
which is indicated by the index: Qm – mass ﬂow, Qν –
1
Copyright (c) IARIA, 2022.     ISBN:  978-1-61208-961-4
INFOCOMP 2022 : The Twelfth International Conference on Advanced Communications and Computation

molar ﬂow, QN – volumetric ﬂow under normal conditions,
Qvol,in/out – volumetric ﬂow in input or output conditions
(by default, input conditions are taken), etc. An element is
called generalized resistive if its equation has derivatives of
the following signature:
∂f/∂Pin > 0, ∂f/∂Pout < 0, ∂f/∂Q < 0.
(1)
The work [1] shows that stationary network problems in which
all elements have a given signature have a unique solution
that can be found by the standard stabilized Newton algorithm
with an arbitrary choice of starting point. Technically, it also
requires a supply with a set pressure Pset in each disconnected
component of the graph, as well as a proper condition for the
behavior of functions at inﬁnity, which can be satisﬁed if there
are linear continuations of the equations of elements outside
the working region that have the signature (1). Also, the
completely inverse signature is formally admissible, since the
sign change of f → −f is admissible for stationary problems.
To eliminate this trivial ambiguity, one can choose the sign of
f, postulating the fulﬁllment of one of the conditions (1), for
example, the ﬁrst one.
The physical meaning of these conditions is illustrated in
Figure 1. It shows the serial connection of the tested element
(in this case the compressor, a circle) and a linear resistor
(a rectangle). Pressure Pset1,2 is set at the free ends. The
intermediate node must satisfy the equation
Pout(Pset1, Q) = Pset2 + RQ,
(2)
graphically depicted in the central and lower parts of the ﬁgure.
Here R > 0 is the resistance value, the corresponding line on
the ﬁgure increases monotonically. If the tested element has
the signature (1), then the function Pout(Pset1, Q) decreases
monotonically in Q, which corresponds to the central part of
the ﬁgure. In this case, the intersection of lines exists and is
unique. It can also occur outside this graph, when the above
condition is met at inﬁnity (continuation of the element’s
characteristic by a linearly strictly decreasing function outside
the working region). In the case, if the signature (1) would
be violated and the function Pout(Pset1, Q) would increase in
Q, then by choosing the parameters Pset2 and R it is possible
to achieve that the lines will have several intersections or no
intersection. Even if the function Pout(Pset1, Q) increases in
Q only locally, a linear resistor can be ﬁtted to it, which will
give several solutions to the problem under consideration. It
is also clear that a non-linear resistor can also be used for this
purpose, as long as its characteristic increases and has enough
parameters for tuning.
Similarly, by connecting elements in reverse order, as well
as considering their parallel connection, it can be shown that
any violation of the condition (1) leads to a violation of the
uniqueness of solution. If the signature is violated, then the
tested element can be connected to an elementary resistive
element in such a way that the equation will have several
solutions or none. The case when the signature is satisﬁed for
all elements and the system has a unique solution is, of course,
more preferable in practical applications.
Fig. 1. On the top: a serial connection of compressor (circle) and resistor (rect-
angle); in the center: decreasing compressor Pout(Q) characteristics (thick
line) and increasing resistor Pout(Q) characteristics (thin line) have a single
intersection (stable case); at the bottom: increasing compressor Pout(Q)
characteristics (thick line) and increasing resistor Pout(Q) characteristics
(thin lines) can have multiple intersections or no intersection (unstable case).
Compressors are the most complex elements in gas prob-
lems; several levels of modeling are used to represent them.
The main purpose of introduction of these levels is the gradual
sophistication of modeling, where the solution of a simple
model is used as a starting point for the more complex one.
Also, it allows to separate effects dependent on individual
calibration of compressors from their basic representation.
Free model: is the simplest, formulated only in terms
of transport variables, and is described by a piecewise linear
formula of the form
max(min( Pin − PL, −Pout + PH, −Q + QH),
(3)
Pin − Pout, −Q) + ϵ(Pin − Pout − Q) = 0,
(4)
where parameters PL, PH, QH deﬁne target values, for exam-
ple, PH = SPO for speciﬁed output pressure, or upper and
lower limits for other controlled values. This formula deﬁnes a
polyhedral surface in the space of transport variables in the so-
called maxmin representation [8]. Particular attention should
be paid to the last term in the equation, which is controlled by
a small positive parameter ϵ. The reason for its introduction
is that the exact equation satisﬁes the signature condition
(1) only marginally, some derivatives vanish. The geometric
interpretation of this is that the normals to the faces of the
polyhedron described by the equation are directed strictly
along the axes, although they should be directed inside the
octant described by the condition (1). Such marginality leads
to degeneracy of the Jacobi matrix, ambiguity of solutions,
bad condition numbers, and other troubles for the numerical
solution procedure. The introduction of a regularizing ϵ term
2
Copyright (c) IARIA, 2022.     ISBN:  978-1-61208-961-4
INFOCOMP 2022 : The Twelfth International Conference on Advanced Communications and Computation

formally eliminates this problem by making the condition (1)
strictly satisﬁed. At the same time, adjusting this parameter
represents a compromise between the physical accuracy and
the numerical stability of the solution procedure. In practice,
the values ϵ = 10−6...10−3 are tolerable, meaning the relative
violation of, e.g., SPO-condition, up to 0.1%, simultaneously
keeping the convergence rate near 100%.
Advanced model: introduces additional internal variables
for compressors: revolution number rev, adiabatic enthalpy
increase Had, performance Perf , efﬁciency η, torque Mt, and
additional equations:
P = ρRTz/µ, Qm = Qvolρin,
(5)
Had = Pin/(ρinα) · ((Pout/Pin)α − 1),
(6)
Perf = QmHad/η, Mt = Perf /(2π · rev),
(7)
α = (κ − 1)/κ, 0 < α < 1, 0 < η < 1,
(8)
where the equation of state is written ﬁrst with its parameters:
density ρ, universal gas constant R, absolute temperature T,
compressibility factor z, molar mass µ; the second is the
relationship between the mass ﬂow and the volumetric ﬂow in
the input conditions; the following are deﬁnitions of internal
variables in terms of transport variables; κ > 1 is the adiabatic
exponent.
For the turbocompressors considered in [2] [3] [4], addi-
tional relationships between internal variables are introduced
based on the calibration procedure. We will now consider
piston and generic type compressors, for which there is a
simpler model that allows an analytical solution. The general
strategy is to resolve all internal variables from the corre-
sponding equations, obtain a formula in terms of transport
variables, check its signature, and use it in the standard
solution algorithm.
III. PISTON COMPRESSORS
Compressors of piston types are modeled by direct propor-
tionality
Qvol = V · rev
(9)
with given constants η and V – compressor chamber volume.
The control equation has the following patches:
f1 = revmax − rev ≥ 0,
(10)
f2 = Mt,max − Mt ≥ 0,
(11)
f3 = Perf max − Perf ≥ 0,
(12)
f4 = relmax − Pout/Pin ≥ 0,
(13)
f5 = ∆Pmax − (Pout − Pin) ≥ 0,
(14)
with given constants revmax, Mt,max, relmax, ∆Pmax and
the function Perf max(rev) determined by the characteristics
of the compressor drive.
Stability analysis: calculating the derivatives of fi with
respect to (Pin, Pout, Qm) in the working region 0 < Pin ≤
Pout, Qm > 0, rev > 0, we get the signatures given in
Table I. In this case, the above formulas are used, as well
as the stability of the equation of state: ρ > 0, ∂ρ/∂P > 0.
TABLE I
PATCH SIGNATURES OF PISTON COMPRESSOR
patch
sgn
condition
f1
(+ 0 −)
f2
(+ − 0)
Pout/Pin < β
f3
(+ − −)
Pout/Pin < β, ∂Mt,drv/∂ rev < 0
f4
(+ − 0)
f5
(+ − 0)
TABLE II
PATCH SIGNATURES OF GENERIC COMPRESSOR
patch
sgn
condition
f1
(+ 0 −)
f2
(+ − 0)
∂zin/∂Pin < 0 or small
f3
(+ − −)
∂zin/∂Pin < 0 or small
In particular, rev = Qm/(ρinV ) has signature (−0+), which
implies the signature of f1 in the table. Mt = HadρinV/(2πη)
has signature (∗ + 0), where ∗ = ∂(Hadρin)/∂Pin < 0 for
Pout/Pin < (1 − α)(−1/α) = β. Thus, the signature f2 is
correct only if the compressor raises the pressure by no more
than the factor β, with the value κ = 1.29 typical for natural
gas, we get β = 3.10408. To eliminate the fold in the equation,
f2 should be replaced with Hadρin|Pin → max(Pin, Pout/β).
It is convenient to divide the expression f3 by (2π rev) and
consider the signature ˜f3 = Mt,drv(rev) − Mt. As noted in
[4], for drive equations to be stable it is necessary that Mt,drv
decrease with rev. Therefore, the ﬁrst term in ˜f3 has the
signature (+0−), and the second already calculated (+−0) in
the region Pout/Pin < β, which gives the complete signature
(+ − −). Calculation of other derivatives is trivial. We also
note that the presence of zeros in the signatures means that the
rule (1) is satisﬁed marginally, which is corrected by adding
a regularizing ϵ-term to the element equation. Also, for the
practical implementation of these formulas, it is necessary to
introduce clamps, which force all variables to the working
region: Qm → max(Qm, 0), Pout/Pin → max(Pout/Pin, 1),
etc.
IV. GENERIC COMPRESSORS
Compressors of generic type can also be considered as
an intermediate level of modeling (generic model). In this
model, the variable rev is not introduced, and restrictions are
introduced on other variables
f1 = Qvol,max − Qvol ≥ 0,
(15)
f2 = Had,max − Had ≥ 0,
(16)
f3 = Perf max − Perf ≥ 0,
(17)
with constant Qvol,max, Had,max and Perf max.
Stability analysis: Calculating derivatives similarly, for
Qvol = Qm/ρin we have signature (−0+), hence (+0−) for
f1. For Had = RTinzin/(µinα)((Pout/Pin)α − 1) we get
(∗ + 0), where ∗ = ∂(zin((Pout/Pin)α − 1))/∂Pin < 0. For
an ideal gas z = 1, hence, obviously, ∗ = −. For natural gas
z is a decreasing function of P, in this case also ∗ = −. For
3
Copyright (c) IARIA, 2022.     ISBN:  978-1-61208-961-4
INFOCOMP 2022 : The Twelfth International Conference on Advanced Communications and Computation

Fig. 2. On the top: test network N1; at the bottom: the structure of parallel
compressor station. Images from [1].
some gases, such as hydrogen, z may increase with P, but it
remains close to 1 and changes so slowly that the remaining
decreasing dependence of Had on Pin dominates. Under these
conditions, f2 has signature (+ − 0). For Perf = QmHad/η
the signature (− + +) under the same conditions on zin, thus
f3 has the signature (+ − −).
V. NUMERICAL TESTS
The described patches are inserted into the free formula as
follows:
max(min( Pin − PL, −Pout + PH, −Q + QH,
(18)
f1, ..., fn ),
(19)
Pin − Pout, −Q) + ϵ(Pin − Pout − Q) = 0,
(20)
after that the stabilized Newton algorithm described in [1]
can be used to solve the system. The tests were carried
out on the network N1 shown in Figure 2 on the top. This
network has 100 nodes and 111 edges, of which 4 compressors
are organized into two compressor stations c1|2 and c3|4
with individual compressors connected in parallel, as shown
in Figure 2 at the bottom. Compressors in station c1|2 are
conﬁgured as piston ones, in station c3|4 as generic ones.
Values PH, QH are set to unreachable high values, thereby
activating the fi patches described above. Note that the stations
also include other elements, but they have trivial equations and
are eliminated by the topological cleaning ﬁlter used in the
solution procedure. The procedure consists of several phases
with a gradual increase in the modeling level. First (init) the
compressors are set to fulﬁll the main target values, e.g.,
P = PH, then (free) the modeling level (3)-(4) is used, taking
into account additional conditions, then (adv) the modeling
level (18)-(20) is taken. The solution procedure described in
TABLE III
TIMING FOR DIFFERENT PHASES OF THE SOLUTION PROCEDURE*
phase
translate
solve
init
15
8
free
15
7
adv
17
20
total
47
35
* in milliseconds, for 2.6 GHz Intel i7 CPU 16 GB RAM computer.
[5] consists of the translation phase of the system from the net-
work description language to the language understood by the
numerical solver, and the actual numerical solution phase. The
corresponding timing is given in Table III; approximately the
same results are obtained if turbocompressors are used instead
of piston/generic ones. The performed numerical experiment
shows that the inclusion of piston and generic compressors in
the system does not lead to any divergences or slowdown of
the solution procedure, which is a direct consequence of the
implementation of the stability criteria described above.
We also performed numerical experiments with test net-
works from work [4]. The test set contains 85 networks
with complexity up to four thousand nodes and up to 42
compressors. Among them are multiple piston and generic
compressors, in parallel and series connections. We have found
that the presence and placement of such compressors does not
affect performance in any way, and this is consistent with the
convergence conditions we developed. The extension of the
convergence theory to the dynamic case is the subject of our
further work.
VI. CONCLUSION
In this work, modeling of piston and generic type gas
compressors was carried out. The signatures of the derivatives
of the control equation are analyzed, the ranges of parameter
values are identiﬁed, under which the conditions for the stable
operation of the algorithm for solving stationary network
problems are satisﬁed. After the practical implementation of
the modeling, in a numerical experiment on a realistic gas
network, the convergence of the solution algorithm is shown.
Our future plans include extending the described methods
to dynamic problems.
ACKNOWLEDGMENT
The work has been supported by the project TransHyDE-
Sys, grant 03HY201M.
REFERENCES
[1] T. Clees, I. Nikitin, and L. Nikitina, “Making Network Solvers Globally
Convergent”, Advances in Intelligent Systems and Computing, vol. 676,
2018, pp. 140-153.
[2] T. Clees, I. Nikitin, L. Nikitina, and L. Segiet, “Modeling of Gas Com-
pressors and Hierarchical Reduction for Globally Convergent Stationary
Network Solvers”, International Journal On Advances in Systems and
Measurements, vol. 11, 2018, pp. 61-71.
[3] A. Baldin, T. Clees, B. Klaassen, I. Nikitin, and L. Nikitina, “Topological
Reduction of Stationary Network Problems: Example of Gas Transport”,
International Journal On Advances in Systems and Measurements, vol.
13, 2020, pp. 83-93.
4
Copyright (c) IARIA, 2022.     ISBN:  978-1-61208-961-4
INFOCOMP 2022 : The Twelfth International Conference on Advanced Communications and Computation

[4] A. Baldin et al., “AdvWarp: A Transformation Algorithm for Advanced
Modeling of Gas Compressors and Drives”, in Proc. of SIMULTECH
2021, International Conference on Simulation and Modeling Method-
ologies, Technologies and Applications, pp. 231-238, SciTePress, 2021.
[5] T. Clees et al., “MYNTS: Multi-phYsics NeTwork Simulator”, in Proc.
of SIMULTECH 2016, International Conference on Simulation and
Modeling Methodologies, Technologies and Applications, pp. 179-186,
SciTePress, 2016.
[6] J. Katzenelson, “An algorithm for solving nonlinear resistor networks”,
Bell System Technical Journal, vol. 44, 1965, pp. 1605-1620.
[7] M. J. Chien and E. S. Kuh, “Solving piecewise-linear equations for resis-
tive networks”, International Journal of Circuit Theory and Applications,
vol. 4, 1976, pp. 1-24.
[8] A. Griewank, J.-U. Bernt, M. Radons, and T. Streubel, “Solving
piecewise linear systems in abs-normal form”, Linear Algebra and its
Applications, vol. 471, 2015, pp. 500-530.
[9] C. T. Kelley, Iterative Methods for Linear and Nonlinear Equations,
SIAM, Philadelphia, 1995.
[10] J. Mischner, H. G. Fasold, and K. Kadner, System-planning basics of
gas supply, Oldenbourg Industrieverlag GmbH, 2011 (in German).
[11] M. Schmidt, M. C. Steinbach, and B. M. Willert, “High detail stationary
optimization models for gas networks”, Optimization and Engineering,
vol. 16, 2015, pp. 131-164.
[12] J. Nikuradse, “Laws of ﬂow in rough pipes”, NACA Technical Memo-
randum 1292, Washington, 1950.
[13] C. F. Colebrook and C. M. White, “Experiments with Fluid Friction
in Roughened Pipes”, in Proc. of the Royal Society of London, Series
A, Mathematical and Physical Sciences, vol. 161, num. 906, 1937, pp.
367-381.
[14] J. Saleh, Fluid Flow Handbook, McGraw-Hill 2002.
[15] DIN EN ISO 12213-2: Natural gas - Calculation of compression factor,
European Committee for Standardization, 2010.
[16] O. Kunz and W. Wagner, “The GERG-2008 wide-range equation of state
for natural gases and other mixtures: An expansion of GERG-2004”, J.
Chem. Eng. Data, vol. 57, 2012, pp. 3032-3091.
5
Copyright (c) IARIA, 2022.     ISBN:  978-1-61208-961-4
INFOCOMP 2022 : The Twelfth International Conference on Advanced Communications and Computation

