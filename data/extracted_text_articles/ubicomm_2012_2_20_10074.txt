Exploring Efﬁcient Methods to Extract Pedestrian Flows
on a Mobile Adhoc Network
Ryo Nishide, Hideyuki Takada
Faculty of Information Science and Engineering
Ritsumeikan University
Kusatsu, Japan
nishider@fc.ritsumei.ac.jp, htakada@cs.ritsumei.ac.jp
Abstract—This paper explores possibilities to extract pedes-
trian ﬂows from Bluetooth detection logs in a distributive
manner. Bluetooth devices are installed in mobile equipments
such as laptops, tablet PCs, cell phones, and PDAs, which
pedestrians carry with them in daily life. If these devices
can be detected and logged, it may be possible to analyze
the movements and density of surrounding pedestrians in
real world. Moreover, we aim to build this system on a
server-less adhoc network, in which the network can be built
autonomously, and the data can be managed between mobile
devices distributively. Our goal is to build this system as simple
as possible, while avoiding the initial preparations to deploy
sensors in real world. The results of experiments have revealed
that detection logs implicitly record traces of surrounding
pedestrian ﬂows, which might provide possibilities to analyze
and distinguish pedestrian ﬂow patterns based on different
situations. The paper has also discussed the related issues on
network construction including methods to interpolate missing
detections.
Keywords-Distributive Database; Bluetooth; Social Context;
Pedestrian Flows; Mobile Devices; Adhoc Network.
I. INTRODUCTION
In recent years, according to the increase of urban pop-
ulation and the expansion of social activities, we cannot
avoid sharing the same public spaces with other people
when travelling outdoors as well as in daily life. These
situations include such occasions as transporting by train,
bus, or walking, eating lunch at restaurants, meeting at
appointed places, and going to a particular site such as a
historical spot, amusement park, festival and business show.
In any occasions, it will be one of the major concerns for
people whether the area is crowded or less-crowded, and
sometimes, it is necessary to know what is actually going on
in such places, including the changing ﬂow of pedestrians.
For example, though people tend to look for less-crowded
places to pass by or stay, they might occasionally choose a
crowded place as a popular spot, pondering or being curious
about what is occurring there.
On the other hand, many location-based services have
appeared on market owing to the enhancement of compu-
tational ability, wireless communication technology such as
wiﬁ and Bluetooth, and GPS technology deployed in mobile
devices. These advancements have paved way to explore
methods for detecting pedestrian ﬂows or social activities
using high performance mobile devices [1], [2], and extend
the applications for location-based systems such as recom-
mendation system [3], navigation system [4], information
sharing system, and so on. In most of these systems, users
are not only information viewers, but also the information
providers who send information as user check-in data, queue
length to wait in line, user comments or evaluation of a
place, and congestion information to the system, so that
these information can be shared between users or applied
to computation to enhance the results. However, most of
these systems require users to send data manually, which
is inconvenient for pedestrians, otherwise, collecting data
automatically from mobile devices, which may leak their
privacy information. Some of them require abundant initial
preparations to construct the system.
This paper proposes methods to extract the density and
ﬂows of pedestrians using the Bluetooth detection logs on a
mobile adhoc network. This adhoc network can be generated
from connection between mobile devices to work as a
distributive database, which can be managed and updated
the detection log data, or modiﬁed the log data by accessing
to geometrically adjacent devices to check for missing detec-
tions. The policy of this work is to avoid initial preparations
such as installing a large number of expensive immovable
sensors and high performance computational equipments in
real space, in order to minimize cost, time and effort. In
this research, we focus on the attempt to extract pedestrian
ﬂows in real world, while the speciﬁc services to utilize the
detection results are left for future work.
To begin with, the related researches and comparable
studies are reviewed in Section II. Then, the methods for
extracting the density and ﬂows of pedestrians, and the data
management scheme are explained in Section III. Section
IV discusses the architect and mechanism of the proposed
system. In Section V, based on the results of experiments,
the pedestrian ﬂows are examined in different situations,
by the analysis of detection patterns. Further study and
additional experiments will be needed to cope with the
interpolation of missing data and the deployment on an
adhoc environment.
29
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-236-3
UBICOMM 2012 : The Sixth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

II. RELATED RESEARCH
Several researches have emerged in the attempt to extract
social contexts owing to the development of mobile equip-
ment and adhoc communication.
O’ Neill et al. [5] and Nicolai et al. [6] examined
the correlation between Bluetooth detecting and pedestrian
movement by deploying stationary Bluetooth sensors in
the environment and analyzing the logs. Eagle et al. [7]
have shown methods to analyze social patterns of user’s
activity in a daily routine. These studies show that Bluetooth
scanning and analysis of detection logs have possibility to
extract the ﬂow of pedestrians, however, not every Bluetooth
device can be guaranteed to be detected depending upon
the performance of the device and situation of the space.
Thus, their methods may not be able to cope with too many
incoming data caused by crowded pedestrians.
To cope with such problems, Kim et al. [8] examined the
detection pattern of Bluetooth device logs, and employed
clustering algorithm and Gaussian blur to remove noises
caused by inquiry fault of undetected Bluetooth devices.
They inferred the transition time of events from multiple
device detections. However, inquiry fault for devices cannot
be detected individually. As there are many complicated
situations in real world, this method may not be enough
to cope with various situations. Weppner et al. [9] estimated
crowd density through collaboration with multiple devices
to improve the accuracy of detections. Users were assigned
to carry multiple devices to perform Bluetooth scanning
together, which might be troublesome for users.
Our research is contemplated to extract social context
by scanning Bluetooth device of surrounding environments,
with consideration to the user’s location and the communi-
cation range of Bluetooth devices. The method is proposed
to work autonomously and distributively with the users’
devices on an adhoc network, avoiding such troubles as
installing ﬁxed sensors or carrying multiple devices. It also
enables to correspond with inquiry faults by performing
computation collaboratively with nearby devices.
III. PROPOSED METHOD
To build a system to extract pedestrian ﬂow without
initial preparations, two points must be considered; (i) an
autonomous method to determine the movements of pedes-
trian without mounting cameras or sensors in real world, and
(ii) the server-less infrastructure to maintain the system and
manage data on mobile devices distributively.
A. Extraction of Pedestrian Flows
We attempt to grasp social contexts such as changes of
pedestrian ﬂows and density by detecting the surrounding
electronic equipments. Recent handheld electronic equip-
ments like cell phone, smart phone, PDA, and laptop are
installed with wireless devices such as wiﬁ and Bluetooth,
which pedestrians carry with them in their daily lives. If
Figure 1.
Detections in Different Situations
these devices surrounding the user are detected and logged
continuously, it may be possible to detect not only the
density of crowd, but also the changes of social contexts such
as the pedestrian ﬂow. In fact, the detection pattern differs
depending upon the situations of the surrounding pedestrians
(Fig. 1). Thus, by analyzing the detection patterns, it might
be possible to assume the social contexts or trends and
changes of surrounding situations. We avoid extracting the
personal information of pedestrians, such as locations or
user’s name, since this kind of information might violate
the privacy issue of pedestrians. Instead, we examine the de-
tection patterns (e.g. numbers and changes of simultaneous
or continuous detections) of devices carried by pedestrians
surrounding the user.
We have conducted a preliminary investigation to examine
the statistics of detectable types of terminal (mobile phone,
PC, etc.) at various places [10]. We have compared two
wireless technologies: wiﬁ and Bluetooth. Wiﬁ was detected
from many types of electronic equipments, either carried
by pedestrians or ﬁxed in the environment. Therefore, wiﬁ
seems difﬁcult to discriminate the types of equipments,
whether they are carried by the pedestrians or not. On
the other hand, by the investigation of Bluetooth signals,
most of the detected Bluetooth radios were from mobile
devices. Especially, Softbank mobile phones were highly
detected, probably because several models with Bluetooth
functions were sold in Discovery mode (a conﬁguration
option to enable the surrounding terminals to discover the
user’s terminal) as a default setup. In this paper, we focus
on Bluetooth devices, in order to detect the ﬂows and
movements of pedestrians, as most of Bluetooth devices are
installed in equipments to be carried by users.
The method we have proposed can be performed only
by utilizing the mobile device carried by the user, without
installing additional equipments such as mounting ﬁxed
sensors or video cameras in the environment.
30
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-236-3
UBICOMM 2012 : The Sixth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

Figure 2.
Delaunay Network with Mobile Devices
B. Mobile Adhoc Network
Another issue of concern is the management scheme of
pedestrian ﬂow data obtained from each mobile device. It
is not efﬁcient to collect and manage the entire data sent
from mobile devices on a server. Therefore, a mechanism is
necessary to manage data and perform computation between
mobile devices cooperatively.
To build such mechanism, it is contemplated to construct
an adhoc network using mobile devices so that the network
can be utilized to manage the data and communicate with
other devices. In this network, each device builds connection
directly with other devices without communicating to the
base station. In generating connections, it is important to
employ an efﬁcient scheme to choose mobile devices to
connect with, considering their location and limited com-
municable distance of mobile devices. Note that not all
surrounding pedestrians with mobile devices are users to
generate connections on adhoc network. Some of their
devices can be cell phones or the kinds with less or no
computational capability.
In this paper, we propose to employ P2P Delaunay
network, which is a geometry-based P2P network whose
topology is deﬁned by the geometric adjacency of mobile
devices (Fig. 2) [11], [12]. These devices are connected in
a geometrical structure Delaunay Diagram, which is well-
known in computational geometry. It has the features as
(i) each device connects to a close-by devices based on
its geographical distance, (ii) the degree of connection for
each device is low (approximately six), (iii) the network
can correspond with join/leave of device only affecting the
surrounding devices to reconstruct and update the connec-
tion, and (iv) the data is reachable to distant device through
multi-hop communication.
P2P Delaunay Network enables to construct a networked
environment in which the mobile devices are connected
to each other autonomously and distributively. It is not
necessary to prepare a server in order to maintain the system
Figure 3.
Detection of Pedestrian Flows
or manage pedestrian ﬂow data on it. Moreover, it also
provides possibilities to perform collaborative computation
or processing to work with set of mobile devices nearby.
Delaunay Network works effectively for accessing to the
data in geometrically adjacent devices, which can expose
the missing detection by observing at the detection logs of
surrounding devices.
IV. SYSTEM STRUCTURE
In this section, we discuss the architect and mechanism
of the system.
A. Detection of Surrounding Bluetooth Devices
During the manufacturing process of Bluetooth device,
each device is assigned with its individual ID expressed in
48-bit MAC address. This address is described as Bluetooth
Device Address (BDA) and is used for communicating with
other devices by sending their BDAs to identify each other.
Thus, BDAs are sent constantly without requiring authenti-
cation to build connection with other Bluetooth devices. Our
target is on class 2 Bluetooth devices embedded in handheld
mobile equipments as cell phones, laptops, PDAs, etc, with
their communication range reachable to approximately 10
meters distance. The protocol for the Bluetooth inquiry ﬁrst
receives the BDA of surrounding Bluetooth devices, and then
inquires the names of these devices. A combination of BDAs
and timestamps are stored in the log ﬁle for every constant
time interval.
Figure 3 shows an example of the pedestrian’s Bluetooth
Device which has entered the reachable communication
range of user’s device. User’s device continuously sends
inquiry to search for the surrounding pedestrians’ devices,
and logs the time and BDA of devices which have re-
sponded to user’s inquiry. From the log, different types
of detection patterns can be veriﬁed, such as continuously
detected, newly detected, undetected or disappeared, and so
on, which might be the key to determine the dynamic ﬂows
of pedestrians in real world.
31
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-236-3
UBICOMM 2012 : The Sixth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

Figure 4.
Determination of Nodes to Connect
B. Network Construction
In our research, we contemplate to apply the method
proposed in the past work [11] to generate P2P Delau-
nay Network with mobile devices. We assume that each
mobile device only has the location information of other
devices, but not the knowledge of how the other devices
are connected. Thus, each mobile device must choose the
appropriate mobile devices to connect, referring to their
location information to generate a P2P Delaunay Network.
To build connections of a P2P Delaunay Network under
such situations, each node (referring to the geographical
location of mobile device) draws an inscribed circle with two
other nodes on a plane, with a property of Delaunay Network
that no other nodes shall be included in the internal side of
the circle. Figure 4 shows an example of v0 determining the
node to generate connections on a plane. Inscribed circles are
generated connecting three nodes each, namely (v0, vi, vj)
{0 ≤ i ≤ 17, 0 ≤ j ≤ 17, i ̸= j}, which any of these circles
has no nodes in the internal. The nodes (v2, v8, v9, v10, v17)
are assigned as the neighbors of v0 to generate connection
with. If rest of the nodes (v1 - v17) does the same processes
v0 has done, a Delaunay Diagram can be generated. The
detail algorithm for generating and maintaining connections
are discussed in the past work [11]. Delaunay Network can
be used not only to generate or maintain connections with
adjacent nodes on a plane, but also to perform collaborative
computation with adjacent nodes described in the following
section.
C. Interpolation of Missing Detection
We have described methods to extract and manage the
Bluetooth detection logs on an adhoc network. However,
there are false-negative cases that some devices within the
communication range may not be detected. That is, abundant
BDA data pours in at once especially at a crowded place,
and the device cannot handle them all within the limited
Figure 5.
Interpolation of BDA Data (BDA1)
time interval while scanning for the surrounding Bluetooth
devices.
To deal with such problems, we consider methods to
check the detection logs of adjacent nodes on Delaunay
network, and interpolate the BDA data which is deﬁnitely
within the communication range of Bluetooth device. Ini-
tially, each node sends a copy of its own detection logs
to adjacent nodes, and receives their copy of detection
logs. Then, it extracts the BDA data which is not detected
from its device, but detected from other adjacent nodes’
devices. These BDA data will be the target data to perform
interpolation, and the location of these adjacent nodes will
be the criterion to determine whether or not to perform
interpolation.
We validate only the BDA data owned by more than
three adjacent nodes to perform interpolation. That is, a
polygon is drawn using the location of adjacent nodes
with the target BDA data as vertices. If the location of
its own node is within the polygon, then the target BDA
data shall be the one to be interpolated. We have chosen
polygonal shape to determine the interpolation, because it is
obvious that the entire polygonal region is covered from the
communication range of Bluetooth device. The purpose of
this interpolation method is to deal with missing detection,
and the deformation of communication range caused by
walls, buildings, and other obstacles are beyond our focus.
Figure 5 shows the interpolation process using the same
Delaunay Network in Fig 4. Node v0 has ﬁve adjacent
neighbor nodes, namely v2, v8, v9, v10, v17, and has the copy
of their BDA detection logs. Among the BDA on detection
logs, BDA1 is the only one that v0 does not have, but more
than three adjacent nodes (v2, v8, v10, v17) have. Using
these nodes as vertices, a polygon is drawn starting from
the upper node in clockwise direction. Finally, BDA1 can
be determined to be included in v0’s detection data, as it is
allocated within the polygon area.
32
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-236-3
UBICOMM 2012 : The Sixth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

(a) In Town
(b) On a Train
(c) In a Conference Room
(d) In a Cafeteria
Figure 6.
Detection Pattern of BDA (upper), Detected Number of BDA (lower)
Table I
CHARACTERISTICS OF PEDESTRIAN FLOW BY SITUATIONS
User
Surrounding ppl
Sharing Space
Stay
Move
Stay
Move
Town
△
⃝
△
⃝
△ or ×
Lecture room
⃝
×
⃝
×
⃝
Cafeteria
⃝
×
⃝
⃝
⃝ or ×
Train
Moving
×
⃝
×
⃝
⃝
Stopping
⃝
×
⃝
⃝
⃝ or ×
notations: (⃝)many; (△)some; (×)few/none
V. VERIFICATION AND DISCUSSION
The authors have done several investigations to observe
surrounding Bluetooth devices in various situations, such
as daily commuting and working at a university, or special
events as conferences, sight-seeing tour, festival, and so on.
To collect data, we used HP iPAQ 112 Classic Handheld
PDA, which has been setup to record BDA with a timeout
interval of 6 seconds after sending inquiry signal for every
30 seconds cycle.
Figure 6 shows BT detection logs in different situations. In
this paper, four cases have been examined, namely strolling
in town, transporting by train, attending the conference, and
taking lunch at a cafeteria. The speciﬁc movements of the
user and the surrounding people are described in Table I.
The results of examination of detection logs are summarized
in the points later. The upper diagram of Fig. 6 shows
the detection pattern of Bluetooth devices, with the time-
line expressed on the horizontal-axis, and the device ID
assigned in chronological order of the incoming BDA on
the vertical-axis. The mobile phones are colored in red, and
PCs and devices other than mobile phones in green, and the
unidentiﬁed devices in blue. The lower diagram of Fig. 6
shows the number of detected devices, with the time-line
expressed on the horizontal-axis, and the quantity of BDA
on the vertical-axis.
(a) Strolling in Town: Fig. 6(a) shows the changes of
multiple detection logs encountered while strolling in town.
The number of BDAs is not constant as the number of
passers-by is always changing. Even if the pedestrians are
walking in the same direction, their devices disappeared
occasionally probably because their directions coincided
only for a while or their walking speed was different. On
the other hand, the same BDA was continuously identiﬁed
in some places while the user was shopping or dropping in
stores.
(b) Transporting by Train: Fig. 6(b) shows the detection
in the train during rush hours. From the log, we can verify
such situations as: (i) devices were continuously detected
from passengers in the same car, (ii) many incoming and
outgoing devices were detected when changing train; and
(iii) a large number of people got on/off the train at major
stations such as Osaka and Kyoto. The passenger’s devices
can be continuously detected even when the train is moving.
However, due to the limited size and rectangular shape of
the car, the quantity of detections has been low even if the
train is crowded. Because of these observations, the authors
have considered that it is necessary to identify the situation
from detection patterns or some other methods, as it cannot
be veriﬁed merely by the quantity of devices.
(c) Attending the Conference: Fig. 6(c) shows that many
BDAs were detected continuously in the same room. As
33
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-236-3
UBICOMM 2012 : The Sixth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

most of the participants are staying in the room during
the conference, the number of BDAs is almost constant
(counting around 14 to 18 devices), except the time for
coffee break. Because the room was wide enough to hold
many people, the quantity of detections has been kept high.
(d) Taking lunch at a Cafeteria: Fig. 6(d) shows that many
devices have been detected during lunch time, as customers
enter, take lunch and leave the cafeteria one after another.
Some devices are detected continuously with long duration,
and others are divided into several times with short duration,
because two types of situations are mixed together: people
sitting and eating lunch, and people walking around to look
for seats or friends.
Based on the results of the experiments, the pedestrian
ﬂow can be assumed by the analysis of the data of detection
logs as follows:
• The number of BDA detection log: crowdedness of
people (requiring reference to the scale of space)
• Time length of BDA detection: people staying in same
space or duration of the event
• Appearance/Disappearance in BDA detection: peo-
ple staying, entering, leaving, or passing by
The detection logs show that there are several undetected
devices even among those staying in the same space. There-
fore, the interpolation of the missing detection is also needed
in order to utilize the detection results.
VI. CONCLUDING REMARKS
We have shown possibilities to extract pedestrian ﬂows by
examining the detection patterns of surrounding Bluetooth
devices, and proposed to apply methods to generate mobile
adhoc network and manage detection data on the network,
adhering to our policy to avoid initial preparations to install
cameras or sensors on the environment, or manage data on
a one point server. For deployment in actual environment,
issues of energy consumption with mobile device battery
must be considered in advancing the research. Moreover,
privacy issue is also another concern because such personal
data as user name and location should not be exposed to
others. For future work, we plan to perform detailed analysis
on Bluetooth device logs, examine the applicability with
other sensory data, and provide location-based application
using social contexts as pedestrian ﬂows. On the other hand,
we plan to continue further study on Delaunay networks,
explore efﬁcient ways or possibilities to manage social
contexts data and log ﬁles, and evaluate our methods to
interpolate missing data caused by inquiry faults.
ACKNOWLEDGMENT
This work was partially supported by MEXT/JSPS KAK-
ENHI Grant Number 23650033.
REFERENCES
[1] P. Lukowicz, A. Pentland, and A. Ferscha, “From Context
Awareness to Socially Aware Computing,” IEEE Pervasive
Computing, 11 (1), pp. 32–41, 2012.
[2] A. Campbell et al., “The Rise of People-Centric Sensing,”
IEEE Internet Computing, 12 (4), pp. 12–21, 2008.
[3] N. Ratipanichvong, J. Yamamoto, R. Nishide, and H. Takada,
“Place Recommendation for Pedestrian Reﬂecting Real-Time
Situation and User’s Preferences”, IPSJ Symposium Kansai
Branch, F-27, 2011.
[4] M. Kawabata, R. Nishide, M. Ueda, and S. Ueshima, “The
Context-adaptable Pedestrian Navigation System and Usabil-
ity in Practical Settings”, IEEE Paciﬁc Rim Conf. on Commu-
nications, Computers and Signal processing, 1(05CH37690),
pp. 368–371, 2005.
[5] E. O’Neill et al., “Instrumenting the city: Developing meth-
ods for observing and understanding the digital cityscape”,
UbiComp, pp. 315–332, 2006.
[6] T. Nicolai and H. Kenn. “About the relationship between
people and discoverable bluetooth devices in urban environ-
ments”, 4th int’l conf on mobile technology, applications, and
systems, pp. 72–78, 2007.
[7] N. Eagle and A. Pentland. “Reality mining: sensing complex
social systems”, Personal Ubiquitous Computing, 10, pp.
255–268, 2006.
[8] D. Kim and D.-K. Cho, BlueSense: Detecting individuals,
locations, and regular activities from Bluetooth Signals,
http://urban.cens.ucla.edu/cs219/images/0/0b/BlueSense.pdf
(Retrieved March 9, 2012)
[9] J. Weppner and P. Lukowicz, “Collaborative Crowd Density
Estimation with Mobile Phones,” 9th ACM Conf. Embedded
Networked Sensor Systems, 2011.
[10] R. Nishide, T. Ushikoshi, S. Nakamura, and Y. Kono, “De-
tecting Social Contexts from Bluetooth Device Logs”, Sup-
plemental Proc. Ubiquitous Computing (UbiComp), pp. 228–
230, 2009.
[11] M. Ohnishi, R. Nishide, and S. Ueshima, “Incremental Con-
struction of Delaunay Overlaid Network for Virtual Collabo-
rative Space”, 3-rd Proc. Conf. on Creating, Connecting and
Collaborating through Computing (C5’05), (IEEE CS Press),
pp. 77–84, 2005.
[12] Y. Sun, Q. Jiang, and M. Singhal, “An Edge-Constrained
Localized Delaunay Graph for Geographic Routing in Mobile
Ad Hoc and Sensor Networks”, IEEE Trans. Mob. Comput.
9(4), pp. 479–490, 2010.
34
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-236-3
UBICOMM 2012 : The Sixth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

