Providing QoS to Secondary Users Employing 
VoIP Applications in Cognitive Radio Networks 
Esra Hatice Demirtaş 
Computer Engineering Department  
Istanbul Technical University 
Istanbul, Turkey 
demirtas@itu.edu.tr 
Sema F. Oktuğ 
Computer Engineering Department  
Istanbul Technical University 
Istanbul, Turkey 
oktug@itu.edu.tr
 
 
Abstract— Quality of Service in Cognitive Radio is an open 
area for researches. Previous works on this item are classified 
as either Quality of Service of Primary User or Quality of 
Service of Secondary User. The work described in this paper is 
related to the latter. We worked on a popular application 
which is Voice over IP. The aim is to provide a sufficient 
Quality of Service to Secondary Users employing Voice over 
IP.  For that purpose; calls over a real Application Server with 
different codecs, and different voice packet size were 
established; voice packets were collected through a network 
protocol analyzer, which is wireshark; packets were analyzed; 
and an application layer algorithm has been proposed. Then, a 
Secondary User with a Voice over IP connection employing the 
proposed algorithm was simulated considering various arrival 
patterns of Primary User using the network simulator, ns-2. 
The results obtained confirmed the success of the proposed 
technique. It is shown that, the cognitive radio applications 
employing the introduced technique achieve an acceptable 
Quality of Service level for Voice over IP connections. To the 
best of our knowledge, this is the first work providing Quality 
of Service to Secondary Users of Cognitive Radio Networks at 
application layer.  
Keywords-component; Cognitive Radio; QoS; VoIP 
I. 
 INTRODUCTION  
There is an increasing spectrum demand because of the 
uptrend in new bandwidth required technologies. However, 
users could not be always served since the lack of empty 
spectrum resource in their location. In the meantime, some 
portions of the spectrum may be underutilized [1]. Since 
spectrum is assigned statically in current wireless networks, 
users can not move to another spectrum although there is an 
available resource on there. Cognitive Radio Networks 
(CRN) use dynamic spectrum access. Secondary Users (SUs) 
sense the spectrum, and they are allowed to use a licensed 
spectrum if they do not affect the Primary Users (PUs) [2-3].  
Works related to Quality of Service (QoS) in CRN are 
very important for the success of CRN. There are two 
different QoS research area in CRN: 
 
QoS of Primary User (PU): Aims to show that in 
CRN, SUs do not affect the QoS of PU. 
 
QoS of Secondary User (SU): Providing QoS to SUs 
in CRN.   
   The main objective of this study is to provide QoS to 
SUs of CRN. For this purpose, a widely used application, 
Voice over IP (VoIP), is chosen. Then, a QoS satisfying 
VoIP application is aimed in order to provide voice 
communication to SU in CRN. In this work, an application 
layer solution is proposed. 
  The rest of the paper is organized as follows: In Section II, 
the related works are summarized. VoIP Basics are 
described in Section III. The technique proposed is 
presented in Section IV. The simulation environment and 
the simulation results are given in Section V, followed by 
conclusion and future works in Section VI. 
II. 
RELATED WORK  
Recent researches in QoS of SUs in CRN have been 
focused on power controls, resource management algorithms 
and Media Access Control (MAC) designs. 
In [4] authors identified every user as selfish and each 
one tries to achieve its target QoS using least power 
consumption. They had optimized the problem as non-
cooperative game, and analyzed Nash Equilibrium (N.E.). In 
system model, each user announces its interference 
regulation price and QoS provisioning price. Then, all of 
users run the proposed multi-channel power allocation 
algorithm [4]. 
  In [5], authors worked on resource management 
algorithms. They proposed a hybrid model named C2net 
which consists of Integrated Services (IntServ) for high 
priority flows such as voice, video, and Differentiated 
Services (DiffServ) for other flows. In [6], a scheduling 
algorithm is proposed for statistical QoS guarantee over 
CRN. Cooperative relay node and admission control 
mechanisms are proposed. In [7], authors investigate a CRN 
which consists of cluster heads (CHs), and regular sensors. 
Constant Bit Rate (CBR) and Best Effort (BE) traffic is 
considered and two different priority algorithms are 
proposed to provide QoS. In [8], authors analyzed the VoIP 
capacity and proposed a new method for finding the 
minimum detection and false-alarm probabilities to ensure 
the QoS requirement of VoIP users in CRN.  They modeled 
the VoIP traffic as Markov-Modulated Poisson Process 
(MMPP); channel as two state Markov chain. 
83
ICSNC 2011 : The Sixth International Conference on Systems and Networks Communications
Copyright (c) IARIA, 2011.     ISBN: 978-1-61208-166-3

In [9] two MAC schemes are proposed for SU accessing 
the wireless channel. Then, an analytical model is proposed 
to derive the voice-service capacity for two MAC schemes. 
III. 
VOIP BASICS 
VoIP is the growing technology that allows voice 
conversations to be carried over the Internet Network [10]. 
VoIP uses Session Initiation Protocol (SIP) [11] or H323 
protocol [12] for signaling. Voice conversations have a 
“sender” and “receiver” roles. Sender and receiver change 
the roles in different portions of conversation. 
A. Working Principle of VoIP 
Sender creates an analogue signal on the conversation. 
These analogue signals are digitized by the use of an encoder 
[13]. At receiver, incoming packets are placed into a 
playback buffer to overcome problems caused by late 
received or non-received packets. These packets decoded 
using identical decoder. The digital bit stream converted 
back into an analogue signal and send to the receiver. 
B. VoIP Session Initialization via SIP  
Calling and called party get an agreement on which 
codec is going to be used, and what will be the packet rate, 
and packet sizes, in each new call. These are agreed at 
session initialization. Session initialization is done with 
either SIP or H323 messages. Here, we investigated SIP. 
There is a Session Description Protocol (SDP) [14] portion 
in SIP messages. It contains all information that needs to be 
shared with the other side to negotiate. Supported codecs are 
given in rtpmap attribute of SIP message. This attribute maps 
the Real-time Transport Protocol (RTP) payload type 
number defined in "m=" line to an encoding name, clock rate 
and encoding parameters. RTP payloads are defined by The 
Internet Assigned Numbers Authority (IANA) and then 
standardized by The Internet Engineering Task Force (IETF) 
[15-16]. Voice packet size is carried in ptime attribute.  
After session is established, calling or called party can 
change the negotiated codec or ptime. This is done by in-
session requests with INVITE or UPDATE messages.  
C. VoIP Packet and Codec Relations 
A VoIP packet consists of 20 bytes Internet Protocol (IP) 
header, 8 bytes User Datagram Protocol (UDP) header, 12 
bytes RTP header and a variable size payload according to 
used codec as illustrated in Fig. 1 [17]. 
Popular codecs in VoIP have been identified and their 
packet size, packet interval have been calculated using (1), 
(2), (3).  
CodecBitRate = CodecSampleSize / CodecSampleInterval   
                                                                                            (1)    
PacketsPerSecond=CodecBitRate/ (VoicePayloadSizeInBit)                                                                    
(2)  
TotalPacketSize = (Layer2Header) + (IP/UDP/RTP_header) 
+ (VoicePayloadSize)                                                         (3) 
 
Calculated codec packet size and interval according to 
ptime value is provided in Table I. 
 
Figure 1.   VoIP Packet 
D. QoS Evaluation in VoIP 
IP Networks were built for non-real time applications 
such as file transfer, email. That is why delay or available 
bandwidth was not the big concern. Later, IP Networks are 
started to be used for real time applications and real time 
applications are relative to delay [18]. In VoIP, packets are 
created at real time, encoded, packetized, sent over the 
network, decoded, and listened by other party. Delay, jitter, 
available bandwidth, as a result QoS, becomes a major 
concern in real time applications. 
The quality of voice is subjective. Users express the 
quality of a call as “good”, “bad”, “quite good”, or “very 
bad”. In QoS tests of VoIP, a conversation is listened to 
users and wanted to quantify the service quality from 1 to 5, 
1 being the worst and 5 is the best. The numerical method of 
expressing voice and video quality is defined as Mean 
Opinion Score (MOS) [19]. 
Instead of subjective tests, MOS can be calculated by 
voice quality effecting factors such as bandwidth, delay, 
jitter, packet loss, echo or noisy background. 
TABLE I.  
CODEC PROPERTIES 
Codec 
(Defined in 
rtpmap 
attribute) 
Voice Payload 
Size (ms- Defined 
in ptime attribute) 
Total packet Size 
(byte) 
G711 
10 
126 
G711 
20 
206 
G711 
30 
286 
G729 
10 
56 
G729 
20 
66 
G729 
30 
76 
G729 
40 
86 
G729 
50 
96 
G729 
60 
106 
G 723.1 
30 
70 
G 723.1 
60 
94 
G726-32 
20 
126 
G726-32 
30 
166 
G726-32 
40 
206 
G726 -24 
20 
106 
G726 -24 
30 
136 
84
ICSNC 2011 : The Sixth International Conference on Systems and Networks Communications
Copyright (c) IARIA, 2011.     ISBN: 978-1-61208-166-3

The ITU-T E-Model [20] defines an analytic model of 
voice quality between two connections known as "Voice 
Transmission Quality from Mouth to Ear" with equipment 
impairment factor method, and previous transmission rating 
models. E-model calculates the Rating Factor (R).  R value is 
calculated using the formula below: 
A
Ie eff
Id
Is
Ro
R






                     (4) 
where Ro is basic signal-to-noise ratio, including noise 
sources such as circuit noise and room noise, Is is a 
combination of all impairments which occur more or less 
simultaneously with the voice signal, Id is the impairments 
caused by delay and the effective equipment impairment 
factor, Ie-eff is the impairments caused by low bit-rate codecs 
and impairment due to packet-losses of random distribution, 
A is the advantage factor. 
MOS value is calculated through R value as below:  
 


















5.4
:
100
1000000
7
6250
7
100
7
100 : 1
5.6
1
:
5.6
3
2
R
R
R
R
R
R
MOS
                                                                              (5) 
See Table II for the relation between, R value and MOS. 
IV. 
PROPOSED SOLUTION  
After investigation VoIP working principle, and VoIP 
signaling details, VoIP packets obtained from one of VoIP 
service provider, Genband Application Server [21] in IP 
network of Netaş [22] were collected and analyzed. It was 
noticed that VoIP packet size was constant and these packets 
were generated periodically. According to SIP Request for 
Comments (RFC), experimental data shows that packet sizes 
are relevant to negotiated codec which is given in rtpmap 
attribute in SIP message at session initialization. Packet 
receive interval is related to ptime attribute in SIP message. 
So, it is obvious that we can model VoIP traffic as CBR 
traffic. 
As stated in Section II, QoS of VoIP is calculated 
through MOS value. In our proposal, MOS is calculated 
periodically. The algorithm remembers the previous MOS 
value. Then, it is compared with the current MOS value. 
 
If the difference is 0, it means MOS remains the 
same  
 
If difference is less than 0, it means MOS decreases 
o 
If it is -1, then ptime value should be 
changed.  
o 
If the change is greater than 1, then codec 
value is changed 
 
If difference is greater than 0, it means MOS 
increases 
 
   When difference is 1, ptime value is increased. In this way, 
packet rate is decreased. Each packet carries more voice 
packet. But this supplies SU to wait more time for non-
received packets.   
   If difference is more than 1, then codec value is changed to 
a lower codec. Total packet size is decreased. 
TABLE II.  
RELATION BETWEEN R VALUE AND MOS [28] 
R Value  
(lower limit) 
MOSCQE  
(lower limit) 
User Satisfaction 
90 
4.34 
Very Satisfied 
80 
4.03 
Satisfied 
70 
3.60 
Some users 
dissatisfied 
60 
3.10 
Many users 
dissatisfied 
50 
2.58 
Nearly all users 
dissatisfied 
 
V. 
RESULTS OBTAINED 
The test bed is created as 500X500-grid area in ns-2 [24] 
which simulates 500 m X 500 m square area. There is 1 SU 
in simulation and it is simulated with mobile node 
functionality of ns-2. PU traffic is thought as aggregated 
traffic, so there is not a number for PU. Existence of PUs is 
modeled by moving the Secondary User to a place longer 
than antenna’s range. When PU has gone, SU moved back to 
original place.  
In this paper, Cognitive Radio’s Spectrum Sensing is out 
of scope.  It is assumed that Spectrum Sensing is done and 
available channels and slots are specified.  
Simulation has been run for 10s. Primary user traffic is 
modeled as deterministic. The simulation is run under 3 
different PU traffic models as listed below: 
 
ON Period = OFF Period 
 
ON Period > OFF Period 
 
ON Period < OFF Period 
In our simulations R value is calculated according to 
delay, jitter and packet loss as in Table III [23].   
TABLE III.  
R VALUE CALCULATION 
1 
EffectiveLatency = (AverageLatency + Jitter * 2 + 10)  
2 
# Take the average latency, add jitter, but double the impact 
to latency then add 10 for protocol latencies 
3 
if (EffectiveLatency < 160) 
4 
    R = 93.2 - (EffectiveLatency / 40) 
5 
Else 
6 
    R = 93.2 - (EffectiveLatency -120/ 10) 
7 
Endif 
8 
# Deduct 2.5 R values per percentage of packet loss 
9 
R = R - (PacketLoss * 2.5) 
 
 
A. ON Period = OFF Period 
First the technique is tested when PU ON and OFF 
periods are equal. ON period and OFF period are taken as 2 
s. Fig. 2(a) illustrates PU traffic model. PU arrives to system 
and transmits data between 2–4 s and 6-8 s. 
Fig. 2(b) shows the change in the MOS value of the SU 
VoIP application when PU traffic is as given in Fig.2(a).  
85
ICSNC 2011 : The Sixth International Conference on Systems and Networks Communications
Copyright (c) IARIA, 2011.     ISBN: 978-1-61208-166-3

MOS starts to decrease at time 2.0, which is the PU arrival 
time. Since our algorithm notices a small decrease in MOS, 
it increases ptime. That’s why MOS increases in the next 
MOS calculation. Similar behavior occurs at time 2.8. When 
there is a bigger decrease than 1, like at time 7.0, the 
algorithm changes codec and in the next period MOS 
increases. 
 
B. ON Period > OFF Period 
We also tested the traffic model where ON period of PU 
is bigger than OFF period. PU traffic model is illustrated in 
Fig. 3(a). PU arrives to system and transmits data between 
2–5 s and 7-10 s. This is risky for the SU, since PU remains 
in the system longer. ON periods are 3 s; while OFF periods 
are 2 s. 
SU MOS changes are given  in Fig. 3(b). MOS changes 
start to decrease after time 2.0, which is the PU arrival time. 
Since our algorithm notice a small decrease in MOS, it 
increases ptime. That’s why; MOS increased in next MOS 
calculation period. Same thing occurs in 2.8. When there is a 
greater decrease, the algorithm changes codec and in next 
period MOS increased. 
 
 
 
Figure 2.  ON Period = OFF Period a) PU traffic b) MOS change on SU 
 
 
 
Figure 3.  ON Period > OFF Period a) PU traffic b) MOS change on SU 
C. ON Period < OFF Period 
Lately, traffic model of ON period of PU is less than 
OFF period is tested. Fig. 4(a) illustrates PU traffic model. 
PU arrives to system and transmits data between 3–5 s and 8-
10 s. ON periods are 2 s, while OFF periods are 3 s.  
Fig. 4(b) shows the MOS changes in SU according to the 
behavior of the PU. Changes in MOS start to decrease at 
time 3.0, which is the PU arrival time. Since our algorithm 
notice a small decrease in MOS, it increases ptime. That’s 
why; MOS increased in next MOS calculation. Same thing 
occurs in time 2.8 s. When there is a greater decrease like at 
time 7.0 s, algorithm changes codec and in the next period 
MOS increases. 
VI. 
CONCLUSION 
This study focuses on the Quality of Service enhancement 
for the Secondary Users with VoIP connections in Cognitive 
Radio Networks. One of the most popular applications, 
Voice over IP is chosen and tried to achieve a satisfying QoS 
level to the corresponding SUs. For this purpose, first, real 
VoIP packets are collected from Genband Application 
Server, and analyzed. After analyzing VoIP packets and 
VoIP signaling, a solution in application layer is proposed to 
provide better QoS to SU VoIP applications. Then, we 
simulate the technique proposed using ns-2.  The technique 
is an application layer approach where the MOS value for 
the VoIP connection is measured periodically and by 
chancing the ptime parameter or the codec type according 
the QoS of the connection is enhanced.  
 
86
ICSNC 2011 : The Sixth International Conference on Systems and Networks Communications
Copyright (c) IARIA, 2011.     ISBN: 978-1-61208-166-3

 
 
Figure 4.  ON Period < OFF Period a) PU traffic b) MOS change on SU. 
It is shown that the proposed technique gives promising 
results for Cognitive Radio Networks by the simulations 
done in ns-2. 
   The performance of this algorithm can be further 
enhanced by not only observing MOS decreases but also 
observing MOS increases, and changing the codec type or 
ptime parameter to appropriate values when there is no PU 
around. 
  For future work, PUs with different behaviors are going to 
be employed. 
ACKNOWLEDGMENT 
Authors would like to thank NETAS for their support. 
REFERENCES 
[1] Waze, V. L., “Spectrum access and the promise of cognitive 
radio technology”, Cognitive Radio Workshop Presentations, 
Washington, DC, May 2003   
[2] Wang, B., and Liu, K. J. R., “Advances in cognitive radio 
networks: a survey”, IEEE J. Sel. Topics Signal Process, 
vol.5, no. 1, pp 5-23, 2011 
[3] Akyildiz, I. F., Lee, W. Y., Vuran, M. C., and Mohanty, S., 
“NeXt generation/dynamic spectrum access/cognitive radio 
wireless networks: a survey”, Computer Networks, vol. 
50(13), pp 2127–2159, 2006 
[4] Wu, Y., Tsang, D. H. K.,” Distributed power allocation 
algorithm for spectrum sharing cognitive radio networks with 
QoS guarantee”, IEEE INFOCOM, Rio de Janeiro, Brazil, 
April 2009 
[5] Yau, A. K. L., Komisarczuk, P., and Teal., P. D., “C2net: a 
cross-layer Quality of Service (QoS) architecture for 
cognitive wireless ad hoc networks”, ATNAC, Adelaide, SA, 
December 2008  
[6] Lien, S. Y., Prasad, N. R., Chen, K. C., and Su, C. W., 
“Providing 
statistical 
Quality-of-Service 
guarantees 
in 
cognitive radio networks with cooperation”, IEEE CogART, 
Aalborg, Denmark, May 2009  
[7] Liang, Z., Zhao, D., “Quality of Service performance of a 
cognitive radio sensor network”, IEEE ICC, Cape Town, 
South Africa, May 2010.    
[8] Lee, H., and Cho, D., “Capacity improvement and analysis of 
VoIP service in a cognitive radio system”, IEEE Trans. Veh.. 
Technol., vol. 59, no. 4, pp. 1646-1651, 2010 
[9] Wang, P., Niyato, D., and Jiang, H., “Voice-Service capacity 
analysis for cognitive radio networks”, IEEE Trans. Veh. 
Technol., vol. 59, no. 4, pp. 1779-1790, 2010 
[10] Lakas, A., and Boulmalf, M., “Experimental analysis of VoIP 
over 
wireless 
local 
area 
networks”, 
Journal 
of 
Communications, vol. 2, no. 4, pp. 3-9, 2007  
[11] RFC3261, 
SIP: 
Session 
initiation 
protocol, 
Internet 
Engineering Task Force, 2002  
[12] H.323, ITU-T Recommendation, 2006 
[13] Cruz, H. T., and Torres-Román, D., “Traffic analysis for IP 
telephony”, 2nd International Conference on Electrical and 
Electronics Engineering (ICEEE) and XI Conference on 
Electrical Engineering, Amsterdam, the Netherlands, June 8-
12, 2005 
[14] RFC 4566, Session Description Protocol, Internet Engineering 
Task Force, 2006  
[15] Real-Time Transport Protocol (RTP) Parameters, IANA, 
<http://www.iana.org/assignments/rtp-parameters>, accessed 
at 05.06.2011 
[16] Schulzrinne, H., Casner, S., RTP profile for audio and video 
conferences with minimal control, 2003 
[17] CISCO, 2005:  “Voice Over IP - per call bandwidth 
consumption”,  unpublished 
[18] Pracht, S., Hardman, D., “Voice quality in converging 
telephony and IP networks”, unpublished 
[19] Unuth, N., Mean Opinion Score (MOS) - A Measure Of 
Voice 
Quality, 
http://voip.about.com/od/voipbasics/a/MOS.htm, accessed at 
05.06.2011 
[20] ITU-T 
Recommendation 
G-107, 
“The 
E-model, 
a 
computational model for use in transmission planning”,  2005 
[21] Genband 
Application 
Serverö 
<http://www.genband.com/Home/Products/Applications/A2-
Business-Applications.aspx>, accessed at 05.06.2011 
[22] Netaş, <http://www.netas.com.tr/ >,  accessed at 05.05.2011 
[23] How 
is 
MOS 
calculated 
in 
PingPlotter 
Pro, 
<http://www.nessoft.com/kb/50>, accessed at 05.05.2011 
[24] NS-2, 
 
< 
http://www.isi.edu/nsnam/ns/>, 
accessed 
at 
05.06.2011
 
87
ICSNC 2011 : The Sixth International Conference on Systems and Networks Communications
Copyright (c) IARIA, 2011.     ISBN: 978-1-61208-166-3

