Optimization Analysis of the Integrated Micro-coil Geometry Parameters Influence 
on the Uniformity of the Magnetic Field Distribution 
 
Miha Gradišek and Janez Trontelj 
Laboratory for Microelectronics, Faculty of Electrical Engineering, University of Ljubljana,  
Tržaška cesta 25, 1000 Ljubljana, Slovenia 
e-mails: Miha.Gradisek@fe.uni-lj.si, Janez.Trontelj1@guest.arnes.si 
 
 
Abstract— The paper deals with the optimization of the 
integrated planar micro-coil characteristics with respect to 
maximizing the generated magnetic field amplitude and its 
uniformity along the region of interest. The integration calls for 
as efficient realization as possible otherwise the electrical 
heating would contribute to reduced performance of the 
integrated system in which the micro-coil is used. A multi-
objective optimization is performed with respect to efficiency 
and uniformity of the magnetic field distribution.  It is optimized 
in a range of the technological rules to be used in application 
where precise magnetic field measurement is required.  
Keywords-Integrated planar micro-coil; Magnetic field 
uniformity; Optimization; Parametrized 3D model. 
 
 
I. 
INTRODUCTION 
Whenever a new technological product is developed, the 
engineers strive for the best possible performance to price 
ratio. To accelerate product development and meet desired 
performance, various optimization methods are used. Based 
on the problem to be solved, two approaches are known, the 
stochastic and the deterministic approach. The former is used 
when the imitation and evolution of nature phenomenon is 
used during convergence to the optimal solution, while the 
latter minimizes or maximizes the criterion function, called 
the Objective Function (OF), with respect to the deterministic 
change of the independent Control Variables (CV) 
deterministically. This work uses a deterministic approach 
because the geometry of the integrated planar micro-coil 
(µCoil), realized in a standard Complementary Metal Oxide 
Semiconductor (CMOS) technology, is limited to the 
technological parameters dictated by the manufacturing 
process rules, so the inputs to the simulator are specific 
numbers and also the output of the simulator is determined by 
the Partial Differential Equation (PDE) formulation, therefore 
it is a deterministic object. 
There has been a lot of research work on the uniformity of 
the magnetic field of coils in different constellations [1][2][3]. 
The most commonly used method to tackle magnetic field 
uniformity is accomplished with Helmholtz coils, which 
alleviate the difficulties in achieving the desired magnetic 
field homogeneity in the center of the system. On the other 
hand, coil integration in the CMOS process prevents a 
comparable relative precision of magnetic field variation, as it 
is inevitable to overcome the mismatch of the planar µCoil 
geometry as a result of the manufacturing process. 
Furthermore, the area of interest for magnetic field evaluation 
in Integrated Circuit (IC) is generally located outside the coil 
center plane, since the Hall sensor is located at the bottom of 
the IC, in the diffusion area, while the planar µCoil is realized 
at higher metal planes. Furthermore, the integration of the 
planar µCoil inside the die requires an energy efficient 
realization. Consequently, this work focuses not only on the 
optimization with respect to the uniformity of the magnetic 
field in the region of interest, but on electrical losses as a 
consequence of the µCoil resistance as well. These losses are 
reflected through the heat dissipation, which is particularly 
undesirable in the integrated system, where the µCoil is used 
as a generator of the reference magnetic field for the 
temperature calibration of the Application Specific Integrated 
Circuit (ASIC) for which the µCoil is to be used [4].  
The paper is structured as follows: The Section II analyzes 
the optimization problem in relation to the specific ASIC and 
the possible formulation of the multi-objective function, the 
Section III describes the workflow from the design of 3D 
model of the µCoil to its integration into the optimization 
interface, while Section IV presents the simulation results 
with observations. Finally, the article concludes with 
summary of the overall work, and an acknowledgement.  
 
II. 
OPTIMIZATION PROBLEM 
As already mentioned, the integrated µCoil should exhibit 
high efficiency, i.e., it should generate as large magnetic flux 
density per µCoil bias current as possible. Therefore, we are 
staring to increase the magnetic flux density by increasing the 
number of coil turns N or to minimize the µCoil radius r. 
According to the Biot-Svart law, the axial component of the 
magnetic flux density BZ in the centerline of the circumference 
is acquired after integration over all elements dL of the closed 
curve, e.g., µCoil (1) shown in Figure 1.  
 
Figure 1.  Parameters of the µCoil. 
75
Copyright (c) IARIA, 2020.     ISBN:  978-1-61208-820-4
SENSORDEVICES 2020 : The Eleventh International Conference on Sensor Device Technologies and Applications


𝐵௓ =
µబூே௥
ସ஠ඥ(௥మା௭మ)య ∮ 𝑑𝐿

Where, μ0 is the permeability of free space, I current 
through N turns with radius r while z denotes the distance 
pointing from the center of the µCoil to an on-axis observation 
point. However, a higher number of µCoil turns N increases 
the total resistance Rcoil, which means higher ohmic heat 
losses, or on the other hand larger variation of the magnetic 
flux density, BZ when too small µCoil radius is chosen.  
These variations are especially problematic when high 
uniformity of the magnetic field at the sensor location is 
desired, i.e., in the ASIC with temperature compensation of 
the Hall sensor and the overall system sensitivity.  The Hall 
sensor is implemented in the strongly temperature dependent 
n-well diffusion region of the CMOS process. The sensitivity 
of the sensor to magnetic field is therefore temperature 
dependent, which is why a compensation technique should be 
introduced. The compensation approach is based on the 
simultaneous measurement of the external magnetic field and 
the reference magnetic field generated by the µCoil. Both 
signals are modulated at high frequency and later, after signal 
processing, demodulated back to a signal proportional to the 
external magnetic field and an additional signal containing 
information about Hall sensor sensitivity, based on the 
response of the overall ASIC sensitivity to a known reference 
magnetic field generated by the µCoil. The reference magnetic 
field should be constant over the entire modulation time. It 
should also be uniformly distributed over the entire Hall 
sensor volume, otherwise a parasitic signal component is 
sneaked into the signal of the measured magnetic field during 
the demodulation process. The aforementioned non-
uniformity causes signal distortion, as shown in Figure 2, so 
the µCoil should generate as uniformly distributed reference 
magnetic field as possible. Taking into account the above 
criteria, an optimal realization of the µCoil should be 
designed, which calls for an optimization procedure.  
The optimization should reduce µCoil resistance and at the 
same time decrease magnetic field gradient in the area of Hall 
sensor. Calculation of the rectangular cross-section planar 
µCoil resistance RCOIL, where current is not evenly distributed, 
as in wires with circular cross-section, is complicated 
therefore an electromagnetic simulator is mandatory. 
Objective function QR for the resistivity Rcoil (2) has the 
minimum value of 0 for single turn coil N=1 with minimum 
radius rmin=10µm, which is half of the Hall sensor maximum 
dimension. Before the objective function QR is evaluated, the 
maximum, minimum Rcoil_min and the average Rcoil_avg 
resistance of the µCoil are determined in separate simulation 
run. The constant kR is used to normalize the maximum value 
of QR compared to other objective function maximum.  

𝑄ோ =
ோ಴ೀ಺ಽିோಾ಺ಿ
ோಲೇಸ
∗ 𝑘ோ

Objective function QstdB, which evaluates the uniformity 
of the magnetic field (3), is composed of the standard 
deviation of the magnetic flux density σB over the cross-
section line where Hall sensor is positioned, marked in red in 
Figure 3. For comparable σB at different magnitudes of 
magnetic flux densities BZ for different µCoil radius, the 
normalization of σB is accomplished by the magnetic flux 
density in the center of the µCoil BZ0. The minimum 
(σB/BZ0)MIN and maximum (σB/BZ0)MAX  ratios of standard 
deviation to magnetic flux density are again acquired in 
separate simulation runs to calculate (σB/BZ0)AVG as well. 
Normalization constant is represented by kstdB. 

𝑄௦௧ௗ஻ =
( ഑ಳ
ಳೋబ)ି( ഑ಳ
ಳೋబ)ಾ಺ಿ
( ഑ಳ
ಳೋబ)ಲೇಸ
∗ 𝑘௦௧ௗ஻

The purpose of the third objective function (4), which is 
composed of QR and QstdB, is to compare and find an optimal 
solution when both QR and QstdB have equal weight. 
Nevertheless, the objective function Qcombined could be 
reformulated based on the design preferences for QR or 
𝑄௦௧ௗ஻ to achieve a different significance of the specific 
objective function.   

𝑄௖௢௠௕௜௡௘ௗ = 𝑎𝑏𝑠(1 −
ொೃ
ொೞ೟೏ಳ)

All objective functions are formulated in such a way that 
they converge to 0 when the resistance (2) decreases, the 
relative uniformity of the magnetic flux density (3) decreases 
and when the two above mentioned function values converge 
to each other (4). Three objective functions form the multi-
objective function Q(r,N), for which the optimizer should find 
a minimum value (5). The optimizer search for the solution in 
the space of the possible parameters, i.e., the objective 
variables. Additionally, constraint of the minimum magnetic 
flux density BZ_min=1mT in the region of Hall sensor from -rmin 
to +rmin is specified to attain sufficient magnetic field. The 
control variables ranges are listed in Table 1. All simulations 
are carried out for a µCoil bias current of 10mA.  

𝑚𝑖𝑛 𝑄(𝑟, 𝑁)

 
Figure 2.  Influence of non-uniformly distributed reference magnetic field 
on the signal error. 
TABLE I.  
OPTIMIZATION PARAMETERS 
Control variable / Constraints 
Symbol 
Lower bound 
Upper bound 
µCoil radius 
r 
10 (µm) 
50 (µm) 
Number of µCoil turns 
N 
1 
3 
76
Copyright (c) IARIA, 2020.     ISBN:  978-1-61208-820-4
SENSORDEVICES 2020 : The Eleventh International Conference on Sensor Device Technologies and Applications

III. 
SIMULATION ENVIRONMENT 
For the simulation purpose, Comsol Multiphysics in 
combination with Solidworks is used. The chart flow of the 
optimization procedure is presented in Figure 4. 
Firstly, a parametrized 3D model of the µCoil is 
constructed in Solidworks according to the recommendation 
of the 0.35µm CMOS technology semiconductor foundry. 
The two most important parameters linked to the Comsol 
Multiphysics simulator are the µCoil diameter r and the 
number of µCoil turns N. The designed 3D model is imported 
into Comsol Multiphysics geometry, where the two 
parameters mentioned above are linked to the control 
variables that are permutated in the predefined range from the 
lower to the upper bound during optimization. The planar 
aluminum µCoil is inserted inside sphere where the 
electromagnetic evaluation takes place. The µCoil that is 
inserted into the sphere within the simulation environment 
with generated mesh is shown in Figure 3. The free tetrahedral 
mesh should be finer at the boundaries of the different 
domains and short edges, while it should be coarser, at other 
locations to avoid memory errors.  Since the optimization 
problem is time independent, the evaluation of the electrical 
characteristics of the 3D µCoil model is performed by the 
Comsol Multiphysics “AC/DC Electromagnetic Fields” 
module with static analysis on the basis of Finite Element 
Method (FEM). This module is suitable for the calculation of 
the µCoil resistance and the generated magnetic field 
distribution, which are the main concerns and have to be 
considered during the optimization process. Simulator 
provides many optimization algorithms, but many of them 
tend to get stuck in local minima, as they iteratively converge 
to the local optimum [5], based on the value of the multi-
objective function from the previous step, as shown in Figure 
5. To overcome this problem, the optimization is performed 
using a Monte Carlo method that randomly sweeps the entire 
parameter search space with uniform distribution of solver 
points independently of the previous step to find global 
optimum. In the optimization interface, multi-objective 
functions (2-5) and an additional constraint of BZ_min are 
specified.  
 
 
Figure 3.  Quality of the mesh dictates accuracy of acquired model 
evaluation.  
 
Figure 4.  Flow chart of the µCoil parameters optimization. 
 
Figure 5.  Local and global optimum. 
During the optimization process the geometry of the µCoil 
is changed based on values of the control variable r and N. 
These two variables are permutated, while the statistical 
distribution of the values of the multi-objective function is 
acquired. The optimizer repeats the simulations as long as it 
does not reach the specified number of iterations. 
 
IV. 
RESULTS 
The optimization of the relatively simple geometry of the 
µCoil in combination with the Monte Carlo algorithm is quit 
time-consuming. In addition, the computing power increases 
exponentially with additional control variables. The optimizer 
therefore only works with the control variables that are 
essential for the optimization, while some parameters are 
evaluated and determined prior to the optimization run, e.g.,  
shape of the µCoil structure, some CMOS technology data 
such as thickness of the specific metal layer, metal material, 
etc.  The design rules specified in Process Design Kit (PDK), 
77
Copyright (c) IARIA, 2020.     ISBN:  978-1-61208-820-4
SENSORDEVICES 2020 : The Eleventh International Conference on Sensor Device Technologies and Applications

within which the µCoil is developed, restrict the design of 
curves in the layout, consequently the planar µCoil consists of 
straight sides only. It can be seen from Figure 6 that variation 
in the number of sides of the µCoil has a negligible effect on 
Bz in the center of the µCoil, while the resistance listed in 
Table 2 decreases as the shape approaches the circumference 
shape. Table 2 summarizes resistivity for µCoil with N=1 and 
r=10µm. With regard to resistance and adoption to the 
maximum dimension of the Hall element, the octagon shape 
is chosen for the optimization process. 
To further reduce the difficulty of the optimization 
process, four optimization runs were performed separately for 
each of the four IC metal layers.  From the Table 3 where 
optimization results are given, it is evident when µCoil turn is 
closest to the Hall sensor, i.e., metal m1, the radius r1 is larger 
than r2 for the higher metal layer m2. This result is expected 
because the variations in magnetic flux density at the edge of 
the coil conductor are at least in the order of 10 greater than 
the variations in the center of the coil. As a result, the standard 
deviation of magnetic flux density in a configuration with a 
small radius and small distance between the source and the 
sensor of the magnetic field is larger compared to the 
configuration using the same distance with a larger radius or 
the same radius but larger distance, which is also shown in 
Figure 7. Figure 7 confirms that at greater distances between 
the source of the magnetic field and sensor course of the BZ 
has flatter behavior compared to the same radius at smaller 
distances. Table 3 lists the number of turns on each metal 
layer, the values of all 3 objective functions and the average 
magnetic flux density BZ on the line from –rmin to +rmin 
regarding the center of the Hall sensor. Resistance Rcoil related 
to QR increases with larger radius or coil turns. Optimization 
without BZ_min constraint results in an optimal solution for the 
radius in the middle radius search space range in combination 
with N=2 which is explained by the fact that the weight of both 
QR and QstdB is normalized. In contrary, optimization with the 
specified BZ_min constraint, which is necessary to fulfill 
requirement of the real-world application, leads to a different 
design realization. Constraint BZ_min cannot be achieved with 
higher metal levels m3 and m4 while m1 and m2 reach the 
desired magnitudes as shown in Table 3. 
 
 
Figure 6.  Magnetic flux density for different µCoil shape realizations 
(r=10µm, N=1). 
TABLE II.  
COIL RESISTANCE FOR DIFFERENT NUMBER OF SIDES 
Number of µCoil sides 
µCoil resistance (Ω) 
4 
4.40  
6 
3.98  
8 
3.84  
10 
3.82  
12 
3.76  
TABLE III.  
OPTIMIZATION SOLUTION 
i 
Metal 
layer 
ri 
(µm) 
N 
QR 
QstdB 
Qcombined 
BZ 
(mT) 
1 
mi 
14.3 
3 
0.253 
0.413 
1.053 
1.017 
2 
mi 
12.2 
3 
0.209 
0.363 
0.998 
1.055 
3 
mi 
10.6 
2 
0.084 
0.049 
0.860 
0.643 
4 
mi 
10.0 
3 
0.159 
0.330 
1.007 
0.646 
 
 
Figure 7.  Magnetic flux density BZ for different distances between 
magnetic field source and sensor (r=10µm, N=1). 
Contribution to the magnetic flux densities of all four 
separately optimized µCoil layers is super positioned and 
verified with an additional simulation using the optimized 3D 
model shown in Figure 8. The total magnetic flux density of 
3.76mT is close to the sum of all BZ values listed in Table 3 
which confirms our assumption.  
 
Figure 8.  Acquired optimized 3D model of the planar µCoil realized at 
four metal layers. 
78
Copyright (c) IARIA, 2020.     ISBN:  978-1-61208-820-4
SENSORDEVICES 2020 : The Eleventh International Conference on Sensor Device Technologies and Applications

The comparison between optimized and non-optimized 
µCoil is shown in Figure 9. The red line represents the non-
optimized µCoil, while the blue line represents the optimized 
design. Both coils are designed to produce approximately the 
same average magnetic flux density BZ=3.76mT. Streamline 
of magnetic flux density in the sphere volume of the 
simulation is shown in Figure 10, while magnetic flux density 
in the region of Hall sensor is shown in Figure 11.   
 
Figure 9.  Comparison between optimized and non-optimized µCoil. 
 
Figure 10.  Streamline of magnetic flux density in the volume of 
simulation. 
 
Figure 11.  Distribution of magnetic flux density in plane of Hall sensor. 
V. 
CONCLUSION AND FUTURE WORK 
The behavior of the planar µCoil used in the ASIC, which 
incorporate temperature compensation of the sensor 
sensitivity, was analyzed. Presented work investigated the 
main disadvantage of on-chip generation of the magnetic field 
and proposed possible solutions obtained by an optimization 
process. The optimization was performed in Comsol 
Multiphysics using the 3D model designed in Solidworks. 3D 
model was optimized in terms of efficiency and performance 
to minimize thermal losses and maximize the magnetic field 
uniformity in the region of interest. The geometry of the 3D 
model was optimized in a range of possible parameters 
specified in the IC process. The multi-objective function and 
the constraints criterion could be modified based on the 
performance preferences of the µCoil in the specific 
application, which would lead to a different geometry of the 
optimized µCoil. Presented results indicated some deviations 
in magnetic flux density between separately optimized planar 
µCoils compared to the µCoil composed of all four planar 
µCoils. The deviations were due to the optimizer precision, as 
a coarser mesh was used in the composed version of µCoil 
otherwise too much memory was allocated for simulation run. 
The future work will focus on reformulating the 3D model 
meshing for a more efficient use of computer memory and a 
reasonable optimization time of more complex 3D structures.    
 
ACKNOWLEDGMENT 
The present work is part of the program “Systems on chip 
with integrated micromechanical, THz, magnetic and 
electrochemical sensors” No. P2-0257 (D) supported by 
Slovenian Research Agency (ARRS). Author would like to 
express gratitude to the LMFE department from the Faculty of 
Electrical Engineering in Ljubljana for expertise to greatly 
contribute to the success of the research. 
 
REFERENCES 
[1] B. J. Darrer, J. C. Watson, P. Bartlett, and F. Renzoni, “Toward 
an Automated Setup for Magnetic Induction Tomography,” 
IEEE Trans. Magn., vol. 51, no. 1, pp. 1–4, Jan. 2015, doi: 
10.1109/TMAG.2014.2355420 
[2] S. H. Kim and K. Ishiyama, “Magnetic robot and manipulation 
for active-locomotion with targeted drug release,” IEEE/ 
ASME Transactions on Mechatronics,” vol. 19, no. 5, Oct. 
2014, pp. 1651-1659, doi: 10.1109/TMECH.2013.2292595 
[3] X. Han, Q. Cao, and L. Li, “Design and Evaluation of Three-
Dimensional Electromagnetic Guide System for Magnetic 
Drug Delivery,” IEEE Trans. Appl. Supercond., vol. 22, no. 3, 
pp. 4401404, Jun. 2012, doi: 10.1109/TASC.2011.2176456 
[4] M. Gradišek and J. Trontelj, “Integrated System Based on the 
Hall Sensors Incorporating Compensation of the Distortions,” 
Adv. Mater. Lett., vol. 11, no. 1, pp. 20011463 (1-4), Jan. 
2020, doi: 10.5185/amlett.2020.011463 
[5] A. Glotić, “Optimization of electrical power network elements 
by using evolutionary algorithms,” Ph.D dissertation, pp. 2-3, 
University of Maribor,” Maribor, 2011, [retrieved: Sep. 2020, 
https://dk.um.si/IzpisGradiva.php?lang=slv&id=18250] 
79
Copyright (c) IARIA, 2020.     ISBN:  978-1-61208-820-4
SENSORDEVICES 2020 : The Eleventh International Conference on Sensor Device Technologies and Applications

