Advanced Modeling of Gas Compressors
for Globally Convergent Stationary Network Solvers
Tanja Clees, Igor Nikitin, Lialia Nikitina
Fraunhofer Institute for Algorithms and Scientiﬁc Computing
Sankt Augustin, Germany
Email: {Tanja.Clees|Igor.Nikitin|Lialia.Nikitina}@scai.fraunhofer.de
Abstract—The simulation of transport networks in civil engi-
neering has become increasingly important for the planning
and stable operation of modern infrastructure. Compressors
are essential elements in gas transport networks; they create
pressure necessary for driving gas towards the consumers. This
paper presents mathematical modeling of gas compressors, taking
into account their individually calibrated physical proﬁles. The
approach is based on conversion of the measured proﬁles into an
explicitly resolved form suitable for globally convergent solvers.
In particular, a proper signature of derivatives for the element
equation of a compressor is provided. The usability of the
approach is demonstrated on a number of real-life network
scenarios.
Keywords–modeling of complex systems; globally convergent
solvers; applications; gas transport networks.
I.
INTRODUCTION
In our previous paper [1], it has been shown that speciﬁc
solvers for generic stationary network problems can be made
globally convergent under special conditions on modeling of
their elements. Stationary network problems combine linear
Kirchhoff’s equations and (generally non-linear) element equa-
tions. The ﬁrst class of equations represents conservation laws,
the second class describes transport. We have shown that
under certain monotonicity conditions on element equations,
i.e., a special signature of the derivatives, the whole system
possesses a globally non-degenerate Jacobi matrix. As a re-
sult, the problem always has exactly one solution. Moreover,
standard algorithms, like Armijo backtracking line search and
Katzenelson piecewise linear tracing, provide convergence to
this solution from an arbitrary starting point.
These ideas have been implemented in our multi-physics
network simulator MYNTS as described in [2], [3]. Con-
sidering gas transport networks, these papers used a simpli-
ﬁed modeling of gas compressors, known in the simulation
community as free compressors. This type of compressors
does not possess limits on their power, only input or output
pressure or gas ﬂow are restricted. The present work extends
the modeling by realistic characteristics to so called advanced
compressors. Such compressors are described by individually
measured physical proﬁles, deﬁning the limits on power,
revolution number, working region, etc. We will show how
to incorporate such realistic characteristics into our globally
convergent solver.
Modeling of gas transport networks has been considered
in full detail in paper [4]. The networks are composed of
a variety of elements (pipes, valves, compressors, drives,
regulators, resistors, etc.), each type possessing a particular
element equation. For instance, the pressure drop in pipes
is described either by an empiric quadratic law [5] or by
more accurate formulae by Nikuradse [6] and Colebrook-
White [7]. Compressors and regulators have a control logic,
implemented in the form of control equations or inequalities
[4], e.g., a compressor/regulator can have a control goal to
keep ﬁxed output pressure, input pressure or ﬂow value. There
are various models for compressors (turbo, piston) and their
drives (gas turbine, steam turbine, gas motor, electro motor),
with characteristic diagrams calibrated on real engines.
The nodal variables (pressure, density, temperature, etc.)
are related by equations of state, including various gas laws
(ideal, Papay, standards of the American Gas Assotiaciation –
AGA and the International Organization for Standardization –
ISO [8], [9]). Gas composition is deﬁned in terms of molar
components and effective gas properties (critical temperature
and pressure, caloriﬁc value, molar mass, etc.), with appropri-
ate equations describing their propagation and mixing. Thermal
modeling [4] includes a number of physical effects (non-linear
heat capacity, heat exchange with the soil, Joule-Thomson
effect, i.e., a temperature drop due to free expansion of gas
through a valve, regulator, etc.).
The obtained system of equations and inequalities is solved
by non-linear programming methods [10], [11]. Due to the
non-linearity of equations, the stability of the solver critically
depends on the choice of the starting point. For this purpose,
various empirical strategies are used [12], [13]. An alternative
has been proposed in our papers [1], [2], employing globally
convergent algorithms, able to ﬁnd the solution from an
arbitrary starting point.
In Section II, we recall conditions on the generic station-
ary network problem, necessary for global convergence, and
concretize these conditions in application to gas transport net-
works. In Section III, we introduce advanced gas compressors.
In Section IV, we present our implementation of advanced
compressor modeling which fulﬁlls the conditions for global
convergence. In Section V, we apply the respective realization
in MYNTS to a number of realistic gas transport network
examples and discuss the results obtained.
MYNTS is a cross-platform application, available on re-
quest from [14].
II.
GLOBAL CONVERGENCE AND GAS TRANSPORT
NETWORKS
A generic stationary network problem can be written as
P
e IneQe = Q(s)
n , n ̸∈ NP , Pn = P (s)
n , n ∈ NP ,
fe(Pin, Pout, Qe) = 0,
(1)
52
Copyright (c) IARIA, 2017.     ISBN:  978-1-61208-567-8
INFOCOMP 2017 : The Seventh International Conference on Advanced Communications and Computation

Figure 1. Test gas transport network N1 with 100 nodes, 111 edges.
where indices n = 1...N denote the nodes and e = 1...E the
edges of the associated network graph, Ine is an incidence
matrix of the graph, Qe are ﬂows through the edges, Q(s)
n
are
source/sink contributions, localized in supply/exit nodes, Pn
are nodal variables (pressure for gas transport networks), P (s)
n
are set values, localized in the subset NP of supply/exit nodes,
at least one value per connected component of the graph. Let
the element equations possess derivatives of the signature:
∂fe/∂Pin > 0, ∂fe/∂Pout < 0, ∂fe/∂Qe < 0. (2)
It has been proven in [1] that the system (1) under condition
(2) possesses a globally non-degenerate Jacobi matrix.
Gas transport networks, e.g., the networks shown in Fig-
ure 1, consist of several types of elements, all possessing the
property (2). The gas networks are mostly composed of pipes
with a non-linear (nearly quadratic) element equation. Some
elements (valves and shortcuts) have linear equations, but
most complex elements (compressors and regulators) possess
piecewise linear equations. According to [13], all continuous
piecewise linear functions can be represented in a max-min
form:
f(x) = maxi minj
X
k
aijkxk + bij,
(3)
where a, b are coefﬁcient lists. In particular, free compressors
are described by the following element equation:
max(min( Pin − ϵPout − ϵQ − PL,
(4)
ϵPin − Pout − ϵQ + PH, ϵ(Pin − Pout) − Q
+QH), Pin − Pout − ϵQ, ϵ(Pin − Pout) − Q) = 0.
The compressor tries to satisfy one of the following con-
trol goals: a speciﬁed pressure on output (SPO), a speci-
ﬁed pressure on input (SPI) or a speciﬁed mass ﬂow (SM).
Being combined with the given upper and lower bounds:
PH = min(SPO, POMAX), PL = max(SPI, PIMIN),
QH = min(SM, MMAX), the element equation deﬁnes a
polyhedral surface shown in Figure 2, top. Here, PH stands
for high pressure limit, PL – low pressure limit, QH – high
ﬂow limit; POMAX is an upper safety bound on output
pressure, PIMIN is a lower safety bound on input pressure,
MMAX is an upper safety bound on the ﬂow. Every face
of the diagram corresponds to the best possible satisfaction of
the control goal, e.g., Pout = PH (typical for SPO-mode),
Q = QH (typical for SM-mode), Pin = Pout (bypass BP,
equivalent to an open valve), Q = 0 (OFF, equivalent to a
closed valve), etc. A small ϵ value is used for regularization
purposes. Every compressor is part of a compressor station, the
simplest one is shown on Figure 2, bottom. This ﬁgure presents
a compressor station with one machine unit, including (in ﬂow
direction) input resistor, compressor, cooler, output resistor,
exit valve, (in an oblique direction) bypass valve, bypass
regulator, both currently closed. In more complex stations,
the compressors with accompanying elements are cascaded to
parallel or sequential conﬁgurations.
III.
ADVANCED MODELING OF GAS COMPRESSORS
In addition to pressure P, the nodes in gas transport
networks possess other common variables, including: ρ – mass
density, T – temperature, z – compressibility factor, µ – molar
mass. In addition to conserving mass ﬂow Q, measured in
kg/s, sometimes volume ﬂow Qx is also considered. It is
measured in m3/s with explicit reference to the measurement
conditions, e.g., Qnorm represents the volume ﬂow under
normal conditions (1 bar, 273.15 K), Qin,out refers to the
volume ﬂow under conditions in the input and output nodes.
Different ﬂow deﬁnitions are related by the formula:
Q = Qnormρnorm = Qinρin = Qoutρout.
(5)
53
Copyright (c) IARIA, 2017.     ISBN:  978-1-61208-567-8
INFOCOMP 2017 : The Seventh International Conference on Advanced Communications and Computation

Figure 2. On the top: control diagram of free compressor. On the bottom: a
compressor station with one typical machine unit.
Advanced compressors bring four new variables: Had – adia-
batic enthalpy increase, ηad – adiabatic efﬁciency, r – revolu-
tion number of compressor drive, W – power of compressor
drive. Also, four equations are added [4]:
Had = RTinzin/(µα) · ((Pout/Pin)α − 1) ,
W = QHad/ηad,
(6)
Had = (1, r, r2) · A · (1, Qin, Q2
in)T ,
ηad = (1, r, r2) · B · (1, Qin, Q2
in)T ,
where R is the universal gas constant, κ the adiabatic exponent,
α = (κ − 1)/κ. A and B are (3x3)-matrices ﬁlled with cali-
bration constants. In addition, working limits for compressors
are deﬁned by the following inequalities:
rmin ≤ r ≤ rmax, ηad ≥ ηmin,
Qin ≥ Qmin, W ≤ Wmax,
(7)
Qmin = (1, Had, H2
ad) · CT ,
Wmax = (1, r, r2) · DT ,
where the constants rmin, rmax deﬁne limits of the revolution
number, ηmin – the lower limit on efﬁciency (so called choke
line; Qmin is a lower limit on the input volume ﬂow (a surge
line), Wmax is an upper limit on power. C, D are (3)-vectors
ﬁlled with calibration constants.
The constants in (A, B, C, D) are found by ﬁtting the
measured data for the compressor considered as part of a
calibration procedure and further represent the individual pro-
ﬁles for this compressor. Here, we described the modeling for
a common class of turbo compressors and gas turbine drive
engines. The other types are simpler in implementation and
can be modeled analogously.
Figure 3 (top) shows proﬁles for a typical turbo compressor.
In this plot, the horizontal axis represents input volume ﬂow
Qin, the vertical axis – adiabatic enthalpy increase Had. Solid
blue curves are the lines of constant revolution number r, their
uppermost curve corresponds to rmax, the lowest curve – to
rmin. The red curve is the surge line Qin = Qmin, while the
rightmost green curve – the choke line ηad = ηmin. The points
in this diagram depict the data measured, a blue cross denotes
the current working point of the compressor.
The equations (6) serve as deﬁnitions of newly introduced
variables, while the inequalities (7) deﬁne the restrictions, in
addition to (4) of those for a free compressor. The upper
bounds r = rmax and W = Wmax deﬁne new upper bounds
for the ﬂow and should be combined with the one deﬁned
by the diagram for a free compressor, shown in Figure 2
top. The lower bounds r = rmin and Qin = Qmin show
the points where the station automatically opens its bypass
regulator, shown in Figure 2 bottom. After that the gas starts
to circulate inside the station, so that the compressor never
violates its bounds. The choke line ηad = ηmin cuts off a
region of unstable calibration related with the small ηad in the
denominator of (6). Usually, the working point of a compressor
is not located in this region, except of the starting procedure.
On necessity the diagram can be continued in this region by
a convenient monotone formula.
If Pin and Pout are ﬁxed and the compressor is on its
r = rmax limit, it is straightforward to resolve the equations
analytically, ﬁnding Had, Qin, ρin, Q, ηad and W, in this
order. If r and Qin are ﬁxed and the compressor is on
its W
= Wmax limit, the equations can be resolved in
the order Had, ηad, Wmax, Q, ρin, Pin, Pout. The ﬁrst
analytic formula gives an explicit representation Q(Pin, Pout)
for the surface, deﬁning a patch of the element equation. The
second one represents the other patch in a parametric form
(r, Qin) → (Pin, Pout, Q). By numerical differentiation, it is
possible to ﬁnd the normals to both surfaces, which directly
deﬁne the signatures of the corresponding patches. We recall
that the correct signature reads (+ − −), see (2). In Figure 3
(bottom) green points show the area of wrong signature. The
54
Copyright (c) IARIA, 2017.     ISBN:  978-1-61208-567-8
INFOCOMP 2017 : The Seventh International Conference on Advanced Communications and Computation

 0
 10
 20
 30
 40
 50
 60
 0
 2
 4
 6
 8
 10
 12
 14
Had
Qin
Figure 3. Advanced modeling of compressors. On the top: typical characteristic
diagram. Solid blue curves are lines of constant revolution number. On the
bottom: stability analysis.
blue curve is the surge line, magenta points show the area
ηad < ηmin. Normally, the unstable green area is cut off by
the surge and choke lines, so that the whole working region
of the compressor is stable. In rare cases, when it is not so,
the surge and choke lines should be modiﬁed accordingly.
IV.
GLOBALLY CONVERGENT IMPLEMENTATION
Figure 4 (top) shows the surface Qadv(Pin, Pout) deﬁned
by the characteristics of the advanced compressor. The cali-
brated part of the surface is located between the curves Qmin
and ηmin and consists of two patches I and II, connected on
the rmax line. Patch I is located between the rmax line and the
origin. Here, the input and output pressures are small and the
Figure 4. Advanced modeling of compressors (cont’d). On the top: control
diagram of an advanced compressor. On the bottom: the same diagram in
afﬁne coordinates and color map representation.
compressor’s performance is limited by its maximal revolution
number: r = rmax. Patch II is located between the rmax and
rmin lines. Here, the pressures are large and the compressor is
limited by the maximal power of the drive: W = Wmax. On
Qmin and rmin curves the surface vertically falls down. This
behavior corresponds to the open bypass regulator. Q in that
case denotes a total mass ﬂow through the compressor and
bypass regulator. The ﬂow through the compressor remains
equal to Qmin or the equivalent ﬂow on the rmin line, while
the negative difference ∆Q circulates through the bypass
regulator. A slope of the vertically falling faces should be
ϵ-regularized to provide the necessary signature (+ − −).
The surface should be continued beyond ηmin curve by any
function supporting the same signature.
Figure 4 (bottom) shows the same diagram as a color map.
Patch II requires a conversion from parametric to explicit rep-
55
Copyright (c) IARIA, 2017.     ISBN:  978-1-61208-567-8
INFOCOMP 2017 : The Seventh International Conference on Advanced Communications and Computation

resentation. For this purpose, we adopt resampling algorithms
well known in computer graphics (CG). At ﬁrst, we perform
an afﬁne transformation:

x
y

=

a
b
0
1
 
Pin
Pout

·
1
Pmax
,
(8)
with a + b = 1. The square on the (x, y)-plane is represented
as a Npx × Npx pixel buffer, storing ﬂoating point values of
Q in double precision. Patches I and II are regularly sampled
and represented as triangle strip sets. Then, the patches are
rendered onto the (x, y)-plane using the Z-buffer algorithm.
Finally, the remaining gaps are ﬁlled by copying a constant
Q-value along the columns and to the right – by a linearly
increasing function in the row. As a result, the Qadv-function
in these regions becomes dependent only on x. Monotonous
increase of Q on the border lines and a choice of afﬁne
coefﬁcients a > 0, b < 0 support correct signature of the
function Qadv(Pin, Pout). If the bypass regulator is activated,
the part above the upper border lines must be reset towards
Q = 0, providing a regularized vertical fall of the surface on
this bound.
The described algorithms provide a transformation from
the calibration coefﬁcients (A, B, C, D) and characteris-
tic diagram in Figure 3 (top) to the tabulated function
Qadv(Pin, Pout), represented by the color map in Figure 4
(bottom). This transformation should be done once per ad-
vanced compressor. For a moment, we use an implementation
of the CG algorithms on Central Processing Unit (CPU) and
plan their acceleration with Graphics Processing Unit (GPU).
In the solver, the lookup function Qadv(Pin, Pout) is made
available via rapid bilinear interpolation of tabulated values
inside the (x, y)-square. It is continued to the whole (x, y)-
plane by an explicit analytic formula:
f(x, y) = f(ˆx, ˆy) + k(min(x, 0) + max(x − 1, 0)),
(9)
ˆx = min(max(x, 0), 1), ˆy = min(max(y, 0), 1),
with a constant k > 0. This global function is constructed
similarly to the continuation formulas in [1]. In our special
case it provides monotonous increase in x and constancy in y
outside of the tabulated region.
Finally, the element equation for an advanced compressor
is obtained by extending (4) as follows:
max(min( Pin − ϵPout − ϵQ − PL,
(10)
ϵPin − Pout − ϵQ + PH, Qadv(Pin, Pout) − Q,
ϵ(Pin − Pout) − Q + QH), Pin − Pout − ϵQ,
ϵ(Pin − Pout) − Q) = 0.
For clarity, the inserted term is underlined.
We have implemented the algorithms described above in
our network simulator MYNTS in a preliminary version (solver
strategy “stable”).
V.
RESULTS
For benchmarking the algorithms, we have received a num-
ber of realistic test scenarios from our partners. The simplest
gas transport network N1 from our test set is shown in Figure 1.
It contains two compressor stations, each equipped with two
machine units, cf. Figure 2 (bottom), working in parallel mode.
It has two supplies and three major consumers. The color
shows the pressure distribution over the network, arrows – the
direction of gas ﬂow, thickness of lines – the diameter of the
pipes. Supplies are shown by rhombi, consumers (n76, n80,
n91) are shown by triangles. The main elements are shown in
the legend.
A closeup to one of the compressors is shown in Figure 2
(bottom), and its characteristics are displayed in Figure 3 (top).
Parameters of more complex networks are presented in Table I.
In particular, medium-sized network N2 contains about a thou-
sand nodes and edges and is equipped with 7 compressors. The
largest considerd network N3 has about ﬁve thousand nodes
and edges and is driven by 25 compressors. Topological con-
nection of elements in the network together with geographic
coordinates, the lengths and diameters of pipes form so called
geometry of the network. Physical setting, such as supply
pressures and consumer ﬂows, control settings of compressors
and regulators, deﬁne scenario for the particular simulation
case. All networks in our test set were simulated with the
same gas composition at 20◦C environmental temperature.
TABLE I. PARAMETERS OF TEST NETWORKS
network
nodes
edges
compressors
N1
100
111
4
N2
931
1047
7
N3
4466
5362
25
In Table II, we compare the performance of the newly im-
plemented algorithms (strategy “stable”) with the performance
of the solver with standard settings. For each network in the
test set two scenarios are considered, with different numerical
values of set points for input pressures and output ﬂows and
compressor/regulator SM, SPO settings. Divergent cases are
marked as ’div’. The number of iterations (iter.) and timing (t)
are given. The simulation is performed on a 3 GHz Intel i7
CPU 8 GB RAM workstation.
TABLE II. COMPARISON OF THE ALGORITHMS
solver strategy
scenario
standard
stable
free
advanced
free
advanced
iter.
t, sec
iter.
t, sec
iter.
t, sec
iter.
t, sec
N1S1
3
0.01
32
0.12
2
0.01
2
0.01
N1S2
57
0.17
70
0.21
11
0.03
4
0.02
N2S1
11
0.27
19
0.64
12
0.31
12
0.37
N2S2
div
–
div
–
13
0.36
15
0.48
N3S1
div
–
div
–
26
3.3
23
3.5
N3S2
47
6.5
div
–
26
3.3
24
3.6
All scenarios are tested both with free and advanced com-
pressor models. We see that the standard solver provides worse
56
Copyright (c) IARIA, 2017.     ISBN:  978-1-61208-567-8
INFOCOMP 2017 : The Seventh International Conference on Advanced Communications and Computation

convergence and even diverges in certain scenarios. Some
scenarios show divergence already for free compressors, some
diverge on advanced ones only. The new algorithm converges
in all cases, in agreement with its theoretical properties. We
also see that the table lookup implemented for advanced
modeling has a negligible computational overhead in strategy
“stable”.
VI.
CONCLUSION
In this paper, we presented mathematical modeling of
gas compressors with their individually calibrated physical
proﬁles. The measured proﬁles are converted to an explicitly
resolved form using algorithms inspired by computer graph-
ics. The control element equation for a free compressor has
been extended by a lookup function representing the working
region of the advanced compressor. The resulting equation
possesses the desired signature of derivatives necessary for
global non-degeneracy of the Jacobi matrix. As a result, the
globally convergent algorithm developed for the solution of
network problems with free compressors remains applicable,
with a negligible computational overhead. The usability of
the approach has been demonstrated for a number of real-life
network scenarios. The algorithm signiﬁcantly overperforms
a standard Newtonian solver in terms of stability, number of
iterations and computational time.
ACKNOWLEDGMENT
This work is supported by German Federal Ministry for
Economic Affairs and Energy, project BMWI-0324019A, Ma-
thEnergy: Mathematical Key Technologies for Evolving En-
ergy Grids.
REFERENCES
[1]
T. Clees, I. Nikitin, L. Nikitina, “Making Network Solvers Globally
Convergent”, in Advances in Intelligent Systems and Computing,
Springer, 2017 (in print).
[2]
T. Clees, N. Hornung, I. Nikitin, L. Nikitina, “A Globally Convergent
Method for Generalized Resistive Systems and its Application to Sta-
tionary Problems in Gas Transport Networks”, In Proc. SIMULTECH
2016, SCITEPRESS, 2016, pp. 64-70.
[3]
T. Clees et al., “MYNTS: Multi-phYsics NeTwork Simulator”, In Proc.
SIMULTECH 2016, SCITEPRESS, 2016, pp. 179-186.
[4]
M. Schmidt, M. C. Steinbach, B. M. Willert, “High detail stationary
optimization models for gas networks”, Optimization and Engineering,
vol. 16, num.1, 2015, pp. 131-164.
[5]
J. Mischner, H.G. Fasold, K. Kadner, System-planning basics of gas
supply, Oldenbourg Industrieverlag GmbH, 2011 (in German).
[6]
J. Nikuradse, “Laws of ﬂow in rough pipes”, NACA Technical Memo-
randum 1292, Washington, 1950.
[7]
C. F. Colebrook and C. M. White, “Experiments with Fluid Friction
in Roughened Pipes”, in Proc. of the Royal Society of London, Series
A, Mathematical and Physical Sciences, vol. 161, num. 906, 1937, pp.
367-381.
[8]
J.
Saleh,
ed.,
Fluid
Flow
Handbook,
McGraw-Hill
Handbooks,
McGraw-Hill, 2002.
[9]
DIN EN ISO 12213-2: Natural Gas – Calculation of compression factor,
European Committee for Standartization, 2010.
[10]
A. W¨achter and L. T. Biegler, “On the implementation of an interior-
point ﬁlter line-search algorithm for large-scale nonlinear program-
ming”, Mathematical Programming, vol. 106, num. 1, 2006, pp. 25-57.
[11]
R. Fletcher, Practical Methods of Optimization, Wiley, 2013.
[12]
M. Schmidt, M. C. Steinbach, B. M. Willert, “High detail stationary
optimization models for gas networks: validation and results”, Op-
timization and Engineering online, 2015, DOI: 10.1007/s11081-015-
9300-3
[13]
A. Griewank, J.-U. Bernt, M. Radons, T. Streubel, ‘Solving piecewise
linear systems in abs-normal form”, Linear Algebra and its Applica-
tions, vol. 471, 2015, pp. 500-530.
[14]
Multiphysical Network Simulator MYNTS,
www.scai.fraunhofer.de/en/products.html
57
Copyright (c) IARIA, 2017.     ISBN:  978-1-61208-567-8
INFOCOMP 2017 : The Seventh International Conference on Advanced Communications and Computation

