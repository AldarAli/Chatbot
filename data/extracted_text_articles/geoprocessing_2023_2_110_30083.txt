Towards Accurate Traceability of Water Reaching the Reservoirs 
Ortega, L.  
Department of Computer Science 
University of Jaen 
Jaen, Spain. 
lidia@ujaen.es 
Ramos, M.I.                                                    
Department of Cartographic Engineering, Geodesy and 
Photogrammetry.                                                      
University of Jaen
Jaen, Spain.                                                
miramos@ujaen.es 
Calle, A.
Researcher hired in project PYC20-RE-005-UJA 
University of Jaen. 
Jaen, Spain. 
acm00225@red.ujaen.es 
Abstract— Drinking water is one of the natural resources most 
consumed by human beings and an important transmitter of 
diseases if it is not subjected to adequate quality controls. In 
Spain, much of the drinking water comes from reservoirs 
whose watershed is often occupied by farms. This means that 
part of the reservoir water has been in contact with 
phytosanitary products used on these farms. In this work, a 
methodology is being developed to determine the origin of the 
water flow that reaches certain areas of the reservoir. It is a 3D 
modelling and simulation methodology for the advance of the 
flow after a given rainfall event. To this end, work is being 
carried out on an improved version of the D8 algorithm, in 
which an extensive hydrological analysis is carried out, 
allowing more input parameters to be controlled in a more 
detailed manner. This allows 3D modelling and simulation of 
the rainwater trajectory until it reaches the reservoir.  
Keywords- Extended D8 algorithm; Drainage Network,; 
Chemical Monitoring. 
I.
INTRODUCTION 
The use of crop protection products in agriculture is a 
common practice in agriculture to increase crop yields. 
However, the extensive use of these products mainly affects 
the soil, and sooner or later these substances end up in rivers 
and aquifers. In some countries in the Mediterranean basin, 
many rivers and aquifers flow into reservoirs whose water is 
also used for irrigation and human consumption. Soil 
conservation is therefore a key point for obtaining good 
agricultural yields and at the same time eliminating 
dependence 
on 
chemicals. 
Technicians 
and 
public 
administrations are looking for effective mechanisms to 
control these discharges and to carry out water traceability, 
especially in the case of water intended for human 
consumption. At present, the use of chemicals is not banned 
in agriculture or in the European Union (EU). They are 
widely used to fertilize the soil or to eradicate pests. In fact, 
it is difficult to find a balance between increasing production 
and preserving the environment. Food supply and food 
security are key objectives at EU and United Nations level. 
A number of organizations have committed themselves 
in the coming years to address efficient soil management to 
meet the major challenge of increasing food production 
while minimizing soil degradation through sustainable 
development plans. In this regard, the 2030 Agenda and the 
Sustainable Development Goals (SDGs) adopted by all 
United Nations (UN) member states in 2015 call on all 
nations to combine economic prosperity, social inclusion and 
environmental sustainability with peaceful societies. They 
are closely linked to the Paris Agreement (United Nations, 
2015) on climate change, which is incorporated into SDG 13 
(Climate Action). These goals and targets entered into force 
on 1 January 2016 and will guide government decisions in  
the coming years. 
The present work focuses on developing a methodology 
for the traceability of rainwater reaching a reservoir and 
determining its possible origin considering the crop areas of 
the basin it supplies. Specifically, the study focuses on the 
water reaching the Rumblar reservoir in the province of Jaen 
(southern Spain). This reservoir is mainly fed by river water 
from the Guadavelín and Pinto rivers. This reservoir supplies 
drinking water to a large part of the inhabitants of the 
province of Jaen. The water from this reservoir is subject to 
quality controls by governmental companies, which carry out 
regular chemical analyses. The company's technicians have 
observed that, after a period of rain, the chemical analyses 
reveal a higher concentration of nitrates. These components 
come mostly from olive groves, which are predominant 
throughout the catchment area. Therefore, an exhaustive 
study on the origin of the discharges should involve the study 
of the catchment basins, land use and orography of the 
terrain. Drainage networks have been used to study chemical 
tracing [1], as well as GIS techniques [2]. However, 3D 
simulations have also been used for similar purposes [3], but 
employed as stand-alone techniques. 
In this work, an improvement of the D8 flow model 
algorithm is being developed in order to establish a 
workflow in which different scenarios can be simulated in 
the course of rainwater from its precipitation to its arrival at 
the reservoir. This simulation is also used to determine the 
concentration of substances at specific locations and to make 
a comparison with the agricultural use of the land. In this 
aspect, GIS tools provide the capacity to cross-reference all 
79
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-079-7
GEOProcessing 2023 : The Fifteenth International Conference on Advanced Geographic Information Systems, Applications, and Services

this information on the drainage network with the different 
land uses and to be able to focus the analysis on specific 
farms. 
The document is structured as follows. Section 2 
describes the methodology carried out and the data 
processing carried out jointly in QGIS and the D8 algorithm 
enhancement. Section 3 shows the first results with a plugin 
that has been implemented in Qgis to make it easier to use 
the extended D8 algorithm. Section 4 describes the 
conclusions and future work to be developed. 
II.
METHODOLOGY
This section describes the process to obtain the 
traceability of water runoff along its path to the reservoir. 
The objective is to know which areas the rainwater comes 
from and arrives at specific points in the river basin that 
finally discharge their water into the reservoir. The aim is 
also to obtain the percentage of water that each of these areas 
contributes to the points under study. It is important to know 
whether this origin is agricultural or not in order to be able to 
carry out a more detailed study of the areas that contribute 
water to the reservoir. Therefore, this study helps to identify 
which farms contribute to the concentration of discharges or 
make inappropriate use of fertilizers or plant protection 
products. Fig. 1 shows schematically the process. The first 
two steps identify a series of representative points on which 
to focus the study and in the second phase (steps 3 and 4) a 
detailed study of the traceability of the water flow in these 
representative points will be carried out.  
Figure 1. Flow diagram of the methodology proposed. 
A.
Research Area 
The study was carried out in the area around the Rumblar 
reservoir, which is a storage reservoir built on the course of 
the river of the same name (38°09′42″N 3°48′15″
W, ETRS89), in the municipality of Baños de la Encina, in 
the province of Jaen, southern Spain. This region has a semi-
continental climate with a mean annual temperature of 
25.1ºC, a mean relative humidity of 70% and a mean annual 
precipitation of 1341 mm. The capacity of the reservoir is 
126 hm³ although it is currently at 16 % of its capacity [4]. 
The reservoir is located in the heart of the Sierra Morena 
mountain range, surrounded by Mediterranean woodland 
with holm oaks and cork oaks, and is an ideal habitat for 
species such as the Iberian lynx. In the surrounding area it is 
possible to observe a large group of birds of prey and 
carrion-eating birds, as well as some mammals such as 
otters, foxes and huntable species such as mouflon, fallow 
deer, wild boar and deer. A few kilometers from the 
reservoir, the relief and vegetation change considerably, with 
olive groves alternating with hilly pastures where wild cattle 
graze. For the purpose of our research, we covered an area of 
56497 ha. Fig. 2 shows the location where the research has 
been carried out. 
B.
Data set 
In the first phase of the work, the hydrographic elements 
of the study area were obtained from the Digital Elevation 
Model with a spatial resolution of 2x2m that forms part of 
the Spanish Spatial Data Infrastructure (IDEE) platform 
which follows INSPIRE Regulation (EC) No 1205/2008. 
This model was downloaded from the Download Center of 
the Autonomous Section of the National Center for 
Geographic Information [5]. It is a model obtained by 
interpolation from the terrain class of the LIDAR flights of 
the 
second 
coverage 
of 
the 
National 
Aerial 
Orthophotography Plan (PNOA) [6]. Another important 
layer of information to be integrated into the system and 
which will allow the identification of areas to monitor the 
dumping of phytosanitary products is that of land use in the 
Rumblar basin. The land uses established in the information 
layer have been obtained from the information compiled by 
CORINE Land Cover, a cartographic inventory of land use 
and a basic instrument in environmental and land-use 
planning policy in the EU. 
C.
D8 extended 
The D8 method for obtaining the drainage network needs 
the DEM (Digital Elevation Model in tiff format) file of the 
area associated with the reservoir basin. This process works 
similarly to the D8 algorithm introduced by O’Callaghan and 
Mark [7].  Initially, the method codifies in each cell C(i,j) 
one of the eight directions where C(i,j) drains its water 
accumulation. Then, an iterative process makes in parallel 
that all cells drain their accumulated water to its neighboring 
cell, depending on this specific direction. The process 
finishes when no more water is drained along an entire 
iteration.  Those specific points whose accumulated water 
exceeds a threshold (RP_threshold in Figure 1) at any 
moment of the process, are considered representative points 
(RP). The set of RPs is the input of this first process, which 
in fact works similarly to the original D8 method. However 
in a second phase, the algorithm is processed again and for 
each representative point and for each iteration of the 
process, the following information is stored in a set of tuples 
<id-plot is the identification number of the plot and 
accumulated-water the amount of water from this plot>.  
There is one tuple for each different plot pouring water 
sooner or later into this RP. The plot is represented by a 
80
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-079-7
GEOProcessing 2023 : The Fifteenth International Conference on Advanced Geographic Information Systems, Applications, and Services

specific identification number, and for each of these plots we 
maintain information about the water traversing the RP. The 
algorithm 
finds 
these 
representative 
points 
(RP) 
automatically, however the user can add specific ones (RPA) 
if additional strategic locations are decided to be used for 
chemical analysis. This information is the input for further 
processing that can be done in QGIS.  
Figure 2. Location of the research area. The left image represents the south of Spain (Andalusia). The right image is the map of the Rumblar reservoir in 
Jaen. The coordinates (m) are UTM, zone 30 referred to ETRS89.
III.
RESULTS
Once the extended algorithm has been implemented, the 
idea is to be able to identify a drainage network according to 
different previously established conditions, Fig.3. 
. 
Figure 3. Interface to the main menu of the system in which the 
extended D8 algorithm has been implemented. 
First of all, our algorithm needs the DEM and the land 
use layer of the working area, which is necessary information 
to be able to carry out the traceability analysis, which is the 
main subject of this work. Secondly, an interesting 
functionality is to be able to add new RPs to the system, not 
only those generated by the classical D8. 
On the other hand, the classical D8 algorithm simulates 
the same amount of precipitation at each pixel. However, in 
the extended version of the algorithm, the amount of 
precipitation is also an input parameter depending on the 
areas. From the zonal cumulative precipitation maps, each 
pixel can be assigned a different precipitation value, which is 
very interesting when working with large areas of land, as 
the amount of precipitation is different in each zone. It is also 
possible to define different levels of water absorption by the 
soil, depending on the underlying soil type. The absorption 
capacity of the soil depends not only on the slope extracted 
from the DEM, but also on the type of material on which it 
rains.  
The number of iterations is another input variable of the 
extended algorithm. This parameter controls the whole 
execution process of the algorithm. By default it runs 
completely, until the rainwater runoff ceases. But it is 
possible to set a certain number and control the progress of 
the process at intermediate stages. It will also be possible to 
overlay land use and query the system to see which areas 
have received the most rainwater. An Qgis plugin has also 
been implemented to allow interaction between the user and 
the system. The system automatically selects on the map the 
plots that have contributed water to that point, and the 
percentage that it represents with respect to the total water 
accumulated in it. 
In this case, a provisional result can be displayed. Fig. 4, 
which shows a screenshot in which it can be seen how, when 
clicking on a characteristic point, the algorithm identifies
81
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-079-7
GEOProcessing 2023 : The Fifteenth International Conference on Advanced Geographic Information Systems, Applications, and Services

Figure 4. Example of a query executed with the Plugin. 
from which plots the water that has reached that point comes 
from, and the information related to each plot. This 
information is essential for water treatment plant managers, 
since by analysing water samples in specific areas, if they 
detect abnormal values of certain chemical substances, they 
will be able to know from which farms these pollutants may 
be arriving.  
Finally, it will be possible to consult from which areas 
rainwater reaches the reservoir and which are absorbed by 
the soil and do not reach it. It is therefore a question of 
having a system in which we can use different configuration 
parameters of the drainage network to achieve the most 
accurate traceability possible of the water that reaches the 
reservoir, with the added value of using an easy-to-use 
application. 
IV.
CONCLUSIONS
In this work, a methodology has been developed to 
determine the origin of the water flow that arrives at certain 
points in the reservoir basin. It is a methodology for 
modelling and simulating the advance of the flow once it has 
rained using an improved version of the D8 algorithm. The 
resulting developed work is an easy to use tool by managers 
of drinking water treatment stations. The spatial information 
uploaded into a GIS software joined to the run of the 
extended D8 algorithm helps us to extract information about 
the study area with just one click on the screen. The 
algorithm is still undergoing debugging and validation. It 
needs to be tested against field data in different parts of the 
study area. However, the tests carried out so far show 
promising results. 
ACKNOWLEDGMENT
This research has been partially funded through the 
research projects PYC20-RE-005-UJA, 1381202-GEU and 
which are co-financed with the European Union FEDER and 
the Junta de Andalucía funds. Also partially supported by the 
Spanish Ministry of Science and Innovation, the European 
Union (via ERDF funds) through the project PID2021-
126339OB-I00.  
REFERENCES
[1]
Williams, M.R.; King, K.W.; Fausey, N.R. “Drainage Water 
Management Effects on Tile Discharge and Water Quality”. 
Agricultural Water Management, vol. 148, pp. 43–51, 2015, 
doi:https://doi.org/10.1016/j.agwat.2014.09.017. 
[2] Habeeb, N.J.; Weli, S.T. “Combination of GIS with Different 
Technologies for Water Quality: An Overview”. HighTech and 
Innovation Journal  vol.  2, n. 3, pp. 262–272, 2021, 
doi.org/10.28991/HIJ-2021-02-03-1.0.
[3]
Karandish, F.; Darzi-Naftchali, A.; Šimůnek, J. “Application of 
HYDRUS (2D/3D) for Predicting the Influence of Subsurface 
Drainage on Soil Water Dynamics in a Rainfed-Canola Cropping 
System”. Irrigation and Drainage, vol. 67, pp. 29–39, 2018  
doi:https://doi.org/10.1002/ird.2194. 
[4]
Ministerio de agricultura, pesca y alimentación Digitisation Strategy 
for the Agri-Food and Forestry Sector and Rural Areas; Estrategia de 
Digitalización del Sector Agroalimentario y Forestal y del Medio 
Rural; 2020.  
[5]
Centro de Descargas del CNIG (IGN) [Online]. Avalilable from 
http://centrodedescargas.cnig.es/CentroDescargas/linkUnMD 
2022.07.06.  
[6]
Plan Nacional de Ortofotografía Aérea [Online]. Available from  
http://pnoa.ign.es/estado-del proyecto-lidar. 2022.07.06. 
[7] O’Callaghan, J.F.; Mark, D.M. “The Extraction of Drainage Networks 
from Digital Elevation Data”. Computer vision, graphics, and image 
processing vol. 28, pp. 323–344. 1984. doi.org/10.1016/S0734-
189X(84)80011-0.
82
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-079-7
GEOProcessing 2023 : The Fifteenth International Conference on Advanced Geographic Information Systems, Applications, and Services

