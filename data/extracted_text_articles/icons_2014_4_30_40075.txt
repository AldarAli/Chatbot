A Matching Problem in Electricity Markets using Network Flows
Ryo Hase and Norihiko Shinomiya
Dept. of Information Systems Science
Soka University
Tokyo, Japan
{e1052105, shinomi}@soka.ac.jp
Abstract—This paper proposes a many-to-one matching algo-
rithm between sellers and buyers in a deregulated electricity
market model that can deal with the limited amount of supply
of electricity. Our matching algorithm aspires safe supply of
electricity and maximization of social welfare, which indicates
overall satisfaction of participants in the markets. In order to
satisfy these goals, the matching mechanism is developed based
on the concept of a maximum ﬂow problem in graph theory.
Additionally, the piled knowledge in the ﬁeld of economics about
matching in markets is also applied into design of this algorithm.
Simulation results shows that this algorithm can ﬁnd whether
there is the maximum many-to-one matching in a given model
of electricity market or not.
Keywords—bipartite graph; buyer-seller networks; many-to-one
matching; maximum ﬂow problem; social welfare.
I. INTRODUCTION
Many countries have constructed electricity grids with cen-
tralized structure, in which a few sellers generate electricity
and supply it. This structure has arisen from need for providing
electricity to buyers safely. Generators in that system must
be responsible for safe supply, and they can get adequate
remuneration for this responsibility.
The main concerns of electricity buyers are both safe supply
and low prices. Recently, failures in the electricity grids have
been decreasing more than ever [1]. Thus, the requests of
buyers for reducing the electricity prices become more re-
markable. However, some problems exist in electricity markets
on the centralized electricity grids. First, the sellers do not
tend to reduce the prices because they have few competitors.
Second, buyers are doubtful about transparency of current
prices because no buyers have sellers who can be compared
with current sellers.
Recently, there have been some actions for restructuring
electricity markets in many countries [1], and deregulation
of the electricity market is one of them. This action aims to
construct more competitive markets, which are expected to
bring technological innovation and lower prices.
In deregulated electricity market, a Power Producer and
Seller (PPS) conducts retail of electricity by using electricity
grids owned by other generators. The PPS has small capacity
to generate electricity; hence, they must get electricity from
another generator when demand is beyond own capacity. PPS
cannot get electricity as much as they want because they will
face a severe business situation if they continue to do that.
Although buyers want to get the electricity from a seller
offering a lower price than the others, some buyers cannot
contract with such a seller if demand for the seller exceeds
its capacity [2]. These buyers must pay higher costs to get
electricity from one of the other sellers. In this situation, it
is realized that some buyers who can purchase the electricity
from the cheapest seller may be satisﬁed, but the satisfaction
of the others will be diminished.
This research proposes an algorithm to ﬁnd a matching
between sellers and buyers in a static model of an electricity
market. By changing prices offered by sellers in high demand,
the algorithm tries to ﬁnd the prices that satisfy all supply and
demand, and give the highest social welfare to us.
In Section II, some related works are introduced. Section III
explains deﬁnitions of methods used in this research. Section
IV proposes an algorithm that ﬁnds a matching between the
seller and the buyer. Section V discusses simulation results,
and Section VI consists of conclusion and future work.
II. RELATED WORK
In 1962, Gale and Shapley discussed a stable marriage
problem and a college admissions problem [3]. The stable
marriage problem is a classic problem of one-to-one matching,
and the matching is called perfect matching when the number
of elements is the same on both sides of the matching. The
objective of the college admissions problem is to ﬁnd a proper
matching between colleges and students. Colleges have the
capacity to accommodate some students, and, on the other
hand, students must be linked to only one college; thus, this
type of matching is called many-to-one matching.
After the research done by Gale et al. [3], various researches
on matching problems have been conducted. A model of
matching problems can be represented as a bipartite graph;
hence some researchers consider the matching problems based
on graph theory.
Matching market is a method that constructs a matching
between sellers and buyers in the networked market with a
pricing mechanism, and this method is explained by Easley
and Kleinberg [4]. The network used in matching market is
described as a buyer-seller network that is discussed in [5].
The utilization of this type of network provides two merits.
First, a buyer can choose a seller independently based on its
evaluation of the seller. This is practical for the use in real
markets because the markets do not ever have the central
coordination of the choice of buyers. Second, efﬁciency of the
market can be examined by social welfare, which is the total of
utilities of all market participants. Even though both matching
market and general economics deal with markets, they differ
in network structure because matching market does not use
79
Copyright (c) IARIA, 2014.     ISBN:  978-1-61208-319-3
ICONS 2014 : The Ninth International Conference on Systems

anonymous networks. Matching market deals with networks
that has typical structure, in which there are some buyers,
sellers, and links between them. Thus, matching market shows
how market participants affect each other in the network.
In an ordinary method of matching market, sellers and
buyers deal with a single item, and the matching algorithm pro-
posed by [4] constructs only perfect one-to-one matching. This
paper proposes an algorithm ﬁnding a many-to-one matching
in which all buyers and sellers deal with different quantity of
electricity. For that reason, this paper integrates methods of
a feasible ﬂow problem and a single-source unsplittable ﬂow
problem with the matching market algorithm. A feasible ﬂow
problem is an application of a maximum ﬂow problem that
ﬁnds whether there is network ﬂow that satisﬁes supply and
demand of every node or not [6]. This problem is solved by
a circulation problem explained by Jungnickel [7]. Besides, a
single-source unsplittable ﬂow problem ﬁnds the paths from a
source to sinks in a network [8][9][10].
III. DEFINITIONS
This section explains deﬁnitions on network structure and
methods used in this research. In this paper, it is assumed that
electricity does not decrease anywhere in market models.
A. Market Settings of Sellers and Buyers
This subsection discuses property of the networked elec-
tricity market model. A buyer-seller network is represented as
a bipartite graph containing two node sets. One is a set Ns
containing sellers si (1 ≤ i ≤ n), and the other is a set Nb
consisting of buyers bj (1 ≤ j ≤ m); thus, the sizes of Ns
and Nb are |Ns| = n and |Nb| = m.
Each seller si and buyer bj has its supply capacity ci
and consumption quantity qj respectively. Let cmin be the
minimum supply capacity of all sellers, and let qmax be the
maximum consumption quantity of all buyers; then, as in other
researches that consider the single-source unsplittable ﬂow
problem, cmin and qmax must satisfy qmax ≤ cmin. In addition,
for safe supply, qj and ci must satisfy ∑m
j=1 qj ≤ ∑n
i=1 ci.
In the rest of this subsection, valuation, price, and payoff
will be deﬁned based on the theory of [4]. Deﬁnitions of these
variables in [4] consider only single item. However, electricity
is not a single item. Then, this paper extends deﬁnition of these
variables to deal with different unit of electricity.
bj decides valuation vj (vj ≥ 0), which is the maximum
acceptable price of one unit of electricity for bj. The valuation
is also called reservation price [11]. Additionally, every buyer
has distinct valuation value, and all participants of the market
do not act cooperatively; hence, valuation of one buyer is
private information for the other buyers. Furthermore, si offers
a price of one unit of electricity pi (pi ≥ 0) to all buyers.
si and bj have a payoff u(si) and u(bj) respectively. As in
[4], even though payoff of a seller is generally calculated by
subtracting supply cost from sales, for simplicity, all sellers
produce electricity at zero cost in our model. Therefore, if si
sells y(si) units of electricity to buyers, u(si) will be
u(si) = piy(si).
(1)
In terms of buyers, ubjsi represents payoff of bj for one
unit of electricity offered by si; hence, ubjsi is deﬁned as
ubjsi = vj − pi.
(2)
Because bj needs to calculate payoffs towards each seller si
with valuation vj, let ubj be a payoff vector of bj, such that
ubj := (ubjs1 ubjs2 · · · ubjsn).
(3)
Consequently, if bj purchases y(bj) units of electricity from
si, the payoff of bj will become
u(bj) = ubjsiy(bj).
(4)
B. Structure of a Preferred-Seller Graph
A preferred-seller of a buyer bj is sellers si whose price
pi brings max(ubj). However, if max(ubj) ≤ 0, there is
no preferred-seller for bj. Each buyer purchases electricity
from its preferred-sellers; in addition, for simplicity, no buyer
purchases electricity from more than one seller in our model.
A preferred-seller graph is an undirected bipartite graph
denoted by G (Ns ∪ Nb, E), in which an edge set E contains
edges between every buyer and its preferred-sellers; therefore,
a preferred-seller graph represents possible pairs between
buyers and sellers in a market represented by G.
Figure 1.
A preferred-seler graph (|Ns| = 3, |Nb| = 3).
In the graph G of Figure 1, the payoff of all buyers for
both s1 and s2 is the maximum payoff, and the payoff of all
buyers for s3 is lower than the payoff for s1 and s2. As a
result, Figure 1 has edges between every buyer and s1 or s2,
and does not have edges between every buyer and s3.
C. Flow Maximization on a Graph
Our algorithm realizes search for a many-to-one matching
M on G. For this purpose, algorithm converts G into a directed
graph H ((o ∪ t ∪ Ns ∪ Nb), A), and considers a feasible
circulation problem on H to ﬁnd the ﬂow that satisﬁes supply
capacity of all sellers and consumption quantity of all buyers.
(a) A model of H.
(b) A model of H′.
Figure 2.
Graphs changed from the preferred-seller graph in Figure 1.
Any G can be converted to H by three steps. First, remove
nodes whose degree is equal to zero, and add two nodes o
and t. Second, make arcs (o, si) for all i, arcs (bj, t) for all
j, and an arc (t, o). Finally, change all edges in E to arcs
(si, bj) ∈ A (let A be an arc set including all arcs in H). For
instance, G in Figure 1 can be converted to H in Figure 2 (a).
Feasible circulation on H must satisfy following two con-
straints. One is a capacity constraint on every arc in H, and
the other is a mass-balance constraint on every node in H.
80
Copyright (c) IARIA, 2014.     ISBN:  978-1-61208-319-3
ICONS 2014 : The Ninth International Conference on Systems

First, as the capacity constraint, every arc (v, w) ∈ A must
have capacity of xvw that is a nonnegative value of ﬂow on
(v, w). Additionally, let ub(v, w) and lb(v, w) be upper and
lower bound of xvw respectively; therefore, xvw must satisfy
lb(v, w) ≤ xvw ≤ ub(v, w).
(5)
Figure 3 (a) shows a ﬂow value xvw on an arc (v, w).
(a) The ﬂow on (v, w).
(b) A model to show (10).
Figure 3.
The ﬂow notation and mass-balance constraint.
For any i, lb(o, si) = 0, and ub(o, si) = ci. By (5),
0 ≤ xosi ≤ ci.
(6)
In addition, for any j, lb(bj, t) = qj, and ub(bj, t) = qj; hence,
xbjt = qj.
(7)
In terms of (t, o), lb(t, o) = 0, and ub(t, o) = +∞. Therefore,
0 ≤ xto ≤ +∞.
(8)
As in (t, o), lb(si, bj) = 0, and ub(si, bj) = +∞; Thus,
0 ≤ xsibj ≤ +∞.
(9)
Second, to consider the mass-balance constraint, difference
function d(v) is utilized. d(v) is denoted by
d(v) =
∑
{w:(v,w)∈Ak}
xvw −
∑
{w:(w,v)∈Ak}
xwv.
(10)
For any node v ∈ (o∪t∪Ns ∪Nb), d(v) represents difference
between ﬂow values current into v and current from v, and
d(v) must satisfy d(v) = 0. For instance, in Figure 3 (b), d(o)
must satisfy d(o) = xos1 + xos2 − xt′o = 0.
The feasible circulation problem on H can be solved
by using general methods of a maximum ﬂow problem by
changing H into H′((t′ ∪ o ∪ t ∪ Ns ∪ Nb), A′). Any H can
be converted to H′ by following steps. First, add a node t′ to
H, and remove an reverse arc from H; then, add an arc (t′, o)
to H. For instance, H in Figure 2 (a) is converted to H′ in
Figure 2 (b). In terms of capacity bounds, lb(t′, o) = 0, and
ub(t′, o) = ∑m
j=1 qj. Hence, xt′o must satisfy
0 ≤ xt′o ≤
m
∑
j=1
qj.
(11)
To obtain the maximum ﬂow on H′, the algorithm solves
following objective function with (6), (7), (8) and (11).
Maximize
xt′o.
(12)
D. Construction of Unsplittable Flow
Even though the algorithm ﬁnds ﬂow that satisﬁes (12), this
ﬂow does not necessarily construct a many-to-one matching.
In Figure 4, both t′ −o−s1 −b2 −t and t′ −o−s2 −b2 −t are
Figure 4.
A model shows the constraint of unsplittability.
possible t′-t paths, and this ﬂow is called splittable ﬂow if both
of these paths supply electricity to b2. However, only one t′-t
path must be selected to supply electricity to b2 because no
buyer can purchase electricity from more than one seller in our
model; therefore, if the maximum ﬂow is splittable ﬂow, this
ﬂow must be changed into unsplittable ﬂow by an algorithm
proposed in [9]. This algorithm ﬁnds alternating cycles and
adjusts ﬂow on these cycles to get unsplittable ﬂow.
In Figure 4, let o − s1 − b2 − s2 − o be an alternating cycle.
In this alternating cycle, o − s1 − b2 is a forward path, and
o − s2 − b2 is a backward path. Then, the algorithm decreases
ﬂow on the forward path, and augments ﬂow on the forward
path until ﬂow on the forward path becomes zero.
E. Social Welfare with Flow Notation
Figure 5 (a) shows unsplittable ﬂow on H′ in Figure
2 (b). Because of the assumption that electricity does not
(a) Unsplittable ﬂow.
(b) A matching.
Figure 5.
Unsplittable ﬂow and a matching on H′ in Figure 2 (b).
decrease anywhere in our model, in Figure 5 (a), t′-t path
through (si, bj) represents a transaction in which bj purchases
electricity from si. Furthermore, xsibj represents quantity of
electricity in the transaction between si and bj. Thus, a many-
to-one matching M between sellers and buyers can be acquired
by extracting all arcs (si, bj) from the unsplittable ﬂow. The
matching M is shown in Figure 5 (b).
In Section III-A, both y(si) and y(bj) are deﬁned as units
of electricity in transactions of an electricity market. By using
the ﬂow notation, y(si) can be described as
y(si) =
∑
{v:(si,v)∈A}
xsiv.
(13)
By assigning (13) to y(si) in (1), payoff of si is described by
u(si) = pi
∑
{v:(si,v)∈A}
xsiv.
(14)
Moreover, if bj purchases electricity from si, y(bj) will be
y(bj) = xsibj.
(15)
Therefore, (4) can be changed by
u(bj) = ubjsixsibj.
(16)
Social welfare is deﬁned as the total of all payoffs of buyers
and sellers in a market; therefore, by summing up (14) and
(16) for all buyers and sellers in an electricity market model,
the social welfare of the model can be derived. Thus, social
welfare of an electricity market model is represented by
W =
n
∑
i=1
u(si) +
m
∑
j=1
u(bj).
(17)
For instance, social welfare W of the matching M in
Figure 5 (b) is calculated in the following manner. s1 supplies
electricity to b1 and b3. Hence, u(s1) = p1xs1b1 + p1xs1b3. In
terms of s2, u(s2) = p2xs2b2. b1 and b3 purchase xs1b1 units
of electricity from s1; thus, u(b1) = ub1s1xs1b1 and u(b3) =
ub3s1xs1b3. Besides, u(b2) = ub2s2xs2b2. Therefore, the social
81
Copyright (c) IARIA, 2014.     ISBN:  978-1-61208-319-3
ICONS 2014 : The Ninth International Conference on Systems

welfare will be W = u(s1) + u(s2) + u(b1) + u(b2) + u(b3).
IV. A MATCHING ALGORITHM
This section proposes an algorithm described below, which
brings us to a matching between sellers and buyers.
Input: |Ns|, |Nb|, ci, pi, qj, and vj for all i, j.
Output: Updated prices and a many-to-one matching.
Seven steps of the algorithm:
1. Set the round number k = 0 when the algorithm starts.
Construct G at round k, which is denoted by Gk, and let
Ek is an edge set E of Gk. The algorithm terminates if
there is one or more buyers that have no incident edges.
2. Convert Gk into H′
an arc set A in H′ k that is H′ at round k, and let Ak be
k.
3. Let Mk be the matching at round k. Discover Mk by
solving the maximum splittable ﬂow problem on H′
k. If
there is feasible splittable ﬂow, let this ﬂow be called F. If
there is not any feasible splittable ﬂow, proceed to step 7.
4. Find alternating cycles in splittable ﬂow F until no alternat-
ing cycles can be discovered in F; subsequently, augment
or decrease ﬂow along the alternating cycles.
5. Let Mmax be a many-to-one matching that is feasible and
maximizes social welfare. If Mk is Mmax, the algorithm
terminates. The prices bring us to M are called market-
clearing prices. If Mk is not Mmax, raise prices of sellers
in H′
k by one unit.
6. Let Wk be social welfare derived from (17) on Mk.
7. Set k = k + 1, and back to the step 1 to start next round.
Before the algorithm starts, input must be initialized. The
algorithm repeats its round that consists of seven steps and
does not stop until discovering whether Mmax exists or not in
the preferred-seller graph with the given pattern of inputs.
The algorithm has two termination conditions; one is de-
scribed in step 5, and the other is denoted in step 1. First one
is trivial because it is the objective of this paper. Correctness of
second one is described below. The prices offered by sellers do
not decrease in the algorithm; for that reason, a buyer cannot
purchase electricity from any seller if no seller offers a price
that is lower than valuation of the buyer. Therefore, in that
case, the algorithm terminates and ﬁnds that Mmax does not
exist in that graph and input pattern.
V. SIMULATION RESULTS
To analyze accuracy of the proposed algorithm, a simulator
of the algorithm has been developed with JAVA. This simu-
lator was used to collect data about the transition of prices,
preferred-seller graphs, and social welfare at every round.
Table I
THE PATTERN OF INPUT FOR THE SIMULATION.
|Ns|
|Nb|
c1
c2
c3
q1
q2
q3
q4
q5
q6
q7
q8
3
8
160
160
160
10
20
30
40
50
60
70
80
p1
p2
p3
v1
v2
v3
v4
v5
v6
v7
v8
4
2
1
5
6
7
8
9
10
11
12
Table I shows an example pattern of input for the simulation,
and Table II displays one of the heuristic results on the given
Table II
TRANSITION OF THE VARIABLES IN THE SIMULATION.
k
p1
p2
p3
y(si)
y(bj)
s1
s2
s3
b1
b2
b3
b4
b5
b6
b7
b8
1
4
2
1
0
0
160
10
0
30
40
10
0
70
0
2
4
2
2
0
160
160
10
20
30
40
50
20
70
80
3
4
3
3
0
170
150
10
20
30
40
50
20
70
80
4
4
4
4
70
150
140
10
20
30
40
50
60
70
80
k
u(si)
u(bj)
W
s1
s2
s3
b1
b2
b3
b4
b5
b6
b7
b8
1
0
0
160
30
0
150
240
70
0
630
0
1120
2
0
320
320
20
60
120
200
300
140
560
720
2760
3
0
510
450
10
40
90
160
250
120
490
640
2760
4
280
600
560
0
20
60
120
200
300
420
560
3120
input. In Table II, prices at round 4 satisfy all supply capacity
and consumption quantity, and these prices maximize social
welfare. Therefore, the matching M4 is Mmax, and the prices
at round 4 are called market-clearing prices for the given input.
Figure 6 shows the structure of M4. Every arc in M4 indicates
Figure 6.
The matching M4 in the simulation.
a transaction between a buyer and a seller, and ﬂow on each arc
is equal to the units of electricity dealt with in the transaction.
VI. CONCLUSION AND FUTURE WORK
This paper proposed an algorithm discovering a many-to-
one matching between buyers and sellers in a static electricity
market model with the set of electricity prices. By the com-
puter simulation, accuracy of the algorithm was examined.
In our deﬁnition of social welfare, the payoff of each seller
is equal to the price offered by the seller. Nevertheless, in
the real markets, sellers must pay the production costs that
reduce a proﬁt of the sellers; hence, more appropriate settings
at that point is required to obtain more accurate social welfare
in an electricity market. In addition, the concept of decrease
of electricity on power lines will be integrated into the model
of our algorithm. These assignments are our future work.
REFERENCES
[1] K. Hijikata, Electricity Derivatives. Sigmabasecapital, 2004, pp. 14-65.
[2] K. Nakanishi, Nikkei Ecology, Nikkei Business Publications, Inc., vol.
12, no. 11, 2012, pp. 12-13.
[3] D. Gale and L. S. Shapley, “ College admissions and the stability of
marriage, ”The American Mathematical Monthly, vol. 69, no. 1, 1962,
pp. 9-15.
[4] D. Easley and J. Kleinberg, Networks, Crowds, and Markets: Reasoning
about a Highly Connected World. Cambridge University Press, 2010.
[5] R. E. Kranton and D. F. Minehart,“A theory of buyer-seller networks,”
The American Economic Review, vol. 91, no. 3, 2001, pp. 485-508.
[6] R. K. Ahuja, T. L. Magnanti, and J. B. Orlin, Network Flows: Theory,
Algorithms, and Applications. Prentice Hall, 1993.
[7] D. Jungnickel, Graphs, Networks, and Algorithms. Splinger, 2013.
[8] J. M. Kleinberg, “ Single source unsplittable ﬂow, ” In Proceedings
of the 37th Annual Symposium on Foundations of Computer Science,
1996, pp. 68-77.
[9] G. X. Michel, Y. Dinitz, and N. Garg,“On the single-source unsplittable
ﬂow problem, ”Combinatorica, vol. 19, no. 1, 1998, pp. 17-41.
[10] S. G. Kolliopoulos and S. Clifford, “ Approximation algorithms for
single-source unsplittable ﬂow, ”SIAM Journal on Computing, vol. 31,
no. 3, 2001, pp. 919-946.
[11] H. Varian, Intermediate Microeconomics: A Modern Approach. Norton
and Company Incorporated. 2010, pp. 3-5.
82
Copyright (c) IARIA, 2014.     ISBN:  978-1-61208-319-3
ICONS 2014 : The Ninth International Conference on Systems

