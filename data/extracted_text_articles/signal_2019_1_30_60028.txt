Study of Spectra with Low-Quality Resonance Peaks
Viktor A. Sydoruk
Institute of Bio- and Geosciences, IBG-2: Plant Sciences
Forschungszentrum Jülich GmbH
52428 Jülich, Germany
e-mail: v.sydoruk@fz-juelich.de
Abstract—A Python-based software for the phenoCAVe family
of
resonators
for
plants
investigations
is
developed
to
automatically extract both the center frequency and the quality
factor of
the
main
resonance
peak,
i.e.,
of
the
lowest
transversal-magnetic mode TM010, at different scan positions.
Due to the specific design of the cavities, which includes large
openings on the top and on the bottom of the resonators, the
main peak even in the unloaded case (when no object is
measured) has a sufficiently small quality factor (<350), which
leads to the large influence of the higher modes on the
reliability of the extracted data. Additionally, the repeated
movements of the resonators and long cables usage may alter
the cable influence. Moreover, continuous movements during
the scans as well as a finite time of spectra sweep give a
distorted peak, especially at the borders of large objects, such
as plant pots, i.e., when the objects are starting to pass through
a resonator. All these problems and more are taken into
account in the automatic data analysis software, which allows
to obtain reliable responses from noninvasive scans of the
investigated plants over the whole period of their growth and
further usage of these responses to calculate the important
parameters for the plant growth, such as water content, dry
weight, biomass, pot water content etc. Here, the whole process
from the analysis of distorted spectra to the evaluation of the
suitable parameters for plant growth is demonstrated. Such an
analysis can be used not only for plant phenotyping platforms
but also in various physical platforms supposing low-quality
spectra analysis and dielectric studies of materials.
Keywords-low-quality resonance peaks; spectra fitting.
I.
INTRODUCTION
Fitting of experimental data using theoretical models is
an important and well-known problem in various fields of
study allowing to fulfill the understanding of investigated
processes or events. There are plenty of developed tools to
do so, especially when theoretical models are quite simple,
such as polynomial, Gaussian, and Lorentzian, or even a
convolution of the last two, often called a Voigtian. Such
tools,
for
instance
Origin
(OriginLab
Corporation,
Northampton,
MA,
USA),
Matlab-based
(MathWorks,
Natick, MA, USA) scripts, Python-based scripts, such as the
lmfit package [1], etc., are usually used in peak fitting tasks.
Nevertheless, task-specified algorithms were developed as
well for the peak fitting procedure, which mainly deal with
either specific data or particular cases of some processes [3]–
[6].
To analyze spectra where low-quality resonance peaks
are presented, a simple model of fitting these peaks cannot
be used due to several reasons. First, due to the coupling of
modes, they are influencing each other by changing their
visible parameters on the spectrum, such as peak frequency,
peak amplitude/attenuation, as well as their quality factor.
Secondly, the amplitude/attenuation at each frequency can be
affected by uncertainties caused by reflections in cables,
noises, spurious coupling or, in case of a phenoCAVe family
of resonators [2], by continuous movements of the cavities.
Some of these uncertainties can be represented as baselines
which are fitted together with spectra to obtain proper
spectrum parameters [7][8].
Skresanov et al. [9] described a novel approach to
recover coupled mode parameters from the microwave
resonator amplitude-frequency response to deal with the first
reason mentioned above. They used an approach from the
theory of oscillation, meaning that it is always possible to
select such a coordinate system, in which oscillations are
independent. In this case, the total amplitude Γ(f) of the
reflected/transmitted signal can be presented as a sum of
complex amplitudes of these oscillations (modes) as follows:

exp(
)
( )
1
2
( )
n
i
i
S
i
i
i
A
j
f
jQ
f



  
 


where ΓS is the coefficient equal to Γ(f) at f→∞ and is 
considered to be a real number, i is the ordinal number of an
oscillation, n is the total number of oscillations (modes),
0
0
(
( )
) /
i
i
i
f
f
f
f



is the frequency tuning parameter, Ai,
Qi, f0i, and φi are the amplitude, quality factor, resonant
frequency (Center Frequency, CF [2]), and phase shift of the
i-th oscillation, respectively. In the case of scattering
parameters, the amplitude Γ(f) should be considered in the
logarithmic form

10
0
( )
20log (
( ) /
)
S f
f





where S(f) is the scattering parameter, e.g., S11, S21, etc., and
Γ0 is the amplitude of the excited signal by a signal
generator.
This work presents an advanced fitting algorithm based
on the approach mentioned above [9] to study low-quality
resonance peaks, i.e., the peaks that have low-quality factor,
disturbances, influences of other modes, etc. The developed
software allows to fully-automatically analyze all the spectra
12
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-716-0
SIGNAL 2019 : The Fourth International Conference on Advances in Signal, Image and Video Processing

obtained during the scans of a set of plants, which can be
grown in different environmental conditions, may have
different genotypes, pot sizes, soil types, etc.
In Section II, the selection of a proper approach to fit
spectra
obtained
during
the
measurements
by
the
phenoCAVe family of resonators [2] is presented, where the
advantage of using (1) is clearly demonstrated (Section II.A)
and compared with the simple Lorentzian fitting approach
for the case of loaded resonators (Sections II.B and II.C).
Additional problems that may appear during the fitting
process caused by disturbed spectra are discussed in
Section III. The spectra fitting routine and the graphical user
interface of the fully-automated data analysis software based
on it is shown in Section IV. The conclusions are conducted
in Section V.
II.
FITTING OF SPECTRA
A.
Unloaded resonators
The fitting algorithm (further referred to as complex
approach) that uses (1) to calculate parameters of up to 7
resonance modes for measured spectra is realized in so-
called “Shaman” software [9]. As an example, Figure 1
shows
the
spectrum
(black dots)
which
includes the
resonance peaks of 5 different Transversal-Magnetic modes
(TM010, TM110, TM210, TM020, and TM310) as well as the
fitted curve given by the software (red solid line). The
obtained parameters for each mode are mentioned in
TABLE 1. The matching is very close to ideal, which proves
the right approach of the fitting. In many cases, especially
when resonance peaks have large quality factors, the phase is
not taken into account. The green dashed lines (Figure 1) are
the fitted Lorentzian curves when each φi equal to zero. The
difference is clearly visible, although the peaks have fairly
correct positions.
B.
Loaded resonators; comparison of fitting approaches
The approach when the phase is not taken into account
can be realized in such a way that the data points are
preselected to be as close as possible to the peak, i.e., in
terms of the scattering parameter S21 up to 3-5 dB far from
the highest point. Then, the fitting by Lorentzian curve is
done in the following form (further referred to as Lorentzian
approach)

2
2
( )
1
4
( )
A
f
Q
f






The last works well for the resonant oscillations, which
quality factors are large enough, usually more than 103, to
make the influence of other resonance modes negligible. Due
to both the design and the large openings in the resonators
used for plant investigations [2], the quality factor of the first
(TM010) mode even when the cavities are empty (unloaded)
has far smaller values (< 350).
To demonstrate how a large error can be caused by the
Lorentzian approach in comparison with the complex one, a
study using both approaches was done. The analyzed spectra
were obtained during the scan of a young maize plant (of
about 2 g fresh weight) with its pot using resonator 1 [2].
The relative errors made by the Lorentzian approach are
shown in Figure 2. Here, it was supposed that the complex
approach gives the true values for the peak parameters, and
the relative error was calculated using following equation

Relative error
/
100%
complex
Lorentzian
complex
p
p
p




where p denotes either peak frequency f0 or quality factor Q.
The result consists of the analysis of the 1st resonance peak
only, although the fittings done by the complex approach
included the 2nd mode too. It should be noted that the quality
factor Q is the most suitable parameter in this study to
demonstrate the influence of modes on each other, due to its
strong dependence on the form of a resonance peak.
Therefore, the relative errors were built versus Q on the plot.
Decreasing of Q was stimulated by placing the resonator at
different vertical positions during the scan of a maize plant
with its pot [2].
TABLE I.
FITTED RESONANCE MODES’ PARAMETERS
Modes,
i
Parameters
f0i (GHz)
Qi
Ai (dBm)
φi
1: TM010
1.14989
246.3
-15.55
0
2: TM110
1.47970
23.2
-29.37
161°
3: TM210
1.94015
297.4
-7.72
-5°
4: TM020
2.13039
72.9
-25.60
8°
5: TM310
2.38543
335.7
-5.68
-172°
Figure 1.
Transmittance spectrum with 5 resonance modes measured for unloaded resonator 1
[2] (black dots), fitting of it (red solid line), and individual resonance modes without phase shift
φi information (green dashed line).
13
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-716-0
SIGNAL 2019 : The Fourth International Conference on Advances in Signal, Image and Video Processing

C.
The false approach leads to errors in plant water
amount estimation
It is visible that the difference between approaches may
cause errors in the estimation of both f0 and Q of up to 0.2%
and 6%, respectively (see Figure 2). These errors may
increase or decrease for larger or smaller measured plants,
respectively. Moreover, by further estimation of the plant
Water Amount (WA) [2] 0.2% by f0 means about 2.3 MHz
for the resonator 1, which in terms of the water distribution
over the height of a plant gives ~1.5 µL/mm (data not
published yet). This in its turn, for a young maize plant of
2 g fresh weight and about 200 mm height gives 0.3 mL of
WA, or about 16% of error for the plant WA estimation
(0.3[mL] / (2[g]×0.95[mL/g]) × 100% ≈ 16%) 
This example demonstrates how the wrong fitting
approach can affect the final measurement results. Therefore,
in the phenoCAVe data analysis software, the complex
approach instead of the simpler Lorentzian one was selected.
III.
DISTURBED SPECTRA
A.
When a resonator is continuously moving while
receiving the spectra
Scanning of a plant by a resonator [2] involves the
obtaining of a set of spectra at different positions along the
height of the plant. Either a plant or a resonator can be
moved against each other. The measurement setup based on
the resonator 1 is supposed to shift a plant through the cavity,
when the setup based on the resonator 2 displaces the cavity
itself. To decrease the scanning time, these movements can
be continuous at the intermediate points between the highest
and
the
lowest
positions.
These
lead
to
additional
uncertainties caused by the finite sweep time of the Vector
Network Analyzers (VNAs), which are used to obtain
spectra, i.e., each frequency on the spectrum has its own
position.
For the Screen-House setup [2], every position of the
resonator is read out from the MAXON motor drive unit
each 50 ms. The VNA (ZNC 3, Rohde & Schwarz GmbH,
Cologne, Germany), in its case, has 87.5 µs sweep time per
frequency point, i.e., one whole spectrum that consists of 801
points is measured during 70 ms. The highest speed of the
resonator varies from 20 to 70 mm/s, meaning that during
70 ms the resonator can change its position by about 5 mm,
which may lead to the crucial modification of the spectra,
especially when the resonator is close to the plant pot. By
knowing the vertical position of each point on the spectra
and taking a set of spectra measured at different positions,
spectra for each selected position can be recalculated using a
polynomial fit of order 2. Such a polynomial fit gives a few
positive effects. The first one is the automatically smoothed
spectrum, and the second one is the possibility to detect
outliers in combination with the Grubbs’ test [10].
B.
Influence of cables and surroundings
Both setups presented previously [2] have cables to
deliver and acquire signals. The cables can be calibrated
using a built-in utility of VNA and commercially available
calibration kits (in our case ZV-Z132, Rohde & Schwarz
GmbH,
Cologne, Germany). The calibration may not
properly work in some cases. For the setup based on
resonator 2, even calibrated VNA showed a sinusoidal
behavior on the spectrum (see Figure 3). In this case,
additionally to the spectrum fitting, residuals
21 ( )
Sres
f
should
be fitted by using a sum of sines in the following form

21
sin
sin
sin
( )
sin(2
/
)
k
res
i
i
i
i
S
f
a
f
f







where aisin, fisin, φisin are the sine parameters, and k is the
number of sines. The bottom plot in Figure 3 reflects this
situation. Residuals may depend on the position of the
resonator due to the influence of surroundings, causing the
residuals fitting to be done for each spectrum. Moreover, this
procedure should be circled to obtain proper parameters for
the resonance peak, i.e., firstly, the spectrum (measured data)
Figure 3.
Complex fitting approach for the spectrum obtained using
unloaded resonator 2 [2] (top plot) and fitting of residuals S21
res using (4)
with k = 2.
Figure 2.
Relative errors of the estimated parameters, peak frequency f0
(black squares) and quality factor Q (red circles), versus Q for the 1st
resonance mode TM010. The black solid line depicts the inverse square
dependence on Q.
14
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-716-0
SIGNAL 2019 : The Fourth International Conference on Advances in Signal, Image and Video Processing

is fitted by the complex approach, secondly, residuals are
calculated and fitted, and finally, the obtained curve in the
form (5) is subtracted from the measured data. These three
steps are repeated several times to obtain a stable solution
(see Figure 3).
IV.
SPECTRUM FITTING ROUTINE
The suggested spectrum fitting routine is shown in
Figure 4. The whole procedure starts from the reading of the
spectral information (measured data) for the resonance peak
at the selected position of a resonator. Then, if the resonator
was continuously moving during the scan, the recalculating
spectrum function is called (Section III.A). After that, the
complex fitting approach starts (Section II), which is
followed by the residuals fitting if needed (Section III.B).
After
subtraction of the fitted residuals, the complex
approach can be called again, i.e., circled until obtaining a
stable solution. At the end, the evaluated parameters of the
resonance peak are stored for further analysis (not a part of
this work). This routine is repeated for each measured
spectrum at different positions of the resonator.
It should be noted that the residuals obtained at different
positions are stored too for the unloaded runs of the
resonator. Later, these residuals are used to simplify the
fittings for the resonator runs with a measured object, e.g., a
plant, a pot with soil, etc.
The
fitting
routine
presented
in
Figure
4
was
programmed
in
the
fully-automatic
phenoCAVe
data
analysis software using Python programming language. To
make an interface and to deal with the mathematics behind it,
a list of packages was used, such as pyqtgraph, PyQt5, scipy,
numpy, lmfit, csv, itertools, fnmatch, inspect, os, bayeos,
multiprocessing, sys, warnings, time, traceback, typing,
copy, etc. The software tab, where spectra fitting is visible, is
presented in Figure 5 with the data shown in Figure 3. The
time spent to fit one spectrum from “Start” to “End” (see
Figure 4) using “spectrum recalculating” and 20 iterations of
“residuals fitting” was less than 5 seconds on the Intel Xeon
E5-2630 v3 based computer.
V.
CONCLUSIONS
The fitting approach presented in this work was mainly
developed to analyze low-quality resonance peaks on
measured spectra. The simple Lorentzian fitting approach
was compared with the complex one, to which a preference
was given. Additionally to that, issues that may arise during
the measurements using partially opened resonators were
shown and discussed with their possible resolution. Among
them are the influences of other modes, surroundings, cables,
and continuous movements of either a resonator or an
investigated object. In the end, the spectrum fitting routine
was
suggested
and
the
software
based
on
it
was
demonstrated. The suggested complex fitting approach is not
newly developed but the proposed fully automated fitting
routine has novel ideas which can be useful for the precise
analysis of spectra with low-quality resonance peaks.
ACKNOWLEDGMENT
The author would like to thank A. Gubin with IRE,
Kharkiv,
Ukraine
and
I.
Zadorozhnyi
with
ICS-8,
Forschungszentrum Jülich GmbH, Germany for valuable
discussions related to the fitting approach and Python-
programming issues.
REFERENCES
[1]
M. Newville et al., “LMFIT: Non-Linear Least-Squares
Minimization
and
Curve-Fitting
for
Python,”
https://lmfit.github.io/lmfit-py/, retrieved: Apr. 2019.
[2]
V. A. Sydoruk et al., “Design and Characterization of
Microwave Cavity Resonators for Noninvasive Monitoring of
START
reading
spectrum, S21
continuous
resonator
movements?
spectrum recalculating
(Section III.A)
complex fitting
approach (Section II)
fit
residuals?
residuals fitting
(Section III.B)
yes
no
repeat?
no
END
yes
yes
no
subtraction of the
fitted residuals
Figure 4.
Suggested spectrum fitting routine.
Figure 5.
phenoCAVe data analysis software developed using Python
programming language.
15
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-716-0
SIGNAL 2019 : The Fourth International Conference on Advances in Signal, Image and Video Processing

Plant Water Distribution,” IEEE Trans. Microw. Theory
Tech., vol. 64, no. 9, Sep. 2016, pp. 2894–2904, doi:
10.1109/TMTT.2016.2594218.
[3]
T. Žák and Y. Jirásková, “CONFIT: Mössbauer spectra fitting
program,” Surf. Interface Anal., vol. 38, no. 4, Mar. 2006, pp.
710–714, doi: 10.1002/sia.2285.
[4]
A. E. Hughes and B. A. Sexton, “Curve fitting XPS spectra,”
J. Electron Spectrosc. Relat. Phenom., vol. 46, no. 1, 1988,
pp. 31–42, doi: 10.1016/0368-2048(88)80003-3.
[5]
A. P. Hammersley and C. Riekel, “MFIT: Multiple spectra
fitting program,” Synchrotron Radiat. News, vol. 2, no. 1, Jan.
1989, pp. 24–26, doi: 10.1080/08940888908261193.
[6]
A.
J.
Brown,
“Spectral
curve
fitting
for
automatic
hyperspectral
data
analysis,”
IEEE
Transactions
on
Geoscience and Remote Sensing, vol. 44, no. 6, Jun. 2006, pp.
1601–1608, doi: 10.1109/TGRS.2006.870435.
[7]
Q. Han et al., “Simultaneous spectrum fitting and baseline
correction using sparse representation,” The Analyst, vol.
142,
no.
13,
May
2017,
pp.
2460–2468,
doi:
10.1039/C6AN02341J.
[8]
H. Hu et al., “Improved Baseline Correction Method Based on
Polynomial
Fitting
for
Raman
Spectroscopy,”
Photonic
Sensors, vol. 8, no. 4, Dec. 2018, pp. 332–340, doi:
10.1007/s13320-018-0512-y.
[9]
V. N. Skresanov et al., “The novel approach to coupled mode
parameters recovery from microwave resonator amplitude-
frequency
response,”
2011
41st
European
Microwave
Conference (EuMC 2011), IEEE Press, Oct. 2011, pp. 826–
829, doi: 10.23919/EuMC.2011.6101922.
[10] “NIST/SEMATECH e-Handbook of Statistical Methods,”
http://www.itl.nist.gov/div898/handbook/,
retrieved:
Apr.
2019.
16
Copyright (c) IARIA, 2019.     ISBN:  978-1-61208-716-0
SIGNAL 2019 : The Fourth International Conference on Advances in Signal, Image and Video Processing

