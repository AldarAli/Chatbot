APEC: Auto Planner for Efﬁcient Conﬁguration of
Indoor Positioning Systems
Ming Jin, Ruoxi Jia, Costas J. Spanos
Department of Electrical Engineering and Computer Science
University of California, Berkeley
Berkeley, CA 94720, USA
Emails: {jinming,ruoxijia,spanos}@berkeley.edu
Abstract—Fingerprints-based methods have been prevailing in
indoor positioning systems, whereas they have certain draw-
backs that ﬁngerprints collection in the ofﬂine phase requires
considerable manpower and time. Auto Planner for Efﬁcient
Conﬁguration (APEC) systematically exploits router setups and
ﬁngerprints allocations over space by taking into account user
preferences and budget constraints. The task of conﬁguration is
formulated as an optimization problem, whose objective is the
expected loss based on the Hierarchical Bayesian Signal Model
(HBSM) and theoretical results on the misclassiﬁcation rates.
To reduce the computational complexity of large-scale problems,
two heuristics are employed, i.e., the coordinate descent and the
router-ﬁngerprints decoupling, which are validated by simulation
analysis. Experiments with three mobile devices (Android, iPad,
iPhone) in two setups (7 or 9 access points) verify that the
expected loss is a reliable predictor of the actual loss of the
system (objective consistency), and that APEC outperforms the
random and uniform approaches (solution superiority). Since
APEC focuses on the system conﬁguration in the planning stage,
it can be combined with other ﬁngerprinting processes in the
online phase to improve the utility of the system.
Keywords–Indoor positioning; Fingerprinting method; System
optimization
I.
INTRODUCTION
The pervasion of radio-frequency transmitters such as WiFi
access points, iBeacons and GSM towers has gathered momen-
tum for indoor positioning without the need for specialized
infrastructure. One popular approach, pioneered by RADAR
[1] and further developed by [2]–[7], is to employ received
signal strength (RSS)-based ﬁngerprinting of locations in the
space of interest, where typically multiple access points can be
heard at each location. A mobile device is then localized by
matching the observed RSS readings against the database by
deterministic, e.g., K-Nearest Neighbors (KNN), or stochastic
methods, e.g., maximum likelihood criterion. While the ﬁnger-
printing approach requires a site survey involving detailed RSS
measurements which entail considerable effort, an alternative
method is to use RF propagation model, such as the prevalent
log-distance pass-loss model, which leads to light-weighted lo-
calization schemes [8]–[11]. Model-based localization method
itself suffers from reduced accuracy since the model can hardly
capture signal variance resulting from complexities of indoor
environments. The combination of ﬁngerprinting and model-
based methods has been proposed as a trade-off between
accuracy and RSS measurement effort, such as [12], [13].
Previous work has been devoting effort to maneuvering
ﬁngerprinting matching process in the online phase to achieve
better localization accuracy, while it remains untouched that
potential performance improvement can be obtained by ex-
ploiting an optimized way to collect ﬁngerprints in the ofﬂine
phase. The focus of this study is on the conﬁguration of
ﬁngerprints-based positioning system as motivated by the
following problems:
•
How to take user preferences, i.e., location priority
and visiting frequencies, into account?
•
How to place routers and allocate ﬁngerprints to be
collected over the space under budget constraints?
The ﬁrst problem arises, for instance, in the scenarios such
as: (i) customer behavior analysis in a supermarket, where
merchandise area has higher priority than check-out stations,
or (ii) region-based indoor environment control, where climate
zones are more important than open spaces. The second
problem emerges since router setup involves capital costs and
ﬁngerprints collection is time-consuming.
It is, therefore, the objective of APEC to design the
ﬁngerprints-based localization system that takes into account
user preferences and budget constraints. The key contributions
of the study are as follow:
•
Proposal of Hierarchical Bayesian Signal Model
(HBSM), a learning-to-learn framework to improve
RSSI estimation over space.
•
Formulation of the optimization problem, where the
objective as a theoretical solution has strong correla-
tion with the actual loss of the system.
•
Design and implementation of APEC as a guidance
for ﬁeld deployments.
The rest of the paper is organized as follow. The HBSM
is detailed in Section II. Section III formulates the opti-
mization problem and derives the expected loss based on
linear/quadratic discriminant analysis, followed by the illus-
tration of the APEC algorithm. Results of ﬁeld experiments
are reported in Section IV, in addition to a toy example to
examine the heuristics and algorithmic performances. Section
V draws conclusion and discusses future works. Notations and
shorthands in the paper are listed in Table I, as a reference.
II.
HIERARCHICAL BAYESIAN SIGNAL MODEL
A. Background
1) Log-Distance Pass-Loss Model: The path loss of signal
strength inside a building over distance is modeled as
XRSSI(d) = XRSSI(d0) + 10γ log d
d0 + ϵσ,
(1)
100
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-418-3
UBICOMM 2015 : The Ninth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

TABLE I. NOTATIONS AND SHORTHANDS REFERENCE.
Random variables
XRSSI(d)
RSSI at distance d by log-distance pass-loss model
ϵσ
Random variable with ϵσ ∼ N (0, σ2)
Z ∼ PZ
Location Z follows the visiting frequency probability PZ
X ∼ PX|Z
RSSI measurement X at location Z distributed as PX|Z
x(t)
i
RSSI measurement at location i and time t, which is the
realization of X ∼ N (Λ⊤
i,·, ˜Σi)
Parameters
K
Total number of routers
N
Number of subregions
M
Number of places available for routers
Ntot
Total number of ﬁngerprints to be collected
θ ={θfp,θrt}
ﬁngerprints allocation parameter θfp ∈ N N
+ and router
location parameter θfp ∈ RM
Srt
Set of possible location candidates for θrt
ni, θfp
i
Number of ﬁngerprints collected at location i ∈ [N]
Λ ∈ RN×K
Mean matrix, with Λi,· for mean RSSI at location i∈[N]
and Λ·,j for all location measurements for router j ∈ [K]
˜Σi
Covariance matrix for RSSI measurement at location i
˜Σ, ˜σ2
˜σ2 is the diagonal entry of RSSI covariance matrix ˜Σ,
which by assumption is the same for all ˜Σi, i ∈ [N]
Σml, sml
Σml = Σ−1
m − Σ−1
l
whose diagonal entries are
identically sml in Section III-B2 QDA misclassiﬁcation
˜Λ∈RN×K
˜Γ∈RNK×NK
Hyperpriors of Λ, Λ·,j ∼ N (˜Λ·,j, ˜Γβ(j)) for router j
and Λ⊤
i,· ∼ N (˜Λ⊤
i,·, ˜Γα(i)) for location i
c ∈ RN
local priority map, ci ∈{HIGH, MED, LOW} for location i
π ∈ RN
local frequency map, πi ∈{OFTEN, SOME, SELDOM}
Shorthand notations and functions
[K]
Shorthand notation for {1, ..., K}
R(i)
Neighborhood of location i
α(i) index func.
{(x, y) : x=i+pN,y =i+qN, p, q ∈ {0, ..., K−1}}
β(j) index func.
{(x, y) : (j − 1)N + 1 ≤ x, y ≤ jN}
hθ(x)
Output of IPS parameterized by θ given RSSI x
L(Z, ˆ
Z)
Cost of misclassiﬁcation given the target is at Z, as in (3)
Pm(h(x)̸=m)
Misclassiﬁcation rate of h(·) given x and true location m
ˆL(θrt, θfp)
Actual loss of an IPS designed by (θrt, θfp) as in (12)
ξi(j)
Empirical misclassiﬁcation rate of location i to j (13)
where XRSSI(d) in Decibel (dB) is the Received Signal
Strength Indicator (RSSI) at distance d, d0 is the reference
distance, γ is the path loss exponent (PLE), and ϵσ ∼ N(0, σ2)
is a random variable reﬂecting the attenuation caused by ﬂat
fading [14].
2) Gaussian Process (GP): Every point in space has a
normal distribution by the Gaussian process. A collection
of points follows a multivariate Gaussian, x ∼ N(µ, ˜Σ)
that is characterized by µ and ˜Σ given by the mean and
covariance functions, respectively. GP has been employed in
spatial smoothing, aka kriging, and prediction. The covariance
function can take many forms, such as constant (KC(z, z′) =
C), Gaussian noise (KGN(z, z′) = σ2δz,z′), and squared
exponential

KSE = exp{− ∥z−z′∥2
2
2
}

, where z and z′ are
spatial positions of any two points.
We propose a neighborhood covariance function, KNH =
ρσ2δz∈R(z′), where R(z) is a set of points that are in the
neighborhood of z , ρ ∈ (0, 1) is the GP coefﬁcient, and
δz∈R(z′) is an indicator function which evaluates to 1 if z is in
the neighborhood of R(z′) and 0 otherwise. The neighborhood
covariance is symmetric, and by appropriate choice of ρ,
positive deﬁnite.
B. Hierarchical Bayesian Signal Model (HBSM)
The space is instrumented with K routers, each of which
can independently produce RSSI measurements within the
area. The HBSM proposed in this study is a two-layered model
for the RSSI observations. The top layer imposes hyperpriors
on the mean of RSSI at any point, whereas the bottom layer
accounts for measurement error.
1) Bottom layer (observations): Let x(t)
i
∈ RK denote
measurement at location i ∈ [N] and time t for K routers.
x(t)
i
∼ N(Λ⊤
i,·, ˜Σi) follows a normal distribution with mean
Λ⊤
i,· and covariance ˜Σi, where Λ ∈ RN×K is the mean
matrix whose i-th row corresponds to the mean RSSI at
location i ∈ [N] and j-th column corresponds to all location
measurements for router j ∈ [K], where we use notations
with tilde to represent hyperpriors, which are non random
and can be estimated by sample averages. The signal can be
considered as a summation of the mean signal Λ ∈ RN×K with
a multivariate Gaussian random noise ϵt ∼ N(0, ˜Σi), which
results from randomness of measurement and environments.
We make the following assumption of the system:
Assumption 1: Routers work independently and identically,
which, by the log-distance pass-loss model (1), indicates that
˜Σi = ˜Σ, i ∈ [N], with identical diagonal entries ˜σ2.
2) Top layer (hyperpriors): The rearranged mean matrix


Λ·,1
...
Λ·,K

 ∼ N






˜Λ·,1
...
˜Λ·,K

 , ˜Γ =


˜Γβ(1)
...
˜Γβ(K)





 has
multivariate Gaussian distribution, where ˜Λ ∈ RN×K is
the mean and ˜Γ is the covariance matrix. We introduce the
indexing functions:
α(i) = {(x, y) : x = i+pN, y = i+qN, p, q ∈ {0, ..., K−1}}
β(j) = {(x, y) : (j − 1)N + 1 ≤ x, y ≤ jN}
where α(i) and β(j) extracts the covariance terms from ˜Γ for
location i and router j, respectively. By rearranging the terms
we have Λ⊤
i,· ∼ N(˜Λ⊤
i,·, ˜Γα(i)) as can be veriﬁed.
Assumption 2: The mean of the hyperprior, ˜Λ, is given by
the log-distance pass-loss model. The diagonal variance and
off-diagonal covariance for all locations corresponding to a
single router j, ˜Γβ(j), are given by the log-distance pass-loss
model and Gaussian process model respectively.
Remarks: The HBSM model is inspired by the learning
to learn framework [15], where the observation at one point
in space can reﬁne our estimation of other points through
the top layer of hyperpriors. It lays the theoretical foundation
of many empirically proven ﬁngerprinting methods, such as
Virtual Fingerprints [16], Modellet [13] and CGSIL [17],
where the collected ﬁngerprints are used to train a radio
propagation model locally in order to estimate the unknown
area. The HBSM model also has implications to radio map
reconstruction by introducing methods from empirical Bayes
and Gaussian process regressions [18].
III.
AUTO PLANNER FOR EFFICIENT CONFIGURATION
We describe the APEC framework in this section. The key
idea is that given limited resources (routers and ﬁngerprints),
critical locations that are visited frequently should be distin-
guished with high accuracy. APEC requires users to provide
two maps as illustrated in Figures 1 and 7 in the Experiment
section (Section IV-B):
101
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-418-3
UBICOMM 2015 : The Ninth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

•
Local priority map, where each subarea is associated
with a priority level ci ∈ {HIGH, MED, LOW} to
represent costs incurred in case of location confusion.
•
Local frequency map, where a visiting frequency
level πi ∈ {OFTEN, SOME, SELDOM} is indicated
for each subregion.
where each level is given a nonnegative value to quantify the
cost. Typical values are HIGH=3, MED=2, LOW=1, which
also applies to the local frequency map.
The practicality of the nonuniform treatment of positioning
accuracy is obvious. In an ofﬁce building, most occupants will
spend their time in their cubicles (HIGH cost of confusion,
OFTEN frequency) and public areas such as conference rooms
(MED, SOME) and kitchen (HIGH cost for energy apportion-
ment, SOME) as compared to corridors (LOW, SELDOM).
Another use case is the supermarkets, where the store manager
might put HIGH value to food shelves to learn customer
behaviors and LOW to open spaces. In the following, we
formulate the problem in an optimization framework.
A. Optimization Framework
Our objective is to minimize the expected cost subject to
router and ﬁngerprints constraints, i.e., number/locations of
routers/ﬁngerprints:
minimize
θ
E
Z∼PZ,X∼PX|Z
[L(Z, hθ(X))|Z]
subject to
θ = {θfp, θrt} ∈ Θ
(2)
where the expectation is with respect to Z
∼
PZ, the
visiting probability given by the local frequency map, and
X ∼ PX|Z, the ﬁngerprints observation at location Z. To
make the problem computationally tractable, we divide the
space into N subregions, so the ﬁngerprints decision variable
θfp ∈ NN
+, 1⊤θfp ≤ Ntot where θfp
i
is the number of
ﬁngerprints collected at subregion i, and Ntot is the total
number to be collected. As for the routers parameter, θrt, we
allow the user to provide M locations to place the K routers
(later we describe a heuristic of choosing the valuable router
locations to lessen the computational burden).
The loss function L(Z, hθ(X)) represents the cost of
misclassiﬁcation given the target is at location Z, i.e.,
L(Z, hθ(X)) = cZPZ(hθ(X) ̸= Z),
(3)
where cZ is indicated by the local priority map, and hθ(X)
is the Bayes optimal classiﬁer which in our case is the
linear/quadratic discriminant analysis (LDA/QDA):
Linear/Quadratic Discriminant Analysis: Given two
distributions N(µk, Σk), k
∈
{m, l}, for an observa-
tion x, deﬁne the discriminant score for distribution k as
dk(x) = − 1
2xm⊤Σ−1
k xm+µ⊤
k Σ−1
k x− 1
2µ⊤
k Σ−1
k µk+ln(πk)−
1
2 ln |Σk|, the optimal classiﬁcation rule is given by
h(x) = arg max
k
dk(x)
(4)
For distinct covariance matrices, Σm ̸= Σl, the above classi-
ﬁcation is known as Quadratic Discriminant Analysis (QDA).
If the covariances are equal, the discriminant score can be
simpliﬁed as dk(x) = µ⊤
k Σ−1
k x − 1
2µ⊤
k Σ−1
k µk + ln(πk),
and the corresponding classiﬁer becomes Linear Discriminant
Analysis (LDA) [19]. Both QDA and LDA yield maximum
posterior distribution, thus are reasonable classifers to employ
for ﬁngerprints-based positioning. In the following, we derive
the analytic form of the misclassiﬁcation rate in (3) to evaluate
our objective function in (2) explicitly.
B. Theoretical Results for Misclassiﬁcation Rate
Assume that the true class of x is m, i.e., xm
∼
N(µm, Σm), then we will have misclassiﬁcation if:
dm(xm) < dl(xm)
(5)
between two classes m and l. In the following, we consider the
cases for the LDA and QDA based on the relation of covariance
matrices.
1) LDA [20]: For Σm = Σl, (5) is equivalent to:
v⊤
mlxm + aml < 0
(6)
where aml = − 1
2

the location misclassiﬁcation rate weighted by the priority
and visiting frequency is minimized. Intuitively, the more
ﬁngerprints x(t)
i
collected the better we can estimate the
mean at that location Λ⊤
i,· and the less the misclassiﬁcation
rate (refer Section II.B for the relations). By the maximum
likelihood method, our estimates of Λ⊤
i,· is the sample mean of
ﬁngerprints x(t)
i , which is normally distributed with mean Λ⊤
i,·
and covariance
1
ni ˜Σi, where ni is the number of ﬁngerprints
collected. By Assumption 1, ˜Σi is the same for all locations
i ∈ [N]. Consider m and l to be neighboring two regions, then
by applying the results in (7) and (9) with Σm =
1
nm ˜Σ and
Σl =
1
nl ˜Σ (˜Σ is diagonal with entries ˜σ2 by Assumption 1),
Pm(h(x) ̸= m) =













Φ
 
−
v⊤
mlµm+aml
r
1
nm v⊤
ml ˜Σvml
!
,
nm = nl
1 − F
 v⊤
mlΣ−1
mlvml+2aml
smlσ2m
; K, λ(ml)
1

,
nm > nl
F
 v⊤
mlΣ−1
mlvml−2aml
smlσ2
m
; K, λ(ml)
2

,
nm < nl
(10)
where
vml
=
˜Σ−1 (nmµm − nlµl),
Σml
=
|nm
− nl|˜Σ−1,
sml
=
|nm − nl| ˜σ−2,
aml
=
− 1
2

nmµ⊤
m ˜Σ−1µm − nlµ⊤
l ˜Σ−1µl

+ ln πmnK/2
m
πlnK/2
l
, ωml
=
Σ−1/2
ml
vml, σ2
m is the diagonal element of
1
nm ˜Σ, and the
noncentrality parameters λ(ml)
1
= PK
i=1

s1/2
ml [µm]i−[ωml]i
s1/2
ml σm
2
,
λ(ml)
2
= PK
i=1

s1/2
ml [µm]i+[ωml]i
s1/2
ml σm
2
. The above formula ties
the HBSM model and optimization framework to allow us
evaluate the objective function efﬁciently. Now, we introduce
the APEC algorithm.
C. APEC Algorithm
We can write out the expected loss in (2) as follow:
E
Z∼PZ,
X∼PX|Z
L(Z, hθ(X)) =
X
i∈[N]
πi
X
j∈R(i)
ciPi(hθ(x) = j)
|
{z
}
Weighted cost of location confusion
,
(11)
where πi is the visiting frequency (normalized from the local
frequency map), ci is the location confusion coefﬁcient given
by the local priority map, R(i) is the neighborhood of point
i. APEC optimizes over the following parameters:
•
θrt (router locations): Given M possible locations,
choose K to place the routers.
•
θfp (ﬁngerprints): Plan the number of ﬁngerprints to
be collected at each subregion i ∈ [N] such that θfp =
[n1, · · · , nN]⊤ ∈ NN
+, 1⊤θfp ≤ Ntot.
It can be seen that the problem is combinatorial in na-
ture, which requires integer programming. The computation is
formidable for large scale problems. For instance, there are
N + Ntot − 1
N − 1

possible solutions to distribute Ntot ﬁnger-
prints to N subregions. APEC Greedy, therefore, is proposed to
solve the problem efﬁciently, as shown in Algorithm 1, which
Algorithm 1: Pseudo-code of APEC Greedy
APEC_Greedy(Maps, Ntot, K)
Input: Maps: possible M locations to place K routers (Srt),
centers of N subregions to collect Ntot ﬁngerprints
(Sfp), local priority/frequency maps
Initialization:
1 Srt ← Comb(Maps, K)
// Set of router locations
2 b ← Number of ﬁngerprints (fp) increment
3 B ← Batch size
θ ← { }
// Cell to store the history of {θfp, θrt}
V ← [ ]
// Vector to store the history of costs
bookInd ← 1
Main program:
4 for θrt ∈ Srt do // Scan possible router locations
5
˜Λ, ˜Γ, ˜Σ ← HBSM(θrt, Sfp)
// Sec.II
θfp ← 1(N, 1)
// Start with 1 fp per location
k ← N
// Current number of fps
while k < Ntot do
θt ← { }, Vt ← [ ]
for i ∈ {1, ..., B} do
/* Randomly choose b indices out of N
with replacement, then increment
the corresponding entries in ˆθ
fp
*/
6
u ← RandInd(N, b)
7
ˆθ
fp ← θfp, ˆθ
fp
u ← ˆθ
fp
u + 1
8
v ←
E
Z,XL(Z, hθ(X))
// Equ. (11)
θt(i) ← ˆθ
fp, Vt(i) ← v
ibst ← arg mini Vt(i)
θfp ← θt(ibst), vbst ← Vt(ibst)
k ← k + b
// Increment fps by stepsize
θ(bookInd) ← {θfp, θrt}, V (bookInd) ← vbst
bookInd ← bookInd + 1
9 ibst ← arg mini V (i)
{θrt
bst, θfp
bst} ← θ(ibst)
Output: {θrt
bst, θfp
bst}
// APEC Greedy solution
is based on the HBSM (line 5, see Section II) and weighted
misclassiﬁcation cost (line 8, see Section III).
The APEC Greedy algorithm exhaustively searches for
router locations (θrt ∈ Srt, where Srt is all possible com-
binations of M choose K locations, line 1), and stochastically
optimizes for ﬁngerprints vectors θfp. The asymptotic case
of choosing b = Ntot and batch size B → ∞ (lines 2,3)
produces the same result of exhaustive search at the cost of
infeasible computation time. The simulation experiments in
the following verify that APEC Greedy performs almost as
well as exhaustive search at computational advantage. We also
propose heuristics in selecting the most useful locations to
place routers through router-ﬁngerprints decoupling to resolve
scalability issue in ﬁeld deployment.
IV.
EXPERIMENTAL RESULTS
A. Toy Case Study
Through the simulation, we compare the performance of
APEC Greedy with APEC Exhaustive, and understand the
router and ﬁngerprints placement in relation to the local
priority and frequency maps. Speciﬁcally, we will examine the
following heuristics that APEC Greedy (Algorithm 1) employs
to reduce computational complexity:
103
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-418-3
UBICOMM 2015 : The Ninth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

•
Heuristic 1 (Coordinate Descent): Fingerprints bud-
get is allocated in θfp by random selection of location
candidates (lines 6,7) and choosing the set that makes
the most cost reduction (line 9).
•
Heuristic 2 (Router-Fingerprints Decoupling): The
set of optimal router locations Srt that minimizes the
loss (11) is chosen by assuming a uniform allocation
of ﬁngerprints budget, i.e., each spot has ﬁngerprints
Ntot
N . Then, the ﬁngerprints θfp are optimized within
the reduced set (line 4) instead of the full set with
combinatorial number of router candidates.
We design a simple problem, as shown in Figure 1, with
M = 9 possible router locations and N = 5 subregions,
where the location priority is color coded, and the frequency
is identical for all 5 subregions. The total number of ﬁnger-
prints Ntot is restricted so that APEC Exhaust is tractable. A
random approach is also implemented where the ﬁngerprints
are distributed randomly.
Figure 1. Map of the toy example showing the access points locations and
ﬁngerprints allocations (radius of the green circle) determined by APEC
Exhaust (also APEC Greedy since they agree).
1) Examination of Heuristic 1: The losses (8) of ﬁnger-
prints allocation θfp given by APEC Exhaust, Greedy, and
random approach corresponding to each router conﬁguration is
shown in Figure 2. The router setup is indexed by the expected
loss of APEC Exhaust, so ideally other methods should incur
similar loss and exhibit descending trend to match the optimal
solution.
2) Examination of Heuristic 2: The router-ﬁngerprints de-
coupling heuristic makes a trade-off between cost and compu-
tation by sequentially optimizing over θrt and θfp in problem
(2), which brings computational advantage for large-scale
problems. Even though the heuristic relies on estimation of
the optimal cost that is not the most accurate, the performance
is guaranteed if the estimation preserves rankings among
the candidates, so that the best router setups are revealed
nevertheless, as shown in Figure 3. As it can be seen, though
the estimation is noisy, the decoupling heuristic can recover
router set index
0
10
20
30
40
50
60
70
80
90
expected loss
1
1.5
2
2.5
APEC Exhaustive
APEC Greedy, batch = 2
APEC Greedy, batch = 5
APEC Greedy, batch = 20
Random selection
Figure 2. Expected loss of ﬁngerprints allocation θfp for each router setup
(out of 84 candidates) with Ntot = 15 total budget, N = 5 subregions,
K = 3 routers, as selected by APEC Exhaust, APEC Greedy (with different
batch sizes B), and random approach (black error bar showing mean±1
standard deviation over 20 test runs).
the best 20 router setups with high probability, which is not
likely for the random selection approach.
Another possible heuristic, random selection, is to treat
each setup uniformly, where they have identical distribution
of expected loss, as shown in Figure 3. We might end up in
a region, i.e., the right half of the graph, where even with the
optimized ﬁngerprints θfp
∗
the incurred loss is signiﬁcantly
higher then the optimal, since unlike the decoupling heuristic,
the ranking information is lost.
Router Setup Index
0
10
20
30
40
50
60
70
80
Expected Loss
1
1.1
1.2
1.3
1.4
1.5
1.6
Heuristic Router Selection
APEC Exhaust
Random Selection, mean
Random Selection, ' 1sd
Figure 3. Expected loss vs. router setup indexed by the optimal costs given
by solving the fully coupled problem (APEC Exhaust). The plot also shows
the loss estimated by random selection (green, mean ± 1 standard deviation)
and heuristic router selection (red).
B. Field Deployment
The theoretical foundation of APEC Greedy, a method to
predetermine the optimal router locations and ﬁngerprints allo-
cation for indoor positioning system (IPS), is the formulation
of the optimization problem (2), which takes into account
the HBSM (see Section II), location priority, and visiting
frequencies. As most ﬁngerprinting system employs methods
such as K-Nearest Neighbor (KNN) for positioning [1], the
assessment of APEC requires the examination of the following:
104
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-418-3
UBICOMM 2015 : The Ninth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

TABLE II. SUMMARY OF DATA COLLECTED IN EXPERIMENT A
(WITH 5 ROUTERS) AND B (7 ROUTERS) FOR THREE DEVICES
(IPHONE, IPAD, ANDROID).
iPhone
iPad
Android
Exp A: 7 RTs
Avg: 72±18 pts
Avg: 72±15 pts
Avg: 96±25 pts
Tot: 144 minutes
Tot: 144 minutes
Tot: 193 minutes
Exp B: 9 RTs
Avg: 84±17 pts
Avg: 80±19 pts
Avg: 98±12 pts
Tot: 167 minutes
Tot: 160 minutes
Tot: 196 minutes
•
Hypothesis
1
(Objective
Consistency):
Given
(θrt, θfp), the expected loss given in (11) is a good
indicator of the actual loss of the system. Objective
consistency ensures that the solution of (2) is (near-)
optimal in practice (see Figure 5).
•
Hypothesis 2 (Solution Superiority): Though the
objective consistency if met can guarantee optimal
solution, we still want to verify that APEC, with the
application of heuristics proposed in Section IV-A,
performs well with respect to the actual cost (Figure
6).
Data collection takes place in the Center for Research in
Energy Systems Transformation (CREST) on the UC Berkeley
campus, where Figure 7 shows the ﬂoor plan and location
priority. The priority is set HIGH to facilitate region-based
thermal and lighting control [21], MEDIUM for shared spaces
such as kitchen and conference room for energy apportion-
ment, and LOW for corridors. Fingerprints are collected by
an Android phone (Nexus 5), iPad, and iPhone, in two in-
dependent experiments, where 7 or 9 access points (D-Link
DIR-605LWiFi Cloud Router) are installed as summarized in
Table II. The average number of ﬁngerprints ± 1 standard
deviation for all 40 subregions (“Avg”), and the total time for
the experiment, which accounts for roughly 3 seconds required
to collect one ﬁngerprint (“Tot” ) are indicated in the table.
Figure 4 shows the RSSI with respect to the log distance
from the ﬁngerprint to the access point. Generally, a linear
relation is observed (with correlation score .77), though the
variance can be reduced by accounting for walls as suggested
by Bahl and Padmanabhan, [1]. It can be seen that the
dependency is stable for all devices (Android, iPad, iPhone),
which ensures cross-platform performance of ﬁngerprints con-
ﬁguration.
log (distance)
-0.5
0
0.5
1
1.5
2
2.5
3
RSSI (dB)
-100
-90
-80
-70
-60
-50
-40
Android
iPad
iPhone
Linear fitting
Figure 4. Plots of RSSI vs. log distance color coded by devices. A linear
regression line is ﬁtted on the data: RSSI = −8.31 · log(d) − 53.4.
1) Examination of Objective Consistency: Given location
priority map c and frequency map π, the actual loss of an IPS
system parameterized by (θrt, θfp) is given by
ˆL(θrt, θfp) =
X
i∈[N]
πi
X
j∈R(i)
ciξi(j)
|
{z
}
Weighted cost of location confusion
,
(12)
where ξi(j) is the empirical evaluation of the misclassiﬁcation
rate of location i to its neighboring spots j,
ξi(j) =
1
|Xi|
X
x∈Xi
1(hθ(x) = j, j ̸= i).
(13)
Xi is the set of test points at location i, and 1(hθ(x) = j, j ̸=
i) is the indicator function valued 1 if the IPS function hθ(x),
e.g., 1-nearest neighbor, outputs j ̸= i, and 0 otherwise. Given
a particular setup, the actual cost and the expected cost given
in (11) is shown in Figure 5.
Expected cost by APEC
3
3.5
4
4.5
5
5.5
Actual cost
0.5
1
1.5
2
2.5
3
1 router
2 routers
3 routers
4 routers
5 routers
6 routers
7 routers
8 routers
9 router
Quadratic fitting
Figure 5. Plots of the actual cost (12) vs. the expected cost (11), color coded
by the number of routers deployed. A quadratic curve is ﬁtted to the data:
ˆL = 0.37 · L2
e − 2.34 · Le + 4.46, where ˆL and Le are actual and expected
losses given in (12) and (11) respectively.
As it can be seen, the expected cost by APEC is a strong
indicator of the actual cost of IPS. Compared to ξi(j) which
is hard to determine a priori, the expected cost is easy to
calculate as a function of (θrt, θfp), as a closed form solution
of the misclassiﬁcation rate Pi(hθ(x) = j) is derived in (10).
In other words, we can predict the ﬁngerprints-based IPS
performance based on the router-ﬁngerprints conﬁguration,
which can be useful for other problems as well, such as the
optimization of the number of routers to be deployed under
budget constraints.
2) Examination of Solution Superiority: Though it is dif-
ﬁcult to check strict optimality due to the non-convexity and
intractable state space of the problem, solution superiority can
be demonstrated by comparing to the two common practices,
i.e., random and uniform selections, where the former ran-
domly allocates ﬁngerprints, the latter maintains a balanced
proﬁle over the space. Both methods, nevertheless, ignores
user preferences encoded in the location priority and frequency
maps. As the expected cost is shown to be a strong predictor
of the actual cost, APEC, theoretically, can reach a preferred
solution as guided by the optimization of (2).
As it is shown in Figure 6, which illustrates the distribution
of actual costs (12) in Experiment A and B (see Table II),
105
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-418-3
UBICOMM 2015 : The Ninth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

G
GG
G
G
0.6
0.8
1.0
1.2
Android
iPad
iPhone
Actual cost
Methods
Random selection
Uniform selection
APEC Greedy
G
GG
GG
G
G
G
G
G
G
G
G
GG
GG
G
GGG
G
G
G
GGGG
GG
GGGG
G
GGGGG
G
GG
GG
GG
G
G
G
G
GGGGGGG
G
0.6
0.8
1.0
Android
iPad
iPhone
Actual cost
Methods
Random selection
Uniform selection
APEC Greedy
Figure 6. Actual cost distribution in Experiment A (left) and B (right) for all devices color coded by the ﬁngerprinting methods, i.e., random selection, uniform
selection, and APEC Greedy. The box goes from the 1st quantile to the 3rd quantile, with the black line indicating the mean. As a side note, Android device
incurs less cost in both experiments as a result of its stability of the RSSI signal.
Figure 7. Visualization of IPS conﬁguration in CREST for experiment A (left) and B (right), where 5 or 7 access points are deployed according to APEC
Greedy. Location priority map is color coded as illustrated in the legend. Location frequency map is not shown, which is HIGH for cubicles, MED for shared
spaces, and LOW for corridors. The radius of the green circle indicates the number of ﬁngerprints at the spot.
the strategy suggested by APEC performs better than the
others for all devices. Since a lower actual cost is a result of
accurate classiﬁcation in high priority areas, APEC is effective
in catering to user needs.
3) Visualization:
The
best
ﬁngerprints
conﬁguration,
(θrt, θfp), as chosen by APEC Greedy for Experiment A and
B are shown in Figure 7. Some simple guiding rules can be
learned from observations:
•
Routers are placed in regions with high priority to
ensure ﬁngerprints distinction.
•
More ﬁngerprints are needed for high priority areas.
•
Region close to the routers requires more ﬁngerprints.
The third point, though less intuitive, can be explained by
inspecting Figure 4, where the RSSI changes slowly in near-
router regions, and the difference of distances are not sufﬁcient
for ﬁngerprints separations.
As future work, we would like to implement the visual-
ization in mobile platforms to further assist planning when
ﬁngerprints IPS is in demand.
V.
CONCLUSION AND FUTURE WORK
APEC systematically optimizes the locations of access
points and allocations of ﬁngerprints over space by taking into
consideration user preferences through local priority/frequency
maps and budget constraints, which can be combined with
106
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-418-3
UBICOMM 2015 : The Ninth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

existing ﬁngerprinting-based methods to improve utility of the
indoor positioning system.
The core of APEC is the optimization problem (2), where
the objective is the expected loss (11) based on the proposed
HBSM and theoretical results on the misclassiﬁcation rates.
As veriﬁed by objective consistency (Figure 5), the expected
loss is a strong predictor for the actual loss incurred by the
IPS system, a useful result to determine the performance of
the system in the planning stage.
To make APEC computationally tractable, the coordinate
descent and router-ﬁngerprints decoupling heuristics are pro-
posed, which are validated by simulation. Experiments with
three devices (Android, iPad, iPhone) in two different setups
(7/9 routers) demonstrates solution superiority of APEC as
compared to the uniform and random approaches. Through
visualization, several simple rules are developed, while the
map serves as a visual guidance for ﬁeld deployment. As future
work, we want to implement and visualize APEC conﬁguration
on mobile platforms to facilitate regular planning.
ACKNOWLEDGMENT
This research is funded by the Republic of Singapore’s
National Research Foundation through a grant to the Berkeley
Education Alliance for Research in Singapore (BEARS) for
the Singapore-Berkeley Building Efﬁciency and Sustainability
in the Tropics (SinBerBEST) Program. BEARS has been
established by the University of California, Berkeley as a
center for intellectual excellence in research and education in
Singapore.
REFERENCES
[1]
P. Bahl and V. N. Padmanabhan, “Radar: An in-building rf-based user
location and tracking system,” in INFOCOM 2000. Nineteenth Annual
Joint Conference of the IEEE Computer and Communications Societies.
Proceedings. IEEE, vol. 2, 2000, pp. 775–784.
[2]
T. Roos, P. Myllymki, H. Tirri, P. Misikangas, and J. Sievnen, “A
probabilistic approach to wlan user location estimation,” International
Journal of Wireless Information Networks, vol. 9, 2002, pp. 155–164.
[3]
M. Youssef and A. Agrawala, “The horus wlan location determination
system,” in Proceedings of the 3rd international conference on Mobile
systems, applications, and services.
ACM, 2005, pp. 205–218.
[4]
Z. Yang, C. Wu, and Y. Liu, “Locating in ﬁngerprint space: wireless
indoor localization with little human intervention,” in Proceedings of
the 18th annual international conference on Mobile computing and
networking.
ACM, 2012, pp. 269–280.
[5]
A. Rai, K. K. Chintalapudi, V. N. Padmanabhan, and R. Sen, “Zee: zero-
effort crowdsourcing for indoor localization,” in Proceedings of the 18th
annual international conference on Mobile computing and networking.
ACM, 2012, pp. 293–304.
[6]
H. Liu, Y. Gan, J. Yang, S. Sidhom, Y. Wang, Y. Chen, and F. Ye, “Push
the limit of wiﬁ based localization for smartphones,” in Proceedings
of the 18th annual international conference on Mobile computing and
networking.
ACM, 2012, pp. 305–316.
[7]
J.-g. Park, B. Charrow, D. Curtis, J. Battat, E. Minkov, J. Hicks,
S. Teller, and J. Ledlie, “Growing an organic indoor location system,”
in Proceedings of the 8th international conference on Mobile systems,
applications, and services.
ACM, 2010, pp. 271–284.
[8]
K. Chintalapudi, A. Padmanabha Iyer, and V. N. Padmanabhan, “Indoor
localization without the pain,” in Proceedings of the sixteenth annual
international conference on Mobile computing and networking.
ACM,
2010, pp. 173–184.
[9]
H. Lim, L.-C. Kung, J. C. Hou, and H. Luo, “Zero-conﬁguration
indoor localization over ieee 802.11 wireless infrastructure,” Wireless
Networks, vol. 16, 2010, pp. 405–420.
[10]
Y. Ji, S. Biaz, S. Pandey, and P. Agrawal, “Ariadne: a dynamic indoor
signal map construction and localization system,” in Proceedings of
the 4th international conference on Mobile systems, applications and
services.
ACM, 2006, pp. 151–164.
[11]
Y. Gwon and R. Jain, “Error characteristics and calibration-free tech-
niques for wireless lan-based location estimation,” in Proceedings of
the second international workshop on Mobility management & wireless
access protocols.
ACM, 2004, pp. 2–9.
[12]
D. Roland, E. Martin, and B. Robert, “Indoor navigation by wlan
location ﬁngerprinting,” in UBICOMM 2014, The Seventh International
Conference on Mobile Ubiquitous Computing, Systems, Services and
Technologies, Porto, Portugal, 2013, pp. 1–6.
[13]
L. Li, G. Shen, C. Zhao, T. Moscibroda, J.-H. Lin, and F. Zhao, “Expe-
riencing and handling the diversity in data density and environmental
locality in an indoor positioning service,” in Proceedings of the 20th
annual international conference on Mobile computing and networking.
ACM, 2014, pp. 459–470.
[14]
J. Goldhirsh and W. J. Vogel, “Handbook of propagation effects for
vehicular and personal mobile satellite systems,” NASA Reference
Publication, vol. 1274, 1998, pp. 40–67.
[15]
J. Baxter, “A bayesian/information theoretic model of learning to learn
via multiple task sampling,” Machine Learning, vol. 28, no. 1, 1997,
pp. 7–39.
[16]
S.-T. Sheu, Y.-M. Hsu, and H.-Y. Chen, “Indoor location estimation us-
ing smart antenna system with virtual ﬁngerprint construction scheme,”
in UBICOMM 2014, The Eighth International Conference on Mobile
Ubiquitous Computing, Systems, Services and Technologies, Rome,
Italy, 2014, pp. 281–286.
[17]
H. D. Nguyen, T. M. Doan, and N. T. Nguyen, “Cgsil: A viable training-
free wi-ﬁ localization,” in UBICOMM 2014, The Eighth International
Conference on Mobile Ubiquitous Computing, Systems, Services and
Technologies, Rome, Italy, 2014, pp. 268–274.
[18]
C. E. Rasmussen, Gaussian processes for machine learning.
Citeseer,
2006.
[19]
G. McLachlan, Discriminant analysis and statistical pattern recognition.
John Wiley & Sons, 2004, vol. 544.
[20]
B. Klaus, “Effect size estimation and misclassiﬁcation rate based
variable selection in linear discriminant analysis,” Journal of Data
Science, vol. 11, 2013, p. 537.
[21]
L. J. Ratliff, M. Jin, I. C. Konstantakopoulos, C. Spanos, and S. S.
Sastry, “Social game for building energy efﬁciency: Incentive design,”
in 52nd Annual Allerton Conference on Communication, Control, and
Computing, Monticello, IL, 2014, pp. 1011 – 1018.
107
Copyright (c) IARIA, 2015.     ISBN:  978-1-61208-418-3
UBICOMM 2015 : The Ninth International Conference on Mobile Ubiquitous Computing, Systems, Services and Technologies

