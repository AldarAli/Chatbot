Distance Measurement System Based on Visible Light Communications and 
Ultrasound Emitters 
 
R. Rodriguez, J. Rabadan, V. Guerra, J. Rufo, R. Perez-Jimenez 
Institute for Technological Development and Innovation on Communications (IDeTIC) 
Universityof Las Palmas de Gran Canaria 
Las Palmas de G. C., Spain 
e-mail: jose.rabadan@ulpgc.es 
 
 
Abstract— Distance estimation is an important task in 
positioning systems, as it is needed for performing the 
triangulation process used by location algorithms. Different 
techniques, such as received signal strength indication (RSSI), 
time of arrival (ToA), and time difference of arrival (TDoA), 
can be used to estimate the distance between devices. Cricket 
indoor positioning systems, designed by MIT, are based on 
TDoA techniques, and they use a combination of ultrasound 
and radiofrequency signals. In this paper, a new distance 
measurement scheme based on Cricket technology, but 
introducing some modifications, is proposed. In this way, some 
new advantages are obtained. The radiofrequency signal is 
substituted by an optical signal, making the system applicable 
to environments where radio emissions are not suitable. 
Furthermore, a double-way measurement is also introduced, in 
order to allow both measurement devices (base station and 
mobile node) to perform the distance estimation, unlike in 
Cricket systems, where only one of the devices is able to 
calculate the distance. 
Keywords-Distance estimation; VLC; time arrival; double 
measurement. 
I. 
INTRODUCTION 
Indoor distance measurement is a challenging problem 
for many indoor positioning systems, as they make use of 
location information to offer contextual services [1][2][3]. 
During the last few years, many different wireless methods 
based on WiFi, wireless sensor networks, Bluetooth, and 
Cricket sensors [4] have been suggested. These techniques 
use specific algorithms to estimate distance from different 
signal parameters, such as signal strength, and arriving 
angles or delays. However, these distance-measurement 
systems either need an additional network infrastructure or 
have difficulties in obtaining accurate distances because of 
multipath propagation. Visible Light Communications 
(VLC) [5][6] takes advantage of the relative high switching 
speed of LEDs to use the light from lamps not only for 
lighting but also as a transmission channel. VLC has a set of 
communication 
characteristics: 
low 
cost, 
light-speed 
propagation, and no electromagnetic interference, which 
reduces 
some 
Radio 
Frequency 
(RF) 
technological 
drawbacks, such as spectrum saturation or interference 
between systems.  
 
In this paper, a new VLC distance-measurement scheme, 
based on the Cricket’s TDoA paradigm is proposed. It uses 
an optical signal instead of the Cricket’s radiofrequency one 
in order to avoid the aforementioned radio signal problems. 
In this way, the system can be used in other environments, 
such as underwater scenarios, where radiofrequency presents 
a prohibitively high attenuation. However, optical links 
require a more complicated alignment, or the use of several 
optical emitters and receivers. Moreover, by the moment, 
optical technology presents the lack of broadly accepted and 
implemented standards, which assure the interoperability 
between different systems, and only isolated solutions as the 
one presented in this work are being developed. 
On the other hand, the transmission and reception stages 
have been modified in order to provide distance 
measurement capability simultaneously to the two devices 
involved in the process: the base station (or transmitter node 
in this work) and the mobile node (or receiver node). In 
Cricket systems, only receiver-node devices are able to 
estimate distance from the signal emitted by the transmitter 
node. In the proposed system, the mobile node returns back a 
new optical signal to the base station, allowing it to perform 
its own relative distance estimation. As it is needed in 
traditional Cricket networks, in order to develop a full 
positioning system, a trilateration structure [7] must be 
implemented using several of the presented distance meters. 
This paper is organized as follows. In Section II, a 
description of the proposed method for obtaining the distance 
is presented. Section III presents a proof of concept 
implemented prototype. In Section IV, a detailed description 
of the measurements and results are provided. Section V 
summarizes the obtained conclusions. 
II. 
DISTANCE ESTIMATION METHODS 
In this work, VLC and ultrasound links are used in the 
measurement devices. The optical signals perform the same 
function than the Radiofrequency ones in Cricket schemes, 
which is to serve as time reference for measuring the 
ultrasound signal time delay. The basic scheme of the 
proposed system is presented in Fig. 1. 
As it can be observed, the transmitter node uses an 
ultrasound transmitter, an optical transmitter and an optical 
receiver, whilst the receiver node makes use of an ultrasound 
receiver, an optical receiver and an optical transmitter. In this 
way, a single acoustic link and two optical links are 
1
Copyright (c) IARIA, 2016.     ISBN:  978-1-61208-514-2
ICWMC 2016 : The Twelfth International Conference on Wireless and Mobile Communications (includes QoSE WMC 2016)

established. The use of VLC technology is proposed because 
the aim of this work is to use the illumination fixtures as base 
stations in indoor positioning systems. Nevertheless, this 
scheme can be also used with other optical wavelengths (IR 
e.g.). 
 
Figure 1.  System scheme 
In the measurement process, the base station starts 
sending an optical and an ultrasound signalsynchronously. 
The mobile node receives the optical signal and waits for the 
ultrasound signal arrival. As the time for light propagation 
can be neglected, at least, when compared with acoustic 
propagation, it can be considered that light is transmitted 
with zero delay, and the delay between both signals in 
reaching the receiver node, depends only on the ultrasound 
propagation. Therefore, the distance from base station to 
mobile node is proportional to that delay. This procedure is 
equivalent to the one performed by Cricket systems, except 
for the use of an optical signal instead of the radiofrequency 
one for delay reference. In this case, the estimated distance is 
calculate by (1) 
𝐷𝐷 =
𝑡𝑡
1
𝑣𝑣𝑆𝑆 −
1
𝑐𝑐
≈ 𝑣𝑣𝑆𝑆 ∙ 𝑡𝑡 
(1) 
Where D is the distance, t is delay time, c is the speed of 
light and vS is the speed of sound. Nonetheless, there are 
several delay sources that must be considered if an accurate 
result is intended. The main delay sources are the electric-to-
acoustic and acoustic-to-electric transduction times in the 
acoustic interfaces, and the time delay due to the sequential 
operation of the microcontroller.The delays produced by this 
sources are solved by means of an adjustment variable. In 
order to set and synchronize the LED and the ultrasound 
pulses in the mobile system, an adjustment variable with a 
value of 250 microseconds has been used. 
This value allows adjusting both the time required for 
ultrasound transducer operation and the runtime delay in the 
microcontroller. In this way, the delay time between optical 
and ultrasound pulse is calculated by (2). 
Δ𝜏𝜏𝐿𝐿𝐿𝐿𝐷𝐷−𝑈𝑈𝑆𝑆 = (𝑇𝑇𝜇𝜇𝜇𝜇 − 𝑇𝑇𝑖𝑖𝑖𝑖𝑖𝑖 ) − Δ𝜏𝜏𝑎𝑎𝑎𝑎𝑎𝑎  
(2) 
Where the time between the LED and ultrasound 
pulses,  Δ𝜏𝜏𝐿𝐿𝐿𝐿𝐷𝐷−𝑈𝑈𝑆𝑆 , is calculated by subtracting to the 
measured microseconds by the microcontroller 𝑇𝑇𝜇𝜇𝜇𝜇 ,the start 
time measurement 𝑇𝑇𝑖𝑖𝑖𝑖𝑖𝑖 , and the adjustment variable Δ𝜏𝜏𝑎𝑎𝑎𝑎𝑎𝑎 . 
At the instant in which the ultrasound signal is received, 
the mobile node sends back an optical signal, indicating that 
the ultrasound signal has reached the mobile node. 
Neglecting again the optical signal propagation delay, the 
base station is able to estimate the distance from the delay 
between its optical and ultrasound transmission and the 
reception of the optical signal from the mobile node (using 
again (1)). In this way, we obtain distance estimation 
capability in both devices, increasing the system flexibility. 
This proposed modification can be easily introduced in 
Cricket systems by adding an additional radiofrequency 
signal transmission. Fig. 2 presents the corresponding 
chronogram. 
 
Figure 2.  Signals timing for mobile node and base station 
It can be seen how the delay values are obtained in the 
mobile node and in the base station. 
III. 
SYSTEM PROTOTYPE 
As a proof of concept, a prototype based on the proposed 
scheme has been implemented. Fig. 3 depicts the system.  
 
Figure 3.  Distance measurement system 
This prototype is based on microcontrollers for time 
measurement and distance calculation. We have used Atmel 
ATMega328P (Arduino Nano) for base station and 
NodeMCU (based on ESP8266 chip) for the mobile node. 
Moreover, the system includes results presentation by means 
of crystal display (LCD) and a wireless network connection 
to a cloud server. The measurement process performed by 
the system is described below 
1. 
The transmitter node sends a light pulse 
and an ultrasound signal and starts its time counter. 
Since a MCU is used, both pulses are not sent 
exactly at the same time and a very small artificial 
2
Copyright (c) IARIA, 2016.     ISBN:  978-1-61208-514-2
ICWMC 2016 : The Twelfth International Conference on Wireless and Mobile Communications (includes QoSE WMC 2016)

delay is introduced. This delay presents no jitter and 
can be easily considered at the receiver side. 
2. 
The optical receiver at the mobile node 
detects the optical pulse and starts its own time 
counter. Due to light speed, it can assumed that 
both time counters start at almost the same time. 
3. 
When the ultrasound signal is detected, the 
receiver node stops the counter and sends an optical 
pulse to the transmitter node. In that moment, it can 
perform the distance calculation from the measured 
delay. This estimation is stored and published in the 
web page. Regarding the ultrasound detection, 
taking into account the behavior of piezoelectric 
devices, two extra delays due to excitation must be 
considered. Furthermore, the sound speed is highly 
affected by temperature, needing the use of a 
temperature sensor to estimate the local sound 
speed in order to compensate the propagation-speed 
error. In order to consider this problem, mobile 
node includes a temperature sensor and uses this 
information for calculating the actual sound speed 
following (3). 
𝑉𝑉𝑆𝑆 = 331.5 + 0.60714𝑡𝑡 (𝑚𝑚/𝑠𝑠) 
(3) 
Where t is the temperature in Celsius degrees. 
4. 
When the transmitter node receives the 
optical signal, it stops its time counter and proceeds 
to calculate its relative range. Once more, thanks to 
light speed, the optical signal can be considered to 
reach the base station at the same time than the 
ultrasound 
signal 
reach 
the 
receiver 
node. 
Therefore, both devices obtain the same delay for 
calculating the distance. Finally, the base station 
calculates the distance and presents it in the LCD 
display. 
In the next subsections, the devices’ main blocks are 
described and commented. 
A. Ultrasound subsystem 
The main component of this block is the ultrasound 
transducer 400ST/R160 from Daventech. This device 
requires a 40 KHZ signal, which is generated by the 
microcontroller and a driver circuit, composed mainly by a 
MAX232 integrated circuit. Fig. 4 shows the emitter’s 
schematic. 
 
Figure 4.  Ultrasound emitter 
The ultrasonic wave receiver circuit includes a detector 
(the same transducer than in the emitter), and a signal 
amplifier based on CX20106A from Sony, which is 
connected to the NodeMCU microcontroller, as is shown in 
Fig. 5. 
 
Figure 5.  Ultrasound receiver 
B. Visible light subsystem 
Optical links make use of white LED and phototransistor 
BPW40 devices as transducers and in this case, simple 
current drivers and amplified receivers have been 
implemented.Since the system is a proof of concept, low-
gain schemes have been used. Nevertheless, the use of 
integrated high-gain amplification circuits would improve 
the performance of a commercial device. Fig. 6 shows the 
emitter and receiver circuits used in this prototype. 
 
 
Figure 6.  Optical emitter and receiver schemes 
Fig. 7 and 8 present the circuits corresponding to the base 
station system and the mobile node system. As it was 
explained before, both devices have optical emitter and 
receiver blocks, whilst the ultrasound block is different: is a 
transmitter in the base station and a receiver in the mobile 
node. 
3
Copyright (c) IARIA, 2016.     ISBN:  978-1-61208-514-2
ICWMC 2016 : The Twelfth International Conference on Wireless and Mobile Communications (includes QoSE WMC 2016)

 
Figure 7.  Base station scheme 
 
Figure 8.  Mobile node scheme 
Finally, an actual picture of base station and mobile node 
is shown in Fig. 9. 
 
 
Figure 9.  Base station and mobile node scheme 
Where it can be appreciated the actual dimmensions and 
circuitry conplexity of the implemented prototypes. 
IV. 
RESULTS 
In this section, experimental results of the implemented 
proposed system are presented. First, some signals which are 
used in the process, such as the emitted and received 
ultrasound signal and the pulse generated for the 
microcontroller, can be shown in Fig. 10. 
 
 
 
Figure 10.  Ultrasound driving signal (left), received ultrasound signal 
(right) and detected (down) signals. 
Note that the received ultrasonic signal is affected by 
severe multipath distortion. However, since this block acts 
only as a power indicator, multipath only introduces a delay 
(which can be estimated and considered in the distance 
calculation). Furthermore, the received signal is amplified 
and passed through an open-loop comparator, generating a 
pulse to serve as input to the microcontroller. Regarding the 
optical part of the system, the emitted and received pulses 
are depicted in Fig. 11. 
 
 
Figure 11.  Optical emitted (left) and detected (right) signals. 
 
Figure 12.  Optical (yellow) and Ultrasound (green) received pulses. 
An example of delay measurement is presented in Fig. 
12, where the optical and ultrasound pulses received by the 
4
Copyright (c) IARIA, 2016.     ISBN:  978-1-61208-514-2
ICWMC 2016 : The Twelfth International Conference on Wireless and Mobile Communications (includes QoSE WMC 2016)

mobile nodecan be observed.A delay between signals of 
ΔX= 400 µs is observed. Introducing it in (1), along with the 
sound speed (0.0343 cm/s), results in an estimated distance 
of 13.72 cm. Theseresults suggest an interesting high 
accuracy of the system, since the distance between terminals 
was set to 14 cm. 
In order to test the system performance, different 
distances were tried. Fig. 13 compares the obtained results in 
the base station and mobile devicewith the real value.   
 
Figure 13.  Measured distance values 
Finally, Fig. 14 shows the measurement error in both 
devices.  
 
Figure 14.  Measures error in base station (left) and mobile node (right). 
It can be observed that the error remains below 2% 
except at the measurement limits of the system, where it is 
dramatically increased due to low signal strength (long 
distance) or due to the limited processing speed of the CPU 
(short distance). 
V. 
CONCLUSIONS 
In this work, a new VLC distance-measurement scheme, 
based on TDoA has been proposed. It is based on Cricket 
technology but introducing some modifications, which 
provide several advantages. The main change consists of the 
substitution of the cricket radiofrequency signal by an optical 
one.  
 
 
In this way, the system can be used in new environments 
not suitable for radiofrequency technology, such as 
underwater scenarios, where radiofrequency suffers a 
prohibitively high attenuation.  
On the other hand, in the proposed system, the mobile 
node returns back a new optical signal to the base station for 
it to perform its own distance estimation. Therefore, the 
proposed system provides distance measurement capability 
to both devices involved in the process: the base station and 
the mobile node. In Cricket systems, only one of the devices 
is able to calculate the distance, from the signals (radio and 
ultrasound) emitted by the other. Nevertheless, this technique 
can be easily incorporated to Cricket modules, just including 
a new radiofrequency signal.  
As a proof of concept, a basic prototype has been 
implemented. It consists on a base station, which generates 
optical and ultrasound signals, and a mobile node, which 
provides the optical signal to the base station. While this 
prototype has some limitation, such as its short range, results 
probe that both system devices are able to calculate the 
distance between them, with similar accuracy (about 2% of 
error). Therefore, with this implementation, the accuracy and 
feasibility of the proposed technique is demonstrated. 
ACKNOWLEGMENT 
This work was supported in part by the Spanish Research 
National Plan (ARIES Project Ref. TEC2013-47682-C2-1). 
REFERENCES 
[1] A. Awad, T. Frunzke, and F. Dressler, “Adaptive Distance 
Estimation and Localization in WSN using RSSI Measures,”, 
Proceedings of 10th Euromicro Conference on Digital System 
Design Architectures, Methods and Tools (DSD 2007), pp. 
471–478, Aug. 2007. 
[2] G. Del Campo-Jimenez, J. M. Perandones, and F. J. Lopez- 
Hernandez, "A VLC-based beacon location system for mobile 
applications", Proceedings of IEEE International Conference 
on Localization and GNSS (ICL-GNSS), pp. 1-4, Jun. 2013. 
[3] H. Kim, D. Kim, S. Yang, Y. Son, and S. Han, "An indoor 
visible light communication positioning system using a RF 
carrier allocation technique", IEEE Journal of Lightwave 
Technology, vol.31 nº.1, pp. 134-144, Jan. 2013. 
[4] N. B. Priyantha, A. Chakraborty, and H. Balakrishnan, “The 
Cricket Location-Support system”, Proceedings of 6th ACM 
MOBICOM, pp. 266-274, Aug. 2000. 
[5] F. Delgado, I. Quintana, J. Rufo; J. Rabadan, C. Quintana, 
and R. Perez-Jimenez, ”Design and Implementation of an 
Ethernet-VLC Interface for Broadcast Transmissions”, IEEE 
Communications Letters, vol. 14 nº12, pp. 1089–1091, Oct. 
2010. 
[6] Y. Tanaka, T. Komine, S. Haruyama, and M. Nakagawa, 
“Indoor Visible Light Transmission System Utilizing White 
LED Lights”, IEICE Transactions on Communications, vol. 
E86-B, nº. 8, pp. 2440-2454, Aug. 2003 
[7] D. E. Manolakis, “Efficient solution and performance analysis 
of 
3-D 
position 
estimation 
by 
trilateration”, 
IEEE 
Transactions on Aerospace and Electronic Systems, vol. 32, 
nº. 4, pp. 1239–1248, Oct 1996.  
 
0
10
20
30
40
50
60
70
80
0
10
20
30
40
50
60
70
80
90
cm
cm
Actual value
Base station
value
Mobile node
value
0
10
20
30
40
50
60
70
80
0
2
4
6
8
10
12
14
16
18
 error
% error
Mobil node
% error
Base station
5
Copyright (c) IARIA, 2016.     ISBN:  978-1-61208-514-2
ICWMC 2016 : The Twelfth International Conference on Wireless and Mobile Communications (includes QoSE WMC 2016)

