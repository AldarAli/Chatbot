An Adaptive Entropic Thresholding Technique for Image Processing and 
Diagnostic Analysis of Microcirculation Videos 
 
Nazanin Mirshahi, 
Kayvan Najarian 
Dept. of Computer 
Science 
VCU 
Richmond, VA, USA 
mirshahin@vcu.edu, 
knajarian@vcu.edu 
 
Sumeyra Demir, 
Rosalyn Hobson 
Dept. of Electrical 
Engineering 
VCU 
Richmond, VA, USA 
demirsu@vcu.edu, 
rhobson@vcu.edu 
 
Kevin Ward 
Dept. of Emergency 
Medicine  
 
VCURES 
Richmond, VA, USA 
krward@vcu.edu 
 
 
Roya Hakimzadeh 
 
Signal Processing 
Technologies LLC 
 
Richmond, VA, USA 
contact@signalproces
singtechnologies.com
Abstract 
– 
Understanding 
the 
functionality 
of 
microcirculation is a key factor in the analysis of blood 
circulatory system. The blood flow distribution changes, 
based on the physiological effects of disorders. This study 
presents a method for analysis of microcirculation videos 
captured from lingual surface of 10 animal subjects. The 
technique applies advanced image processing methods to 
stabilize videos, segment microvessels (capillaries and 
small blood vessels), and estimate the average Functional 
Capillary Density on 20 consecutive frames for each 
subject. The algorithm consists of four main parts: pre-
processing, video stabilization, entropic-based adaptive 
local thresholding segmentation and post-processing. The 
key objective is to quantitatively examine the changes 
that occur in microcirculation over treatment periods for 
diseases as well as for the resuscitation process. The 
designed system will help physicians and medical 
researchers in diagnostic and therapeutic decision 
making to determine the sufficiency of resuscitation 
process and the effect of drug consumption in patients. In 
particular, the system focuses on minimizing user 
interaction while improving the accuracy of the analysis. 
Visual evaluation of the results by medical experts 
indicates that the technique is capable of identifying 95% 
of active capillaries and blood vessels in videos.  
 
Keywords - Microcirculatin, Image processing, multi-
resolution, 
entropic 
thresholding, 
Adaptive 
local 
thresholding, Lorentz information measure 
 
I. INTRODUCTION 
 
Microcirculation refers to the blood flow in blood 
vessels less than 100 µm luminal diameter [2]. 
Changes in microcirculation might be due to numerous 
diseases 
and 
abnormalities 
in 
humans. 
Microcirculatory studies indicate that the small 
diameter of microvessels (arterioles, capillaries and 
venules) helps observe changes in blood circulation 
more evidently compared to large blood vessels. 
Basically, the rheological properties of blood in  
capillaries and small blood vessels lead to effective 
viscosity 
in 
those 
vessels 
which 
considerably 
differentiates the circulation of red blood cells and 
plasma in microvessels and large blood vessels.  The 
major function of the micro-vascular network is 
distribution of nutrients, fluid and oxygen throughout 
tissues in humans [3,4]. As a result, the distributions of 
microcirculatory network and blood circulation are 
considered to be key factors in human physiological 
health [5-8]. Evidence suggests that information 
regarding the status of microcirculation plays a crucial 
role in treatment and diagnosis of several diseases such 
as sepsis, sickle cell, chronic ulcers, diabetes mellitus 
and hypertension [9-13]. Research and clinical 
experience show that each of the mentioned diseases 
uniquely affects characteristics of microcirculation 
such as structure of capillaries and features of blood 
flow [14-18]. Hence, investigation of microcirculatory 
changes has clinical significance in measurement and 
observation of the changes in response to treatment of 
microvessels 
under 
clinical 
conditions. 
Timely 
detection of such changes potentially helps in taking 
proper actions which in turns improves the chances of 
treatment success. A technique to quantitatively assess 
and monitor these alterations is extremely valuable for 
further study of such pathological conditions [19]. 
Particularly, in trauma care, continuous monitoring of 
microcirculation and measurement of microcirculation 
indices 
while 
resuscitation 
process 
helps 
in 
determining when to start/stop resuscitation [20-22]. 
The 
recent 
development 
of 
videomicroscopy 
technology has provided effective tools for detection 
and assessment of tissue perfusion and oxygenation 
through 
visualization 
of 
microvasculature 
[23]. 
Quantitative analysis of microcirculation allows 
monitoring changes in microvessels that occur due to 
diseases and other abnormalities. Both visual analysis 
and use of existing semi-automated video analysis 
tools are time-consuming and demanding, preventing 
real-time assessment of microcirculation. This calls for 
133
International Journal on Advances in Life Sciences, vol 2 no 3 & 4, year 2010, http://www.iariajournals.org/life_sciences/
2010, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

automated systems to be used for applications 
including resuscitation.   
Two prevalent medical imaging techniques that have 
been widely used for examining microcirculation 
during surgery and for other clinical research are 
Orthogonal Polarization Spectral (OPS) imaging and 
Side-stream Dark Field (SDF) [24,25]. SDF is superior 
to OPS in the field of microcirculation study as it 
improves contrast and lowers surface reflectance 
compared to OPS [35]. Although advances in hardware 
systems have played a major role in acquiring 
knowledge about the physiology and pathology of 
microvascular function, lack of existing techniques for 
rapid and accurate processing of microcirculation 
videos is still an issue. Manual analysis of this 
information by experts is a complex and time- 
demanding process which may not be used for real-
time assessment of microcirculation; however, an 
automated 
system 
can 
therapeutically 
and 
diagnostically 
assist 
physicians 
and 
medical 
researchers. 
Several methods have been employed to analyze 
microcirculation images. A short version of the method 
proposed in this paper was mentioned in [1]. Dobbe et 
al. has proposed a semi-automatic, highly accurate 
method for the analysis of microcirculation [26]. The 
method 
applies 
image 
stabilization, 
centerline 
detection and space time diagram to detect capillaries 
and small blood vessels. Despite the high accuracy, 
this method is extremely time-consuming and requires 
human interaction to produce acceptable results, and 
therefore, 
it 
is 
not 
appropriate 
for 
real-time 
applications of microcirculation analysis. The image 
processing techniques that were proposed in the field 
of microcirculation are mainly used to process high 
quality 
color 
and/or 
grayscale 
retinal 
images; 
conversely, the accuracy of the results declines when 
the same method is applied to other microcirculation 
images due to their low contrast. Numerous techniques 
and their combinations have been employed on 
segmentation 
of 
small 
blood 
vessels. 
Pattern 
recognition-based techniques were used by Staal et al. 
to analyze two-dimensional color images of retina [27]. 
Several features of the image are selected and 
classified to extract image ridges automatically. The 
main shortcoming of this method is that it is likely to 
over- and undersegment the vessels.  The tracking-
based approach described in [28] locates the optic 
nerve in ocular fundus images. Utilizing fuzzy 
convergence of the blood vessel, the algorithm uses 
two features, convergence of vessel network and 
brightness of the nerve to perform segmentation. 
Despite its capabilities, the method fails to accurately 
detect blood vessels where bright lesion regions exist.  
Vermeer et al. applied a model based approach [29]. 
The 
method 
incorporates 
Laplace 
concept, 
thresholding as well as classification to detect vessels 
in retinal images. The method requires high levels of 
human intervention, therefore, is not appropriate for 
real-time segmentation of microcirculation images.  
Artificial intelligence methods use prior knowledge for 
direct segmentation [30].  
Most of the vessel segmentation methods that were 
reviewed earlier in this section are capable of 
extracting vessels in retinal images; however, lack 
essential properties to segment microcirculation images 
[31]. The aim of the proposed study is to stabilize and 
segment low local contrast microcirculation videos 
automatically, accurately and in a close to real-time 
manner in order to aid physicians and clinical 
researchers in making diagnostic and therapeutic 
decisions. This algorithm attempts to eliminate human 
intervention in the precise extraction of small blood 
vessels. Furthermore, it calculates the diagnostically 
useful measure of Functional Capillary Density (FCD) 
for 20 consecutive frames in a microcirculation video 
[34].  The algorithm segments the image using a 
modified 
entropic 
thresholding 
technique 
[33]. 
Entropy-based methods apply a threshold to the images 
using entropy of an image or similar information. The 
rest of thresholding techniques are categorized into five 
main classes [36]. In histogram shape-based methods, 
certain parts of image histogram are assessed. 
Clustering-based methods utilize mixture of two 
Gaussians to separate foreground and background in an 
image. Object attribute-based algorithms look at 
similarities between the original image and its 
corresponding binary image. Higher order probability 
distribution is used in thresholding based on spatial 
methods. Local methods use local image properties to 
threshold an image. Experiments have shown that for 
the purpose of thresholding microcirculation images, 
entropic thresholding techniques yield the most 
successful outputs. 
Section II provides a detailed description of the 
methodology 
including 
preprocessing, 
video 
stabilization, segmentation and post-processing. The 
results of the study on 10 video samples of 
hemorrhaged and healthy subjects are presented in 
Section III. Section IV contains the conclusion and 
discussion of the obtained results. Finally, Section V 
concludes the paper with future work.  
 
II. METHODOLOGY 
 
The proposed methodology is an extension of [1]. 
Key modifications were applied to improve the 
segmentation part. Furthermore, the algorithm was 
examined on more data samples to evaluate the 
capabilities of the technique in this paper. The 
134
International Journal on Advances in Life Sciences, vol 2 no 3 & 4, year 2010, http://www.iariajournals.org/life_sciences/
2010, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

microcirculation videos used to validate the results of 
the proposed research study are based on SDF imaging 
technique, captured by MicroScan hardware [35]. 
MicroScan is an easy to use instrument that is mainly 
utilized in various microcirculation observations and 
analysis.  The data samples for this study were 
acquired from sublingual surface of healthy and 
hemorrhaged swine subjects. In SDF imaging 
modality, the light from light emitting diodes is 
absorbed by hemoglobin, which results in the visibility 
of flowing cells. Consequently, the walls of the 
capillaries become visible in the presence of Red 
Blood Cells (RBCs) [24]. Medical research has proven 
that lingual surface suffice for the investigation of 
microcirculation condition in the body as capillaries 
are adequately superficial for MicroScan. Thus, lingual 
recordings are considered valid indicators of normality 
or abnormalities of the microcirculatory network.  
A major challenge in the image processing of 
microcirculation videos are their low resolution and 
local contrast that complicates the distinction between 
objects of interest (capillaries and small blood vessels) 
and frame background. An instance of an original 
microcirculation frame is provided in Figure 2. 
Another challenge is the inconsistency of the graylevel 
intensity in background and blood vessels from one 
sample to another. The effect of uneven lighting due to 
the movement of camera and/or subjects results in 
different levels of intensity in different frames. 
Therefore, the choice of a single threshold level for an 
entire frame is not adequate for effective thresholding. 
The proposed study addresses the mentioned issues by 
adopting an adaptive entropic thresholding technique.  
Prior to being processed, videos are converted to 
their comprising sets of images or frames; these frames 
were either processed individually or in combination 
with other frames as will be described in the rest of the 
paper. An outline of different steps of the algorithm is 
provided in Figure 1. 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
Figure1. Block diagram of the algorithm 
 
A. PREPROCESSING 
 
    Preprocessing 
of 
microcirculatory 
images 
is 
essential considering the low local contrast of 
microcirculation 
images. 
Preprocessing 
usually 
comprise a series of operations to improve the quality 
of images in order to maximize the difference between 
image background and objects of interests. In 
microcirculation images, the intensity of capillaries and 
small blood vessels are exceptionally close to that of 
background and tissues. In order to process the images, 
the first main step is preprocessing. 
As the first step, adaptive histogram equalization is 
applied to the images to help enhance low local 
contrast of the images. The histogram of an image is a 
representation for the number of different pixel values 
in the image. Microcirculation images comprise of a 
narrow range of intensities. In adaptive histogram 
equalization, the histogram for various parts of the 
image 
is 
generated 
and 
interpolated. 
Bilinear 
interpolation eliminates the visibility of the boundary 
lines that were produced by local histograms. The 
result of adaptive histogram equalization is a modified 
image whose histogram is different from that of the 
original image. In other words, the background appears 
rather uniform in terms of intensity with a remarkable 
contrast as compared to the blood vessels and other 
artifacts in the image.    
To further reduce the effects of background noise, 
wavelet transformation is incorporated in this step. 
Wavelet transformation decomposes the image into its 
different frequency contents. Usually, high frequencies 
represent noise and low frequencies represent details in 
an image. The image is transformed to wavelet domain 
and decomposed with mother wavelet of Daubechies 8, 
level 2.  Following that, high frequencies present 
within the image are filtered.  Then the image is 
reconstructed in the original domain. The noise in the 
resulting image is much lesser than the input image.  
A microcirculation frame usually contains blood 
vessel in different levels of proximity to the surface of 
tongue. Representing images in multiple spatial-
Preprocessing 
Histogram Equalization 
Wavelet Transform 
Gaussian Pyramid 
Matched Filtering 
Video Stabilization 
Laplacian of Gaussian 
Filter 
Segmentation 
Frame Averaging 
Adaptive Local Entropic 
Thresholding 
Post-processing 
Union of selected points 
as vessels 
135
International Journal on Advances in Life Sciences, vol 2 no 3 & 4, year 2010, http://www.iariajournals.org/life_sciences/
2010, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

frequency domains emphasizes the patterns of blood 
vessels in different scales that normally can not be seen 
in the image. The significance of analyzing images at 
various resolutions is that the objects of different sizes 
are more visible in different resolution levels. 
Experiment shows that level 2 and level 3 of Gaussian 
pyramid separate blood vessels of different sizes, thus 
making the segmentation a more accurate process. To 
construct the first level of Gaussian Pyramid, image is 
filtered using a low-pass filter and then sub-sampled. 
Low-pass filter presents an equivalent effect as 
convolving images with a series of Gaussian-like 
weighting functions followed by sub-sampling. The 
same procedure is repeated, using the resulting image 
of the earlier step as an input image to generate the 
next set of results. The filter operates as convolution of 
Gaussian blur kernel with the image to eliminate high 
frequencies components. The pyramid compresses 
image by making it coarser in each level and reducing 
the number of bits of precision. The blood vessels 
become more distinguishable after this step. In this 
study, for each frame, levels 2 and 3 of Gaussian 
Pyramid are saved for future analysis.  
Matched filter is applied to the image to extract 
features. In this step, to enhance the edges of blood 
vessels, matched filter is applied to the image [32]. 
Matched filter approximates the intensity profile of the 
image with Gaussian curves. In this study, the function 
in equation (1) is implemented for the detection of 
linear anti-parallel pieces of blood vessels. Although 
the gray-level profile varies for different vessels, 
similar properties of blood vessels make the mentioned 
Gaussian function appropriate for this purpose. The 
function is a two-dimensional kernel that is convolved 
with the image to sharpen edges of blood vessels.  
 
                    
2
2
(
)
2
( , )
e
x
f x y
δ
−
=
for |
|
2
y ≤ L
              (1) 
 
In (1), L represents the size of the selected slice of 
the vessel with fixed orientation. The value of L is 
specified by experiment. The kernel is originally only 
aligned with y-axis. In order for the kernel to detect 
vessels in other orientations, the kernel is rotated. The 
rotation is performed convolving ten 15 16
×
 pixel 
kernels with the image. The maximum value resulting 
from each convolution is considered the convolution 
response of that orientation. This step of the algorithm 
enhances the edges of blood vessels, while blurring 
large blood vessels and tissue. An instance of this 
effect is illustrated in Figure 3. 
 
B. VIDEO STABILIZATION 
  
Recording videos from microcirculation provides an 
effective tool to visualize the activity of blood vessels 
and capillaries over a short period of time. This makes 
video 
superior 
to 
image 
when 
analyzing 
microcirculatory networks, since video contains more 
information 
compared 
to 
image. 
Despite 
the 
advantages of capturing videos for the study of 
microcirculation, the motion artifact due to the 
movement of the handheld camera and that of the 
subject are obstacles for effective analysis of 
microcirculation videos. To eliminate the effects of 
motion artifacts, video stabilization is performed at this 
step.   
The main aim of this step is to calculate the 
transformation between two consecutive frames in the 
video. The first step is to compute the first derivatives 
of the image using Gaussian Gradient filter. Since the 
image is a function of two variables,
( , )
f x y , the 
derivatives are computed in both horizontal and 
vertical direction. The sum of the resulting values of 
the filter in each direction generates the overall 
Gaussian gradient for the image. Following that, seven 
control points are selected in the first frame. The 
control point should be on the vessels and not on the 
background in order to be tracked effectively. 
Laplacian of Gaussian filter is applied to the frame for 
choosing the most relevant control points. Laplacian of 
Gaussian filter computes the second order derivatives 
of the Gaussian function.  The filter is used to find 
regions of rapid change in images such as edges. Using 
the filter guarantees that the selected points are located 
on the objects of interest. The control points are the 
ones that yield to the highest amounts of filter output.   
Once being picked for the first frame, control points 
are tracked in the 19 following frames. To track the 
same points in the following frames, a window of 
25x25 pixels is defined around the control point. The 
points are tracked within a corresponding window of 
65x65 size in the following frames. In case any of the 
point is fallen outside the image due to excessive 
motion, new control points will be defined using the 
mentioned method.  
The next step is to calculate the cross-correlation 
coefficients between two successive frames. Cross-
correlation coefficients are calculated for tracking the 
points in the previous step. To identify the control 
points in the frames except for the first frame, the 
65x65 window is scanned to detect the maximum 
correlated regions in two consecutive frames. The 
frames are registered according to the maximum 
correlated sub-areas. Registration helps finding the 
amount of shift between the two successive frames. In 
136
International Journal on Advances in Life Sciences, vol 2 no 3 & 4, year 2010, http://www.iariajournals.org/life_sciences/
2010, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

other words, the distance between the frames is 
acquired through calculating the cross-correlation 
value. 
1
( ,
)
i
i
d f f +  represents the distance between the 
grayscale profile of two succeeding image in which i
shows the frame number. This value will be used as a 
parameter in segmentation. An example of the 
stabilization result for 10 frames is shown in Figure 4. 
 
C. SEGMENTATION 
 
Image segmentation is performed to partition image 
into its comprising components. The objective of 
microcirculation image processing is to separate 
background from blood vessels and capillaries using 
grayscale values. Such separations make the analysis 
of the image an easier task. The outcome of 
segmentation is a binary image whose background is 
shown with white pixels and objects of interest with 
black pixels. 
One main class of techniques that is incorporated for 
image segmentation is thresholding. The main classes 
of thresholding were mentioned in the introduction 
part. Depending on the application, one may use global 
thresholding or local thresholding. Uneven grayscale 
intensity of the background and the varieties in the 
intensity of the objects in microcirculation images 
make the global thresholding inefficient. However, 
local thresholding smoothly varies across the image 
and is capable to adapt the threshold value for different 
parts of the image. This study adaptively selects 
windows in the image based on Lorentz Information 
Measure (LIM) [37]. Following that, for the 
thresholding of each sub-image, the algorithm 
implements an extension of the entropic thresholding 
technique proposed in [33].   
 Adaptive local thresholding successfully reduces 
the issue with uneven background intensity by 
partitioning the image into windows of variable sizes 
based on LIM value. If the image F is the gray level 
image and 
( , )
f x y is defined as the intensity image, the 
amount of information in the image known as Picture 
Information Measure (PIM) is calculated by:  
 
          
1
0
( )
( ) max ( )
F
i
PIM f
h i
h i
−
=
=
−
∑
              (2)         
 
PIM shows the minimal graylevel variation if 
( , )
f x y is converted to a constant grayscale image. 
( )
h i shows the graylevel histogram of the image for 
}
{: 0,1,...,
1
h
F
N
−
→
. If the image comprises of only 
one graylevel, 
( )
PIM f = 0
, while 
( )
max
PIM f =
occurs when the graylevel intensity of the image is 
uniformly distributed.  
The normalized form of (1) is defined as: 
 
                     
( )
( )/
( )
NPIM f
PIM f
N f
=
             (3) 
 
where 
( )
N f is the number of pixels in the image. 
( )
NPIM f  can be calculated for any sub-image in the 
image, indicating the amount of information in the 
given sub-image.  An experimental cutoff value for 
( )
NPIM f  is chosen in order to adaptively adjust the 
sub-image size for thresholding. The values greater 
than the cutoff value ensure that the sub-images 
contain both background and objects of interest.  
The superiority of thresholding method in the 
proposed 
algorithm 
is 
that 
it 
considers 
flow 
information in addition to local property and intensity 
information. The technique is based on graylevel 
spatial correlation histogram of the image. The aim is 
to maintain the spatial structure of the image using 
pixel neighborhood property. In an image F with 
graylevel intensity of  
( , )
f x y  in which ( , )
x y
represents the coordination of a pixel, let Q
× R
be the 
number of pixels. 
( , )
g x y is defined as the number of 
pixels in N
× N
neighborhood of pixel ( , )
x y  within ζ
distance of the pixel. The ζ value of 2 and 
neighborhood of 3 3
×
 (N = 3) were chosen empirically 
for the purpose of this study. 
The flow factor used in this part was calculated in 
the stabilization section. For every frame, the 
summation 
of 
the 
differences 
between 
each 
consecutive pair frames in 10 preceding frames is 
computed using the following equation: 
 
                         
1
10
( )
(
,
)
n i
n
n
n i
Sd f
d f
f
=
+
= −
= ∑
            (4) 
 
Three parameters of flow, neighborhood vicinity and 
pixel intensity information are used in equation (5) to 
calculate the graylevel spatial correlation histogram of 
the image: 
 
( ,
,
)
( ( , )
, ( , )
,
( )
)
h k m D
prob f x y
k g x y
m
Sd f
D
=
=
=
=
      (5) 
 
      Equation (5) determines the probability ( ,
,
)
h k m D  
in 
which
( , )
f x y
= k
,
( , )
g x y
= m
and 
( )
Sd f
= D
 
where 0
255
≤ k
≤
, 1
9
≤ m
≤
and 1
2
≤ D
≤
. 
According to the principle of entropy, noise and 
edge produce more information than background and 
137
International Journal on Advances in Life Sciences, vol 2 no 3 & 4, year 2010, http://www.iariajournals.org/life_sciences/
2010, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

objects. In order to emphasize the effect of m as a key 
distinction factor, the nonlinear function in equation 
(6) is multiplied with entropy function. 
 
          
9
9
( ,
)
(1
) / (1
)
m
m
N N
N N
W m N
e
e
−
−
×
×
=
+
−
            (6)    
 
     
In equation (6), N is the selected neighborhood of a 
pixel and m is the number of neighbor pixels within  ζ  
distance of the pixel, 
{1,2,3,..., x }
m
N N
=
.  
In the next step, threshold T is calculated; T is
0
1
T
l
<
< − . It segments the image into object and 
background, represented by O and B respectively. In 
order to calculate T, the second order entropy of image 
and background is calculated using equations (7) and 
(8). 
 
 
 
 
 
 
            (7) 
255
(2)
1
1
( , ,
)
( , , )
( ,
)
ln(
)
( ,
)
( )
( )
N N
B
B
B
k T
m
P k m D
P k m D
H
T N
W m N
P T
P T
×
=
= +
=
− ∑ ∑
 
 
 
 
 
        
          (8) 
(2)
0
1
( , ,
)
( , ,
)
( ,
)
ln(
)
( ,
)
( )
( )
T
N N
O
O
O
k
m
P k m D
P k m D
H
T N
W m N
P T
P T
×
=
=
=
−∑∑
    
                                   
In the equations of second order entropy, 
( ,
,
)
P k m D  
is the normalized form of ( ,
,
)
h k m D . 
The optimal threshold is calculated as the total of 
equations (7) and (8). The optimal threshold is 
calculated using:  
 
         
(2)
(2)
( ,
)
( ,
)
( ,
)
B
O
H T N
H
T N
H
T N
=
+
             (9) 
 
T is obtained by computing a value that maximizes 
H(T,N).  Experimental evidence has shown that as a 
result of noise factors, the obtained value is not the 
optimal threshold. In order to eliminate this issue,     
the median of ten maximum values of H(T,N) is 
selected to be the optimal threshold.  
The final segmentation process employs the 
information acquired through calculation of Lorentz 
Information Measure to threshold the image using the 
mentioned 
entropic 
thresholding 
technique. 
As 
mentioned in the stabilization part, 20 frames are 
stabilized for each level of the Gaussian Pyramid. The 
output of the stabilization is a set of stabilized frames 
that demonstrate active blood vessels. In many 
instances, stabilization distorts the edges of the frames 
to effectively smooth out the video. In order to 
eliminate the possible effect of the stabilization, 15 
pixels from top, bottom, right and left of the images are 
removed. Following that, the intensity values of each 
pixel 
coordinate 
in 
20 
stabilized 
frames 
are 
arithmetically averaged. The result of this step is the 
input for the main segmentation part. 
The size of microcirculation images of the study 
after removing a 15 pixel frame from the image 
becomes 450x690 pixels. The original window size of 
60x60 pixels is chosen empirically to divide the image 
into sub-images for thresholding. Thresholding starts 
with the original window size from the top left of the 
image. The image is partitioned into a window of size 
60x60 pixels and 
( )
NPIM f  is calculated for the sub-
image. If the 
( )
NPIM f value was greater than 0.97, the 
sub-image is thresholded using the mentioned entropic 
thresholding technique. The limit value for 
( )
NPIM f  
was selected experimentally. If the 
( )
NPIM f  value is 
less than the limit, the window size adaptively grows to 
120x120, twice as much as the original window in 
direction of x and y. The sub-image is then thresholded 
using the proposed entropic thresholding technique. 
The same process of thresholding the sub-images is 
repeated for the entire image. The output of 
thresholding is a binary image in which blood vessels 
and capillaries are represented by black pixels and the 
background with white pixels.  
Despite the success of pre-processing to reduce the 
effect of image artifacts, the result of this step might 
still contain tissue and other artifacts in shape of 
scattered small objects. One solution to eliminate the 
effect of artifacts is to apply morphological operations 
to the image. Morphology performs mathematical 
techniques on images to analyze and process 
geometrical shapes. In this step, the objects in the 
binary image are labeled. The size, width and length of 
the objects are acquired and compared to the user 
defined ones. The objects with values out of the 
defined range are removed. Such operation clears the 
image from isolated pixels with width and length less 
than 4 and 10 pixels as well as large vessels with width 
of greater than 30 pixels. The result of this step is a 
binary image with less noise. 
 
D. POST-PROCESSING 
 
Post-processing 
refers 
to 
a 
combination 
of 
techniques for generating the final results of the 
algorithm. In the previous steps, levels 2 and 3 of 
Gaussian pyramid were generated for 20 frames. 
Following that, the frames were stabilized, averaged 
138
International Journal on Advances in Life Sciences, vol 2 no 3 & 4, year 2010, http://www.iariajournals.org/life_sciences/
2010, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

and segmented for each level. Accordingly, two sets of 
images were acquired.  
Different levels of Gaussian pyramid provide 
different resolution of the same image. Since different 
blood vessels might be better visible in each of the 
levels, there is a need to combine the results of the two 
levels to construct the final results. The union of points 
identified as capillaries and blood vessels in each set 
forms the ultimate results of the algorithm. The final 
result is an image that shows the active blood vessels.  
 
III. RESULTS 
 
To verify the effectives of the proposed algorithm, it 
was tested on 10 microcirculation video samples. Five 
of the subjects were hemorrhaged animals and five 
were healthy animal subjects. Equal number of normal 
and abnormal subjects helps examining the major 
difference in statistical analysis of the results. The 
videos were captured with the rate of 30 frames per 
second. The original size of a video frame is 480x720 
pixels. The sample data were provided by Virginia 
Commonwealth University Reanimation Engineering 
Shock Center.  
The algorithm was applied to the first 20 frames of 
each video. The results of different steps of the 
algorithm for a healthy case are illustrated in Figures 2-
5, while Figures 6-9 show the results for a 
hemorrhaged case. MATLAB® programming language 
was used to develop codes to examine the validity of 
the proposed algorithm and to generate experimental 
results. With respect to time complexity, the algorithm 
takes an average of 15 minutes to run on a 2.40 GHz 
computer with 3 GB of RAM. The evaluation of results 
is performed through visual inspection of medical 
experts. The inspection has shown that the accuracy of 
algorithm in extracting active blood vessels and 
capillaries is 95% on average.  
The measure of FCD was calculated for the sample 
data. The FCD value results are listed in Table 1. FCD 
is the area of the segmented capillaries in an image 
divided by the area of the image [33]. In each averaged 
frame, the total number of black pixels is divided by 
the size of the image to obtain FCD value. The result 
shows that the algorithm can successfully distinguish 
between normal and abnormal cases based on a simple 
statistical analysis.   
 
IV. CONCLUSION 
 
The proposed method is a fully automated approach 
for image processing of microcirculation videos. The 
algorithm incorporates a novel thresholding technique 
that considers flow information to be a key factor in 
calculation of entropy. Furthermore, it adjusts the 
threshold level locally based on image information 
using Lorentz Information Measure. The algorithm 
looks at two levels of Gaussian Pyramid resolutions to 
acquire a true estimate of active blood vessels in a 
video. The technique is capable of distinguishing 
between the healthy and hemorrhaged subjects in the 
10 studied samples using Functional Capillary Density. 
Visual evaluation of the results shows 95% accuracy in 
blood vessel detection. The designed technique can 
potentially assist physicians and medical researchers in 
making diagnostic decisions.  
 
V. FUTURE WORK 
 
   As future work, an extension of the current approach 
will combine multi-resolution concept with multi-
thresholding to improve the segmentation results while 
reducing the false positives.  Other diagnostically 
useful measures such as Perfused Vessel Density 
(PVD), Proportion of Perfused vessels (PPV) and 
Microvascular Flow Index (MFI) will be calculated 
using the proposed algorithm.  A larger dataset will be 
acquired and the algorithm will be tested and validated 
on the new dataset. The stabilization technique will be 
improved and combined with other registration 
techniques. The results will be validated using the 
available semi-automated commercial software tools 
such as Vascular Analysis Commercial software tools 
by medical experts. Statistical analysis will be 
performed for further evaluation of the results. 
 
Table1. FCD for five healthy and five Hemorrhaged subjects 
 
Healthy 
Hemorrhaged 
Case 1 
0.12 
0.09 
Case 2 
0.15 
0.08 
Case 3 
0.14 
0.05 
Case 4 
0.10 
0.05 
Case 5 
0.12 
0.07 
 
 
Figure 2. Original image of a frame– Healthy subject 
139
International Journal on Advances in Life Sciences, vol 2 no 3 & 4, year 2010, http://www.iariajournals.org/life_sciences/
2010, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

Figure 3. Preprocessing of the frame in Fig2, level 3 of Gaussian 
Pyramid – Healthy subject 
 
Figure 4. Stabilization results of 10 consecutive frames (Fig2 as the 
first frame), level 3 of Gaussian Pyramid - Healthy subject 
 
 
 
Figure 5.Postprocessing results of 20 frames – Healthy subject 
Figure 6. Original image of a frame – Hemorrhaged subject 
 
Figure 7. Preprocessing of the frame in Fig6, level 3 of Gaussian 
Pyramid – Hemorrhaged subject 
 
 
 
Figure 8. Stabilization results of 10 consecutive frames (Fig7 as the 
first frame), level 3 of Gaussian Pyramid - Hemorrhaged subject 
 
140
International Journal on Advances in Life Sciences, vol 2 no 3 & 4, year 2010, http://www.iariajournals.org/life_sciences/
2010, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

Figure 9.Postprocessing results of 20 frames - Hemorrhaged subject  
 
ACKNOWLEDGEMENT 
 
The dataset used in this study was provided by 
Virginia Commonwealth University, Department of 
Emergency Medicine and Virginia Commonwealth 
University Reanimation Engineering Shock Center 
(VCURES). 
REFERENCES 
 
[1] N. Mirshahi, S.Demir, K. Ward, R. Hobson, R. Hakimzadeh, K. 
Najarian, "A Multi-resolution Entropic-Based Image Processing 
Technique for Diagnostic Analysis of Microcirculation Videos," 
biosciencesworld, pp.64-69, The First International Conference on 
Biosciences, 2010 
 
[2] R. F. Tuma, W. N. Duran, K. Ley. HANDBOOK OF 
PHYSIOLOGY MICROCIRCULATIO, Elsevier Science, USA,   
2008. 
 
[3] AR. Pries, D. Neuhaus and P. Gaehtgens, “Blood viscosity in 
tube flow: dependence on diameter and hematocrit.” Am J Physiol, 
263: H1770-H1778, 1992.  
 
[4]A. Krogh, Anatomy and physiology of capillaries. New Haven 
Connecticut: Yale University Press, 1929. 
 
[5]A. Krog, “Supply of oxygen to the tissues and the regulation of 
the capillary circulation.” J physiol (Lond) 52:457-474, 1919. 
 
[6] AG. Tsai, PC. Johnson and M. Intaglietta, “Oxygen gradients in 
the microcirculation”, Physiol Rev 83:993-963, 2003. 
 
[7] CC. Michel and EE. Curry, “Microvascular permeability”, 
Physiol Rev 79: 703-761, 1999. 
 
[8] U. Yuan, WM. Chilian, HJ. Granger and DC. Zaeija, “Flow 
modulates coronary venular permeability by a nitric oxide-related 
mechanism.” Am J Physiol 263:H641-H646, 1992. 
 
[9] RM. Bateman, MD. Sharpe, and CG. Ellis, “Bench-to-bedside 
review: microvascular dysfunction in sepsis: hemodynamics, oxygen 
transport and nitric oxide” Crit Care Med 7: 359–373, 2003.  
 
[10] RP. Hebbel, R. Osarogiagbon, D. Kaul, “The endothelial 
biology of sickle cell disease; inflammation and chronic 
vasculopathy” Microcirculation 11:129-151, 2004. 
 
[11] MJ. Stuart, and RL. Nagel, “Sickle cell disease”, The Lancent 
364:1343-1360, 2004.  
 
[12] BI. Levy, G. Ambrosio, AR. Pries, and HA. Struijker-Boudier. 
“Microcirculation in hypertension: a new target for treatment?” 
Circulation 104:735–740, 2001.  
 
[13] C. Verdant, and D. De Backer, “How monitoring of the 
microcirculation may help us at the bedside”, Curr Opin Crit Care, 
11(3):240-244, 2005. 
[14] KA. Nath, ZS. Katusic, and MT. Gladwin, “The perfusion 
paradox and instability in sickle cell disease”, Microcirculation, 
11:179-193, 2004. 
 
[15] DK.  Kaul, and ME. Farby, “In vivo studies of sickle red blood 
cells”, Microcirculation: 11:153-156, 2004. 
 
[16] RM. Touyz, “Intracellular Mechanisms Involved in Vascular 
Remodeling of Resistance Arteries in Hypertension: Role of 
Angiotensin  II”, Exp Physiol, 90: 499-455, 2005.  
 
[17] EH. Serne, RO. Gans, JC. ter Maaten, GJ. Tangelder, AJ. 
Donker, and CD. Stehouwer, “Impaired skin capillary recruitment in 
essential hypertension is caused by both functional and structural 
capillary rarefaction”, Hypertension: 38:238-242, 2001. 
 
[18] MA. Creager, TF. Luscher, F. Cosentino, and JA. Bechkman, 
“Diabetes 
and 
Vascular 
disease: 
pathophysiology, 
clinical 
consequences, and medical therapy: part I”, Circulation 108:1527-
1532, 2003. 
 
[19] O. Genzel-Boroviczeny, J. Strotgen, A. G. Harris, K. Messmer, 
and F. Christ, “Orthogonal polarization spectral imaging (OPS): A 
novel method to measure the microcirculation in term and preterm 
infants transcutaneously”, Pediatr Res 51:386–391, 2002.  
 
[20] Y. Sakr, MJ. Dubois, D. De Backer, J. Creteur, JL. Vincent, 
“Persistent microcirculatory alterations are associated with organ 
failure and death in patients with septic shock”, Crit Care Med, 
32:1825-1831, 2004.  
 
[21] PE. Spronk, C. Ince, MJ. Gardien, KR. Mathura, HM. 
Oudemans-van Straaten, and DF. Zandstra, “Nitroglycerin in septic 
shock after intravascular volume resuscitation”, Lancet, 360:1395-
1396, 2002.  
 
[22] M. Fries, M. H. Weil, Y. Chang,, C. Castillo, and W. Tang, 
“Microcirculation during cardiac arrest and resuscitation”, Crit Care 
Med 34: 454–457, 2006.  
 
[23] E. Chaigneau, M. Oheim, E. Audinat, and S. Charpak, Two 
Photon imaging of capillary blood flow in olfactory bulb glomeruli. 
Proc Natl Acad Sci, USA, 100:13081-13087, 2003. 
 
[24] V. Cerný, Z. Turek, and R. Pařízková, “Orthogonal polarization 
spectral imaging: a review”, Physiol. Res. 56, 2007.  
 
[25] C. Ince, “The microcirculation is the motor of sepsis”, Critical 
Care,  9(suppl 4):S13-S19, 2005. 
 
[26] J. G. G. Dobbe, G. J. Streekstra, B. Atasever, R. van Zijderveld 
and C. Ince, “The measurement of functional microcirculatory 
density and velocity distributions using automated image analysis”, 
Med Biol Eng Comput, 46(7): 659–670, 2008.  
 
[27] J. Staal, M. D. Abràmoff, M. Niemeijer, M. A. Viergever, and 
B. V. Ginneken, “Ridge-Based vessel segmentation in color images 
of the retina”, IEEE Transactions on Medical Imaging, vol. 23, no. 4, 
pp. 501–509, 2004.  
 
141
International Journal on Advances in Life Sciences, vol 2 no 3 & 4, year 2010, http://www.iariajournals.org/life_sciences/
2010, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

[28] A. Hoover, and M. Goldbaum, “Locating the optic nerve in a 
retinal image using the fuzzy convergence of the blood vessels”, 
IEEE Tran. on Medical Imaging, Vol. 22, No. 8, p. 951-958, 2003.  
 
[29] K.A. Vermeer, F.M. Vos, H.G. Lemij, and A.M. Vossepoel, “A 
model based method for retinal blood vessel detection”, Comput. 
Biol. Med., in press, DOI: 10.1016/S0010-4825(03)00055-6, 2003.  
 
[30] U. Rost, H. Munkel, and C. E. Liedtke, “A knowledge based 
system for the configuration of image processing algorithms”, 
Fachtagung Informations und Mikrosystem Technik, 1998.  
 
[31] C. Kirbas, and F. Quek, “Vessel Extraction Techniques and 
Algorithms : A Survey” , Third IEEE Symposium on BioInformatics 
and BioEngineering,  2003. 
 
[32] S. Chaudhuri, S. Chatterjee, N. Katz, M. Nelson, and M. 
Goldbaum, “Detection of blood vessels in retinal images using two 
dimensional matched filters:’ IEEE Trans. Medical imaging, vol. 8, 
no. 3, 1989. 
 
[33] Y. Xiao, Z. Cao, and T. Zhang, “Entropic Thresholding Based 
on Gray Level Spatial Correlation Histogram”, IEEE Trans. on 
Wireless Communications 7(1): 334-342, 2008. 
 
[34] D. De Backer,  S. Hollenberg, C. Boerma, P. Goedhart, G. 
Büchele, G. Ospina-Tascon, I. Dobbe, C. Ince, “How to evaluate the 
microcirculation: report of a round  table condference”. Critical 
Care, 11:R101, 2007. 
 
[35] D. Johnson, "Introducing the MicroScan". MicroVision 
Medical. 
July 
1, 
2010 
<http://www.microvisionmedical.com/mvm_docs/MicroScan.pdf>. 
 
[36] S Mehmet, S Bulent, “Survey over image thresholding 
techniques and quantitative performance evaluation” Journal of 
Electronic Imaging, 2004.  
 
[37] S.K. Chang, “Principle of Pictorial Information Systems 
Design”, Prentice-Hall, Inc. 1989. 
 
142
International Journal on Advances in Life Sciences, vol 2 no 3 & 4, year 2010, http://www.iariajournals.org/life_sciences/
2010, © Copyright by authors, Published under agreement with IARIA - www.iaria.org

