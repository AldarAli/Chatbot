Interaction between an Online Charging System and a Policy Server 
 
Marc Cheboldaeff 
Carrier Applications EMEA 
Alcatel-Lucent 
Ratingen, Germany 
Marc.Cheboldaeff@alcatel-lucent.com 
 
 
Abstract— According to the 3GPP standard architecture up to 
Release 9, a Charging System is not supposed to interact 
directly with a Policy Server. The Charging System is 
responsible for rating and charging, while the Policy Server is 
responsible for determining the right policy depending on the 
kind of traffic. In reality, it appears that the decision about the 
right policy might be influenced by some real-time subscriber 
information, which might also be relevant for charging, and 
therefore stored in the Charging System. In this context, a 
direct interface between the Charging System and the Policy 
Server might be required. The goal of this paper is to study 
what such an interface would look like, based on an actual 
implementation. The main achievement is to validate a 
scenario where the policy should change in real-time during a 
data session because a volume threshold has been crossed. 
Keywords- Rating; Policy; IMS; OCS; PCRF; PCC; QoS 
I. 
 INTRODUCTION 
According to the 3GPP IP Multimedia Subsystem (IMS) 
standard architecture, rating and charging takes place for 
online charging in a so-called Online Charging System 
(OCS) [1]. The latter contains rating and charging rules 
depending on all traffic typology criteria. The decision 
regarding policy falls to the Policy and Control Resource 
Function (PCRF) [2]. The latter contains policy rules 
depending on all traffic typology criteria. 
In the standard Policy and Charging Control (PCC) 
architecture [3], the core network, which knows the actual 
traffic properties, asks the PCRF which policy it should 
apply, and the OCS (in case of online charging) which 
charging scheme it should apply. The Policy and Charging 
Enforcement Function (PCEF) at core network level, 
included in a Packet Data Network (PDN) Gateway, which 
can be for example the Gateway GPRS Support Node 
(GGSN), is then responsible to apply the proper policy and 
the correct pricing structure to the actual traffic, according to 
the input from the PCRF and the OCS.  
However, there are some scenarios where the decision on 
policy might be influenced by the OCS. In Section II, we 
shall describe such scenarios, and check whether some of 
them have been studied already in the literature. In Section 
III, we will describe an approach in which the OCS interacts 
with the PCRF. Finally, in Section IV, we will present an 
actual implementation. 
Please note that we focus on online charging in this 
paper, not on offline charging, because we are interested in 
rating respectively policy decisions / changes in real-time 
while a data session is running. 
II. 
PURPOSE OF THE INTERACTION BETWEEN THE PCRF 
AND THE OCS 
Going into more details in the IMS standard architecture 
for online charging [1], the OCS relies on two databases: 
• 
The database in the Rating Function (RF), which 
contains generic tariff information at service level; 
• 
The database in the Account Balance Management 
Function (ABMF), which contains subscriber-specific 
information relevant for the rating. 
Actually, searching the literature, an interface between 
the policy decision function and external databases is 
mentioned in [4], but it does not relate specifically to an OCS 
database. And the dynamic mid-session interaction is not 
studied in detail either. A direct interaction between the 
PCRF and the OCS has already been studied in [5], but it 
restricts to an interaction of the PCRF with the Rating or 
Tariff Function of the OCS. It means that the policy decision 
might indeed depend on tariff rules, but it still does not 
depend on subscriber-specific information such as his/her 
current consumption or life cycle state. 
Moreover, reducing the subscriber tariff information to a 
single tariff class ID might be restrictive given newer tariff 
schemes, where multiple charging options might be applied 
individually on top of a default tariff. Such charging options 
are for example usage-based discounts, subscriber bonus, or 
individual buckets e.g., free minutes, that the subscriber can 
book in addition to his/her default tariff, or that he/she gets 
as a reward for high consumption or recharge. 
Basically, one of the functions of the OCS is to perform 
account balance management towards external systems 
through the ABMF. For this purpose, the OCS might store 
subscriber’s pieces of information applicable for rating like 
usage counters. Furthermore, it might store additional 
information like his/her life-cycle state e.g., validity dates, or 
the status of his/her valid tariff options. 
According to [1], in order to support the online rating 
process, the Rating Function necessitates counters. The 
counters are maintained by the Rating Function through the 
Account Balance Management Function. Assuming that 
these counters are maintained at subscriber level, storing 
them together with other real-time subscriber information in 
the ABMF makes sense. 
47
ICN 2011 : The Tenth International Conference on Networks
Copyright (c) IARIA, 2011              ISBN:978-1-61208-113-7

According to [3], in order to support the policy decision 
process, the PCRF may receive information about total 
allowed usage per user from the Subscription Profile 
Repository (SPR). Going further in this direction, some 
additional subscriber information might be relevant to the 
PCRF in order to determine the right policy: not only static 
data like an allowed usage threshold specific to a subscriber, 
but also subscriber dynamic data like the value of some 
counters at a certain point in time, his/her life-cycle state, or 
the status of his/her valid tariff options. 
Such an approach supports scenarios like the following: 
as long as the subscriber consumption within one month does 
not exceed a certain limit, he/she is eligible for a better 
Quality of Service (QoS) than once the threshold has been 
exceeded. Alternatively, a scenario might occur in which a 
specific subscriber bought on top of his/her standard tariff an 
option for data traffic so that he/she is eligible for a better 
policy than “normal” subscribers. 
Consequently, the SPR would have to store such 
information as well. However, this information is still 
mandatory in the OCS because it might influence ratings. 
For example, the high value of a usage counter respectively 
having subscribed to a certain tariff option might lead to a 
reduced or negligible price for data traffic. Or taking the 
example above again, once the subscriber consumption 
within one month exceeds a certain limit (not necessarily the 
same limit as for policy decision), the subscriber might enjoy 
cheaper rates for data traffic. 
This shows that some subscriber data is meaningful both 
for the SPR and the ABMF. There could be here a kind of 
overlapping between the SPR and the ABMF as represented 
in Figure 1. 
 
Replicating the information both in the SPR and in the 
ABMF would be an option. But this would assume efficient 
synchronization mechanisms between the two databases, 
since the number of subscribers respectively their data traffic 
in today’s telecommunication networks might be substantial. 
Furthermore, the involved pieces of information consist of 
real-time data. If the policy should change when the 
subscriber’s consumption reaches a certain limit, the change 
would happen in real-time and without delay. In the same 
way, if the rating should change when a certain limit is 
reached, the change should happen in real-time too. 
Duplication of databases, which store a great deal of real-
time 
data, 
could 
increase 
the 
complexity 
of 
the 
implementation. If the relevant subscriber information is 
already present in the OCS, why should not the PCRF 
retrieve it directly from the OCS? This is represented in 
Figure 2. 
 
III. 
PROPOSED APPROACH 
The proposed approach consists of a framework where 
the PCRF and the OCS exchange in real-time subscriber 
information, which is necessary not only for charging, but 
also in order to determine the right policy. The goal is to 
support such scenarios where the policy might be changed 
based on the value of some subscriber data volume counters. 
The latter are stored in the OCS as master copy in any 
case because they are relevant for charging, in order to 
support offers like the following: after a subscriber has 
consumed 1MB within one week, he/she gets 10 free SMS, 
or he/she is allowed free data traffic till the end of the week. 
Furthermore, these counters are relevant to the PCRF in 
order to support similar offers where, for example, the data 
speed is throttled once the subscriber has reached 10MB 
consumption within one month. In the context of the present 
contribution, we shall focus on volume counters. However, it 
could be another piece of subscriber data, which would be 
relevant for the policy server, for example, the life-cycle 
state of the subscriber. For example, if a prepaid data card is 
near expiry, the surfing speed may diminish. 
In the context of the implementation described in the next 
section, these are the values of subscriber volume counters, 
which should be reported in real-time from the OCS to the 
PCRF. More precisely, the counter values will be reported 
when they exceed some predefined thresholds. The latter 
might be defined either for a certain subscriber marketing 
category, or for all the subscribers in the same tariff, or 
individually at subscriber level. Since these thresholds might 
be reached in the middle of a session, the OCS might have to 
notify the PCRF in the middle of a data session too. 
Nevertheless, the PCRF should retrieve latest subscriber 
information like the tariff plan ID and the values of the 
48
ICN 2011 : The Tenth International Conference on Networks
Copyright (c) IARIA, 2011              ISBN:978-1-61208-113-7

volume counters at the beginning of the session as well in 
order to determine correctly the initial policy. Alternatively, 
the PCRF could replicate this subscriber information, 
meaning again that some synchronization mechanisms would 
have to be implemented. 
In general, the message flow when a data session is 
established would resemble Figure 3. In (1), the PCEF asks 
the PCRF about the policy that should apply to the session, 
which is about to start for this subscriber. For this purpose, 
the PCRF retrieves latest subscriber information from the 
OCS in (2) and (3). Consequently, the PCRF can notify the 
initial policy to the PCEF in (4). This would happen through 
the Gx interface in accordance with [2]. 
 
Once the policy has been determined, the PCEF requests 
the OCS for a volume slice in (5). After checking the 
current subscriber consumption, the subscriber’s default 
tariff respectively available options, and current balance, the 
OCS allocates a slice in (6). This would happen through the 
Gy interface in accordance with [2]. In order to allocate the 
proper slice, the OCS takes into account charging-relevant 
thresholds, but it should take into account policy-relevant 
thresholds as well: this will ensure a timely charging or 
policy change. Depending on the duration of the session, 
there might be several volume slices requested i.e., several 
messages like (5) and (6). 
The arrow in (7) is represented in dotted line because it 
may or may not occur during a session: the OCS would 
notify the PCRF only if a policy-relevant threshold is 
exceeded during the on-going data session. 
As stated above, the protocol for (1) & (4) respectively 
(5) & (6) is Gx respectively Gy. The protocol for (2) & (3) 
respectively (7) will be discussed in the next section. Since 
(2) & (3) respectively (7) are not fully covered by standard 
bodies yet to the best of our knowledge, the protocol which 
is the most convenient will be assessed. 
An alternative approach, trying to stick to existing 
standards, would have been for the PCRF and the OCS to 
exchange information through the PCEF i.e., through the Gx 
and Gy protocols. But this would imply an extension of the 
existing protocols as well. In fact, since the present 
implementation, various alternatives are being discussed in 
[6]. They focus on the exchange of information about 
volume or monetary counters. Additional pieces of 
information such as the subscriber’s life cycle state or 
his/her optional tariff options may become relevant too. 
IV. 
IMPLEMENTATION 
Regarding the protocol for (7) in Figure 3, since Gx and 
Gy rely on Diameter, and Gy on Diameter Credit Control 
Application [7], it was decided to use Diameter Credit 
Control Request (CCR) Event. The reader might have noted 
that in (5) & (6), the OCS acts as a Diameter Server towards 
its client i.e., the PCEF, while in (7) the OCS acts as a 
Diameter Client toward the Diameter Server, which is the 
PCRF in this case. As there might be several PCRF nodes, 
the OCS should support an N+K PCRF architecture in order 
to ensure a good scalability. The OCS should be able to send 
CCR Event messages to the PCRF nodes in round-robin way 
in order to ensure high-availability, meaning that the 
functionality can still be supported, even if one PCRF node 
is down. 
Regarding (2) and (3), it is about the PCRF’s retrieving 
subscriber profile data from the OCS database at the 
beginning of a session. Therefore, it is not really about Credit 
Control, nor Authentication / Accounting. Consequently, 
Diameter was not chosen, but SOAP/XML instead, because 
it is a simple protocol to let applications exchange 
information over HTTP in a platform-independent manner. 
For more information on SOAP/XML, the reader might refer 
to [8] and [9]. 
Within this framework, the following scenario can be 
supported: let us assume that a subscriber is entitled a 
downlink/uplink speed of 768/384 Kbps as long as he/she 
has not exceeded 10MB within a month. Once he/she 
reaches 10MB, he/she should be throttled to 128/64 Kbps. 
Let us assume that at the beginning of a session, the 
subscriber has a consumption of 9.9MB in the current month. 
 Consequently, when the session is established, the PCRF 
communicates a QoS corresponding to 768/384 Kbps to the 
PCEF. In addition, the OCS allocates a quota of only 0.1MB 
(10-9.9) in the initial Credit Control Answer (CCA) 
message. That way, when the threshold of 10MB is reached, 
the PCRF can be notified in real-time. This is represented in 
Figure 4. 
 
49
ICN 2011 : The Tenth International Conference on Networks
Copyright (c) IARIA, 2011              ISBN:978-1-61208-113-7

In case the PCRF has a local database duplicating the 
OCS database, and containing subscriber information that is 
not outdated, the query from the PCRF to the OCS may be 
skipped. 
When the allocated quota of 0.1MB has been used up, the 
PCEF should request another volume quota. If the subscriber 
balance is sufficient, the OCS will allocate another quota so 
that the data session can carry on. The allocated quota might 
be bigger than 0.1MB this time, for example 0.5MB. 
Simultaneously, the OCS will notify through a Diameter 
CCR Event message as suggested previously that the volume 
threshold of 10MB has been reached for this subscriber, so 
that the PCRF can calculate the new QoS and notify it to the 
PCEF. This is represented in Figure 5. 
 
 
In order to further notify the policy’s change to the 
PCEF, the PCRF uses Diameter Re-Authentication Request / 
Answer messages (RAR/RAA) [10]. 
In case of multiple parallel sessions, the policy change 
should apply to all on-going sessions. For example, let us 
assume that one session – Session 1 – starts when the counter 
value is 9.9MB. Given the threshold of 10MB, the OCS 
should allocate initially a slice of 0.1MB. Before the latter is 
used up, another session – Session 2 – starts. The OCS also 
allocates 0.1MB as initial slice because the counter value is 
still 9.9MB in the OCS database. This is represented in 
Figure 6. 
 
As soon as the initial slice of 0.1MB of Session 1 or 
Session 2 is used up, the PCEF will request another slice. 
The OCS will grant a new slice, but it will update the volume 
counter value to 10MB, which should trigger the notification 
to the PCRF. This is represented in Figure 7, where the first 
session using up the 0.1MB quota is Session 1. 
 
 
 
Consequently, the PCRF should notify the PCEF to 
change the QoS obviously for Session 1, but for Session 2 
too, since the volume threshold is applicable to both Session 
1 and Session 2, even if it was triggered by Session 1 only. 
V. 
CONCLUSION 
The 3GPP defines a valuable framework in order to grant 
different traffic policies applicable to different kinds of data 
traffic typologies. The policy server has the ability to retrieve 
subscriber information from a subscription repository in 
order to make individual policy decisions. However, the 
policy server could interact directly with an online charging 
system in order to support scenarios where the policy 
depends on subscriber real-time information, which is 
mandatory for rating and charging too. For this reason, we 
allowed ourselves to extend the 3GPP framework available 
at the time of the design, and implemented the described 
proposal. 
In the IMS standard in Release 10, subscriber data is still 
present in different network elements depending on the 
application for which this data is required. When it comes to 
dynamic subscriber data required by different applications, 
dispatching might not always be suitable. Therefore, as in the 
approach presented in this paper, it will lead to the 
specification of new interfaces. 
 
TERMINOLOGY 
 
3GPP 
3rd Generation Partnership Project 
ABMF Account and Balance Management Function 
CCA 
Credit Control Answer 
CCR 
Credit Control Request 
GW 
Gateway 
50
ICN 2011 : The Tenth International Conference on Networks
Copyright (c) IARIA, 2011              ISBN:978-1-61208-113-7

GGSN GPRS Gateway Support Node 
GPRS 
General Packet Radio Service 
GW 
Gateway 
Gx 
IMS reference point between PCEF & PCRF 
Gy 
IMS reference point between PCEF & OCS 
IMS 
IP Multimedia Subsystem 
IP 
Internet Protocol 
Kbps 
kilo bit per Second 
MB 
Mega Byte 
OCF 
Online Charging Function 
OCS 
Online Charging System 
PCC 
Policy and Charging Control 
PCEF 
Policy and Control Enforcement Function 
PCRF 
Policy and Control Resource Function 
PDN 
Packet Data Network 
QoS 
Quality of Service 
RAA 
Re-Authentication Answer 
RAR 
Re-Authentication Request 
RF 
Rating Function 
SOAP 
Simple Object Access Protocol 
Sp 
IMS reference point between PCRF & SPR 
SPR 
Subscription Profile Repository 
XML 
eXtended Markup Language 
ACKNOWLEDGMENTS 
Much of the source material used for this paper derives 
from work accomplished together with the technical teams of 
Alcatel-Lucent, Openet and Vodafone. The author would 
like to thank especially Renée Fang, Xiang Yang Li, Jacob 
Terpstra, Simone Thomann, Gianmarco Montini from 
Alcatel-Lucent, Michael Leahy from Openet, Ron Jennissen, 
Jeffrey Lammerts van Bueren, Dion Pirnaij from Vodafone, 
Paul Grooten from EDS and Christian Falckenberg from 
Starent. 
The author would like to thank Marianne Cave for her 
review. 
REFERENCES 
[1] 3rd Generation Partnership Project, Technical Specification Group 
Services and System Aspects, “Online Charging System (OCS): 
Applications and Interfaces”, 3GPP TS 32.296, Release 10, October 
2010 
[2] 3rd Generation Partnership Project, Technical Specification Group 
Services and System Aspects, “Policy and Charging Control (PCC) 
architecture”, 3GPP TS 23.203, Release 10, September 2010. 
[3] 3rd Generation Partnership Project, Technical Specification Group 
Services and System Aspects, “Policy and Charging over Gx 
Reference Point”, 3GPP TS 29.212, Release 10, September 2010 
[4] R. Good, and N. Ventura, “Application driven Policy Based Resource 
Management for IP multimedia subsystems”, 5th International 
Conference on Testbeds and Research Infrastructures for the 
Development of Networks & Communities (TridentCom), 2009 
[5] T. Grgic, K. Ivesic, M. Grbac, and M. Matijasevic, “Policy-based 
Charging in IMS for Multimedia Services with Negotiable QoS 
Requirements”, 10th International Conference on Telecommunications 
(ConTEL), 2009 
[6] 3rd Generation Partnership Project, Technical Specification Group 
Services and System Aspects, “Study on Policy solutions and 
enhancements”, 3GPP TS 23.813, Release 10, October 2010 
[7] H. Hakala, L. Mattila, J-P. Koskinen, and M. Stura, J. Loughney, 
“Diameter Credit Control Application”, IETF RFC 4006 
[8] SOAP Version 1.2, World Wide Web Consortium (W3C) 
Recommendation, http://www.w3.org/TR/soap12-part1/ [retrieved: 
November 9th, 2010] 
[9] World 
Wide 
Web 
Consortium 
(W3C), 
http://www.w3.org/standards/xml/ [retrieved: November 9th, 2010] 
[10] P. Calhoun, G. Zorn, D. Spence, and D. Mitton, “Diameter Network 
Access Server Application”, IETF RFC 4005 
 
 
51
ICN 2011 : The Tenth International Conference on Networks
Copyright (c) IARIA, 2011              ISBN:978-1-61208-113-7

