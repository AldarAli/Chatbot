Codebook Subsampling and Rearrangement Method for Large Scale MIMO 
Systems 
 
 
Tianxiao Zhang 
School of Advanced Engineering 
Beihang University 
Beijing, China 
anterzhang@126.com 
 
 
 
 
 
Xin Su, Jie Zeng, Limin Xiao, Xibin Xu, Jingyu Li 
Tsinghua National Laboratory for Information Science and 
Technology, 
Tsinghua University 
Beijing, China 
{suxin, zengjie, xiaolimin, xuxibin, 
lijingyu}@mail.tsinghua.edu.cn 
 
 
Abstract—In 
large 
scale 
multiple-input 
multiple-output 
(MIMO) systems, the size of codebook increases greatly when 
transmitters and receivers are equipped with more antennas. 
Thus, there are demands to select subsets of the codebook for 
usage to reduce the huge feedback overhead. In this paper, we 
propose a novel codebook subsampling method using chordal 
distance of different codewords and deleting them to 
affordable payload of Physical Uplink Control Channel 
(PUCCH). 
Besides, 
we 
design 
a 
related 
codebook 
rearrangement algorithm to mitigate the system performance 
loss when there are bit errors in the feedback channel. 
Keywords-Large scale MIMO; codebook subsampling; 
codebook rearrangement; PMI feedback 
I. 
 INTRODUCTION  
     The explosive growth of wireless data service calls for 
new spectrum resource. Meanwhile, the available spectrum 
for further wireless communication systems is very limited 
and expensive. Since the capacity of a multiple-input 
multiple-output (MIMO) system greatly increases with the 
minimum number of antennas at the transmitter and receiver 
sides under rich scattering environments [1], the large scale 
MIMO [2] shown in Fig. 1 is one of the most important 
techniques to address the issue of exponential increasing in 
wireless data service by using spatial multiplexing and 
interference mitigating. 
For the consideration of practical application, the number 
of antennas on the terminal side is restricted, and thus the 
number of multiplexing layers is limited though the number 
of antennas on the base station (BS) could be very large. As 
a result, we should explore the large scale MIMO system 
potentials by utilizing beamforming technologies. The 
performance of beamforming relies on the accuracy of 
precoding. However the size of codebook can be very large 
when antennas are increased, considering that the payload 
capacity of Physical Uplink Control Channel (PUCCH) is 
limited to 11 bits [3]. To decrease the overhead in Channel 
State Information (CSI) feedback, the choice of codebook 
subsampling for transmission is necessary [4][5]. 
     Several subsampling methods have been proposed in 
Rel-10 in 2,4,8 Tx scenario. The subset selection in this case 
naturally corresponds to the reduction of granularity in 
direction and/or phase offset [6], such as uniform 
subsampling or staggered subsampling which keeps better 
granularity. However, the codebook design for large scale 
MIMO system may not be based on direction for each 
polarization and phase offset between polarizations; hence 
the application above for large scale MIMO is restricted. 
     In this case, we propose a novel codebook subsampling 
method which applies to all kinds of codebook design, in 
which we select the subset of codebook using chordal 
distance of different codewords and delete them to 
affordable payload of PUCCH. In addition, to further 
optimize the performance of Precoding Matrix Indication 
(PMI) when errors occur, we propose the codebook 
rearrangement method to decrease the impact of mismatch 
between PMI and the channel. 
Precoding
Codebook
Demo-
dulation
Uplink Feedback
Codebook
Codeword 
Selection
CSI 
Extraction
Stream L
Stream 1
Stream L
Stream 1
...
...
...
...
Nt
Nr
 
Figure.1 The close-loop MIMO system model 
 
     
129
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-256-1
ICNS 2013 : The Ninth International Conference on Networking and Services

      This paper is organized as follows: Section II introduces 
the model of the precoding system. Section III presents the 
codebook 
subsampling 
method 
and 
the 
codebook 
rearrangement method. Section IV shows the simulation 
results. And finally, Section V  concludes the paper. 
II. 
SYSTEM MODEL 
A. System Model   
In this paper, we discuss about a close-loop MIMO 
system with
t
N transmit antennas and
r
N receive antennas 
depicted in Fig. 1. For massive MIMO system 
t
N  could be 
very large. 
Firstly, the data vector S in the system is demultiplexed 
into L streams. L is limited by1
min(
,
)
t
r
L
N N
≤
≤
 . When 
L=1 we call the transmission beamforming, while L>1 we 
call it multiplexing. After the data vector s is preprocessed 
by a Nt×L precoding matrix Wi, we get a Nt×1 signal vector 
x for the 
t
N  antennas to transmit: 
                                     x
= Ws
                                              (1) 
Thus, after x passing the channel and being added the noise, 
we will get the received signal y, which can be expressed as: 
                            
i
y
HW s
v
=
+
                                    (2) 
where H (
r
t
N
N
H
C
×
∈
) denotes the fading channel matrix with 
its 
entry
Hij
denoting 
the 
channel 
response 
from 
the
thj
transmit antenna to the
thi
receive antenna, and v 
denotes the white complex Gaussian noise vector with 
covariance matrix
0
N INr
. 
The precoding matrix is selected from the predesigned 
codebook which is known to the transmitter and the receiver. 
Taking the downlink as an example, when UEs have 
received the pilots from the BS, the receiver can choose the 
optimal codeword after the channel estimation. Then the 
receiver reports the PMI with limited bits to BS [7] through 
the uplink channel. If the feedback is limited to B bits, the 
size of codebook satisfies
B
N
= 2
. Thus the transmitter can 
retrieve the precoding matrix and perform the precoding.  
B. Kerdock Codebook 
The basic idea of the kerdock codebook design is 
utilizing the feature of Mutually Unbiased Bases (MUB) to 
construct precoding matrices. The main characteristic of the 
kerdock codebook is that all the elements of the matrix are 
±1 or ±j. Hence, the kerdock codebook has some advantages, 
such as low requirement for storage, low computational 
complexity for codeword search, and the simple systematic 
construction.  
The MUB property is described as follows: 
1
{ ,...,
}
Nt
S
s
s
=
,
1
{ ,...,
}
Nt
U
u
u
=
are two orthonormal 
bases with size
t
t
N
× N
. If the column vectors drawn from S 
and U satisfy
,
1/
i
j
t
s u
N
=
, we can say that they have 
the mutually unbiased property [8]. 
An MUB is the set 
1
{ ,...,
}
Nt
S
s
s
=
 satisfying the mutually 
unbiased property. The Kerdock codebook has several 
construction 
methods 
such 
as 
Sylvester–Hadamard 
construction and power construction. In this paper, we use 
the Sylvester–Hadamard construction: 
First, we construct the generating matrices Dn (
t
t
N
× N
 
diagonal matrices with ±1, ±j elements) for n=0,1,2…Nt-1 
according to [9].  
Then we construct the corresponding orthonormal matrix: 
                             
1
ˆ
,
0,1,...,
1
t
n
n
N
t
t
W
D H
n
N
N
=
=
−
                
(3) 
where ˆ
HNt
is the 
t
t
N
× N
 Sylvester–Hadamard matrix: 
                                 
2
2
ˆ
ˆ
ˆ ....
HNt
H
H
=
⊗
                                 (4)
 
 
where	  
2
1
1
ˆ
1
1
H
⎡
⎤
= ⎢
− ⎥
⎣
⎦
	  
For the beamforming, we can construct the codebook by 
selecting each column of all the bases as the precoding 
vector: 
                   
{
}
{1}
{2}
1
0
2
0
1
{
,
,...,
}
t
t
N
N
N
C
f
W
f
W
f
W
−
=
=
=
=
             (5) 
And for a L-layer spatial multiplexing codebook, the 
largest codebook is derived by taking all L-column 
combinations from each
n
W . 
C. Codeword Search 
We 
can 
choose 
the 
optimal 
main 
codeword 
from
1
2
{
,
,...,
N }
K K
K
Κ =
through the estimate of the channel. 
The codebook is shared by the transmitter and receiver. 
Codeword selection criteria: for 1-layer beamforming, 
the beamformer that minimizes the probability of symbol 
error for maximum ratio combining receiver is expressed as 
[10]: 
                          
2
2
ˆ[ ]
argmax
[ ]
f
C
f i
H i f
∈
=
                            
(6)
 
where f denotes a
1
t
N × matrix. For spatial multiplexing 
with a zero forcing receiver, the minimum singular value 
selection criterion is expressed as: 
                         
min
ˆ[ ]
argmax
{ [ ] }
K C
F i
H i K
λ
∈
=
                        
(7)
 
130
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-256-1
ICNS 2013 : The Ninth International Conference on Networking and Services

where
λmin
denotes the minimum singular value of the 
argument. This selection criterion approximately maximizes 
the minimum sub-stream signal-to-noise ratio (SNR). 
III. 
THE NOVEL CODEBOOK SUBSAMPLING AND 
REARRANGEMENT METHOD 
A. Codebook Subsampling 
To pursue the maximum SNR, we select the codeword 
with the smallest chordal distance from the transmission 
channel. The basic idea of the codebook subsampling 
method is to delete one codeword of the codeword pairs 
which have the smallest chordal distance. The chordal 
distance between two precoding vector is represented by 
                          
2
(
,
)
1
,
chord
i
j
i
j
i
j
d
f
f
f
f
f
f
=
−
⎛
⎞
⎜
⎟
⎜
⎟
⎝
⎠
                       (8) 
with ||.|| being the norm of the vector. If the chord distance 
between two codewords is the smallest among the 
codewords pool, we may reserve only one of them and delete 
another. Therefore we could decrease the overhead as well as 
remain the performance of precoding at the utmost. 
The process of subsampling is shown as follows: 
(1) Suppose the codebook includes K codewords. Divide the 
codewords into g groups. 
a) Compute the chordal distance between any two 
codewords
( ,
)
i
j
d f
f
. Choose
if and
jf  as reference 
codewords if their distance is the largest. 
b) Compute 
the 
chordal 
distance 
between 
the 
rest
(
(0,
], !
&& !
)
Lf
L
K
L
i
L
j
∈
=
=
and reference 
codeword. If
( ,
)
(
,
)
i
L
L
j
d f
f
d f
f
<
, put
Lf in
if ’s 
group. Otherwise put
Lf in
jf ’s group. 
c) Repeat the procedure until the number of groups is g. 
(2) Delete codewords and related PMI. 
a) Compute the chordal distance between any two  
codewords 
in 
, )
,2,1
(
g
lth l
⋅⋅⋅
=
group. 
Find 
the 
min
( ,
)
l
i
j
d
f
f
 
b) Choose the min{min
( ,
)}(
1,2,
, )
l
i
j
d
f
f
l
g
=
⋅⋅⋅
as the 
codeword pair to deal with (suppose in the
th
m group). 
c) Compute 
the 
chordal 
distance 
between 
the 
rest
( !
&& !
)
Lf
L
i
L
j
=
=
in
mth
group and reference 
codeword. If
( ,
)
(
,
)
i
L
L
j
d f
f
d f
f
<
∑
∑
, delete
if , 
otherwise delete
jf . 
d) Select the new min
( ,
)
m
i
j
d
f f
. Back to a) until the 
number of codewords satisfy the requirement of PMI 
feedback. 
The summary of the algorithm is given in Table I. 
TABLE I. SIMULATED SUBSAMPLING ALGORITHM 
 //K: the total number of codewords 
 //B: cycling times 
 //N=2B : groups of codewords 
 //n: current number of groups 
 //dis[i][j]: matrix of chordal distance between codewords 
    n=1; 
loop for B cycles 
loop for n cycles 
calculate any of two codewords fi, fj with  dis[i][j]                                                      
(fi, fj∈the nk group) 
get the two codewords fi,  fj with the largest codewords distance 
in the nk group 
             if dis(i,t)<dis(j,t) [t∈size(nk)，t≠i,j] then 
            allocate the codeword to the group 2*(nk-1) 
             else 
       allocate to the group 2*nk 
    end if 
          end loop 
    n=n*2 
     end loop 
    loop for N cycle 
  calculate the nk group any of two codewords fi, fj  with dis{nk}[i][j] 
    end loop 
    while(K>payload) 
   dis(nk)=min(dis{nk}(:)) 
   m=argmin(dis(nk)) 
   In the m group 
   if ∑dis(i,t)<∑dis1(j,t) then 
  delete the codeword fi in the m group 
   else 
  delete the codeword fj in the m group 
   end if 
   renew the m group with a minimum distance 
    end while 
B. Codebook Rearrangement 
The error in PMI feedback could lead to severe 
mismatch of precoding vector and user’s channel, thus 
greatly decreasing transmission gain and increasing 
unreliability. By decreasing the mismatch caused by PMI 
transmission 
error, 
we 
could 
compensate 
for 
the 
performance loss, even the precoding vector is not optimal. 
131
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-256-1
ICNS 2013 : The Ninth International Conference on Networking and Services

Therefore we rearrange the PMI, reduce the Hamming 
distance of binary indexes of codewords with high 
correlation. Consider one bit error in PMI feedback. When 
the two indexes with one bit of Hamming distance are 
arranged to codewords with high correlation, even if the 
error occurs and the base station uses the wrong codeword, 
the wrong codeword could still perform well due to the high 
correlation with the correct one, thus ensuring the 
compatibility with the channel and decreasing the gain loss. 
The process of subsampling is presented in Table II, and 
the description is given as follows: 
(1) Divide PMI into B PMI groups based on binary code 
weight.
if denotes the original codeword associated with 
PMI
iw , and 
i
U denotes the new one. 
0
0
U
= f
. 
(2) Select one
b i
w , in
, )
,2,1
(
B
bth b
⋅⋅⋅
=
PMI group. Find all 
the
j
wb
− ,1
in 
th
b
( − )1
 PMI group that
1
)
,
(
,1
,
=
−
j
b
b i
binary
w
w
d
. 
(3) In
, )
,2,1
(
g
lth l
⋅⋅⋅
=
codeword group, compute 
1,
(
,
),
th
k
b
j
k
j
d f
f
f
l
−
∈
∑
 
If  
'
1,
1,
(
,
)
min
(
,
)
b
j
k
b
j
k
j
j
d f
f
d f
f
−
−
=
∑
∑
 
(
th
kf
∈l
codeword group), then 
'
,b i
k
U
= f
. 
(4) If all codewords in
th
l codeword group are rearranged 
with new PMI, turn to
th
l
( + )1
codeword group. 
(5) If all PMI in
th
b PMI group are rearranged with new 
codeword, turn to
th
b
( + )1
PMI group. 
TABLE II. SIMULATED REARRANGEMENT ALGORITHM 
//G=log2(payload) 
//PMI_B : groups of PMI based on code weight 
loop for payload cycles 
restore each PMI in PMI_B{i} with code weight i; 
end loop 
D0 =f0 
for i=1:G 
for j=1:size(PMI_B{i}) 
Pij=PMI_B{i}( j) 
      Uji-1={ fji-1, d(Pi-1,Pij)=1} 
      ji
’=argmin∑d(fm,Uji-1) (fm∈the nk group) 
      Dji=f ji’ 
if the codeword in the nk group all have been 
allocated new PMI then 
go to next group 
else  
continue in this group 
end if 
end 
end 
IV.       SIMULATION RESULTS 
This section we present the simulation results under the 
configuration given in Table III. The simulation procedure 
follows the system model in Fig. 1. 
TABLE III.      SIMULATION PARAMETERS 
Parameter 
Value 
Frequency 
2.1 GHz 
System bandwidth 
10 MHz 
Channel modelling 
i.i.d, CN(0,1) 
Number of BS antennas 
32 
Number of UE antennas 
1 
Channel estimation 
Ideal 
UE receiver 
MMSE 
SNR  
10 dB 
 
10
-3
10
-2
10
-5
10
-4
10
-3
10
-2
10
-1
SNR =  10 dB
Feedback error probability
Trans. BER
 
 
Kerdock
Sampled
Proposed
 
Figure.2 The BER performance of different codebooks 
 
Fig. 2 shows the performance of downlink transmission 
BER vs. feedback error probability. The feedback error 
probability means the probability of each bit-error occurs in 
the PMI feedback, and the downlink transmission BER 
means the bit error rate of the downlink transmission. From 
the results, we can see the codebook after subsampling has 
significant BER performance gain compared with the 
original Kerdock codebook, because of the low probability 
of error occurrence due to the fewer bits for feedback. And 
the proposed codebook after rearrangement has the further 
BER performance gain since to configure high correlation 
codewords with reduced code distance, we decrease the 
132
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-256-1
ICNS 2013 : The Ninth International Conference on Networking and Services

performance loss of system when the mismatch of 
precoding vector and the channel occurs. 
V.         CONCLUSION 
In this paper, we proposed a novel codebook 
subsampling method based on chordal distance as well as 
the related codebook rearrangement algorithm for codebook 
designs in large scale MIMO system. The codebook 
subsampling method can reduce the feedback overhead 
without impacting the system performance, and the 
rearrangement algorithm can significantly mitigate the 
system performance loss when errors in the feedback 
channel occur. Simulation results show that the Kerdock 
codebook after subsampling and rearrangement has 
significant performance gain under the non-ideal uplink 
feedback channel in large scale MIMO system. 
ACKNOWLEDGMENT 
      This work was supported by Beijing Natural Science 
Foundation Funded Project (No.4110001), National S&T 
Major 
Project 
(No. 
2011ZX03003-002), 
Tsinghua 
Independent Research (No. 2010TH203-02) and Samsung 
Company. 
 
 
REFERENCES 
 
[1] E. Telatar, “Capacity of multi-antenna Gaussian channels”, 
European Transactions on Telecommunications, vol. 10, no. 6, 
1999, pp. 585-595. 
[2] F. Rusek et al., “Scaling up MIMO: opportunities and 
challenges with very large arrays,” IEEE Signal Processing 
Magazine, 2012, vol. 30, no. 1, pp. 40 - 60. 
[3] 3GPP TS 36.213: Evolved Universal Terrestrial Radio Access 
(E-UTRA); Physical layer procedures, pp. 56-64. 
[4] R1-104164 Way Forward on 8Tx Codebook for Rel.10 DL 
MIMO, CATT et al, RAN1 #61bis, June 2010, Dresden, 
Germany. 
[5] R1-104259 Way Forward on CSI Feedback for Rel.10 DL 
MIMO, Alcatel-Lucent et al, RAN1 #61bis, June 2010, 
Dresden, Germany. 
[6] R1-104901 8Tx Codebook Subsampling, Panasonic, August 
2010, Madrid, Spain. 
[7] 3GPP TS 36.211: Evolved Universal Terrestrial Radio Access 
(E-UTRA); Physical channels and modulation, pp. 17-20. 
[8] A. Klappenecker and M. Rotteler, “Constructions of mutually 
unbiased bases”， Finite Fields Appl., 2004，pp. 137–144,. 
[9] R. W. Heath, Jr., T. Strohmer, and A. J. Paulraj, “On quasi-
orthogonal signatures for CDMA systems”， IEEE Trans. Inf. 
Theory, vol. 52, no.3, 2006，pp. 1217–1226. 
[10] D. J. Love and R. W. Heath, Jr., “Limited feedback unitary 
precoding for spatial multiplexing systems”，IEEE Trans. 
Inf. Theory, vol. 51, no.8, 2005，pp. 2967–2976. 
 
133
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-256-1
ICNS 2013 : The Ninth International Conference on Networking and Services

