Improving Thermal Management of Electric Vehicles by Prediction of Thermal 
Disturbance Variables 
Peter Engel 
TU Clausthal 
Department of Informatics, 
 Clausthal, Germany 
e-mail: peter.engel@tu-
clausthal.de 
Sebastian Meise 
TLK-Thermo GmbH,  
Braunschweig, Germany  
e-mail: s.meise@tlk-
thermo.de 
Andreas Rausch 
TU Clausthal 
Department of Informatics, 
Clausthal, Germany  
e-mail: arau@tu-
clausthal.de 
Wilhelm Tegethoff  
TLK-Thermo GmbH,  
Braunschweig, Germany  
e-mail: w.tegethoff@tlk-
thermo.de 
Abstract— In addition to the powertrain, heating and air-
conditioning represents the second-largest energy consumer in 
electric vehicles. Optimization in this area can therefore 
contribute significantly to enhance the range of these vehicles. 
A new approach exploiting this optimization potential is the 
use of a model predictive controls. These controllers are based 
on a mathematical process model, which predicts the 
trajectories of the output variables. The predicted output 
variable trajectories are then evaluated by a non-linear cost 
function in order to find the corresponding optimal 
manipulated variable trajectory. Since external disturbances 
also affect the system in addition to manipulated variable, it is 
also necessary to predict these disturbances with sufficient 
precision. This is the core problem of this control approach 
and is not adequately addressed in previous approaches. For 
vehicle cabin heating and air-conditioning, the disturbances 
correspond to the thermal loads. These loads are mainly 
caused by the energy input of solar radiation, outside 
temperature, wind speed and humidity. In the following work, 
we will show how the coupling of methods of machine learning 
with Car2X technologies can lead to a high-precision 
prediction of thermal disturbances for an electric vehicle. 
Keywords- Model Predictive Control; BEV; Applied Machine 
Learning; HVAC; Mobile Data Mining 
I.
INTRODUCTION 
The limited range of Battery Electric Vehicles (BEV) 
continues to be a major cause of the low market penetration 
of this technology. In addition to the drive train, the energy 
requirement for climate control is a key factor here. The 
energy requirement for heating, ventilation, and air-
conditioning and (HVAC) can reduce the range by up to 
50% [1] [2]. A recent promising approach reducing this 
additional 
energy 
demand 
is 
the 
replacement 
of 
conventional controls by Model-Predictive Controls (MPC). 
MPC are based on a linear or nonlinear model (NMPC) of 
the system to be controlled, which predicts future states for 
given input variables. The resultant states over a prediction 
horizon are then evaluated with a cost function. By means of 
an optimization method, the manipulated variables are then 
adjusted until an overall optimal state of the system is 
achieved. In various previous investigations [3] - [5], the 
potential of this method in the field of the vehicle thermal 
management was demonstrated. For example, an NMPC 
was used in [6] to simultaneously control the battery 
temperature and the vehicle cabin temperature. Compared to 
a conventional PI controller, it was shown that the set-point 
values were achieved considerably faster, nearly without 
overshoot while maintaining a high degree of overall energy 
efficiency. However, all these investigations showed a weak 
spot. The future disturbance variables were either assumed 
to be known in advance, were not taken into account or 
predicted by a very weak estimate. The disturbance variable 
over the current prediction range is most frequently 
estimated by the last measured value. This is unrealistic, 
since in the real world, however, the outside temperature, 
but also the solar radiation, fluctuate very dynamically over 
the course of the journey. 
In this paper, we will first discuss the state of the art, 
discuss the impact of the prediction accuracy in Section III 
and then introduce our approach to a structure of the 
disturbance variable prognosis system in Section IV. Our 
approach is to train machine learning algorithms with data 
from weather forecasts for an upcoming vehicle ride and 
obtained vehicle sensor data of a subsequent measurement 
ride. The trained functions are then used to generate a 
forecast for the thermal disturbances of an upcoming trip 
using the current weather forecast. We will show in Section 
V how the data collection and processing is carried out with 
the help of an electric vehicle and the corresponding server 
structure. Finally, we will explain the applied machine 
learning techniques in Section VI and discuss the results of 
the test runs in Section VII. 
II.
STATE OF THE ART
As already mentioned, no precise prediction of the 
disturbance variables was used in any known work in the 
field of vehicle HVAC. In [6] and [7] the ambient 
temperature is kept constant over the prediction horizon, [8] 
analyzed HVAC power consumption for different given 
ambient temperatures, [9] estimates disturbance variables 
from measurement data, [4] and [10] use no ahead 
prediction at all. For vehicle cabin heating and air-
75
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-610-1
ADAPTIVE 2018 : The Tenth International Conference on Adaptive and Self-Adaptive Systems and Applications

conditioning, the disturbances correspond to the thermal 
loads. These loads are mainly caused by the energy input of 
solar radiation, outside temperature, wind speed and 
humidity. The prediction of these magnitudes is, however, a 
sub-area of the scientific discipline of atmospheric science 
and, in particular, of meteorology, which has a major focus 
on weather forecasting. The findings from this research are 
applied in various neighboring sciences such as agricultural 
meteorology, aviation meteorology, maritime and technical 
meteorology. The meteorological weather forecast is based 
on Synoptic Meteorology. Here, a network of ground-based 
atmospheric observing stations is used to perform 
measurements under a standardized procedure. These 
observations take place uniformly throughout the world at 
fixed time intervals. The information obtained is then 
supplemented by radiosonde ascents, satellite observations 
and aircraft measurements. The collected data is then 
mapped in weather maps and is used, on the one hand, for 
the shortest-term forecast (0-2h forecast), the so-called 
nowcasting and further as input for Numerical Weather 
Models (NWM). One of the most widespread NWM is the 
global GFS model (Global Forecast System) of the US 
National 
Oceanic 
and 
Atmospheric 
Administration 
(NOAA). Using the NWM, very short-term forecasts (2-
12h), short-term forecasts (12-72h) and medium-term 
forecasts (3-10d) are then prepared by state and private 
weather services [11]. 
In recent years, dramatic progress has been made in the 
field of weather forecasting. The quality of the weather 
forecast fluctuates during the year. Thus, in the summer, 
more reliable forecasts can be drawn up in more stable 
weather conditions than in winter. For example, the average 
forecast error of the daily high temperature for a one to two-
days forecast of the German weather service fell from 2.5 K 
in the year 1984 to 1.6 K in the year 2008 [12]. 
The use of weather forecasts for control engineering 
applications 
in 
combination 
with 
model 
predictive 
controllers has already been investigated in several scientific 
papers [13]-[19].  The main application area was the climate 
control of buildings. In [17], the impact of forecasting 
accuracy of different prediction models on the quality of a 
model-predictive control for climate control of buildings 
was investigated. Different methods based on historical data 
(TMY2 
predictor, 
same-as-yesterday 
predictor, 
bin 
predictor) were compared with methods based on unbiased 
random walk and on seasonal autoregressive and moving 
average prediction model (SARIMA). It was observed that 
the bin predictor models, in particular the 30-days and 60-
days bin models provide the best performance. Furthermore, 
it was found that in comparison to the model predictive 
control with perfect prediction, the quality of the methods 
with bin predictor were only slightly behind. In [18], an 
improved disturbance prediction method as well as an 
extended MPC method, the stochastic MPCs (SMPC), have 
been used. Stochastic MPCs take into account the 
uncertainties of the measuring system, the overall system 
and the state estimator. An overview of SMPC can be found 
in [19]. For the prediction of the weather, results of the 
numerical weather prediction model COSMO-7, locally 
measured weather by the SWISS Meteological Network and 
building measurements were used. Furthermore, a linear 
error model was generated, which then provided the forecast 
in combination with the weather data via a Kalman filter. 
The use of online weather predictions is discussed in [20] 
and [21]. In order to forecast the future temperature value, 
the predicted temperatures of various online accessible 
weather services were combined in [21] to an improved 
prediction. Furthermore, the prediction of the solar 
radiation, which is not part of the weather forecast, is 
discussed. In this case, a method is proposed, which 
calculates the theoretical global radiation as a function of 
location and time for a clear sky as well as a method for 
calculation reduction in the irradiation through the predicted 
cloudiness. By means of a linear regression model, these 
forecast data are then linked with actual measured data. 
In summary, it can be said that the results obtained are a 
great advance for application to the regulation of building 
climate control, but can be transferred only partly to the area 
of electric vehicles HVAC. There are several reasons for 
that. Due to the size, design, the storage capacity and 
thermal insulation, the entire system responds much slowly 
to external disturbances. As a result, short-term fluctuations 
do not have a very strong effect on the overall system. 
Furthermore, the system is generally operated continuously 
and not as in the case of the vehicle from only a few minutes 
to a few hours. This requires for building climate control a 
rather long-term forecast, which tolerates a wider standard 
deviation in the sense of the distribution of the forecast 
error. Secondly, buildings do not rotate and do not change 
their positions either. As a result, the associated weather 
observation stations and also the distance to this stations do 
not change, which can lead to a different prediction quality. 
The relative position to the sun in the case of buildings 
depends only on astronomical laws. This, on the other hand, 
affects the maximum possible global solar radiation as well 
as the side of the system facing the sun. Similarly, the 
relative position to shadow-causing obstructions like 
neighboring buildings, plants and trees does not change. In 
addition, a moving object is obviously exposed to bigger 
weather fluctuations, since the weather can differ from place 
to place. In [22], a high resolution system for routes, which 
monitors not weather data but road infrastructure based on 
acquired vehicle sensor data and machine learning was 
introduced. In [20], a range prediction system was 
introduced, which considers continually updated and locally 
resolved GFS weather data. The finest resolution of this 
system is 1 km. This resolution is too low for our 
application since, e.g., shadow-causing obstructions are not 
taken into account. All this require a more elaborate 
76
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-610-1
ADAPTIVE 2018 : The Tenth International Conference on Adaptive and Self-Adaptive Systems and Applications

prognosis technique than in the upper case, which will be 
presented in this study. 
III.
IMPACT AND EVALUATION OF THE PREDICTION 
ACCURACY
The quality of control of a model predictive control 
essentially depends on the accuracy of the predicted 
manipulated variables, the accuracy of the predicted 
variables of the constraints and the range of the prediction 
horizon. Since the control optimizes only within the range 
of the prediction horizon, the optimum found is locally 
limited to this horizon. If a manipulated variable is predicted 
incorrectly in this horizon, the control deviation is also 
predicted incorrectly, which is why the control cannot find 
the true optimum for the given boundary conditions. The 
prediction value of the future behavior of the manipulated 
variables is subject to two uncertainties. On the one hand, it 
is subject to the accuracy of the process model, which is not 
part of this work, and, on the other hand the consideration of 
the disturbance variables of the control. If a disturbance 
variable changes only slowly in relation to the range of the 
prediction horizon, then the prediction accuracy can be 
improved by integrating the current values of the 
measurable quantities into the control. Additionally, 
immeasurable state and disturbance variables can be 
estimated by using observers or Kalman filters [20]. Since 
in the case of vehicle air conditioning, the disturbance 
variables, such as temperature and solar radiation, are 
subject to strong fluctuations with respect to the forecast 
horizon, these measures are only limited sufficient. 
The exact quantification of the impact of a tangible 
prediction error, e.g., in terms of energy saving is difficult, 
as this effect depends on the particular MPC model and the 
state of all system parameters and variables. The quality of 
the forecasting method is therefore evaluated below in 
relation to the quality of the existing methods and the 
measurement inaccuracy of the respective sensor. In the 
case of the outside temperature prediction, the temperature 
sensor has a resolution of 0.5 K. This equates to an RMSE 
of 0.5, which is used as reference value. Since in this study 
the forecast horizon is assumed to be the duration of a 
journey up to one hour, the best state of the art reference 
estimate of the temperature is used on the basis of historical 
data and a naive prognosis. The estimated value of the naive 
prognosis corresponds to the first measured value of the 
temperature. The historical data estimate is usually in 1 hour 
increments. So, here it is assumed that this can be 
represented by the mean value of the vehicle measurement. 
The evaluation of the radiation prognosis is carried out 
analogously, whereby in this case the measurement 
inaccuracy is in each case 10% of the measured value. 
IV.
STRUCTURE OF THE DISTURBANCE VARIABLE 
PROGNOSIS SYSTEM
The task of the disturbance variable prognosis system is 
to predict the thermal disturbances acting on the system 
precisely in terms of extent and, if applicable, effective 
direction for the period of an impending journey with an 
electric vehicle. The accuracy must be described with a 
rating system. Each predicted single value for a variable 
corresponds to the realization of an event. Since this 
realization of an event is subject to a certain probability, a 
good prediction method must also predict a whole 
probability distribution for each individual event to be 
predicted [24]. 
The reference system is thus the continuous time of 
travel in the vehicle. Since the disturbances are caused 
externally and locally, the reference system must be related 
to the local state. This is done by two successive 
predictions. First of all, the location, time and orientation of 
the vehicle are predicted for the course of the journey. For 
this purpose, the route is discretized in road sections. 
Secondly, a prediction of the local disturbances is made for 
each discretized road section at the predicted time, taking 
into account the direction of travel. The forecasting 
procedure is described below. In this case, it is assumed that 
the destination of the trip is known to the system in advance. 
A.
Location – Time Prediction 
As already mentioned, the prediction for the upcoming 
journey takes place in the form of a series of predictions for 
the separate road sections of the route ahead. Every road 
section is referred to as a segment in the following. A 
segment always consists of 2 nodes. The nodes used here 
originate from the OpenStreetMap data model (OSM). A 
node consists of a single point in space defined by its 
latitude, longitude, altitude and node ID. Currently, as of 
June 2017, 3,900,000,000 points are defined in the OSM 
data model. 
Figure 1. Definition of map elements 
A journey is made on a defined way. The way is defined 
by its start and end nodes. Several routes are possible for 
77
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-610-1
ADAPTIVE 2018 : The Tenth International Conference on Adaptive and Self-Adaptive Systems and Applications

each way. The allocation of ways and routes is done in a 
separate table of the database of the system. Each route is 
defined by a fixed sequence of segments. The definitions 
used here are shown graphically in Figure 1. For the first 
prediction, it is now necessary to predict the segment entry 
time and the dwell time of the vehicle in this segment. This 
must be done successively for all segments to be traversed 
on the entire route. For this purpose, it is necessary in a first 
step to find an optimal path between the start and the 
destination. This can be accomplished with the aid of a 
suitable route planning algorithm, e.g., the Dijkstra's 
algorithm. Since the finding of the optimal route is not 
subject of this investigation, the routing API of the open 
source routing library GraphHopper was used for this 
purpose. The GraphHopper API provides the optimal route 
for a given way in the form of individual waypoints of 
OSM-nodes and associated time points. From this, a 
predicted dwell time can be derived for each segment, and 
additionally, since the length of the segment can be 
calculated, a predicted velocity in the segment can also be 
derived. In the context of vehicle measurements, however, it 
was found that these prognosticated times are not suitable as 
a basis for the following predictions of the disturbance 
variables. Although on average the arrival time is predicted 
relatively well, there are strong deviations in the individual 
segments. This is based on the fact that depending on the 
type of road, a certain average speed is assumed and 
individual conditions such as the occurrence of traffic lights 
are not taken into account individually.   
Figure 2. Predicted velocity by GraphHopper routing 
Figure 3. Predicted velocity by wknn-approach 
Figure 2 shows the comparison of a velocity prediction 
made with the GraphHopper routing and a corresponding 
vehicle measurement. However, a more precise prognosis of 
the dwell time in the segment is necessary, since it is 
necessary to determine how long the vehicle will be 
subjected to the respective disturbance variable, e.g., of the 
solar radiation, in the individual segment. For this purpose, 
a forecast function based on machine learning was 
developed, which more accurately predicts both the time of 
arrival and segment dwell time. Figure 3 shows the 
comparison of the predicted velocity and the actual 
measured velocity. The prediction function is described in 
more detail in Section VI.A. 
B. Prediction of Disturbances Variables 
In the subsequent second prediction, the prediction of 
the disturbance variables must now be performed for each 
segment at the predicted arrival time. The measured values 
of local weather stations, local weather forecasts and the last 
known measured value of the vehicle are used as input for 
the prediction function. Various online weather services are 
available for querying weather data. These include, for 
example, YR (Norwegian Weather Service), DWD (German 
Weather Service), OpenWeatherMap (Extreme Electronics 
LTD), Weather Underground (IBM) and Here (Intel, Audi, 
BMW, Mercedes, etc.). These services provide current and 
historical weather data as well as weather forecasts to 
developers of web services and mobile applications. In this 
study, primarily OpenWeatherMap is used. However, 
further services will be integrated into the system in 
perspective. OpenWeatherMap uses, among other tools, the 
already mentioned GFS model of the NOAA as a NWM. An 
API can be used to access data on cloudiness, air 
temperature, air pressure, wind speed, wind direction, 
precipitation and humidity. These data also include the 
coordinates of the assigned weather station, the time of the 
last measurement as well as the projected time period for the 
78
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-610-1
ADAPTIVE 2018 : The Tenth International Conference on Adaptive and Self-Adaptive Systems and Applications

forecast of the predicted weather events. The data of the 
weather services are referred to below as services. A 
number of specific services are assigned to each individual 
segment. The assignment of services to segments is 
determined by a request to the respective weather services 
and then registered in a separate table of the database. This 
is done once when creating a new route. The entities are in a 
many-to-many relationship. This means that each segment 
can be assigned to several services and each service can be 
valid for several segments. Since the segment sequence is 
fixed for each route based on the primary prediction, all 
associated services can now be determined for an upcoming 
journey. In advance to the disturbance variable prediction, 
the weather data for all services for all affected segments are 
queried and stored in the database. The weather data are 
supplemented by additional data to interpret their 
informative value. For example, the relative position of the 
affected weather station to the affected segment, as well as 
the time difference between the segment entrance time and 
the weather forecast time are stored. To predict the 
disturbance variables, all these data are entered into a 
mathematical 
algorithm, 
which 
outputs 
the 
desired 
variables. This algorithm is based on machine learning. 
Each segment is initially considered independent of other 
segments. The approach for the learning is so-called 
supervised learning. The algorithm learns a function from 
given pairs of inputs and outputs for each segment. The 
correct result of the function is available during the learning 
process as training data. The goal of supervised learning is 
to train the system until it can establish the correct 
associations. 
In addition to the input data, the output data are also 
required for the learning process. In this case, this 
corresponds to the measured disturbance variables. The 
measurement and preparation of this data are subject of the 
next chapter. 
V.
DATA COLLECTION AND PROCESSING
For this investigation, an electric vehicle of the VW    
e-Golf type was used. This vehicle is equipped, as standard, 
with various sensors for recording vehicle and climate data. 
These are, for example, the ambient air temperature sensor, 
the fresh air intake duct temperature sensor, the humidity 
sensor, the sunlight penetration photo sensor, the brightness 
and rain sensor of the windscreen wiper. In addition, the 
current position can be determined via GPS and, of course, 
the speed can also be measured. The signals from the 
sensors can be tapped via the various CAN busses as well as 
via the onboard diagnostic interface (OBD). Since, in the 
case of the Can bus, the data can be recorded in finer time 
frames with cycle times of 20 ms to 200 ms, access was 
made to these data. For the vehicle measurement, the 
powertrain-CAN, infotainment-CAN and comfort-CAN 
were cut free and connected to a data logger. The data 
logger, on the other hand, can transfer the recorded data 
wirelessly to the central server via WiFi or 3G. These 
measurement data are organized in a first processing step in 
such a way that a vector of time stamp, geographical length, 
geographical latitude, outside temperature of the air, 
precipitation quantity, solar radiation, air humidity and 
vehicle speed are assigned to each measured time point in 
the 200 ms time grid. In a further processing step, each of 
these vectors is assigned to a known segment of the 
database. For this purpose, it has always been ensured that 
the segments have already been registered in the database as 
part of the prediction. Depending on the vehicle speed and 
time grid, the number of measuring points per segment 
varies in each case. Figure 4 shows the location of the 
measurement points (red dot) and the predicted segments 
(colored line with segment number) for a part of a trip. 
The mapping of the vectors to the segments is carried 
out by means of a mapmatching algorithm, taking into 
account the distance from the measured point to the center 
of the segment as well as the segment length. In order to 
improve the route planning, the determined segments are 
compared with the predicted segments and, when 
appropriate, a new path is registered in the database. If no 
measured value is measured for a prognosticated segment, 
this segment is not subsequently learned. 
Figure 4. Predicted segments and measurement points 
In the next processing step, all the values of assigned 
measuring points of a segment are aggregated to a single 
value xs for each variable 
. 
ݔௌ =
∑
௧೔∗௫೔
೙
೔సభ
∑ ௧೔
೙
೔
  (1) 
After this step, the target data for the learning functions are 
ready for use.  
VI.
APPLIED MACHINE LEARNING TECHNIQUES
There is a wide range of different methods of machine 
learning for different tasks like classification, regression or 
clustering. For our underlying problem of regression, there 
79
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-610-1
ADAPTIVE 2018 : The Tenth International Conference on Adaptive and Self-Adaptive Systems and Applications

are a number of methods that differ by calculation effort, 
ability to generalize, fast convergence or overfitting. Since 
we have a huge number of road segments, which we have to 
train separately, we choose the procedures with the least 
computational effort. These methods are based on k-nearest 
neighbor and linear regression algorithms. 
A.
Vehicle Speed and Segment Dwell Time 
The vehicle speed in a segment is related to vehicle 
type, driving style, traffic situation, road type, road 
geometry, and possible obstacles, e.g., traffic lights or 
construction sites. In the first approach, it is assumed that 
these influencing variables are essentially related to the time 
of the trip and are subject to similar patterns. While the road 
type and road geometry hardly change, the other factors 
tend to vary more. Our approach is based on the assumption 
that, e.g., the overall situation on a Monday morning always 
behaves similarly and again different than on Saturday 
night. Therefore, a dwell time in the segment is to be 
predicted depending on the time and the day of the week. 
ܸ: ܵ × ܶ ×ܦ→ܴ                                                              (2) 
ܵ⊆ ℤ                            ݏ݁݃݉݁݊ݐܫܦ
ܶ={0…86400}
ܶ⊆ ℤ                           ܿ݋݊ݐ݅݊ݑ݋ݑݏݏ݁ܿ݋݊݀݋݂ݐℎ݁ ݀ܽݕ
ܦ={1…7}ܦ⊆ ℤ   ݀ܽݕ
ܴ⊆ ℝ                          ݀ݓ݈݈݁ݐ݅݉݁
 The 
non-parametric 
distance-weighted 
k-nearest-
neighbor method, which has already been published in [25], 
was used for this purpose. The wkNN algorithm is one of 
the simplest machine learning algorithms and due to the 
multitude of segments to be learned well suited. The feature 
space (labeled examples) consists of all the aggregated 
measured data of the segment. The output consists of the 
property values of the k closest training examples in the 
feature space. The Euclidean distance is used as a distance 
metric. Since the feature space is circular in both dimension, 
e.g., the Monday (numerically represented as 1) beside the 
Sunday (numerically represented as 7), the feature space at 
the edges was expanded by copies of the opposite edge. For 
the k-property values, a weight w is calculated according to 
their distance. 
ݓ௡=
భ
೏೙
∑
భ
೏೔
ೖ
೔సభ
 (3) 
With these weights of the individual neighbors, the resulting 
total value for the prediction rpred is then calculated. 
ݎ௣௥௘ௗ = ∑ݓ௜∗ݎ௜
௞
௜ୀଵ
 (4) 
As Figure 4 shows, the quality of the results is already 
significantly higher than that of the route planning. Figure 5 
shows the distribution of the error for this measurement run. 
Figure 5. Velocity prediction error 
As can be seen from this, it can be approximated with 
standard normal distribution. The dwell time for each 
segment can now also be determined from the vehicle 
speed. The prediction is performed sequentially one step 
ahead for all segments of an upcoming trip. To calculate the 
segment entry time of the following segment tk+1, the 
predicted dwell time rpred of the last segment is added to the 
segment entry time of the last segment.  
ݐ݇+1=ݐ݇+ݎ݌ݎ݁݀݇  (5) 
B.
Temperature Prediction 
The prediction of the ambient temperature is based on 
the work described in Section II. and extended to routes. On 
the basis of data from online weather services the local 
temperature in a specific segment is to be predicted. As 
already mentioned, in the first instance only the 
OpenWeatherMap service was used for this purpose. Our 
following machine learning approach is based on the 
assumption that the temperature of two different places at 
the same time within a close area has a fixed offset. The 
second assumption is that the temperature changes by a 
constant slope over a limited period of time.  This slope is 
assumed to be constant in a limited area for limited time 
span. The slope is calculated from the weather forecast for 
the next 3 hours. The input to the learning process is the last 
measured value and the predicted time slope of the 2 closest 
weather stations for every segment.  
For temperature prediction, a learning method with a 
weighted multivariate regression is used. The weights w are 
used to represent the temporal change of the temperature of 
a segment and correspond to the time elapsed since the 
query of the respective weather date. Using the weights a 
multiple linear regression analysis using least squares 
algorithm is performed for the following equation: 
ݕ=ܾ଴+∑ܾ௜∗ܶ௜
ଶ
௜ୀଵ
+ ∑
ܾ௜ ∗ݓ௜∗∆ܶ
ସ
௜ୀଶ
 (6) 
80
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-610-1
ADAPTIVE 2018 : The Tenth International Conference on Adaptive and Self-Adaptive Systems and Applications

Figure 6. Temperature forecast and measurement 
The system was trained by 30 test runs and tested in 3 
further vehicle measurements to validate the learned 
function. The 3 test runs averaged a RMSE of 0.626. As can 
be seen in Figure 6 the predicted results were not very 
accurate. The reason for this was the strong deviation of the 
forecasted openweathermap weather data from the actual 
temperature value. Therefore, the openweathermap weather 
data for Clausthal was substituted by weather data retrieved 
from the control engineering institut weather station in 
Clausthal and applied in another test series. The system was 
subsequently trained and tested again. 
Figure 7 shows the results of the prediction and 
measurement for a test run from Goslar to Clausthal and 
back. Both places have a height difference of 300 meters, 
which explains the strong temperature change. Two 
additional test runs were performed, which gave similar 
results. The quality of the prediction can be evaluated by 
calculating the root mean square error (RMSE). 
Figure 7. Temperature forecast and measurement 
The test runs averaged a RMSE of 0.151, which is 
significantly lower than the naïve prognosis (RMSE 3.325), 
the historical data estimation (RMSE 1.3459) and resolution 
(RMSE 0.5K). The error probability can approximately be 
described with a standard normal distribution. The 
prognosis procedures for humidity and air pressure are 
carried out analogously to the temperature prognosis 
method. Therefore, a further explanation thereof will be 
omitted. 
C.
Prediction of Solar Radiation 
The energy input to a vehicle by solar radiation is 
essentially dependent on the relatively constant radiation 
power of the sun, the angle of solar irradiation, the degree of 
atmospheric reflection and absorption, the cloudiness and 
the position of shadow-causing objects. The solar radiation 
consists of direct and indirect radiation. The prediction of 
solar radiation is more difficult, since weather services do 
not provide a direct forecast for radiation. The weather 
services provide only a description and prediction of the 
cloudiness in the form of a scalar valuation from 0 to 100. 
However, studies in the fields of agricultural meteorology 
[26] and regenerative energy systems [27] show that the 
proportion of direct radiation can be calculated very well 
when the position of the sun relative to the own location is 
known. However, if diffuse solar radiation occurs due to 
dispersion of the light through obstacles, fog or clouds, the 
irradiance can hardly be calculated. In our approach, it is 
assumed that if there is no cloud or mist, the energy input by 
solar radiation can be learned. The reason for this is that the 
reduction in the radiation caused by shadow causing 
obstacles (buildings, plants and trees) again depends only on 
the angle of the sun radiation. The shadow as a function of 
the sun position is thus learnable. The position of the sun 
can be described by the azimuth and the solar altitude. 
Azimuth and solar altitude can be calculated with the values 
predicted in Section IV.A. by using the astronomical 
formula referred to in [27]. If now additionally information 
about the weather, as the extent of the cloudiness, is added, 
this effect is also be learnable. The input variables for the 
prediction algorithm are therefore the position of the sun, 
described by azimuth and sunshine, as well as the predicted 
degree of cloudiness by the weather service. In analogy to 
the calculation of the temperature, normalized weights are 
calculated for the cloud values from the weather data in 
order to compensate the temporal offset between predicted 
segment entry time and measurement time. This initially 
predicts the degree of cloudiness. In the first approach, the 
recorded and aggregated signals of the brightness sensor of 
the windshield wiper control were used as training data. The 
distance-weighted 
k-nearest-neighbor 
approach 
from 
Section VI.A is again used as a learning method. The 
system was again trained by 30 vehicle measurements, then 
tested in 4 measurements in August and November.  
81
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-610-1
ADAPTIVE 2018 : The Tenth International Conference on Adaptive and Self-Adaptive Systems and Applications

Figure 8. Results of the solar radiation prediction 
Figure 8 shows the results of the experiment. In this case, it 
can be seen that the course of the radiation acting on the 
vehicle is relatively well predicted, but in absolute terms 
there are sometimes high deviations. This can be explained 
by the small number of measuring journeys, which did not 
adequately reflect the possible constellations of cloudiness 
in the training data. The prediction for the test runs averaged 
an RMSE of 1131.2, which is significantly lower than 
average RMSE for the naïve prognosis (RMSE 5499.4) and 
the historical data estimation (RMSE 3097.4). As can be 
seen in Figure 8, the predicted brightness is partly 
significantly lower than the later measured brightness. The 
reason for this is that the samples gained in the training had 
a lower degree of cloudiness compared to the test run. This 
error can be predicted by evaluating the aggregated mean 
distance from formula (3). The difference of the cloudiness 
of the k-similar samples to the expected cloudiness is 
represented by the distance weight wn. To tackle this 
problem, the quality measure J of the prediction is 
determined in advance. 
ܬ= 
భ
ೖ ∑
௪೙
ೖ
೙సభ
√ଷ
 
 (7)
If the prediction is insufficient, due to insufficient 
learning data, an error handling routine must be integrated 
in the MPC algorithm. This could be realized, for example, 
by the temporary use of a conventional controller. 
VII.
CONCLUSION
The limited range of BEV is still a big challenge. To 
tackle this, we have shown an approach to improve the 
promising MPC-control strategy. We have trained machine 
learning algorithms with data from weather forecasts and 
vehicle sensor data to generate various prediction functions 
for the individual thermal disturbance variables. The quality 
of the thermal disturbance variable prediction strongly 
depends on the weather forecast quality and on the quality 
and quantity of the training data. Increasing this quality will 
be the subject of the upcoming work steps. In order to 
increase the quality of the input forecasts for the individual 
segments, further weather services are to be integrated into 
the system on one hand. On the other hand, the use of 
several vehicles in the course of a fleet test should result in a 
larger training data volume.
REFERENCES 
[1] A. Wiebelt und M. Wawzyniak, „Thermal Management for 
Electrified Vehicles,“ MTZ worldwide Volume 77, p. 38–43, 
May 2016.  
[2] E. Rahimzei, „How does data about energy consumption and 
range of electric vehicles come about?,“ VDE e. V., Frankfurt 
am Main, 2015. 
[3] H. Esen, T. Tashiro, D. Bernardini and A. Bemporad, „Cabin 
heat thermal management in hybrid vehicles using model 
predictive control,“ in 22nd Mediterranean Conference on 
Control and Automation, Palermo, Italy, 2014.  
[4] M. Auer, Ein Beitrag zur Erhöhung der Reichweite durch 
prädiktives 
Thermomanagement, 
Stuttgart, 
Germany: 
Springer Vieweg, 2015.  
[5] A. Karnik, A. Fuxman, P. Bonkoski, M. Jankovic and J. 
Pekar, „Vehicle Powertrain Thermal Management System 
Using Model Predictive Control,“ in SAE International 
Journal of Materials and Manufacturing - V125-5, Detroit, 
USA, 2016.  
[6] J. Eckstein, C. Lueke, F. Brunsteina, P. Friedela, U. Koehler 
and A. Traechtler, „A Novel Approach Using Model 
Predictive Control to Enhance the Range of Electric 
Vehicles,“ in 3rd International Conference on System-
integrated Intelligence: New Challenges for Product and 
Production Engineering, SysInt 2016, Paderborn, Germany, 
2016.  
[7] J. Lopez-Sanz, C. Ocampo-Martinez, J. Alvarez-Florez, M. 
Moreno-Eguilaz, R. Ruiz-Mansilla, J. Kalmus, M. Graeber 
and G. Lux, „Nonlinear Model Predictive Control for Thermal 
Management in Plug-in Hybrid Electric Vehicles,“ in IEEE 
Transactions on Vehicular Technology Volume 66, 2017.  
[8] M. A. Al Faruque and K. Vatanparvar, „Modeling, Analysis, 
and Optimization of Electric Vehicle HVAC Systems,“ in 
Design Automation Conference (ASP-DAC), 2016 21st Asia 
and South Pacific, Irvine, 2016.  
[9] M. Graeber, C. Kirches, D. Scharff and W. Tegethoff, „Using 
Functional Mock-up Units for Nonlinear Model Predictive 
Control,“ in Proceedings of the 9th International Modelica 
Conference, Munich, Germany, 2012.  
[10] T. Fischer, T. Kraus, C. Kirches and F. Gauterin, „Nonlinear 
Model Predictive Control of a Thermal Management,“ in 
Proceedings of the 12th International Modelica Conference, 
Prague, Czech Republic, 2017.  
[11] B. Klose und H. Klose, Meteorologie, Oldenburg, Germany: 
82
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-610-1
ADAPTIVE 2018 : The Tenth International Conference on Adaptive and Self-Adaptive Systems and Applications

Springer Spektrum, 2016.  
[12] R. 
Wengenmayr 
and 
G. 
Lux, 
„Wie 
gut 
sind 
Wettervorhersagen?- 
Qualitätsprüfung 
beim 
DWD,“ 
Deutscher Wetterdienst, Offenbach, Germany, 2008. 
[13] W. J. Grünenfelder and T. Juerg, „The use of weather 
predictions and dynamic programming in the control of solar 
domestic 
hot 
water 
systems,“ 
in 
Mediterrainian 
electrotechnical Conference of IEEE Region 8, Madrid, 
Spain, 1985.  
[14] F. 
Weißel, 
Stochastische 
modell-prädiktive 
Regelung 
nichtlinearer 
Systeme, 
Karlsruhe: 
Universitätsverlag 
Karlsruhe, Germany, 2008.  
[15] G. P. Henze and M. Krarti, „Predictive Optimal Control of 
Active and Passive Building Thermal Storage Inventory,“ in 
University of Nebraska, Lincoln, USA, 2005.  
[16] F. Oldewurtel, A. Parisio, C. N. Jones, D. Gyalistras, M. 
Gwerder, V. Stauch, B. Lehmann and M. Morari, „Use of 
model predictive control and weather forecasts for energy 
efficient building climate control,“ in Energy and Buildings 
(2012) 15–27, Zurich, Switzerland, 2012.  
[17] A. Viehl, R. Valentina, M. R. Zofka and B. Mühr, „Optimized 
Utilization of E-Vehicle Range Using Route-Based Online 
Weather Forecast Data,“ in 24th Aachen Colloquium 
Automobile and Engine Technology 2015, Aachen, Germany, 
2015.  
[18] Y. Zhang and V. I. Hanby, „Short-term prediction of weather 
parameters using online weather forecasts,“ in Proceedings: 
Building Simulation 2007, Leicester, United Kingdom, 2007. 
[19] J. Masino, J. Thumm, M. Frey and F. Gauterin, „Learning 
from the crowd: Road infrastructure monitoring system,“ in J. 
Traffic Transp. Eng. (Engl. Ed.) 2017; 4 (5): 451-463, 
Karlsruhe, Germany, 2017.  
[20] R. Dittmar and B.-M. Pfeiffer, „Industrial Application of 
Modell Predictive Control,“ at Automatisierungstechnik, Bd. 
12, pp. 592-593, 2006.  
[21] M. Feindt and U. Kerzel, Prognosen bewerten - Statistische 
Grundlagen und praktische Tipps, Karlsruhe, Germany: 
Springer Gabler, 2015.  
[22] S. A. Dudani, „The Distance-Weighted k-Nearest-Neighbor 
Rule,“ in IEEE Transactions on Systems, Man, and 
Cybernetics, Malibu, USA, 1976.  
[23] H. S. Fischer and H. Gilgen, „DACHRad – Berechnung der 
direkten Sonneneinstrahlung in Deutschland, Österreich und 
der Schweiz,“ in Bulletin of the Geobotanical Institute ETH, 
Zurich, Switzerland, 2002.  
[24] V. Quaschning, Regenerative Energiesysteme, Munich, 
Germany: Carl Hanser Verlag, 2015.  
[25] G. P. Henze, D. R. H. and K. Moncef, „Development of a 
predictive optimal controller for thermal energy storage 
systems,“ in International Journal of HVAC&R Research 
3(3), Boulder, USA, 1997.  
[26] G. P. Henze, D. E. Kalz, S. Liu and C. Felsmann, 
„Experimental Analysis of Model-Based Predictive Optimal 
Control for Active and Passive Building Thermal Storage 
Inventory,“ in HVAC&R Research, Volume 11, Number 2, 
Lincoln, USA, 2005.  
[27] B. Dong and K. P. Lam, „A real-time model predictive 
control for building heating and cooling systems based on the 
occupancy behavior pattern detection and local weather 
forecasting,“ in BUILD SIMUL (2014), San Antonio, USA, 
2013.  
83
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-610-1
ADAPTIVE 2018 : The Tenth International Conference on Adaptive and Self-Adaptive Systems and Applications

