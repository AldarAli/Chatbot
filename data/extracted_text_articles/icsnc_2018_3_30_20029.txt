Routing Algorithm Based on the Transmission History for Monitoring Railway 
Vehicles 
Nagateru Iwasawa, Satoko Ryuo, Tomoki Kawamura and Nariya Iwaki 
Signalling and Transport Information Technology Division 
Railway Technical Research Institute 
Tokyo, Japan 
e-mail: iwasawa.nagateru.81@rtri.or.jp 
 
 
Abstract— Efforts have been made to utilize the Wireless 
Sensor Network (WSN) to monitor the state of railway 
facilities, such as structures, tracks, vehicles, etc. In monitoring 
the condition of railway cars, items such as the brakes, the 
train speed, the truck vibration, etc. are subjected to 
monitoring. We are developing a system under which the crew 
can monitor the condition of the train's vehicle in real time. In 
cases where data are transmitted when the train is running, it 
is assumed that the communication distance between the 
wireless terminals changes according to changes in the radio 
wave propagation environment. Therefore, in this paper, we 
propose a transmission method when the train is driving, and 
also conduct a functional verification test by an actual machine. 
Keywords-routing algorithm; railway vehicle; monitoring; 
radio wave environment. 
I. 
 INTRODUCTION 
Recently, with the development of information and 
communication technology, studies on the monitoring of the 
condition of the railway facilities by using the WSN have 
been in progress [1][2]. They cover diverse fields, such as 
the structures, the tracks, the overhead contact lines and the 
vehicles. Furthermore, the purpose of the monitoring is 
extensive. Two examples are the detection of abnormal 
values due to sudden condition changes, such as the 
landslide and derailment, and understanding, via long-term 
monitoring, of the tendency to deterioration of the facilities. 
In the railway vehicle condition monitoring, data such as the 
control information of brakes and air conditioning, train 
speed, train positions, temperature and vibration of the bogie 
are collected. In this paper, our purpose of the railway 
vehicle monitoring is that the crew of the train confirms the 
control information of the brake in a minute. 
Figure 1 shows a typical WSN setup for railway 
condition monitoring [2]. The WSN consists of sensor nodes 
that measure the physical quantity and wirelessly transmit it 
as sensor data and a base station that collects data. 
Furthermore, the base station transmits the data to the server 
via a network like the mobile telephone network as necessary. 
Also, the server accumulates the data in the Data Base (DB). 
The users can access the data in the DB via the public or the 
private network. In the train consisting of multiple vehicles, 
if the vehicles condition is monitored, the sensor nodes of the 
WSN are installed linearly. The ways of the transmission the 
sensor data from these sensors to the base station are single-
hop and multi-hop. Besides, in areas where fixed power 
sources, such as a bogie cannot be supplied, the sensor nodes 
are driven by the batteries, so efficient power consumption is 
required. When the distance between the lead vehicle and the 
last vehicle is several hundred meters, in order to make a 
single-hop network, it is necessary to increase the 
transmission power. Of course, there is a possibility that 
direct communication between the lead vehicle’s node and 
the last vehicle’s node cannot be performed with the 
prescribed transmission power. So, it is important that the 
WSN of the train need efficient multi-hop routing. For 
example, some sensor nodes are grouped, and one sensor 
node in each group aggregates the sensor data, and the base 
station collects data via the aggregated sensor nodes [3][4][5]. 
In addition, a method of constructing a Wireless Personal 
Area Network (WPAN) using ZigBee for communication 
within a group and configuring a Wireless Local Network 
(WLAN) using Wi-Fi for communication between groups 
and base stations has been proposed [6]. However, the sensor 
nodes included in each group are fixed, so it is not taken into 
consideration that the coupling given thought that the 
coupling and the decoupling train vehicles causes groups and 
the base station to change. And the wireless communication 
technology for WSN called Low Power Wide Area (LPWA), 
such as LoRaWAN and SIGFOX can be construct a fixed 
wide network. So, it is applicable as long as the train set does 
not change. 
On the other hand, in the ad hoc network, it is possible to 
construct a network with a base station and the sensor nodes 
among neighbor vehicles and collect data. So, it is suitable 
for a system under which all the sensor data of the trains in 
 
Figure 1.  Example of WSN for railway condition monitoring 
 
58
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-669-9
ICSNC 2018 : The Thirteenth International Conference on Systems and Networks Communications

the area are accumulated in the DB and the users can browse 
the data in it. But in such a system, overhead occurs when 
the train crew browse the data in the DB due to data 
transmission from the base station to the DB and the access 
to the data by the train crew. Therefore, it is necessary to 
construct a network among the base station and the sensor 
nodes of one train set so as to reduce the length of time until 
the crew checks the data. For example, it is possible to 
construct an ad hoc network between the base station and the 
sensor nodes by manually setting the same network 
IDentification (ID) on base station and sensor nodes. But 
considering the time required for setting the network ID and 
the possibility of misconfiguration, it is desirable to 
automatically construct the network in the train set. In ad hoc 
network research, a method of estimating the location of a 
sensor node based on the Received Signal Strength Indicator 
(RSSI), the Time Of Arrival (TOA) and the Time Difference 
Of Arrival (TDOA) has been proposed [7]. However, it is 
not realistic because it may result in errors with a probability 
of 50% or more. Also, instead of the Global Positioning 
System (GPS) with high power consumption, a method 
capable of discriminating between vehicles of the same train 
and different train based on the correlation between the data 
for several seconds obtained from the acceleration sensor has 
been proposed [8]. However, there are problems in that it is 
necessary to scale down in order to implement it on the 
Central Processing Unit (CPU) of the sensor node, etc., 
because MATrix LABoratory (MatLab) [9] analyzes data 
offline. 
Therefore, we have proposed a system configuration and 
a method of automatically constructing a closed network 
within a train set at the time of the train is stopping at a 
station, taking into consideration the coupling and 
decoupling [10]. In this paper, we propose a method of 
efficiently collecting data in the network of the system 
mentioned above at the time the train is running. 
The rest of the present paper is organized as follows:  
Section II presents our proposed system for the railway 
vehicle monitoring. In Section III, we propose the routing 
algorithm for the monitoring system at the time the train is 
running. In Section IV, we implement the proposed 
algorithm in a prototype, and we indicate the result of the 
function verification test with it in Section V. Finally, 
Section VI concludes the present paper. 
II. 
SYSTEM PROPOSED 
A. System Configuration [10] 
Figure 2 shows the system configuration we have 
proposed regarding the construction of a network for each 
train set for collecting data. First, the in-vehicle network 
consists of a relay and sensor nodes in one vehicle. The relay 
relays the sensor data from the sensor nodes. The networking 
components of this network are not variable even if the train 
set changes according to the coupling and decoupling, so it 
may be a fixed network. Therefore, the communication 
between the relay and the sensor node in this network is 
possible using a wired as well as a wireless network. 
Next, the inter-vehicle network consists of a base station 
and relays in one train set. The base station collects the 
sensor data from the relays. The base station comprehends 
the vehicles and the relays of its own train and constructs a 
network based on the organization information in the 
operation plan of the vehicles. By selecting a frequency band 
different from that of the in-vehicle network, it is possible to 
communicate using the in-vehicle network independently 
from 
the 
communication 
which 
is 
being 
made 
simultaneously using the in-vehicle network, suppressing the 
interference in the own system. 
B. Problem of Communication at the Time the Train is 
Runnning 
There is concern that the communication quality at the 
time the train is running fluctuates under the fading and the 
influence of change in radio environment. Figure 3 shows 
the measurement results of the radio environment of a band 
of 920MHz, which is the Industrial, Scientific and Medical 
(ISM) band of Japan at two stations in the suburban and 
urban areas. Figure 4 shows a scene of the measurement. It 
indicates that the frequency used differs according to the 
location. Therefore, when using a specific frequency, it is 
assumed that the communication quality fluctuates as the 
location changes. In particular, it is thought that the influence 
on long-range inter-vehicle communication is greater than 
the in-vehicle communication. In this paper, we propose a 
routing algorithm in the inter-vehicle network considering 
change in communication environment. 
III. 
PROPOSAL OF NEW ROUTING ALGORITHM 
A. Transmission Matrix[10] 
In the inter-vehicle network of the system proposed, a 
transmission matrix as show in the Table I is created at the 
time of network configuration and it is memorized in the 
base station. Since the transmission matrix is created based 
on 
the 
train 
sets 
information 
and 
communication 
confirmation, the physical distance and the communication 
environment at the time of network configuration are taken 
into consideration. The relay number represents a vehicle 
number, for example, relay 1 means a relay of the first 
vehicle. The vehicle number is a unique number of a vehicle, 
 
Figure 2. Proposed system configuration for monitoring vehicles 
59
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-669-9
ICSNC 2018 : The Thirteenth International Conference on Systems and Networks Communications

and the same number does not exist elsewhere. And 1 in the 
Table I indicates a communication candidate link, 0 indicates 
that it is not a communication candidate link. For example, 
between the base station and relay 1, 2, 3 there are 
communication 
candidate 
links. 
It 
means 
that 
the 
communication candidates of the base station are relay 1, 2 
and 3. In addition, we assume symmetric communication 
quality, the communication candidate of relay 1, 2 and 3 is 
the base station. Also, if the communication toward the base 
station is designated as the communication in the uplink 
direction and the communication toward the relay as the 
communication in the downlink direction, the base station 
and the relays hold uplink direction and downlink direction 
communication candidates in the routing table respectively. 
For example, relay 2 holds {Base station, Relay 1} as the 
uplink communication candidate, {Relay 3, Relay 4} as the 
downlink communication candidate in the routing table. In 
the 
data 
collection 
immediately 
after 
the 
network 
configuration in stopped train, based on this routing table, 
the routing is performed with the number of hops as a metric 
in [10]. When changes in the communication environment 
are not considered, it is desirable to transfer data to the relay 
close to the destination node and reduce the total number of 
hops, thereby reducing the total power consumption in the 
network. However, if the communication quality deteriorates 
and data cannot be transferred from the relay 3 to the base 
station, the relay 3 tries to transfer them to the relay 1. 
Changing the transfer destination causes an increase in the 
power consumption due to retrial and in the latency due to 
timeout. 
B. Routing Algorithm Considering Environmental Change 
As a method of grasping changes in the communication 
environment, there is a method of periodically sending the 
hello packets between nodes as communication candidates 
and monitoring the RSSI [6]. However, periodic packet 
transmission increases the traffic of the entire network, and 
the power consumption of the entire network also increases. 
Therefore, we examined a method of dynamically 
determining a transfer destination from communication 
candidates based on the result of past data communication. 
Regardless of the frequency of hello packets, it does not need 
the power to transmit them. The base station and the relays 
hold a table of an arbitrary length α + 1 called a transmission 
history table; one for the uplink direction (called forward 
history table) and the other for the downlink direction (called 
backward history table). Figure 5 shows an example of the 
transmission history table of relay2 in Table I. They hold the 
result of, in order of lateness, the most recent to the αth 
transmissions which were made in the uplink direction and 
those in the downlink direction and the downlink direction 
and update them in the First In First Out (FIFO) format. 
Character 1 in the transmission history table indicates 
successful data transmission and character 0 in it indicates 
data transmission failure. The data transmission failure or 
success is judged by the presence of the ACKnowledgement 
(ACK) from the destination node to the source node. The 
first column always holds 1. If it does not hold 1, there is a 
-130
-120
-110
-100
-90
-80
-70
922
924
926
928
Received power [dBm]
Frequency [MHz]
Urban area
Suburban 
area
 
Figure 3. Measurement results of radio environment 
   
 
 
Figure 4. Scenery of measuring radio environment 
 
Base station
1
1
1
0
Relay1
1
1
1
1
1
1
1
1
Relay3
1
1
1
1
1
1
1
Relay4
1
1
1
1
0
the transmission result of last α times
(a) forward history table
(b) backward history table
 
Figure 5. Example of a transmission history table 
TABLE I.  
EXAMPLE OF TRANSMISSION MATRIX 
Relay 1
Relay 2
Relay 3
Relay 4
Relay 5
Base station
1
1
1
0
0
Relay 1
－
1
1
0
0
Relay 2
－
－
1
1
0
Relay 3
－
－
－
1
1
Relay 4
－
－
－
－
1
 
60
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-669-9
ICSNC 2018 : The Thirteenth International Conference on Systems and Networks Communications

possibility that the node whose priority has dropped due to 
deterioration of the radio wave environment may not be 
selected again. This leads to the increase in the number of 
hops. Therefore, holding 1 in this column, it is possible to 
raise the priority again for the node whose priority has 
dropped. 
Figure 6 shows the basic procedure for determining the 
transfer destination relay based on the transmission history 
table. The arrival rate is the probability that a transmission 
from a node to the other node in a specific period α + 1 has 
succeeded. This algorithm preferentially selects the furthest 
node among the nodes whose arrival rate is higher than the 
threshold value β set. In the forward history table of relay 2 
in fig. 5 (a), we will assume β, which is the threshold of 
arrival rate, to be 0.9. Figure 7 shows an example of the 
operation of the transmission procedure. First, in fig. 5 (a), 
since the rate of arrival at the base station is 0.75 and the rate 
of arrival at relay 1 is 1.0, transmission from relay 2 to relay 
1 the arrival rate of which is greater than β in the uplink 
direction is selected. After that, the forward history table in 
cases where it was transferred to relay 1 successfully is 
shown in fig. 7. Next, the table is updated with the passage 
of time, and the arrival rate from relay 2 to the base station 
decreases. Last, since the rate of arrival from relay 2 at the 
base station and that at relay 1 are both 1, base station is 
selected in the next transmission. In this way, by always 
holding 1 in the first column, the relay which failed in 
transmission is also selected again. Therefore, when the 
communication environment is improved, it can be expected 
to reduce the number of hops. It is assumed that the 
communication distance between nodes changes according 
to changes in the radio wave propagation environment. 
However, even if this algorithm is used in the environment 
where the communication distance does not change, the 
performance equivalent to the hop metric algorithm. 
IV. 
IMPLEMENTATION 
We implemented the proposed method described in 
Section III(B) in a prototype. Figure 8 shows the prototype. 
The base station consists of a wireless module and a laptop 
that controls it. And the relay consists of a wireless module, 
a CPU board that controls it, and a battery. Table II shows 
the specifications of the wireless module [11]. Then, Figure 
9 shows the frame format in the inter-vehicle network. In this 
Select the node with highest arrival rate
Add “0” to the history table
Success of 
transmission to the 
selection node
Add “1” to the history table
No
Yes
Are there any 
nodes the arrival 
rates are over β?
Yes
Select the closest node to the destination 
node from the nodes the arrival rates are 
over β
No
Start to route packet
Calculation of the arrival rates to each 
nodes in the history table
End
All nodes in the 
history table have 
selected
Yes
Restart to route packet 
except for the failure nodes 
of transmission
No
 
Figure 6. Basic procedure for determining the transfer destination relay 
Base station
1
1
1
0
Relay1
1
1
1
1
1
1
1
1
75%
100%
Base station
1
1
0
Relay1
1
1
1
1
1
1
1
1
1
67%
100%
Base station
1
0
Relay1
1
1
1
1
1
1
1
1
1
1
50%
100%
Base station
1
Relay1
1
1
1
1
1
1
1
1
1
1
1
100%
100%  
Figure 7. Example of the operation of the transmission procedure 
TABLE II.  
SPECIFICATIONS OF THE WIRELESS MODULE 
Standards-compliant
ARIB STD-T108 (Japan), 
IEEE 802.15.4g/e
Frequency
922.3～928.1 MHz
Band width
200 kHz, 400 kHz
Modulation method
2GFSK
Baud rate
50 kbps, 100 kbps
Transmission power
1 mW, 10 mW, 20 mW
 
61
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-669-9
ICSNC 2018 : The Thirteenth International Conference on Systems and Networks Communications

paper, we set 8 bytes of dummy data for the payload 
assuming 1 byte of data length, 4 bytes of dates and time, 
and 3 bytes of sensor data. 
The data collection sequence of this prototype is that the 
base station sequentially performs data request and data 
reception for each relay. Therefore, by reconsidering the data 
collection sequence, the processing time can be expected to 
reduce. 
V. 
EXPERIMENT 
We conducted an experiment to confirm the function of 
data transmission taking account of the changes in the radio 
wave environment using the prototype introduced in Section 
IV. Figure 10 shows the scenery of the experiment. Inside 
the room, one base station and ten relays were linearly 
arranged at 80-cm intervals. Also, the transmission power 
was 1 mW. For this experiment, the sensor data are collected 
from all relays once. After collecting data 5 times, the 
antennas were removed and data were collected again 5 
times. After that, the antennas were attached and data were 
collected 5 times. We simulated the radio environmental 
change by detaching and attaching the antennas. These 
operations were carried out by the method which was applied 
with the number of hops as a metric, and they were repeated 
by the method proposed, and then evaluation was made 
based on the length of time required for data collection. In 
the proposed method, we assumed that the length of the table 
α = 3 and the threshold of the arrival rate β = 0.9. Since this 
is a function verification test, α was set to be small and β was 
set to a large value in order to frequently change the node 
selection. Table III shows the experimental results. The 
values in Table III represent the average time. The average 
length of time required for data collection of the first five 
and the last five operations conducted with the antennas 
attached is about 36 seconds. On the other hand, that of the 
intermediate five operations conducted with the antennas 
detached is 103.7 seconds, almost 3 times as long as 36 
seconds, when the former method is applied, and 48.9 
seconds, 1.4 times as long as 36 seconds, when the latter 
method (the method proposed) is applied. In this 
 
Figure 8. Prototype of the base station and the relay 
Sequence
frame 
number
[4 bytes]
Frame 
control
[1 byte]
Reserved
[2 bytes]
Retry 
number
[1 byte]
Source 
node ID
[5 bytes]
Destination 
node ID
[5 bytes]
Payload
[variable]
Frame 
check 
sequence
[2 bytes]
Max 500 bytes
 
Figure 9. Frame format of the prototype in the inter-vehicle network 
 
Figure 10. Scenery of the experiment 
62
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-669-9
ICSNC 2018 : The Thirteenth International Conference on Systems and Networks Communications

environmental condition change, the difference in length of 
time required for data collection between the two methods 
becomes about two times. If we apply the method proposed, 
the communication distance is actually shortened, and we 
confirmed that in the static environment, under the method 
proposed the node which sends data is capable of switching 
the forwarding destination to the node closer to it, and that 
the method proposed is effective when change in radio wave 
propagation environment occurs. 
VI. 
CONCLUSION AND FUTURE WORK 
We are developing a monitoring system aimed at 
confirming control information, such as brakes in real time in 
crew members. We have been transmitting hop count metrics 
for stoppage until now. In this paper, we propose a data 
transmission method considering radio wave environment 
change during driving. We implemented the proposed 
method in prototype and carried out function verification test. 
We simulated the deterioration of the radio wave 
environment and the time required for data collection 
became less than half, so we confirmed that it is effective 
when the radio wave environment deteriorates. In addition, it 
was confirmed that even when the environment improved, it 
returned to the state before deterioration. In the future we 
will study the following.  
· How to set the appropriate length and threshold of the 
transmission history table 
If the length of the transmission history table α is short 
and the threshold value β is high, steep change can be made, 
the length of that α is long and it can deal with gentle 
fluctuation if the threshold value β is low. It is necessary to 
appropriately set them according to the allowable delay of 
data and the acquisition interval. 
· Method of leveling power consumption 
In the proposed method, since the communication time 
becomes shorter, it can be expected that the electric load of 
the whole network is reduced. However, even if a specific 
relay is loaded, it will not be avoided. Considering battery 
replacement, it is also important that no load is placed on a 
specific relay. 
· Demonstration experiment of running condition 
Since the experiment in this paper was carried out in a 
stationary state, it is important to demonstrate even in the 
running state. 
 
 
REFERENCES 
[1] G. M. Shafiullah, A. Gyasi-Agyei, and P. Wolfs, "Survey of 
Wireless Communications Applications in the Railway 
Industry," The 2nd international conference on Wireless 
Broadband 
and 
Ultra 
Wideband 
Communications 
(AusWireless 
2007), 
Aug. 
2007, 
pp.65-70, 
doi: 
10.1109/AUSWIRELESS.2007.74. 
[2] V. J. Hodge, S. O'Keefe, M. Weeks, and A. Moulds, 
"Wireless Sensor Networks for Condition Monitoring in the 
Railway Industry: A Survey," IEEE Transactions on 
Intelligent Transportation Systems, Nov. 2014, pp. 1088-1106, 
doi: 10.1109/TITS.2014.2366512. 
[3] H. 
Scholten, 
R. 
Westenberg, 
and 
M. 
Schoemaker, 
"Trainspotting, a WSN-based train integrity system," 
Proceedings of ICN 2009, March 2009, Gosier, France, pp. 
226-231, 
IEEE 
Computer 
Society 
Presse, 
DOI: 
10.1109/ICN.2009.59. 
[4] N. Wang, Y. Liang, and L. Wang, "On-line Monitoring 
Method of Bearing in Rotating Machinery Based on Wireless 
Sensor Networks," The 3rd international forum on energy, 
environment science and materials (IFEESM 2017), Jan. 2017, 
pp. 564-571, doi: 10.2991/ifeesm-17.2018.107. 
[5] W. Nan, M. Qingfeng, Z. Bin, L. Tong, and M. Qinghai, 
"Research on Linear Wireless Sensor Networks Used for 
Online Monitoring of Rolling Bearing in Freight Train," 
Journal of Physics: Conference Series, vol.305, no. 1, July 
2011, pp. 1-10 doi: 10.1088/1742-6596/305/1/012024. 
[6] P. Mahasukhon, et al., "A study on energy efficient multi-tier 
multi-hop 
wireless 
sensor 
networks 
for 
freight-train 
monitoring," The 7th international wireless communications 
and mobile computing conference (IWCMC), Aug. 2011, pp. 
297-301, doi: 10.1109/IWCMC.2011.5982549. 
[7] A. Savvides, C. Han, and M. B. Strivastava, "Dynamic Fine-
Grained Localization in Ad-Hoc Networks of Sensors," The 
7th annual international conference on Mobile computing and 
networiking (Mobicom '01), 2001, pp. 166-179, doi: 
10.1145/381677.381693. 
[8] H. Scholten, R. Westenberg and M. Schoemaker, "Sensing 
Train Integrity," the IEEE International Conference on 
Sensors, 
Oct. 
2009, 
pp. 
669-674, 
doi: 
10.1109/ICSENS.2009.5398340. 
[9] MathWorks, https://mathworks.com/ [retrieved: August 2018] 
[10] S. Ryuo, N. Iwasawa, T. Kawamura, A. Hada, and K. 
Kawasaki, "Method for Creating Networks between Vehicles 
to Monitor Vehicle Condition," Quarterly Report of RTRI, 
vol. 
58, 
no. 
4, 
pp. 
285-291, 
Nov. 
2017, 
doi: 
https://doi.org/10.2219/rtriqr.58.4_285. 
[11] SATORI 
ELECTRIC 
CO., 
LTD., 
http://www.satori.co.jp/english/ [retrieved: August 2018] 
 
 
TABLE III.  
RESULT OF THE EXPERIMENT (AVERAGE TIME) 
First 5 times
 (antenna attached)
[s]
Next 5 times
 (antenna detached)
[s]
Last 5 times
 (antenna attached)
[s]
Hop number metric
36.1
103.7
37.6
Proposed method
35.8
48.9
36.1
 
63
Copyright (c) IARIA, 2018.     ISBN:  978-1-61208-669-9
ICSNC 2018 : The Thirteenth International Conference on Systems and Networks Communications

