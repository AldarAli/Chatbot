 
 
Development of a Neural Network-based Building Model and Application to 
Geothermal Heat Pumps Predictive Control 
 
 
Tristan Salquea,b, Peter Riederera 
a Energy-Health-Environment Dept. 
CSTB (Scientific and Technical Centre for 
Building)  
Sophia-Antipolis, France 
tristan.salque@cstb.fr; peter.riederer@cstb.fr 
 
 
 
Dominique Marchiob  
b CEP - Centre énergétique et procédés, 
CEP/Paris 
Mines ParisTech 
Paris, France 
dominique.marchio@mines-paristech.fr 
 
 
Abstract - The use of artificial neural networks in the field of 
building energy management has led to remarkable results 
over the recent years. In this study, the development of room 
temperature neural network models, to be used for predictive 
control of geothermal heat pump systems, is discussed. 
The training process, including the determination of optimal 
input data, algorithm and structure, is detailed. The prediction 
performance of the developed neural network is compared to 
linear ARX models. Simulated data used for training and 
validation is generated using the TRNSYS environment. The 
developed model is then implemented into a predictive 
controller for geothermal heat pumps systems. Simulation 
results showed that the predictive controller can provide up to 
17% energy savings in comparison with conventional 
controllers. 
 
Keywords - Artificial neural networks; Room temperature 
prediction; Predictive control; Energy savings; Geothermal heat 
pump. 
I.  INTRODUCTION  
This study focuses on the identification of the building 
thermal behavior with the aim of being used in a predictive 
control. Three main types of building modeling are usually 
distinguished. Direct modeling, which assumes that all the 
characteristics of the building are known a priori, is more 
appropriate at the design stage of a building. On the other 
hand, black-box modeling infers description of the building 
based on observed data only. Gray-box modeling is a 
combination of the two latter at various degrees. In this 
article, only black-box models for predictive control of the 
indoor temperature will be discussed.  
Important research was conducted on predictive control 
strategies and especially on the building model. Linear 
autoregressive models were first used for prediction by Lute 
et al [1]. More recently, the use of artificial neural networks 
(ANN) 
has 
significantly 
increased 
the 
prediction 
performances of models. ANN clearly outperforms linear 
models for the prediction of room temperature [2, 3]. In our 
investigation, a number of parameters are different from the 
existing studies (input parameters, algorithm, performance 
criteria, prediction horizon, etc.). The main difference lies in 
the emitter type which is in our case a radiant floor heating. 
Its high thermal inertia creates a thermal lag that requires a 
longer 
prediction 
horizon. 
The 
ANN 
prediction 
performances are compared to linear ARX models, which 
are commonly used for the building model in predictive 
control. 
The developed ANN model is then applied to ground 
source heat pumps (GSHP) predictive control. With this 
system, conventional controls often lead to overheating in 
the afternoon as they do not integrate a prediction of solar 
gains. On the contrary, predictive control can adjust the heat 
supply in advance in accordance with a prediction of room 
temperature and weather data. The operation of the 
controller is tested by simulation on a residential house. The 
predictive controller is compared to conventional controllers 
with respect to energy savings and overheating control.  
II. SIMULATION TEST CASE 
Simulation data are obtained with the graphically based 
TRNSYS software. A residential house equipped with a 
radiant floor heating connected to a geothermal heat pump is 
simulated during 3 months with a 15 minutes time step. The 
simulation includes the following components: 
 
The studied building (Type 56) is the “Mozart 
house”, which is a 99.8 m2 single-family house of 
single floor area (Figure 1). The building elements 
have been chosen to correspond to the current 
French regulation. The external wall is made of 20 
cm of concrete and 8 cm of expanded polystyrene 
(U-value of 0.42 W.m-2.K-1). The glazing area (U-
value of 2.43 W.m-2.K-1) covers 15% of the 
external surface. This multi-zone building is 
equipped with a centralized radiant floor heating 
made of 6 cm of concrete and 6 cm of insulation. 
The internal gains profile is based on a typical 
profile for a family of 4 persons. 
 
Figure 1: Plan of the "Mozart House" used in simulation 
24
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-234-9
SIMUL 2012 : The Fourth International Conference on Advances in System Simulation

 
 
 
The vertical borehole heat exchanger (Type 557b – 
Tess Library) is made of one 75 m vertical 
borehole sized using a calculation spreadsheet 
developed by Philippe [4]. The soil has typical 
thermal characteristics (cp= 2000 J.kg-1.K-1 and 
λ= 2 W.m-1.K-1). The double-U pipes have a fluid 
to ground resistance of Rb= 0.1 K.m.W-1 ; 
 
Two single-speed pumps (Type 740 – Tess 
Library) of nominal mass flow rate 1000 kg/h and 
nominal electric power 80 W ; 
 
Outdoor conditions are given by a weather data 
reader (Type 109) for the city of Nancy in France 
provided by Meteonorm. 
III. MODELING PROCESS 
A. Models 
In this study, ANN models for room temperature 
prediction over the next 6 hours are developed and 
compared to ARX models. Various sets of inputs are tested 
on both types of models. 
 For each set of inputs, the optimal ANN architecture 
(number of hidden layers, number of neurons per layer) is 
determined via a parametric study. In the present study, one 
hidden layer was always found to be the best solution. The 
number of neurons in the hidden layer was first chosen to be 
equal to 75% of the number of inputs [5] and then optimized 
by trial-and-error until no improvement could be seen. The 
hyperbolic tangent sigmoid function was used as the transfer 
function in the hidden layer. 
B. Choice of inputs 
Various 
input 
parameters 
influence 
the 
indoor 
environment: 
outdoor 
temperature, 
solar 
radiation, 
occupation (internal gains, windows opening, etc.), heating 
power, wind, humidity, etc. Taking into account all these 
parameters is not conceivable for two main reasons. First, 
regarding the application on a real controller, the number of 
sensors would be too high and some variables are difficult 
to measure. Second, a more complicated model is more 
likely to diverge as it is more sensitive to noise in the data. 
The model has to be as simple as possible while taking into 
account the most relevant inputs. Among all the 
meteorological variables, the global horizontal solar 
radiation and the outdoor temperature are accordingly the 
most influential parameters for the indoor environment. 
For nonlinear models such as ANN, there is no 
systematic approach [6] and the risk of dismissing relevant 
inputs is high. Statistical methods like auto-correlation 
criterion or cross correlation give a good insight into the 
relevance and the lag effect of an input variable on the 
output.  
C. Training process 
The parameters of the ARX-models have been identified 
using the ordinary least squares method that minimizes the 
quadratic prediction error criteria. As regards ANN, the 
algorithm used for training was an optimized version of the 
Levenberg-Marquardt algorithm that included Bayesian 
regularization. This algorithm minimizes a combination of 
squared errors and weights, and then determines the correct 
combination so as to produce a network that generalizes 
well. The generalization capability is also improved with the 
early stopping feature. In this technique, the collected data 
that was first normalized to the range [-1; 1] is divided into 
three subsets: training, validation and test. Training stops 
when validation performance has increased more than 5 
times since the last time it decreased. The test data set is 
used to estimate the generalization error of the ANN, but 
does not interfere during the training process.  
IV. PREDICTION RESULTS 
A. Performance criteria 
To evaluate the prediction error of ANN and ARX 
models, the root mean square error (RMSE) and the mean 
error (ME) were used as performance criteria: 
      √ 
 ∑| ̂    |
 
 
   
 
(1) 
     
 ∑( ̂    )
 
   
 
(2) 
The 95% confidence intervals for one-step-ahead 
forecasts are approximately equal to the point forecast plus 
or minus 2 times the RMSE (under the assumption of 
normality). The ME indicates whether the forecasts are 
biased, i.e. whether the prediction errors tend to be 
disproportionately positive or negative. 
B. Results and discussion 
 
Three months of simulation were used to train and test 
the models: January and February data are used for training 
and validation of ANN and ARX models, while March is 
used for test. A wide range of inputs were tested, but we 
chose to show only 4 representative set of inputs (TABLE 
1), including the set that gave the best prediction 
performance. The models provide the room temperature  ̂  
for the next time step from weather data (outdoor 
temperature   and global horizontal solar radiation I) as 
well as previous and current values of heating power    and 
room temperature   . Tests not presented here revealed that 
the mean value of outdoor temperature on the last 24 hours 
     contains enough information to describe the dynamic 
behavior of this specific building. For less insulated 
buildings, the impact of outdoor temperature is higher and 
the current value of    is likely to be more appropriate. 
TABLE 1. INPUTS GIVEN TO ANN AND ARX MODELS FOR ROOM 
TEMPERATURE PREDICTION 
Inputs 
ANN1/ARX1 
ANN2/ARX2 
ANN3/ARX3 
ANN4/ARX4 
I(k) 
x 
x 
x 
x 
I(k-1) 
x 
 
 
 
Ph(k) 
x 
x 
x 
x 
Ph(k-1) 
x 
 
x 
 
To24(k) 
x 
x 
x 
x 
Ti(k-1) 
x 
x 
x 
x 
Ti(k-2) 
x 
 
x 
x 
25
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-234-9
SIMUL 2012 : The Fourth International Conference on Advances in System Simulation

 
 
TABLE 2.  
PREDICTION ERRORS OF ROOM TEMPERATURE OVER A 6 HOUR PREDICTION HORIZON 
Prediction 
horizon 
1 h 
2 h 
3 h 
4 h 
5 h 
6 h 
Total 
Error [°C] 
ME 
RMSE 
ME 
RMSE 
ME 
RMSE 
ME 
RMSE 
ME 
RMSE 
ME 
RMSE 
ME 
RMSE 
ANN1 
0.02 
0.13 
0.04 
0.25 
0.07 
0.35 
0.10 
0.42 
0.13 
0.49 
0.15 
0.53 
0.52 
2.17 
ANN2 
0.04 
0.20 
0.08 
0.32 
0.12 
0.42 
0.16 
0.52 
0.20 
0.61 
0.25 
0.69 
0.86 
2.75 
ANN3 
0.02 
0.12 
0.03 
0.23 
0.06 
0.31 
0.09 
0.39 
0.12 
0.44 
0.14 
0.49 
0.46 
1.99 
ANN4 
0.02 
0.12 
0.04 
0.31 
0.07 
0.42 
0.10 
0.46 
0.12 
0.48 
0.14 
0.50 
0.48 
2.30 
ARX1 
-0.05 
0.41 
-0.12 
0.53 
-0.19 
0.66 
-0.24 
0.74 
-0.27 
0.79 
-0.29 
0.80 
-1.17 
3.92 
ARX2 
-0.11 
0.35 
-0.22 
0.53 
-0.32 
0.70 
-0.43 
0.84 
-0.53 
0.96 
-0.64 
1.04 
-2.25 
4.42 
ARX3 
-0.05 
0.40 
-0.12 
0.51 
-0.19 
0.64 
-0.23 
0.71 
-0.26 
0.75 
-0.27 
0.76 
-1.11 
3.76 
ARX4 
-0.06 
0.40 
-0.13 
0.52 
-0.19 
0.64 
-0.24 
0.72 
-0.27 
0.76 
-0.27 
0.76 
-1.16 
3.80 
As the models time step is one hour, the prediction is 
iterated several times to return up to a 6 hour forecast. 
TABLE 2 shows the prediction performances of the different 
models over a prediction horizon from 1 to 6 hours. The 
following comments can be made: 
 
ANN models clearly outperform ARX models in 
terms of ME and RMSE over the whole prediction 
horizon. The RMSE is in average 40% lower using 
non-linear ANN models. ANN forecasts are less 
biased as the ME is smaller in absolute value. 
 
Too complicated models, such as ANN1 and 
ARX1, do not give accurate results. On the 
contrary, ANN2 and ARX2 are too simple to 
describe the dynamic behavior of the building. 
 
ANN3 and ARX3 are the most accurate models 
given both criteria. Previous values of heating 
power Ph(k-1) as well as room temperature Ti(k-1) 
and Ti(k-2) must be taken into account due to the 
high inertia of the building and the floor heating. 
 
Other tests not presented here showed that taking 
into account previous values further into the past 
does not improve the prediction performances of 
both types of models. 
An example of 3 hour prediction results of ANN3 and 
ARX3 models on a representative week of March is given in 
Figure 2. ANN model reproduces more accurately the 
thermal behavior of the building in comparison to the linear 
ARX model. ANN is in particular much better when the 
building is subject to strong solar gains (first day of Figure 
2). 
 
Figure 2. 3 hours prediction of room temperature with ANN3 and 
ARX3 (March 16-23). 
V. APPLICATION TO PREDICTIVE CONTROL 
Predictive control can adjust the heat supply in advance 
in accordance with a prediction of future room temperature 
and perturbations (solar radiation, outdoor temperature etc.). 
Important research was conducted on predictive control 
strategies during the 1980s and 1990s [7-9]. ANN models 
were successfully applied to the control of residential and 
small office buildings [10, 11]. The development of 
predictive controllers for radiant floor heating systems has 
also led to remarkable results [12-14]. 
The developed ANN model for room temperature 
prediction is applied here to single-speed ground source heat 
pumps (GSHP) predictive control. The concept of the 
predictive controller, developed by Salque [15],  is first 
introduced. The operation of the controller is then tested by 
simulation on a residential house and compared to 
conventional controllers. 
A. Concept of the controller 
The objective of the controller is to minimize the energy 
consumption of the GSHP system and maintain a good 
temperature level anticipating future disturbances and room 
temperature. The controller is designed to be self learning 
and easily adaptable in practice. To be compatible with the 
developed controller, the GSHP system must fulfill the 
following conditions: 
 
The GSHP is single-speed (only one single-speed 
compressor); 
 
The GSHP only supplies heating and/or cooling 
(no domestic hot water supply); 
 
The GSHP is directly connected to the radiant floor 
heating, without any storage tank for hydraulic 
decoupling. 
1) Controller strucutre 
The modular structure of the controller is illustrated in 
Figure 3.The forecasting modules are all based on ANN. A 
weather module performs predictions of solar radiation (I) 
and outdoor temperature (To). The heating power produced 
(Ph) and the electric power consumed by the GSHP (Pel) are 
predicted by another module. The latter uses as inputs the 
supply and returns temperatures in the boreholes (Tb) and in 
the radiant floor (Tf), as well as all the possible trajectories 
of the GSHP on/off for the next 6 hours. The developed 
ANN model is used for room temperature prediction. 
0
20
40
60
80
100
120
140
160
18
19
20
21
22
23
24
Time [h]
Room Temperature [°C]
 
 
ANN
ARX
Reference
26
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-234-9
SIMUL 2012 : The Fourth International Conference on Advances in System Simulation

 
 
  
Figure 3. Flow chart of the ANN-based predictive controller. The symbol (^) is assigned to the predicted values.   
 
2) Control strategy 
The optimization block determines the optimal 
trajectory that minimizes the following cost function: 
   ∑   [    (  ̂          
     
)
 
    
̂   
    
] 
 
   
 
 
(3) 
   
subject to           ̂         
(4) 
where   ̂    and       are the predicted and the 
setpoint temperature, while    
̂    and      are the 
predicted and the maximum electric power consumed by the 
GSHP. The maximal distance to the setpoint       can be 
adjusted whether the occupants give more importance to 
comfort or to energy savings (           by default). 
When the building is not occupied, the condition (4) 
maintains    between      and        For intermittent 
control strategy,      is set to one during the occupancy 
period and to zero otherwise.   is a value between zero and 
one (typically 0.8) that gives more weight to the first 
predictions in time, these being usually more accurate than 
the distant predictions. 
3) Prediction horizon 
The length of the prediction horizon depends on several 
factors. A large horizon is needed when large room 
temperature or electricity price changes are expected in the 
future [1]. It is the case in an intermittently occupied 
building. In practice, the horizon length is chosen as an 
equivalent of the room time constant corresponding to the 
first active layers of the walls. For the purpose of the present 
study, a 6 hour receding horizon is applied. 
4) Algorithm 
At each time step, the optimal on/off trajectory for the 
next 6 hours is determined. The discrete nature of the input 
makes it possible to compute all the possible trajectories and 
chose the one that minimizes the cost function (3) subject to 
constraint (4). Moreover, it allows the use of non-linear 
models, such as ANN, that usually limit the possibilities of 
analytical problem solving [16]. 
B. Test of the predictive controller 
1) Reference controllers 
Two conventional controllers are used as a reference: a 
closed loop controller (CL) on room temperature and a 
compensated open loop controller (COL) on floor heating 
supply temperature Tf,s. These two control logic are the most 
frequently observed in single-speed GSHP installations. 
The CL controller switches on/off the GSHP when 
room temperature is beyond the temperature setpoint Tr 
with a standard 1°C hysteresis. A smaller hysteresis loop 
can lead to relatively better temperature level but it reduces 
the compressor lifetime by increasing the number of on/off 
cycles.   
The COL controller is based on the following heating 
curve that is adjusted with the actual value of room 
temperature: 
                           
 
(5) 
where   is the outdoor temperature and         the 
difference between the actual and the setpoint temperature.             
The COL controller switches on/off the GSHP when the 
water supply temperature Tf,s is beyond    ±2°C. The 
coefficients of the heating curve were finely tuned to 
optimize room temperature for this particular case. The 
compensated open loop control logic requires the pump on 
the building side to always be working to keep the fluid 
circulating. The two controllers are represented in Figure 4. 
 
Figure 4. Control logics of the conventional controllers taken as 
references. 
 
27
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-234-9
SIMUL 2012 : The Fourth International Conference on Advances in System Simulation

 
 
2) Results and discussion 
For the purpose of the test, the TRNSYS environment 
that simulates the GSHP system is coupled to the Matlab 
software where the predictive controller is coded. January 
and February data are used to train and validate the ANN 
models while March is used to test the controller. Two 
conventional controllers presented above are used as 
reference: a closed loop controller (CL) on room 
temperature and a compensated open loop controller (COL) 
on 
floor 
heating 
supply 
temperature 
and 
outdoor 
temperature. The temperature setpoint is constant and set to 
20°C. 
A comparison of the controllers on the first day of 
March is depicted in Figure 5. CL and COL controllers both 
lead to overshoots in the afternoon. These conventional 
controllers actually face the same problem: when the GSHP 
is switched on in the morning of a sunny day, the indoor 
environment is likely to be overheated in the afternoon. This 
is of course due to the fact that both control logics do not 
integrate a prediction of solar gains. The ANN controller 
stays closer to the setpoint thanks to its prediction 
capability. A small undershoot is observed just before 
strong solar gains are expected so that to avoid overheating 
and benefit from free solar gains, leading to energy savings. 
Over the whole month of March, overheating time 
(Ti>21°C) is reduced by at least 86% with the ANN 
controller. The COL controller is generally more efficient 
than the CL in terms of overheating, but the total electrical 
energy consumed with the COL logic is much higher with 
the pump at the building side working permanently. The 
ANN controller ensures a good temperature level with just 4 
hours of overheating above 21°C. Total energy savings 
achieved are 6% and 17% in comparison with CL and COL 
controllers. 
 
Figure 5. Comparison between predictive controller (ANN) and 
conventional controllers (CL and COL). From top to bottom : room 
temperature, weather data (global horizontal solar radiation and 
outdoor temperature) and GSHP on/off control. March 1st. 
VI. CONCLUSION AND FUTURE WORK 
In this study, the identification of black-box models for 
predictive control of room temperature in buildings has been 
discussed. ANN models were developed and compared to 
ARX models. Various sets of inputs were tested on both 
types of models. It was shown that the results obtained with 
ANN are much better than those obtained with ARX 
models. RMSE on room temperature prediction over a 6 
hour horizon is in average 40% lower with ANN. It was also 
demonstrated that too complicated models do not give 
accurate results. The model has to be as simple as possible 
while taking into account the most relevant inputs. Given 
the high inertia of the floor heating and the building, 
previous values of heating power Ph(k-1) as well as room 
temperature Ti(k-1) and Ti(k-2) must be taken into account in 
the models. 
The developed ANN model was then applied to ground 
source heat pumps predictive control. The operation of the 
controller was tested by simulation on a residential house 
and compared to conventional controllers. Numerical results 
showed that the predictive controller was able to increase 
comfort and save energy at the same time. Over the tested 
month, overheating time was reduced by at least 86% thanks 
to the prediction capability of the controller and energy 
savings ranged from 6% to 17% depending on the reference 
controller. 
In a next step, this predictive control algorithm will be 
implemented as a prototype in a real heat pump system. The 
real heat pump system has already been monitored for one 
heating season. The performances using the predictive 
control algorithm can thus be compared to the classic 
control. 
REFERENCES 
 
[1] P. Lute and D. van Paassen, "Optimal indoor temperature 
control using a predictor", IEEE Control Systems,  pp. 4-9, 1995. 
[2] B. Thomas and M. Soleimani-Mohseni, "Artificial neural 
network models for indoor temperature prediction: investigations 
in two buildings", Neural Computing & Applications, vol.16 (1), 
pp. 81-89, 2007. 
[3] G. Mustafaraj, G. Lowry, and J. Chen, "Prediction of room 
temperature and relative humidity by autoregressive linear and 
nonlinear neural network models for an open office", Energy and 
Buildings, vol.43 (6), pp. 1452-1460, 2011. 
[4] M. Philippe, M. Bernier, and D. Marchio, "Sizing Calculation 
Spreadsheet Vertical Geothermal Borefields", ASHRAE Journal, 
vol.52 (7), pp. 20-28, 2010. 
[5] Q.Y. Tang and M.G. Feng, "DPS Data Processing System for 
Practical Statistics.", Beijing: Science Press,  pp. 648, 2002. 
[6] T. Chernichow, A. Piras, K. Imhof, P. Caire, Y. Jaccard, B. 
Dorizzi, and A. Germond, "Short term electric load forecasting 
with artificial neural networks.", Engineering Intelligent Systems, 
vol.2  pp. 85-99, 1996. 
[7] P. Parent, "Optimal control theory applied to dwelling heating 
system", IRCOSE, Agence française pour la maitrise de l'énergie,   
1987. 
[8] J.-C. Visier, V. Paillassa, A. Marti, and M.-H. Foucard, "La 
commande optimale : un outil d'aide à la définition de stratégies de 
0
5
10
15
20
19
20
21
22
Ti [°C]
 
 
CL
COL
ANN
0
5
10
15
20
off
on
Time [h]
Control [-]
 
 
CL
COL
ANN
0
5
10
15
20
0
400
800
I [W/m2]
0
5
10
15
20
-5
5
15
To [°C]
28
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-234-9
SIMUL 2012 : The Fourth International Conference on Advances in System Simulation

 
 
gestion", Journées RCT 93 (Régulation - Commande - 
Télégestion), Sophia-Antipolis,  pp. 97-107, 1993. 
[9] T.B. Hartman, "Dynamic control : Fundamentals and 
considerations", ASHREA Transactions 94, vol.1  pp. 599-609, 
1988. 
[10] P.S. Curtiss, G. Shavit, and K. Kreider, "Neural networks 
applied to buildings - a tutorial and case studies in prediction and 
adaptive control", ASHRAE Transactions, vol.102 (1),  1996. 
[11] N. Morel, M. Bauer, El-Khoury, and J. Krauss, "Neurobat, a 
predictive and adaptive heating control system using artificial 
neural networks", International Journal of Solar Energy, (21), pp. 
161-201, 2000. 
[12] H. Karlsson and C.-E. Hagentoft, "Application of model 
based predictive control for water-based floor heating in low 
energy residential buildings", Building and Environment, vol.46 
(3), pp. 556-569, 2011. 
[13] C. Verhelst, F. Logist, J. Van Impe, and L. Helsen, "Study of 
the optimal control problem formulation for modulating air-to-
water heat pumps connected to a residential floor heating system", 
Energy and Buildings, vol.45 (0), pp. 43-53, 2012. 
[14] A.A. Argiriou, I. Bellas-Velidis, M. Kummert, and P. André, 
"A neural network controller for hydronic heating systems of solar 
buildings", Neural Networks, vol.17 (3), pp. 427-440, 2004. 
[15] T. Salque, P. Riederer, and D. Marchio, "Neural predictive 
control for single-speed ground source heat pumps connected to a 
floor heating system", Building Services Engineering Research  
and Technology, (unpublished),  2012. 
[16] K.J. Aström and B. Wittenmark, "Computer controlled 
systems : theory and design", Prentice Hall,   1990. 
 
 
29
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-234-9
SIMUL 2012 : The Fourth International Conference on Advances in System Simulation

