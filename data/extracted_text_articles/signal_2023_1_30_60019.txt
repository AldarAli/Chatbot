Fruiting Mother-Shoot Counting System Based On Segmented Images
Zhao RuoQi, Megumi Wakao, Naoki Morita
School of Information and Telecommunication Engineering
Tokai University
Tokyo, Japan
E-mail: 0mjnm002@mail.u-tokai.ac.jp, 9bjt2103@cc.u-tokai.ac.jp, morita@tokai.ac.jp
Kenta Morita
Faculty of Medical Engineering
Suzuka University of Medical Science
Mie, Japan
E-mail: morita@suzuka-u.ac.jp
Abstract—To grow sweet grapes, it is important to be able to
count the number of fruiting mother shoots accurately. In a
previous study, segmentation of aerial photographs containing
fruiting mother shoots and branches was conducted to count
the number of fruiting mother shoots. However, counts were
inaccurate for areas where fruiting mother shoots were
incorrectly segmented into branches. In this study, a fan-
shaped search method was proposed to correctly count shoots
that could not be properly counted in that previous study.
Experiments
confirmed
the
effectiveness
of
the
newly
proposed method.
Keywords-Smart Agriculture; Artificial Intelligence; Image
Processing.
I.
INTRODUCTION
To grow sweet grapes, it is vital to be able to determine
the number of fruiting mother shoots properly. Most
vineyards in Japan have adopted shelf cultivation, and
farmers can only see a small area when they are working in
the vineyard. However, aerial photography has made it
possible to check the branching over a wide area [1]. Figure
1 shows an example of such an aerial photograph. The red
outlined areas in Figure 1 represent the fruiting mother
shoots extending from the upper left branch, which is
outlined in blue.
Ito et al. [2] marked branch in red, fruiting mother shoot
in yellow, and the rest in gray to produce teacher data for
training SegNet [3] network. Thus, a neural network system
was developed to separate branches from fruiting mother
shoots in aerial photographs. Finally, they try to determine
the number of fruiting mother shoots by counting the
yellow region in the image.
Figure 2 shows the analysis results from the same aerial
photograph shown in Figure 1 using the method proposed by
Ito et al. From Figure 2, we can instantly see that the upper
left branch has seven fruiting mother shoots growing from it.
The branches and the fruiting mother shoots in the
aerial images used for testing in the first study were in the
best ideal condition, with the fruiting mother shoot not
being obscured by the branch. As a result, the fruiting
mother shoot in the aerial image is also depicted in the
recognition image as a single fruiting mother shoot, without
any division. Therefore, there is no error when counting the
yellow areas in the recognition image to determine the
number of fruiting mother shoots. However, not all of the
branches in the aerial image are actually in the best possible
condition with respect to the fruiting mother shoot. One
fruiting mother shot is counted as more than one in the
calculation of the number of fruiting mother shoots if the
fruiting mother shoot breaks during the recognition process
for a variety of reasons, which results in an error. Ito et al.
and others have failed to offer a workable answer to this
issue.
In order to lessen the inaccuracies that can occur
while counting the number of fruiting mother shoots, the
purpose of this research is to propose a method for correct
the divided fruiting mother shoots. Specifically, the
following methods are used. First, the system automatically
selects the areas that need to be corrected and the areas that
do not need to be corrected. Then, it considers only the areas
that need to be corrected as one area. Finally, it counts the
number of fruiting mother shoots.
Figure 1. Aerial photograph with red outlined mother shoots
13
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-057-5
SIGNAL 2023 : The Eighth International Conference on Advances in Signal, Image and Video Processing

Figure 2. Segmentation analysis results
In Section 2, we will concentrate on the challenges in
tackling this problem.
II.
PROBLEM
In Section 1 we indicated that the output of SegNet
occasionally contains incorrectly recognized areas. This
error may cause the fruiting mother branch to divide, which
could result in inaccurate count of its number.
Figure 3 shows another example of an aerial photograph,
and Figure 4 shows a misidentification corresponding to the
blue box in Figure 3. In the aerial photograph, there is only
one fruiting mother shoot, but because it is partially
misidentified as branch instead of a single fruiting mother
shoot, there is a small division, and two fruiting mother
shoots are counted. This problem, which was not addressed
in the study by Ito et al., results in an incorrect final count
when the number of fruiting mother shoots is aggregated.
The pixel range at the division in Figure 4 is 65px, and
the area within this range is calculated to correct the figure.
Figure 5 shows other errors generated when correcting
Figure 4. The correction range can be adjusted, and the blue
outline shown in the Figure 5 is the correction area formed
when the correction range is 65px. If the area of the fruiting
mother shoots in the correction area is corrected to one area,
the number of fruiting mother shoots, which should be
counted as two, will instead be counted as one. Therefore,
the number of fruiting mother shoots cannot be calculated
correctly only by adjusting this pixel range.
Figure 3. Aerial photography example
Figure 4. Divided single shoot counted as two
Figure 5. Falsely corrected shoot
In Section 3 we
explain how we used a fan-shaped
search to overcome this issue.
III.
PROPOSED METHOD
The unique approach we have suggested for correcting a
divided fruiting mother shoot in a recognition image will be
A
B
14
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-057-5
SIGNAL 2023 : The Eighth International Conference on Advances in Signal, Image and Video Processing

the main topic of this section. We reviewed the data and
found that there is no relevant correction method for the
recognition images of branches. As a result, we had to
change how we were thinking to address this brand-new
subject.
The fruiting mother shoots has characteristics of grow
as straight as possible [4]. Therefore, if there are two close
fruiting mother shoots in the recognition image, when they
are connected start for end, the whole fruiting mother shoot
tend to be straight, or slightly curved to a certain extent. In
that case, we can judge that these two fruiting mother
shoots belong to the same divided single shoot.
If we ignore the width of fruiting mother shoot and take
it as a line, then the problem can be reduced to the correct
of straight line. Studies on line correct, such as fingerprint
correct [5][6] and object contour correct [7], all have
examples to analyze the vector and curvature at both ends
of the broken part of line. Both vector and curvature are
correlated to angles and directions. Therefore, for the
correct in our study, we thought it would be a good idea to
introduce angles and directions.
If we use the fan-shaped area to control the distance and
angle of search, at the same time simulate the extension line
at both ends of fruiting mother shoot along the extension
direction to fix the direction of fan-shaped area. For
example, as shown in Figure 6 and Figure 7, a fan-shaped
search area is made at both ends of each fruiting mother
shoot, through which the parts that need to be corrected can
be found. The part that requires to be corrected in Figure 6
is between points B and C. We stipulate that if two
endpoints appear in each other's fan-shaped area, the area
between these two points shall be judged as the part that
needs to be corrected.
Points C and D exist in the fan shape formed by point B
in Figure 5. Point B exists in the fan shape formed by point
C. Therefore, since points B and C are within each other's
fan shape, the divided part will be corrected by connecting
points B and C. Points A and D in Figure 5, points E and F
in Figure 6 do not meet the judgment criteria, so these
points will not be connected. Figure 8 and Figure 9 show
the correct results after judging Figure 4 and Figure 5,
respectively.
The process involved in the fan-shaped search method is
described below.
(1)
Find the two endpoints of a fruiting mother shoot.
(2)
Make an extension line for each endpoint.
(3)
Plot a fan-shaped area at the specified angle and
radius using the extension line as the base.
(4)
Search for other endpoints within each fan-shaped
region.
(5)
When the two endpoints are within each other's fan
shape, connect only the single endpoint closest to the search
target.
Through the fan-shaped search area, the divided fruiting
mother shoots can be screened and corrected correctly.
Figure 6. Fan-shaped area of A
Figure 7. Fan-shaped area of B
Figure 8. Correction result for A
A
B
CD
E
F
15
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-057-5
SIGNAL 2023 : The Eighth International Conference on Advances in Signal, Image and Video Processing

Figure 9. Correction result for B
We have created a comparative experiment for Section
4 to help further demonstrate the validity of the approach.
IV.
EXPERIMENT
In this section, to verify the effectiveness of the
proposed method, we compared the number of fruiting
mother shoots counted by the method that corrects only by
pixel range, and that by our method.
The images used for comparison were 12 vineyard
aerial photographs in which there are fruiting mother shoots
divided by branches. The correct number of fruiting mother
shoots in the 12 images is 285. There are 57 fruiting mother
shoots that need to be corrected.
Any of the fruiting mother shoots in aerial photograph
can be counted correctly in recognition image within the
following two conditions:
1. There is no single shoot being counted as two or more
due to divided problem.
2. There are no multiple fruiting mother shoots being
counted as one because of the error correct with other
fruiting mother shoots.
The fruiting mother shoots that are counted correctly
should contain those that can be counted correctly without
correct and that can be counted correctly after correct. But
the fruiting mother shoots with error correct should be
excluded. Therefore, the accuracy of fruiting mother shoots
that are counted correctly can be expressed by formula (1).
285
Number of Corrected- Number of False Corrected
228
Accuracy


(1)
In the 12 images, the minimum range that needs to be
corrected is 62px, and the maximum range is 173px. The
minimum fan-shaped angle that needs to be corrected is 14°,
and the maximum is 52°. For this reason, in this study, the
radius threshold is set every 50px from 50px to 200px, and
the angle is set every 20° from 20° to 60° for comparison.
Table 1 summarizes the results using the method of
correcting only by pixel range, and Table 2 gives the results
using the proposed method. The numbers in the upper line
of each row are the numbers of fruiting mother shoots that
were successfully corrected. The numbers in parentheses
are shoots that were corrected erroneously. The lower line
in each row shows the accuracy.
TABLE I.
RESULTS CORRECTING ONLY BY PIXEL RANGE
200px
150px
100px
50px
57(53)
81.4%
55(18)
93.0%
52(14)
93.3%
0(0)
80.0%
TABLE II.
RESULTS USING PROPOSED METHOD
200px
150px
100px
50px
60°
57(2)
99.3%
55(2)
98.6%
52(0)
98.2%
0(0)
80.0%
40°
55(2)
98.6%
53(2)
97.9%
50(0)
97.5%
0(0)
80.0%
20°
49(2)
96.5%
47(2)
95.8%
44(0)
95.4%
0(0)
80.0%
For images in which the fruiting mother shoot is divided
by branches, the method that corrects only by pixel range
has a highest accuracy of 93.3% for a range of 100px. In the
proposed method, when the radius is 200px and the angle is
60°, it a highest accuracy of 99.3% is achieved. This is a
6.0% improvement over the method using only the pixel
range.
The experimental results demonstrate that, using the
method that depends only on the pixel range, the accuracy
decreases
as
the
range
increases
because
erroneous
correction occurs. In the fan-shaped search method, the
correction effect can be improved by extending the radius,
and at the same time, erroneous corrections can be better
avoided. Therefore, it is possible to improve the estimation
accuracy of the number of fruiting mother shoots that are
correctly counted.
V.
CONCLUSION
In this study, we proposed a fan-shaped search method
that is effective for aerial photographs where a fruiting
mother shoot is divided by branches, resulting in a more
accurate count of the number of fruiting mother shoots. Not
only can the pruning efficiency of fruiting mother shoots be
improved by quickly and accurately mastering the number
of fruiting mother shoots, but also it is possible to
accurately predict grape yield.
All images in the experiments used to investigate the
effectiveness of the fan-shaped search method were taken
for only one part of a single farm. In the future, we would
like to make a panoramic image from the partial images of
vineyards and correct the number of fruiting mother shoots
in entire vineyards for accurate aggregation.
The research breakthrough takes the grape-growing
process one step further towards full automation.
16
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-057-5
SIGNAL 2023 : The Eighth International Conference on Advances in Signal, Image and Video Processing

REFERENCES
[1]
https://www.cupidfarm.co.jp/ [retrieved: February, 2023]
[2]
Funa Ito, Duke Maeda, Naoki Nakamura, Kenta Morita,
Naoki
Morita,:“Shoot
Counting
System
Based
on
SegNet”,eKNOW
2020:The
Twelfth
International
Conference
on
Information,
Process,
and
Knowledge
Management. [retrieved: February, 2023]
[3]
V. Badrinarayanan, A. Kendall, R. Cipolla,:“SegNet :A Deep
Convolutional Encoder- Decoder Architecture for Image
Segmentation.”, IEEE trans. on PAMI, vol. 39, pp. 2481-
2495, 2017. [retrieved: February, 2023]
[4]
https://www.pref.shimane.lg.jp/nogyogijutsu/gijutsu/budou-
sisin/4_2.html [retrieved: February, 2023]
[5]
L. C. Jian, U. Halici, I. Hayashi, S. B. Lee,:“Intelligent
biometric techniques in fingerprint and face recognition[M].”
Boca Raton: CRC Press, October 1999. [retrieved: February,
2023]
[6]
CHEN Pei-hua, CHEN Xiao-guang,:“A new approach to
healing the broken lines in the thinned fingerprint image.”,
CNKI: Vol. 25, No. 6, June 2004. [retrieved: February, 2023]
[7]
ZHANG Gui-mei, LIU Pi-yu,:“Gestalt psychology and Euler
spiral for contour completion.”, CNKI: Vol. 30, No. 8, Aug.
2013. [retrieved: February, 2023]
17
Copyright (c) IARIA, 2023.     ISBN:  978-1-68558-057-5
SIGNAL 2023 : The Eighth International Conference on Advances in Signal, Image and Video Processing

