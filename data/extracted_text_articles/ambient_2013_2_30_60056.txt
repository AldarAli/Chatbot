Indoor localization Using a Magnetic Flux Density Map of a Building
Feasibility study of geomagnetic indoor localization
Dries Vandermeulen, Charles Vercauteren and Maarten Weyn
Faculty of Applied Engineering - CoSys-Lab
University of Antwerp
Paardenmarkt 92, B-2000 Antwerp, Belgium
charles.vercauteren@uantwerpen.be, maarten.weyn@uantwerpen.be
Abstract— The need for indoor localization has become
increasingly important in recent years for a number of
applications. Magnetic flux density fluctuations, caused by
reinforced concrete or metal objects, are common in indoor
environments. Originally, these fluctuations were considered to
be
harmful
for
localization
because
they
can
cause
electromagnetic
interference
in
sensitive
sensors
like
a
compass. However, in many papers it is suggested that these
interference patterns can be mapped and used to achieve
indoor localization. During this research, tests were performed
to determine how feasible geomagnetic indoor localization is
for a handheld smartphone device. Pattern matching, a
technique often used by radio-frequency based localization
technologies, will be used to determine the position of such a
device. Advantages of this technology are discussed and
possible obstacles are exposed.
Keywords - Indoor localization; Pattern matching; Magnetic flux
density; Geomagnetic indoor localization
I.
INTRODUCTION
Since the emergence of the global positioning system,
outdoor localization has become a part of our everyday
lives. Though the system has proven its worth for outdoor
localization in recent years, it falls short when localization is
required in an indoor environment, as discussed by Mautz
[1]. The ability to locate a person or a device in an indoor
environment has become increasingly important for a
number of applications.
Since the need for indoor localization systems arose,
many technologies have been developed and tested, and it
has become apparent there is no overall solution based on a
single technology [1]. Studies by Boles and Lohmann [2]
and Mouritsen et.al. [3] have shown that animals use local
anomalies
in
the
Earth’s
magnetic
field
to
orientate
themselves. In recent years, the idea emerged that the same
principle can be used for indoor self-localization, termed
geomagnetic indoor localization.
Static and low frequency magnetic fields both natural and
man-made are present everywhere around us in an indoor
environment, as shown by Yamazaki and Keita [4]. The
steel reinforced concrete structure of a building and other
metal objects cause fluctuations in the Earth’s magnetic
field. Originally, these fluctuations were considered to be
harmful
for
localization
because
they
can
cause
electromagnetic interference in sensitive sensors like a
compass. However, in many papers it is suggested that these
interference patterns can be mapped and used to achieve
indoor localization [5] [6] [7] [8] [9] [10].
The goal of this research is to determine how feasible
geomagnetic localization is for a handheld smartphone in an
indoor environment. Different hardware platforms will be
tested, to determine if magnetic flux density measurements
are platform independent and localization can be achieved
with each platform. This paper wants to validate stated
results from other papers using a handheld smartphone.
This paper will first explain the earth’s magnetic field in
Section II. Second, it will discuss how pattern matching can
be done using this magnetic field in Section III. Afterwards,
it will describe the used hardware and address the problem
of hardware variances in section IV. Section V and VI
describe the core of this paper; the indoor magnetic flux
density and fingerprinting. In Section VII, interference of
objects is discussed and tested. The last part includes the
localization measurement model in Section VIII followed by
test results in Section IX. The paper in concluded in Section
X.
II.
EARTH’S MAGNETIC FIELD
Earth’s magnetic field originates from currents produced
by highly conductive liquid iron spinning inside the outer
core. The magnetic field that originates from these currents
is called the magnetic B field. The magnitude of the
magnetic B field over a surface is described as magnetic
flux density and is measured in weber per square meters
Wb/m2, tesla T or gauss G (1 Wb/m2 = 1 T = 10000 G). In
this research, tesla is used, as it is the current official unit
defined by the SI system. The magnetic B field itself can be
affected or distorted by natural or manmade objects that
cause interference. The magnetic B field at the earth’s
surface ranges from 25 to 65 µT.
Magnetic
flux
density
can
be
measured
by
a
magnetometer to determine magnetic north. It is important
to note that magnetic north is not the same as true north.
True north or geographical north is the direction the North
Pole is located along the earth’s rotational axis. Magnetic
north refers to the geomagnetic pole position which is not
located along the earth’s rotational axis. The angle between
magnetic north and true north is called magnetic declination.
42
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-309-4
AMBIENT 2013 : The Third International Conference on Ambient Computing, Applications, Services and Technologies

Magnetic declination can differ from place to place and
changes over time.
Earth magnetic field is described by seven parameters.
The total intensity F consisting of a north X, an east Y and a
vertical Z component. The horizontal intensity H, which
consist only of the north X and the east Y components.
Inclination I describes the angle between H and F.
Declination D describes the angle between magnetic north
and true north.
Antwerp, the city where this investigation took place has
a positive declination of 0° 19’, an inclination of 66° 25’
and an average magnetic flux density of 48.73 µT. These
values can be found using Google maps.
III.
GEOMAGNTIC PARTERN MATCHING
Pattern
matching
is
a
technique
that
incorporates
measurement data to overcome the cumulative error of an
estimated position, as shown by Weyn [11]. While this
technique is often used in radio-frequency (RF) based
localization technologies, it is very suited for geomagnetic
localization, as shown by Storms [5].
The pattern matching process consists of two phases: an
offline calibration or training phase and an online tracking
or localization phase. During the offline training phase a
database is build, containing measurements of the magnetic
flux density at predefined positions in a building. This
database is called the fingerprint as it is often unique for
each building. These measurements will serve as reference
points during the localization phase. During the localization
phase, the currently measured magnetic flux density by a
smartphone is compared to all measurements stored in the
fingerprint database. If the current measurement matches a
measurement in the fingerprint database it is highly
probable
that
the
user
will
be
at
the
position
that
corresponds
to
this
fingerprint
measurement.
Using
statistical algorithms the most likely position can be
determined.
IV.
MAGNETOMETERS
Magnetometers are capable of measuring the three
components of earth’s magnetic field (x, y and z), relative to
their own spatial orientation. Today magnetometers are
standard sensors in almost every smartphone, which makes
them suitable candidates to use for localization.
For this research two magnetometers on two different
platforms were used. A Honeywell HMC5843 3-axis digital
compass on a Shimmer 9 dimensions-of-freedom Kinematic
Sensor [12]. A AK8973 3-axis magnetometer used on a
Huawei Sonic U8650 smartphone [13]. The behavior of
each
individual
sensor
was
tested
to
determine
if
measurements are platform independent.
The first test was conducted in an indoor bedroom
apartment were both sensors were individually placed on a
wooden table, away from any possible interference factors
like metal objects or electronic devices. The sensor would
send data back via Bluetooth to a computer were all data
was recorded. Both sensors were placed on the table facing
true north, which was found using outdoor reference points
and Google maps.
Table 1 shows the average magnetic flux density of the
first test. Test results show that magnetic flux density
measurements are not the same for both sensor platforms.
This can be expected, both sensors each have a unique
electronic and metal composition, which might distort
sensor readings. These distortions are called hard iron
effects and are caused by the internal structure of the sensor
[14]. Compensation for these hard iron effects is needed. If
no compensation for hard iron effects would be done and we
use a different sensor for both offline training and online
localization phase, we might have an inconsistency between
the 2 data sets. Thus, compensating for hard iron effects is
crucial for geomagnetic indoor localization.
TABLE 1. SHIMMER SENSOR AND SMARTPHONE AVERAGE
MAGNETIC FLUX DENSITY OF STATIC TEST
Shimmer Sensor
Smartphone
x (µT)
-1.05
0.50
y (µT)
7.34
19.19
z (µT)
-57.61
-41.50
Norm (µT)
58.09
42.32
Hard iron characteristics can be found by rotating the
sensor round the x, y and z axis. If no hard iron effects are
present, rotating a magnetometer 360 degrees and plotting
the resulting data as y-axis versus x-axis, will result in a
circle centered around (0, 0). Figure 1 and 2 show the
resulting circles of the x-y rotation of the smartphone and
the Shimmer sensor before compensating for hard iron
effects and after. Table 2 shows the compensation values for
each axis of both sensors.
TABLE 2. HARD IRON COMPENSATION VALUES FOR BOTH
SENSORS
Shimmer Sensor
Smartphone
Correction X (µT)
15.00
3.67
Correction Y (µT)
7.25
0.16
Correction Z (µT)
-11.25
4.52
After compensating both sensors for these hard iron
effects by subtracting the compensation values from the raw
data, the first test was repeated and the results are shown in
Table 3. We can now see that both sensors give very similar
measurements at the same position.
43
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-309-4
AMBIENT 2013 : The Third International Conference on Ambient Computing, Applications, Services and Technologies

Figure 1. Smartphone hard iron compensation
Figure 2. Shimmer sensor hard iron compensation
TABLE 3. SHIMMER SENSOR AND SMARTPHONE AVERAGE
MAGNETIC FLUX DENSITY OF STATIC TEST AFTER HARD IRON
COMPENSATION
Shimmer Sensor
Smartphone
x (µT)
-0.33
-0.8
y (µT)
17.12
18.01
z (µT)
-45.97
-44.46
Norm (µT)
49.06
47.98
Often, magnetometers are also calibrated to compensate
for the presence of external metal or electronic distortions,
called soft iron effects. For this research, this is an undesired
calibration as the goal of geomagnetic localization is to
measure and map these distortions.
If we do not look at the previous test data, we would
expect the smartphone to have a higher variance because of
its more advanced electronic composition, which might
influence the sensitive magnetometer. The test showed that
the shimmer sensor had a slightly larger variance, which was
unexpected. Additional tests were conducted were all
receivers of the smartphone were turned on in an attempt to
maximize the variance. Table 4 shows the magnetic flux
density measurements of the smartphone with receivers
disabled and enabled. Note that the Bluetooth receiver was
enabled in both scenarios as it would send back the data.
Although variance in the data rose slightly when both
receivers were activated, it would not significantly affect our
measurements.
TABLE 4. SMARTPHONE MAGNETIC FLUX DENSITY VARIANCE
TEST RESULTS
Wi-Fi and GPS disabled
Wi-Fi and GPS Enabled
Mean (µT)
Std
Mean (µT)
Std
x
15.07
0.47
15.14
0.48
y
2.35
0.43
2.43
0.54
z
-32.94
0.49
-32.91
0.55
Norm
36.31
0.50
36.32
0.56
As the focus of this research will be handheld
smartphones, tests were conducted to see if human hand
contact would significantly affect measurements. During the
offline calibration phase measurements might be taken with
or without contact by a human hand. Magnetic flux density
measurement were taken with and without contact by
human hand and results are presented in Table 5. The test
results show that there was no significant change between
both scenarios.
TABLE 5. SMARTPHONE MAGNETIC FLUX DENSITY VARIANCE
TEST RESULTS
No Human Hand Contact
Human Hand Contact
Mean (µT)
Std
Mean (µT)
Std
x
14.33
0.55
14.48
0.48
y
1.21
0.50
0.93
0.55
z
-33.80
0.52
-33.32
0.52
Norm
36.74
0.54
36.35
0.51
V.
INDOOR MAGNETIC FLUX DENSITY
While indoor environments pose good candidates for
indoor geomagnetic localization, magnetic flux density
measurement must be stable over long periods of time. Li et.
al. [7] conducted experiments were indoor magnetic flux
density was measured in different environments. The results
show stable magnetic flux density measurements over a 24
hour period. The experiments were repeated 3 months later
and no significant chance was detected.
To achieve indoor localization, it is important that
magnetic flux density measurements change considerably
from position to position. If the magnetic flux density
measurements do not change considerably, the fingerprint
might not contain enough information to overcome the
cumulative error of the estimated position and indoor
localization cannot be achieved [1].
A dynamic test was performed to see if magnetic flux
density measurements would vary inside two hallways. The
Shimmer sensor was placed on an office chair and was
elevated to a height of 1.2m. This height is similar to a user
holding a smartphone. The elevation also made sure there
was as little interference as possible from the chair itself.
44
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-309-4
AMBIENT 2013 : The Third International Conference on Ambient Computing, Applications, Services and Technologies

The chair was moved at a constant velocity (0.3 m/s)
through the hallway. The speed is not always constant as
human error is inevitable. The first hallway was expected to
have changing measurement value because of the reinforce
concrete floor and metal furniture in the rooms next to the
hallway. The second hallway was expected to have less
varying measurements because of the wooden fl
absence of metal furniture.
Figure 3 and Figure 4 show the measurements of the x, y
and z components taken through the first hallway and the
second hallway respectively. The test results show changing
magnetic flux density measurements for hall
peaks and drops in magnetic flux density allow us to
identify certain areas inside the hallway and accordingly
allow for localization. The measurements of hallway B
different story, there are no peaks or drops to identify
certain
areas,
which
makes
accurate
localization
improbable.
Figure 3. Magnetic flux density dynamic tests of hallway A
Figure 4. Magnetic flux density dynamic tests of hallway B
VI.
INDOOR MAGNETIC FLUX DENSITY FINGERPRINTI
As stated before, pattern matching will be
achieve indoor localization. This technique requires the
recording of a magnetic flux density fingerprint. During this
research, an application is developed that allows a user to
The chair was moved at a constant velocity (0.3 m/s)
through the hallway. The speed is not always constant as
able. The first hallway was expected to
have changing measurement value because of the reinforce
concrete floor and metal furniture in the rooms next to the
hallway. The second hallway was expected to have less
measurements because of the wooden floor and the
the measurements of the x, y
and z components taken through the first hallway and the
second hallway respectively. The test results show changing
nsity measurements for hallway A. These
peaks and drops in magnetic flux density allow us to
identify certain areas inside the hallway and accordingly
. The measurements of hallway B tell a
different story, there are no peaks or drops to identify
which
makes
accurate
localization
nsity dynamic tests of hallway A
nsity dynamic tests of hallway B
DENSITY FINGERPRINTING
As stated before, pattern matching will be used to
. This technique requires the
recording of a magnetic flux density fingerprint. During this
an application is developed that allows a user to
record such fingerprint. The user loads a map of the desired
location in the application. The application will then define
measurement positions at the selected resolution. The user
selects a desired position, then walks to the coordinates of
this position with the magnetometer and starts recording a
desired amount of magnetic flux density measurements.
important that the orientation of the magnetometer does not
change
during
the
fingerprinting
process
as
the
magnetometer will measure magnetic flux density relative to
its own orientation. When all positions are measur
fingerprint is finished and can either be exported for analysis
or used for localization.
The application was used to record a fingerprint of 3
different locations: the ground floor of a suburban house (14
x 16 m), the second floor of a city center
m) and the second floor lab of the university campus (6 x 19
m). These locations were chosen because they represent
different distinct environments were indoor localization
might be required. It was important that all locations had
multiple rooms and had a medium
Figure 5 shows the recorded fingerprints of the suburban
house. The color map shows the magnetic flux density
measurements of the normalized x, y and z components
taken at 1 m spacing. Areas that remaine
were no fingerprint measurement could be obtained because
of built in cabinets, wardrobes or other furniture.
Figure 5. Magnetic flux density fingerprint ground floor suburban house. A
big metal stove was located between the dining ro
high magnetic flux density was measured at that location (red square)
The fingerprint in Figure 5 shows that the magnetic flux
density characteristics change from position to position. A
test was done to determine if these character
for an indoor environment. A fingerprint was taken of
garden (4 x 6 m) and a small part of a street (5 x 15 m).
Figure 6 shows the obtained fingerprint of the street.
outdoor results are very different from the indoor results. The
magnetic
flux
density
characteristics
don’t
change
significantly with position. Table
magnetic flux density standard deviation of the recorded
measurements
for
both
the
indoor
and
the
outdoor
record such fingerprint. The user loads a map of the desired
n in the application. The application will then define
measurement positions at the selected resolution. The user
selects a desired position, then walks to the coordinates of
this position with the magnetometer and starts recording a
etic flux density measurements. It is
important that the orientation of the magnetometer does not
change
during
the
fingerprinting
process
as
the
magnetometer will measure magnetic flux density relative to
its own orientation. When all positions are measured, the
fingerprint is finished and can either be exported for analysis
The application was used to record a fingerprint of 3
different locations: the ground floor of a suburban house (14
x 16 m), the second floor of a city centered apartment (9 x 12
m) and the second floor lab of the university campus (6 x 19
m). These locations were chosen because they represent
different distinct environments were indoor localization
might be required. It was important that all locations had
tiple rooms and had a medium to large size (+20 m2).
shows the recorded fingerprints of the suburban
house. The color map shows the magnetic flux density
measurements of the normalized x, y and z components
taken at 1 m spacing. Areas that remained white were places
were no fingerprint measurement could be obtained because
of built in cabinets, wardrobes or other furniture.
Figure 5. Magnetic flux density fingerprint ground floor suburban house. A
big metal stove was located between the dining room and the kitchen. A
high magnetic flux density was measured at that location (red square)
shows that the magnetic flux
density characteristics change from position to position. A
test was done to determine if these characteristics are unique
for an indoor environment. A fingerprint was taken of a
ll part of a street (5 x 15 m).
Figure 6 shows the obtained fingerprint of the street. The
outdoor results are very different from the indoor results. The
magnetic
flux
density
characteristics
don’t
change
significantly with position. Tables 5 and 6 show the
magnetic flux density standard deviation of the recorded
ndoor
and
the
outdoor
45
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-309-4
AMBIENT 2013 : The Third International Conference on Ambient Computing, Applications, Services and Technologies

fingerprints. The indoor environments clearly have more
varying measurements that the outdoor environments.
TABLE 5. MAGNETIC FLUX DENSITY STANDARD DEVIATION OF
RECORDED INDOOR FINGERPRINTS
Suburban house
Apartment
x (µT)
5.70
5.49
y (µT)
4.63
5.52
z (µT)
5.11
4.65
TABLE 6. MAGNETIC FLUX DENSITY STANDARD DEVIATION OF
RECORDED OUTDOOR FINGERPRINTS
Garden
Street
x (µT)
1.45
3.53
y (µT)
1.28
3.30
z (µT)
0.55
2.65
VII.
METAL AND ELECTRONIC OBJECT I
Indoor environments are places where objects are often
moved or replaced. When objects are moved after the initial
fingerprinting
phase,
they
can
cause
undesired
inconsistencies between the fingerprint data and real word
circumstances.
Tests were conducted to investigate these interferences.
Three objects were tested, a perforator, a mobile phone and
a hard drive. These objects were chosen because they can
represent normal household objects which are often moved
within an indoor environment. These different size objects
were moved at a constant speed towards a Shimmer sensor
to investigate the range and magnitude of the interferences.
Figure 6 shows the results of the hard drive test.
flux density changes drastically as the hard drive
closer to the sensor. As can be expected the change in
magnetic flux density was less significant for the smaller
objects. Table 7 shows the interference range of all objects.
Test results show that the size and magnetic composition
of the object determines the range and magnitude of the
interference. Small size objects only caused interference at a
maximum range of ±15 cm, while larger objects cause
interference at ±25 cm. While small objects have a negligible
influence for a room sized environment, the interference of
larger objects cannot always be ignored.
TABLE 7. METAL AND ELECTRONIC OBJECT INTERFERENCE
TESTS RESULTS
Perforator
Phone
Average velocity (cm/s)
1.48
1.66
Start of interference (s)
29
24
Interference range (cm)
12
15,1
Fingerprint tests were conducted
to
confirm these
findings. A fingerprint was taken from a small bedroom (3.5
x 3.5 m). Magnetic flux density measurements of the x, y
and z component were taken at 0.5 m spacing. Figure
shows the interior setup of the room and the resulting
magnetic flux density fingerprint of the normalized x, y and
z components. As can be seen form this fingerprint
speaker cause a clear magnetic flux density interference
pattern. The size of this distortion is rather large as speaker
are often constructed with strong magnets inside them. After
fingerprints. The indoor environments clearly have more
varying measurements that the outdoor environments.
MAGNETIC FLUX DENSITY STANDARD DEVIATION OF
RECORDED INDOOR FINGERPRINTS
Lab
6.99
4.84
8.08
MAGNETIC FLUX DENSITY STANDARD DEVIATION OF
RECORDED OUTDOOR FINGERPRINTS
INTERFERENCE
Indoor environments are places where objects are often
moved or replaced. When objects are moved after the initial
fingerprinting
phase,
they
can
cause
undesired
inconsistencies between the fingerprint data and real word
were conducted to investigate these interferences.
Three objects were tested, a perforator, a mobile phone and
a hard drive. These objects were chosen because they can
represent normal household objects which are often moved
hese different size objects
were moved at a constant speed towards a Shimmer sensor
to investigate the range and magnitude of the interferences.
shows the results of the hard drive test. Magnetic
flux density changes drastically as the hard drive moves
closer to the sensor. As can be expected the change in
magnetic flux density was less significant for the smaller
shows the interference range of all objects.
Test results show that the size and magnetic composition
the range and magnitude of the
interference. Small size objects only caused interference at a
maximum range of ±15 cm, while larger objects cause
interference at ±25 cm. While small objects have a negligible
the interference of
METAL AND ELECTRONIC OBJECT INTERFERENCE
Phone
Hard Drive
1.66
1.37
23
15,1
23,5
Fingerprint tests were conducted
to
confirm these
findings. A fingerprint was taken from a small bedroom (3.5
x 3.5 m). Magnetic flux density measurements of the x, y
and z component were taken at 0.5 m spacing. Figure 7
shows the interior setup of the room and the resulting
magnetic flux density fingerprint of the normalized x, y and
z components. As can be seen form this fingerprint, the two
speaker cause a clear magnetic flux density interference
his distortion is rather large as speaker
are often constructed with strong magnets inside them. After
taking the first fingerprint one of the speakers was moved to
a different location within the room and a new fingerprint
was taken. Figure 8 shows the ne
resulting new fingerprint. The interference pattern of the
moved speaker is clearly visible in the new fingerprint.
These test results give an example of how the repositioning
and removal of objects inside a room can form an obstac
for indoor geomagnetic localization. When the interior setup
of a room changes significantly, a new fingerprint should be
taken.
Figure 6.
Metal and electronic object interference tests of the hard drive
Figure 7.
Magnetic flux density fingerprint
original position
Figure 8.
Magnetic flux density fingerprint of bedroom (speaker on new
position)
taking the first fingerprint one of the speakers was moved to
the room and a new fingerprint
w interior setup and the
resulting new fingerprint. The interference pattern of the
moved speaker is clearly visible in the new fingerprint.
These test results give an example of how the repositioning
and removal of objects inside a room can form an obstacle
for indoor geomagnetic localization. When the interior setup
of a room changes significantly, a new fingerprint should be
Metal and electronic object interference tests of the hard drive
Magnetic flux density fingerprint of bedroom (speaker on
original position)
Magnetic flux density fingerprint of bedroom (speaker on new
46
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-309-4
AMBIENT 2013 : The Third International Conference on Ambient Computing, Applications, Services and Technologies

VIII.
GEOMAGNETIC INDOOR LOCALIZATION
MEASUREMENT MODEL
All previous results suggest that magnetic flux density
measurements can be used to achieve indoor localization. It
is important to note, that the quality of the localization often
depends on the number of measured components that can be
used as reference points [1].
Having many values to
compare can obviously increase the chance of finding the
right position. The number of components that can be
recorded by a magnetometer is rather small. Only the x, y
and z components of the Earth’s magnetic field can be
measured. There are some practical considerations to be
made during the localization and fingerprinting phase to use
these three components.
As stated before, a magnetometer will measure the
magnetic flux density components relative to its own
orientation. So, to use the three components requires that the
orientation of the sensor is exactly the same during
fingerprinting and localization phase. This is a requirement
that cannot easily be met. A user will walk around in
different directions and the orientation of the device will
follow along with him. The way the user holds the device is
also never the same. Determining the orientation of the
device will be key to using all three components. If no
information is available about the orientation of the device in
either one of these two phases, we can only use the normal of
the measured x, y and z components. This would bring the
amount of components to be used for localization to only
one.
To resolve this issue, a tilt compensated magnetometer
can be used [14]. Such magnetometer uses accelerometers to
detect the vertical orientation of the device by measuring the
force of gravity. Tilt compensation will allow us to calculate
the
z
component
of
the
magnetic
field.
Using
tilt
compensation allows us to use two components, the z
component and the norm of the x and y component [7]. To
use all three components the horizontal orientation of the
device needs to be known. To determine the horizontal
orientation the magnetometer can be used as a compass. A
compass can determine the direction of the magnetic north
and can thus determine the horizontal orientation of the
device. However, to do this the user has to manually point
the device to a reference point on the map e.g. true north. By
defining a reference point the horizontal orientation can be
determined
[11].
This
research
showed
that
indoor
environments
can
cause
interference
in
compass
measurements. These interferences are called
soft-iron
effects. Compensation has to be done to remove these
interferences to get an accurate heading [14]. It is important
to note, that when soft-iron compensation is done, there
needs to be clear distinction between the compensated data
and the raw data. Orientation requires soft-iron compensation
while localization requires no soft-iron compensation.
All aforementioned information can be combined to
define
a
measurement
model
for
geomagnetic
indoor
localization. Defining a measurement model can provide a
technology
interface
for
sensor
fusion
systems
[11].
Algorithm
1
describes
the
measurement
model.
The
measurement model is used to find the probability of a
positionݔ௧ given a measurementݖ௧.
Although magnetic flux density measurement remain
stable over long periods of time, moving metal objects like a
lift cause variations in these measurements [7]. These
sources of error can cause a mismatch in the magnetic flux
density measured at the same position. The accumulated
error can be modeled as a Gaussian kernel distribution. The
standard deviation of this distribution has to represent the
maximum variation that can be expected. The standard
deviation was set to 2 µT as this was the maximum standard
deviation reported by Li et. al 2 m from a lift [7].
Algorithm 1: Geomagnetic Measurement Model (ࢠ࢚,࢚࢞)
1:
getݖ௧
ା from fingerprint forݔ௧
2:
if ݁ܥ݋݉݌ܽݏݏ௧௜௟௧஼௢௠௣௘௡௦௔௧௜௢௡ and ݁ܥ݋݉݌ܽݏݏு௘௔ௗ௜௡௚஼௢௠௣௘௡௦௔௧௜௢௡ then
3:ݓ௫ =ݓ௫ . ݌(ݖ௧
௫|ݔ௧)
4:ݓ௬ =ݓ௬ . ݌൫ݖ௧
௬หݔ௧)
5:ݓ௭ =ݓ௭ . ݌(ݖ௧
௭|ݔ௧)
6:
else if ݁ܥ݋݉݌ܽݏݏ௧௜௟௧஼௢௠௣௘௡௦௔௧௜௢௡ then
7:ݓ௫௬ =ݓ௫௬ . ݌൫ݖ௧
௫௬หݔ௧)
8:ݓ௭ =ݓ௭ . ݌(ݖ௧
௭|ݔ௧)
9:
else
10:ݓ௡௢௥௠=ݓ௡௢௥௠.݌(ݖ௧
௡௢௥௠|ݔ௧)
11:
end if
12:ݓ௧௢௧௔௟ =ݓ௫.ݓ௬.ݓ௭.ݓ௡௢௥௠
13:
returnݓ௧௢௧௔௟
14:
with:
15:
݌(ݖ௧|ݔ௧) =
ୣ (஍ಾ೐ೌೞೠೝ೐೘೐೙೟ – ஍೑೛ )
ଶఙమ
σ = 2 µT
IX.
GEOMAGNETIC INDOOR LOCALIZATION FEASIBILITY
RESULTS
The measurement model defined in Algorithm 1 was
used to investigate the feasibility of geomagnetic indoor
localization.
To
test
the
feasibility,
each
individual
fingerprint position and its accompanying magnetic flux
density measurements was used as a test position. Each test
position was compared to all measurement positions in the
fingerprint using the measurement model described in
Algorithm 1. The measurement model would give a high
weight to fingerprint positions that had magnetic flux
density measurements similar to the test position. The
weight represents the likelihood of the user being at position
ݔ௧ given the measurementݖ௧. The final estimated position
ݔ௧ was calculated as the weighted average of all fingerprint
positions [11], using Equation 1. Positions with a high
probability will contribute more to the final estimated
position.
ݔ௧ =
∑
௪೟
೔௫೟
೔
ಿ
೔సభ
∑
௪೟
೔
ಿ
೔సభ


The coordinates of the final estimated position are
compared to the real coordinates of the test position and the
error is stored. The process will be repeated for all
measurement
positions
within
the
fingerprint.
The
maximum, minimum and average errors for every location
were determined. The amount of estimated positions that
were within 1 m and the amount of estimated positions that
were in the same room was also determined. Table 8 shows
47
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-309-4
AMBIENT 2013 : The Third International Conference on Ambient Computing, Applications, Services and Technologies

the results that were obtained from the three fingerprints that
were recorded.
TABLE 8. GEOMAGNETIC FEASIBILITY RESULTS
Suburban house
Apartment
Lab
Components
1
2
3
1
2
3
1
2
3
Avg (m)
4.8
4.3
3.1
3.7
3.3
2.5
4.5
3.4
2.5
Min (m)
0.1
0.0
0.0
0.1
0.1
0.0
0.2
0.0
0.0
Max (m)
9.3
9.4
8.8
7.2
7.4
7.0
10.5
11.3
11.8
< 1m (%)
4
9
17
7
13
23
9
20
32
room (%)
10
18
44
21
31
49
73
74
82
It is clear from the results that using three components
gives the best localization results and results deteriorate as
fewer
components
are
available.
The
maximum
and
minimum errors stay relatively the same for all amounts of
components. All localization results were combined to form
a cumulative density function in Figure 9.
Figure 9: Cumulative density function, error of localization using 3 (red), 2
(blue) and 1 component (green).
Table 9 shows the results of the same test, only now the
room of the test position was known. Only measurement
position in the same room as the test position would have to
be compared to test position. Test results were significantly
better, even using only one component could achieve
localization close to 1 m. These results indicate that
geomagnetic
localization
might
be
more
suited
for
localization within a room.
TABLE 9: GEOMAGNETIC FEASIBILITY RESULTS WHEN ROOM
WAS KNOWN
Suburban house
Apartment
University lab
Components
1
2
3
1
2
3
1
2
3
Avg (m)
1.4
1.0
0.8
1.4
1.0
0.6
2.2
1.4
0.9
Min (m)
0.1
0.0
0.0
0.0
0.0
0.0
0.1
0.0
0.0
Max (m)
3.2
2.8
2.3
5.2
3.9
2.1
5.4
5.2
3.7
< 1m (%)
30
47
67
35
50
74
21
42
61
Figure 10 shows the cumulative density function when
the room was known.
Figure 10: Cumulative density function, error of localization using 3 (red),
2 (blue) and 1 component (green) when the room was known
Although previous results give a good indication of how
feasible geomagnetic indoor localization can be, they are
largely theoretical. To verify these findings, a more practical
test was done. A route was recorded through the suburban
house. On this route, magnetic flux density measurements
were
taken
at
the
same
position
where
fingerprint
measurements were taken. The position could not be exactly
the same as human error is inevitable. Figure 11 shows the
recorded magnetic flux density for the route and the
fingerprint.
The results show that the recorded measurements are not
exactly the same. The average correlation coefficient
between
the
route
and
the
fingerprint
x,
y
and
z
measurements is 0.93 which means that both recordings are
very similar. The recorded route was estimated within the
environment using Algorithm 1. Figure 11 shows the
original route (blue) and the estimated route (red). First the
route was estimated when nothing about the room was
known, later when the room of the measurement was
known. Table 10 shows the localization results of both
scenarios.
Figure 11: Magnetic flux density x measurements from fingerprint and
route
0.0
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
1.0
0
1
2
3
4
5
6
7
8
9
10
Propability
Distance (m)
0.0
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
1.0
0
1
2
3
4
5
6
7
8
9
10
Propability
Distance (m)
48
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-309-4
AMBIENT 2013 : The Third International Conference on Ambient Computing, Applications, Services and Technologies

Figure 12: Suburban house route results for 3 components
not known (left) and when the room was known (right)
recorded route and red the estimated route.
TABLE 10: ROUTE ESTIMATION RESULTS
Global
Room known
Components
1
2
3
1
Avg (m)
2.1
2.1
1.4
1.3
Min (m)
0.2
0.1
0.0
0.0
Max (m)
4.22
4.2
4.5
3.1
< 1m (%)
13
13
38
43
room (%)
25
31
56
/
This
practical
test
confirmed
the
original
findings
Localization
is
very
dependent
on
the
amount
of
components that can be used and results are superior when
room sized localization is required.
X.
CONCLUSIONS
Geomagnetic localization has some
compared to other indoor localization technologies. No
dedicated hardware infrastructure is needed, as magnetic
fields are present all around us. Magnetic flux density
measurements are platform independent as long as hard
calibration is applied. Magnetic flux density measurements
remain stable over long periods of time. Magnetometers are
build-in sensors in almost every smartphone on the market
which makes them very suited as a localization sensor.
During this research, many test have be
determine how a magnetic flux density map can be used
achieve indoor localization. Possible obstacles are exposed
and theoretical feasibility results were produced. Test results
show that the quality of localization is strongly depended
the number of components that were used. When three
components are used, geomagnetic localization
reasonably well. When only one or two components
the feasibility results decrease rapidly. Although these results
might
not
be
sufficient for
a
standalone technology,
geomagnetic localization can be applied in a sensor fusion
system. A sensor fusion system combines all available sensor
measurement data on the platform to estimate the position of
the user. Results were poor when global localization was
needed but showed promising results when the room was
known. In a sensor fusion system other more suited
technologies might be used for global loc
geomagnetic localization can be used to determine the most
likely position within a room.
components when room was
not known (left) and when the room was known (right), blue line is the
route and red the estimated route.
TABLE 10: ROUTE ESTIMATION RESULTS
Room known
2
3
1.1
0.9
0.0
0.0
2.6
2.0
43
62
/
/
practical
test
confirmed
the
original
findings.
Localization
is
very
dependent
on
the
amount
of
that can be used and results are superior when
Geomagnetic localization has some big advantages
compared to other indoor localization technologies. No
dedicated hardware infrastructure is needed, as magnetic
fields are present all around us. Magnetic flux density
measurements are platform independent as long as hard-iron
applied. Magnetic flux density measurements
remain stable over long periods of time. Magnetometers are
in sensors in almost every smartphone on the market
which makes them very suited as a localization sensor.
many test have been performed to
determine how a magnetic flux density map can be used to
. Possible obstacles are exposed
and theoretical feasibility results were produced. Test results
show that the quality of localization is strongly depended on
that were used. When three
are used, geomagnetic localization performs
components are used
the feasibility results decrease rapidly. Although these results
might
not
be
sufficient for
a
standalone technology,
geomagnetic localization can be applied in a sensor fusion
system. A sensor fusion system combines all available sensor
ent data on the platform to estimate the position of
the user. Results were poor when global localization was
s when the room was
sensor fusion system other more suited
technologies might be used for global localization while
geomagnetic localization can be used to determine the most
While
this
research
touches
on
many
aspect
of
geomagnetic localization, further research is still required.
Using the three components of the Earth’s
crucial to achieve proper localization results. To use these
three components in a real life localization application, a
tilt/heading compensated magnetometer must be developed.
Determining the maximum variance of such a magnetometer
of such a magnetometer under all circumstances is
REFERENCES
[1]
R. Mautz, “Indoor Positioning technologies,” Institute of
Geodesy and Photogrammetry, Zurich,
[2]
L. C. Boles and K. J. Lohmann, “True navigation and
magnetic maps in spiny lobsters,”
2003.
[3]
H. Mouritsen, G. Feenders, M. Liedvogel, and W. Kropp,
“Migratory birds use head scans to detect the direction of the
earth’s magnetic field.” Current Biology, vol. 14, issue 21, pp.
1946-1949, Nov. 2004.
[4]
K. Yamazaki “Analysis of magnetic disturbance due to
buildings.” IEEE transactions on magnetics, vol. 39, issue 5,
pp. 3226 – 3228, Sept. 2003.
[5]
W.
Storms,
“Magnetic
field
aided
indoor
navigation
BiblioScholar, Nov. 2012.
[6]
I. Vallivaara, J. Haverinen, A. Kemppainen, and J.
“Simultaneous
localization
and
mappi
magnetic field” IEEE Conference on Multisensor Fusion and
Integration for Intelligent Systems (MFI), pp 14
2010.
[7]
B. Li, T. Gallagher, A. G. Dempster, and C. Rizos, “How
feasibleis the use of
magnetic field
alone for
indoor
positioning,” International Conference on Indoor Positioning
and Indoor Navigation (IPIN), pp. 1
[8]
J. Haverinen and A. Kemppainen, “Global indoor self
localization based on the ambient magnetic field
and Autonomous Systems, vol. 57,issue 10,
Oct. 2009
[9]
J. Chung, M. Donahoe, C. Schmandt, and I.
location sensing using geo-magnetism
154 2011.
[10] S. Suksakulchai, S. Thongchai, D. M. Wilkes, and K.
Kawamura, “Mobile robot localization using an electronic
compass for corridor environment”
[11] M. Weyn, “Opportunistic seamless localization
Antwerp, march 2011.
[12] Honeywell, 3-Axis Digital Compass IC HMC5843.
[13] A. kasei, AK8973 3-axis Electronic Compass
[14] C. Konvalin, “Compensating for Tilt, Hard Iron and Soft Iron
Effects”, 2008
While
this
research
touches
on
many
aspect
of
geomagnetic localization, further research is still required.
Using the three components of the Earth’s magnetic field is
crucial to achieve proper localization results. To use these
in a real life localization application, a
magnetometer must be developed.
maximum variance of such a magnetometer
circumstances is crucial.
EFERENCES
door Positioning technologies,” Institute of
Geodesy and Photogrammetry, Zurich, 2012.
L. C. Boles and K. J. Lohmann, “True navigation and
magnetic maps in spiny lobsters,” Nature 421, pp. 60–63, Jan
H. Mouritsen, G. Feenders, M. Liedvogel, and W. Kropp,
“Migratory birds use head scans to detect the direction of the
Current Biology, vol. 14, issue 21, pp.
sis of magnetic disturbance due to
IEEE transactions on magnetics, vol. 39, issue 5,
c
field
aided
indoor
navigation”
I. Vallivaara, J. Haverinen, A. Kemppainen, and J. Roning,
localization
and
mapping
using
ambient
IEEE Conference on Multisensor Fusion and
Integration for Intelligent Systems (MFI), pp 14-19, Sept
B. Li, T. Gallagher, A. G. Dempster, and C. Rizos, “How
e of
magnetic field
alone for
indoor
International Conference on Indoor Positioning
pp. 1-9, Nov. 2012.
J. Haverinen and A. Kemppainen, “Global indoor self-
d on the ambient magnetic field” Robotics
and Autonomous Systems, vol. 57,issue 10, pp 1028-1035,
J. Chung, M. Donahoe, C. Schmandt, and I.-J. Kim, “Indoor
magnetism” MobiSys pp. 141-
S. Suksakulchai, S. Thongchai, D. M. Wilkes, and K.
Kawamura, “Mobile robot localization using an electronic
”, 2000.
rtunistic seamless localization” University of
Axis Digital Compass IC HMC5843.
onic Compass.
, “Compensating for Tilt, Hard Iron and Soft Iron
49
Copyright (c) IARIA, 2013.     ISBN:  978-1-61208-309-4
AMBIENT 2013 : The Third International Conference on Ambient Computing, Applications, Services and Technologies

