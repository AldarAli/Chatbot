Comparison of Single-Speed GSHP Controllers with a Calibrated 
Semi-Virtual Test Bench 
 
 
Tristan Salquea,b, Peter Riederera 
a Energy-Health-Environment Dept. 
CSTB (Scientific and Technical Centre for Building) 
Sophia-Antipolis, France 
tristan.salque@cstb.fr; peter.riederer@cstb.fr 
 
 
Dominique Marchiob 
b CEP - Centre √©nerg√©tique et proc√©d√©s, CEP/Paris 
Mines ParisTech 
Paris, France 
dominique.marchio@mines-paristech.fr 
 
 
Abstract ‚Äî With the recent development of new controllers 
for heat pump systems, there is a need to test and compare 
these controllers in a realistic and reproducible environment. 
This can be done using a semi-virtual test-bench with a 
simulation environment that is calibrated with in-situ 
measurements. A real ground source heat pump (GSHP) is 
connected to the test bench that emulates the building and the 
boreholes. The test can thus be carried out under dynamic 
conditions: dynamic weather conditions are used as well as 
simulated building, floor heating and boreholes. In this study, 
the developed neural network-based predictive controller is 
compared to a conventional controller during a one-week semi-
virtual test. Test results showed that the predictive controller 
can provide up to 40% energy savings in comparison with a 
conventional controller. 
 
Keywords - Artificial neural networks; Predictive control; Energy 
savings; Geothermal heat pump, Semi-virtual test-bench. 
I. 
INTRODUCTION 
 
Important research was conducted on predictive control 
strategies during the 1980s and 1990s. More recently, the use 
of artificial neural networks (ANN) has significantly 
increased the prediction performances of models. ANN 
models were successfully applied to the control of residential 
and small office buildings [1-4]. Other kinds of predictive 
controllers for radiant floor heating systems have also led to 
remarkable results [5-8].  
Most of these smart controllers were validated by 
simulation, while some were tested on a real building or on a 
test cell. Each test technique has its advantages and its 
disadvantages. The simulation test is required to optimize the 
controller and to ensure its accurate behavior in various 
situations. Nevertheless, a simulated environment may not be 
realistic enough to produce reliable results. Besides, this 
procedure uses a simulated heat pump. To remedy that 
situation, the controller can be tested in-situ on a real 
building or on a test cell. These approaches allow the use of 
a real heat pump and deals with real noisy data. The main 
problem of these tests is the fact that two controllers can only 
be tested sequentially. Even if weather compensation 
techniques can be done, the comparison generally fails since 
the conditions (occupants‚Äô behavior, weather, etc.) are 
different. Another comparison technique, called cross-
comparison, consists in testing two controllers at the same 
time but on separate blocks of the same building. Again, the 
comparison is not accurate since the two blocks can have 
different internal and external heat gains, orientation or wall 
composition. 
For the purpose of comparing different controllers 
sequentially and under identical conditions, the semi-virtual 
test bench PEPSY-PAC [9] developed by the CSTB is used. 
A real GSHP is connected to a test bench that emulates the 
building and the boreholes. The test of the controllers can 
thus be carried out under dynamic conditions: dynamic 
weather conditions are used as input of a building simulation 
including floor heating and boreholes. This approach opens a 
large variety of possible test schedules since the simulated 
building, the emitter, weather conditions and occupancy can 
be changed easily. Moreover, the semi-virtual test allows the 
comparison of different controllers with the same 
solicitations. 
In this paper, the developed ANN predictive controller is 
compared to a conventional controller during two sequential 
semi-virtual tests of one week. The simulation environment 
is designed to reproduce all characteristics (building, 
weather, boreholes, etc.) of an in-situ GSHP that was 
monitored during the 2011/2012 heating season in the north 
of France. The system components parameters (boreholes, 
GSHP, floor heating and building) are first identified 
separately then the global simulation with all the components 
is compared to in-situ measurements. 
The paper also includes the description of the ANN 
controller. The training process including the determination 
of optimal input data, algorithm, and structure is detailed. 
The objective of the controller is to minimize the energy 
consumption of the GSHP system and maintain a good 
comfort level anticipating future disturbances (solar gains, 
outdoor temperature) and room temperature. ANN modules 
are used for the prediction of weather data, room temperature 
and temperatures in the floor heating and in the boreholes. 
The paper is organized as follows. In Section II, the 
semi-virtual test bench is presented. Section III deals with 
the calibration of the simulated part with in-situ 
measurements. The ANN controller is detailed in Section IV. 
In Section V, the predictive controller is compared to a 
conventional controller on the bench. The last section 
presents the conclusions of this paper. 
 
235
International Journal on Advances in Systems and Measurements, vol 6 no 1 & 2, year 2013, http://www.iariajournals.org/systems_and_measurements/
2013, ¬© Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
Figure 1: Flowchart of the semi-virtual test of a controller. 
 
II. 
SEMI-VIRTUAL TEST BENCH 
A. Concept of the test-bench 
The semi-virtual platform PEPSY-PAC (Platform for 
the Evaluation of Performances of dynamic SYstems) has 
been developed for testing performances of GSHP systems 
or parts of the system [9]. It also allows the test of a 
controller connected to a real GSHP integrated in a simulated 
environment, as presented in this paper. This test bench 
allows the emulation of any water-based heat emitter 
integrated in a building as well as any kind of ground heat 
exchanger. The outlet temperature and flowrate of the test 
bench is controlled by the system simulation.  
Matlab is used for the simulated part of the test bench. 
Simulation is therefore slowed down to real time and the 
simulation environment enables at the same time the test 
bench control, system simulation (emulator) and online 
monitoring of the test. 
The operation of the test bench is detailed in Figure 1. 
Every thirty seconds, the simulated part sends model outputs 
(outlet temperatures of the floor heating Tf,o-set and the 
boreholes Tb,o-set) to the test bench.  
 
 
 
Figure 2: Test bench hydraulic circuit diagram. 
 
The test bench controls the real outlet temperatures of 
the GSHP (Tf,o  and Tb,o) to reach these setpoints. At the same 
time, the GSHP inlet temperatures (Tf,i and Tb,i) and flow 
rates (m  and m ) are measured and sent to the simulation 
environment.  Weather data like solar radiation I and outside 
temperature To as well as room temperature Ti are 
transmitted to the tested controller. In-situ measurements, 
detailed in the next section, are used to fit the simulated part. 
B. Construction and control 
The test bench integrates 6 hydraulic ports for testing 
(building, boreholes and Domestic Hot Water tank) as well 
as 2 hydraulic ports for the cold primary circuit. The DHW 
tank ports are not used for this test. The circuit diagram is 
presented in Figure 2. 
Seven proportional-integral-derivative (PID) controllers 
ensure the continuous control of outlet temperatures through 
the action of hydraulic valves and electric heaters. Figure 3 
shows the temperature step responses on the building side 
and in the boreholes. Inlet and outlet temperatures are 
measured every thirty seconds with a specific datalogger. 
The test bench was designed to consume the less possible 
energy: the heat extracted at the building side is used to heat 
up the boreholes side. Two hydraulic separators on the 
building side and on the borehole side allow the heat pump 
flowrate to be independent from the bench flowrate. The 
pressures losses of the heat pump circulators can thus be 
adjusted to correspond to real floor heating and boreholes. 
 
Figure 3: Test-bench response to setpoint step changes. 
236
International Journal on Advances in Systems and Measurements, vol 6 no 1 & 2, year 2013, http://www.iariajournals.org/systems_and_measurements/
2013, ¬© Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
 
Figure 4 : In-situ monitoring of a GSHP system on a dwelling in Marck (France). 
 
III. 
CALIBRATION OF SIMULATED PART 
A. In-situ measurements 
A single family-house located in Marck (France) has 
been monitored during the 2011/2012 heating period.  The 
dwelling is conform to the 2005 French regulation (RT2005) 
and has the following characteristics:  
- 
Surface area of 100 m2. 
- 
External walls: brick (11 cm), air layer, cellular 
concrete (11 cm), glass-wool (10 cm), air layer, 
plasterboard (1.3 cm). Global U-value of 0.18 W.m-
2.K-1 ; 
- 
Double glazing, U-value of 1.5 W.m-2.K-1 ; 
- 
Windows distribution: North 7%, South 10%, East 
17%, West 0% ; 
- 
Single flow hygro-adjustable ventilation ;  
- 
Equipped with a 8.5 kW GSHP connected to a floor 
heating; 
- 
Double U-pipe vertical boreholes of 100m depth. 
The renewable energy monitoring box (REMBO) 
developed by the CSTB acquires, treats and sends measured 
data every minute to a server.  Flow rates and temperatures 
on the building side and on the borehole side are measured 
as well as electric consumptions of compressor and pumps. 
Outside and room temperature are also measured. Global 
horizontal solar radiation is obtained from satellite images 
thanks to the SODA service [10]. 
 
B. Modeling of the GSHP system 
The whole system model is based on Matlab/Simulink 
environment using the SIMBAD toolbox (Simbad, 2004). 
The system includes the following components ( 
Figure 5): 
 
- Building part (building, floor heating system, 
occupants, ventilation and equipment); 
 
- GSHP; 
 - Borehole heat exchanger part. 
 
 
The building was modeled with the Simbad multizone 
model [11] and designed with the associated SimBDI 
graphical interface. A simple monozone model has been 
chosen.  
The floor heating model developed by Salque [12] is 
based on finite difference method. It consists in a 2D-grid of 
the slab coupled to a pipe model. The floor heating is made 
of four layers (floor covers, slab with pipes, insulation and 
concrete floor) with different thermal properties. 
The heat pump model is based on experimental data. 
The coefficient of performance (COP), which is the ratio of 
the heat produced at the condenser to the electric energy 
consumed by the compressor, is determined with the method 
of least squares for a plane equation, depending of average 
temperatures at both condenser and evaporator side. 
The boreholes model developed by Partenay [13] is 
based on finite difference method. It consists in a 3D-grid of 
the ground coupled to a pipe model, allowing the modeling 
of single or double U pipes. The heat conduction problem is 
solved with a state-space formulation. 
 
 
Figure 5 : Modeling of the GSHP system with Matlab/Simulink. 
237
International Journal on Advances in Systems and Measurements, vol 6 no 1 & 2, year 2013, http://www.iariajournals.org/systems_and_measurements/
2013, ¬© Copyright by authors, Published under agreement with IARIA - www.iaria.org

C. Fitting of simulated part 
The objective is to fit the simulated GSHP system to the 
measured data to obtain a realistic simulation environment. 
The system components parameters (boreholes, GSHP, floor 
heating and building) are identified separately. For each 
component, the physical parameters known a priori were 
fixed, while others were fitted by least square minimization. 
A step by step method for tuning the physical parameters of 
the different models was proposed by Salque [12]. A specific 
iterative process for parameters identification of building and 
floor heating was developed since these components are 
physically coupled. An overview of this method is detailed 
here, for more information please refer to [12]. 
‚Ä¢ 
Boreholes parameters identification 
Design parameters such as the radius of drilling, 
borehole length or pipe diameter are fixed since they are 
known from in-situ measurements. Modeling parameters 
such as the radius of domain and the number of nodes are 
also fixed to simplify the problem. The unknowns concern 
the 
thermal 
characteristics 
of 
the 
ground 
(ground 
conductivity and heat capacity) and the initial ground 
temperature. These variable parameters were adjusted in a 
physical range of values to best fit the measured data. The 
following values were found to be the optimal set of 
parameters:  
- 
Ground conductivity : 2.2  W/(m.K) 
- 
Ground heat capacity: 2180 kJ/(kg.K) 
- 
Initial ground temperature : 12.2¬∞C 
The Root Mean Square (RMS) error on outlet 
temperature with the optimal set of parameter is 0.41¬∞C. The 
error in terms of energy extracted from the ground during the 
month of March is lower than 1%. 
 
‚Ä¢ 
Floor heating and building parameters identification 
 
The building was modeled with the Simbad multizone 
model [11] and designed with the associated SimBDI 
graphical interface. Geometry and wall compositions of the 
identified dwelling were read from plans. Due to a large 
number of unknowns related to the occupants‚Äô behavior 
(windows opening, internal gains, etc.) and the exact location 
of the room temperature sensor, a simple monozone model 
has been chosen. Design parameters such as building 
geometry, wall composition or floor heating surface are 
supposed to be perfectly known and fixed. The real hygro-
adjustable ventilation is modeled by simple-flux ventilation 
with a constant air flow as humidity ratio of indoor air is 
unknown. 
Since 
internal 
gains 
and 
ventilation 
parameters 
compensate when trying to fit the building model, internal 
gains were fixed to a typical value while the ventilation rate 
was estimated. A constant blinds position between 0 (closed) 
and 1 (open) was also estimated to fit the solar gains. The 
composition of floor heating layers is known in a range of 
uncertainty. It was found that the adjustment of the most 
influent layer (slab with pipes) is enough to make the model 
fit. Another crucial floor heating parameter that needs to be 
adjusted is the pipe spacing that is proportional to the heat-
exchange surface between fluid and floor heating 
Since there are no measurements of surface temperature, 
the identification of both floor heating and building models 
has to be made in parallel. The optimal set of parameters was 
found to be: 
- 
Pipe spacing : 0.33 m ; 
- 
Floor heating conductivity : 1.9 W/(m.K) ; 
- 
Floor heating inertia : 8950 kJ/K ; 
- 
Ventilation rate : 0.36 vol/h; 
- 
Blinds position: 0.8 [-]. 
 
‚Ä¢ 
GSHP parameters identification 
The GSHP model is only required to verify that the 
global simulation still fits the measured data. The heat pump 
COP is modeled by the following function, developed by 
Partenay [13]: 
           = 
 ‚àó  +   ‚àó  
(1) 
where Tevap and Tcond are the average temperatures at 
evaporator and condenser side. For a given temperature 
level in the heating floor, COP behaves as a linear function 
of the temperature level in the ground. Experimental tests 
revealed that electric power Pel was only a function of 
condenser temperature. The chosen model is expressed as 
follows: 
             =  ‚àó 
 ‚àí  ‚àó  +  
(2) 
The coefficients a, b, c, d, e, f are identified using the least 
squares method (a=5.09, b=0.16, c=-0.05, d=-81.9, e=66.9, 
f=-0.55). 
‚Ä¢ 
Global simulation results 
The identified models are now integrated in a global 
simulation in Matlab/Simulink. The month of March is 
simulated and compared to the measured data. The measured 
heat pump on/off control is applied to the simulated heat 
pump. This way the differences between simulation and 
measurements are only due to the modeling and cannot be 
attributed to an incorrect estimate of control logic. Besides, 
the action of the occupants on room temperature setpoint 
makes it very difficult to accurately estimate the control 
logic.  
Figure 6 shows the comparison between simulated and 
real GSHP system. The first graph on top shows simulated 
and measured room temperatures. The identification of the 
thermal behavior of the building is satisfactory. Indeed, 
simulated and measured room temperature extremum are in 
phase. The RMS error on room temperature over the whole 
month is 0.63 ¬∞C. The RMS error is 26 W for condenser 
power and 18 W for evaporator power. Simulated heating 
energy 
consumption 
is 
558 
kWh 
while 
measured 
consumption is 541 kWh.               .         
238
International Journal on Advances in Systems and Measurements, vol 6 no 1 & 2, year 2013, http://www.iariajournals.org/systems_and_measurements/
2013, ¬© Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
Figure 6 : Comparison of global simulation results and in-situ measurements ‚Äì Month of March. 
 
The last graph shows the SPF, which is the ratio 
between heating energy delivered to the building and electric 
energy consumed by the compressor. The SPF over the 
month of March obtained by simulation is 4.28, while the 
real SPF is 4.21.  
IV. 
THE PREDICTIVE CONTROLLER 
The objective of the controller is to minimize the energy 
consumption of the GSHP system and maintain a good 
temperature level anticipating future disturbances and room 
temperature. The controller is designed to be self-learning 
and easily adaptable in practice.  
To be compatible with the developed controller, the 
GSHP system must fulfill the following conditions: 
‚Ä¢ 
The GSHP is single-speed (only one single-speed 
compressor); 
‚Ä¢ 
The GSHP only supplies heating and/or cooling 
(no domestic hot water supply); 
‚Ä¢ 
The GSHP is directly connected to the radiant floor 
heating, without any storage tank for hydraulic 
decoupling. 
A. Controller strucutre 
The modular structure of the controller is illustrated in 
Figure 7. The forecasting modules are all based on ANN. A 
weather module performs predictions of solar radiation (I) 
and outdoor temperature (To). The heating power produced 
(Ph) and the electric power consumed by the GSHP (Pel) are 
predicted by another module. The latter uses as inputs the 
supply and returns temperatures in the boreholes (Tb) and in 
the radiant floor (Tf), as well as all the possible trajectories of 
the GSHP on/off for the next 6 hours. Based on these 
predictions, another ANN makes predictions of room 
temperature Ti. The optimization block determines the 
optimal trajectory to be applied to the system according to 
the various trajectories of Ti and Pel. 
B. Control strategy 
The 
optimization 
block 
determines 
the 
optimal 
trajectory that minimizes the following cost function: 
J = % Œ±& 'Œ¥(k) +T-.(k) ‚àí T/(k)
‚àÜT123
4

+ P67
8(k)
P123
9 
:
&;<
 
 
(3) 
   
subject to    T1=> < T-.(k) < T123 
(4) 
where T-.(k) and T/(k) are the predicted and the setpoint 
temperature, while P67
8(k) and P123 are the predicted and the 
maximum electric power consumed by the GSHP. The 
maximal distance to the setpoint ‚àÜT123  can be adjusted 
whether the occupants give more importance to comfort or 
to energy savings (‚àÜT123 = 0.5K by default). When the 
building is not occupied, the condition (4) maintains T= 
between T1=>  and T123.  For intermittent control strategy, 
D(E) is set to one during the occupancy period and to zero 
otherwise. Œ± is a value between zero and one (typically 0.8) 
that gives more weight to the first predictions in time, these 
being usually more accurate than the distant predictions.
0
100
200
300
400
500
600
700
20
22
24
Tamb [¬∞C]
 
 
Measured
Simulated
0
100
200
300
400
500
600
700
0
400
800
I [W/m2]
 
 
I
To
0
100
200
300
400
500
600
700
-5
5
15
To [¬∞C]
0
100
200
300
400
500
600
700
6000
6500
7000
7500
P condenser [W]
 
 
Measured
Simulated
0
100
200
300
400
500
600
700
5000
5500
6000
6500
P evaporator [W]
 
 
Measured
Simulated
0
100
200
300
400
500
600
700
3
4
5
Time [h]
SPF [-]
 
 
Measured
Simulated
239
International Journal on Advances in Systems and Measurements, vol 6 no 1 & 2, year 2013, http://www.iariajournals.org/systems_and_measurements/
2013, ¬© Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
Figure 7: Flow chart of the ANN-based predictive controller. The symbol (^) is assigned to the predicted values.   
 
C. Prediction horizon 
The length of the prediction horizon depends on several 
factors. A large horizon is needed when large room 
temperature or electricity price changes are expected in the 
future [14]. It is the case in an intermittently occupied 
building. In practice, the horizon length is chosen as an 
equivalent of the room time constant corresponding to the 
first active layers of the walls. For the purpose of the present 
study, a 6 hours receding horizon is applied and the optimal 
control problem is repeated every 15 minutes. 
D. Algorithm 
At each time step, the optimal on/off trajectory for the 
next 6 hours is determined. The discrete nature of the input 
makes it possible to compute all the possible trajectories and 
chose the one that minimizes the cost function (3) subject to 
constraint (4). Moreover, it allows the use of non-linear 
models, such as ANN, that usually limit the possibilities of 
analytical problem solving [15]. 
E. ANNs training process 
The various modules were first optimized via extensive 
off-line tests conducted with the neural network toolbox in 
Matlab [16]. The objective is to produce a network that fits 
the data as accurately as possible, but simple enough to train 
easily and generalize well. Optimization is an iterative 
process that consists in finding the ideal ANN structure, 
algorithm and set of input variables.  
The ANNs architecture is a multilayer perceptron.  In 
the present study, one hidden layer was always found to be 
the best solution.  The number of neurons in the hidden layer 
was first chosen to be equal to 75% of the number of inputs 
[17] and then optimized by trial-and-error until no 
improvement could be seen.  
Another key step in the process of ANN building is the 
choice of inputs and associated time delays. For nonlinear 
models such as ANN, there is no systematic approach [18]  
and the risk of dismissing relevant inputs is high. Statistical 
methods like auto-correlation criterion or cross correlation 
give a good insight into the relevance and the lag effect of an 
input variable on the output. The model has to be as simple 
as possible while taking into account the most relevant 
inputs. Again, optimal sets of inputs and time delays are 
obtained by trial-and-error. A hyperbolic tangent sigmoid 
function was used as the transfer function in the single 
hidden layer. The algorithm used for training was an 
optimized version of the Levenberg-Marquardt algorithm 
that included Bayesian regularization. This algorithm 
minimizes a combination of squared errors and weights, and 
then determines the correct combination so as to produce a 
network that generalizes well.  
The generalization capability is also improved with the 
early stopping feature. With this technique, the collected data 
that was first normalized to the range [-1; 1] is divided into 
three subsets: training, validation, and test. Training stops 
when validation performance has increased more than 5 
times since the last time it decreased. The test data set is used 
to estimate the generalization error of the ANNs but does not 
interfere during the training process.  
For online applications, ANNs have to be trained 
regularly on new data set to adapt to changes in the system. 
For instance, during the heating season, the boreholes 
temperature will fall. To take into account this phenomenon, 
studies not presented here showed that the ANN for borehole 
temperature prediction has to be trained every 15 days on the 
last 30 days data. 
 
240
International Journal on Advances in Systems and Measurements, vol 6 no 1 & 2, year 2013, http://www.iariajournals.org/systems_and_measurements/
2013, ¬© Copyright by authors, Published under agreement with IARIA - www.iaria.org

F. Room temperature prediction 
ANN for room temperature prediction is here detailed as 
this module is of most interest. For more information on the 
other ANN modules, please refer to [19]. 
 
‚Ä¢ 
Choice of inputs 
 
Various 
input 
parameters 
influence 
the 
indoor 
environment: 
outdoor 
temperature, 
solar 
radiation, 
occupation (internal gains, windows opening, etc.), heating 
power, wind, humidity, etc. Taking into account all these 
parameters is not conceivable for two main reasons. First, 
regarding the application on a real controller, the number of 
sensors would be too high and some variables are difficult to 
measure. Second, a more complicated model is more likely 
to diverge as it is more sensitive to noise in the data. The 
model has to be as simple as possible while taking into 
account the most relevant inputs. Among all the 
meteorological variables, the global horizontal solar 
radiation and the outdoor temperature are accordingly the 
most influential parameters for the indoor environment. 
 
‚Ä¢ 
Optimal structure 
 
The developed ANN provides room temperature Ti for 
the next time step from current weather data (To, I) as well as 
previous and current values of heating power Ph and room 
temperature Ti. This ANN making the link between the 
heating power delivered to the radiant floor and the impact 
on room temperature, it encapsulates both the thermal 
behavior of the building and the emitter. In particular, the 
thermal lag of the radiant floor is taken into account in the 
ANN using Ph(k-1). A wide range of current and previous 
values of these variables was tested as inputs. The optimal 
ANN structure and set of inputs for room temperature 
prediction of the studied building are presented in Figure 8.  
Offline tests revealed that the mean value of the outdoor 
temperature on the last 24 hours 
)
(
To24 k
contains enough 
information to describe the dynamic behavior of the tested 
building. For less insulated buildings or buildings with a 
higher ventilation rate, the impact of the outdoor temperature 
is higher and the current value of 
o
T is likely to be more 
appropriate. The ANN used in this module has 6 input 
neurons, one hidden layer of 6 neurons and one output 
neuron. 
 
Figure 8: ANN architecture for room temperature prediction. 
‚Ä¢ 
Comparison with ARX model 
 
ANN performances for room temperature prediction are 
compared to linear ARX models, which are commonly used 
for the building model in predictive control. ARX models are 
Auto Regressive models with eXternal inputs that can be 
written as follows: 
F(G) = H ‚àó IJ(G ‚àí 1), J(G ‚àí 2) ‚Ä¶ N 
  + O ‚àó IF(G ‚àí 1), F(G ‚àí 2) ‚Ä¶ N + O ‚àó P(G)  
(5) 
where F(G)is the output vector, J(G) the input vector and 
P(G) a white noise with zero mean.  
Three months of simulation were used to train and test 
the models: January and February data are used for training 
and validation of ANN and ARX models, while March is 
used for test. A wide range of inputs were tested. To evaluate 
the prediction error of ANN and ARX models, the root mean 
square error (RMSE) and the mean error (ME) were used as 
performance criteria over the 6 hours prediction horizon. The 
main results are summarized below: 
‚Ä¢ 
ANN models clearly outperform ARX models in 
terms of ME and RMSE over the whole prediction 
horizon. The RMSE is in average 40% lower using 
non-linear ANN models. ANN forecasts are less 
biased as the ME is smaller in absolute value. 
‚Ä¢ 
Too complicated models do not give accurate 
results.  
‚Ä¢ 
Previous values of heating power Ph(k-1) as well as 
room temperature Ti(k-1) and Ti(k-2) must be 
taken into account due to the inertia of the building 
and the floor heating. 
‚Ä¢ 
Taking into account previous values further into 
the past does not improve the prediction 
performances of both types of models. 
An example of 3 hours prediction results of ANN3 and 
ARX3 models on a representative week of March is given in 
Figure 9. ANN model reproduces more accurately the 
thermal behavior of the building in comparison to the linear 
ARX model. ANN is in particular much better when the 
building is subject to strong solar gains (first day of Figure 
9). 
 
 
 
Figure 9: 3 hours prediction of room temperature. 
0
20
40
60
80
100
120
140
160
18
19
20
21
22
23
24
Time [h]
Room Temperature [¬∞C]
 
 
ANN
ARX
Reference
241
International Journal on Advances in Systems and Measurements, vol 6 no 1 & 2, year 2013, http://www.iariajournals.org/systems_and_measurements/
2013, ¬© Copyright by authors, Published under agreement with IARIA - www.iaria.org

V. 
COMPARISON OF CONTROLLERS ON THE SEMI-
VIRTUAL TEST BENCH 
A. Conventional controller 
For the test, the real measured controller output is used 
as a reference. This on/off signal is applied to the heat pump 
connected to the bench. It can be noticed that the heat pump 
installed in the laboratory is the same heat pump of that in 
the monitored dwelling. This reference controller is a 
Compensated-Open-Loop (COL) controller that is installed 
by default with most single-speed GSHP systems. The COL 
controller is based on the following heating curve that is 
adjusted with the actual value of room temperature: 
QR = (
 ‚àó  + ) ‚àí S ‚àó (T ‚àí U) 
(6) 
where  is the outdoor temperature and (T ‚àí U)  the 
difference between the actual and the setpoint room 
temperature. The coefficients a and b are the heating curve 
parameters while c is the ambient compensation factor. The 
COL controller switches on/off the GSHP when the water 
supply temperature Tf,s is beyond TVW ¬±2¬∞C. This control 
logic requires the pump on the building side to always be 
working to keep the fluid circulating. The COL controller is 
represented in Figure 10. 
 
 
Figure 10 : Control logic of the COL conventional controller. 
 
B. Experiment process 
‚Ä¢ 
Test procedure 
 
The ANN controller is compared to the COL controller 
during two sequential tests of one week on the bench. The 
complete test procedure is illustrated in Figure 11. The 
procedure starts with an initialization phase from February 
15th to March 15th that consists in a simulation of the whole 
system. During this phase, the measured on/off signal is 
applied to the simulated heat pump. Initialization period is 
also required to train the ANN modules of the predictive 
controller: the training data set is from February 15th to 
February 28th while the validation data set is from February 
29th to March 15th. At the end of the initialization, the real-
time testing of the controller starts. The simulated building 
and boreholes are in the same thermal state at the beginning 
of each test to ensure an accurate comparison. 
 
 
Figure 11 : Procedure of the semi-virtual test of the controllers. 
 
Since the real GSHP has a very small time constant (the 
steady-state of the heat pump is almost immediately 
reached), the real-time testing can in fact be accelerated to 
significantly reduce the duration of the test. The acceleration 
factor of real-time depends on the minimum duration of a 
compressor cycle during the test as well as the response time 
of the bench. In our case, the bench approximately takes 3 
minutes to reach the setpoint ¬± 0.5¬∞C when the compressor 
starts. With the ANN controller, the minimum duration of a 
compressor cycle is 15 minutes (time lapse between 2 
controller‚Äôs calls). With the conventional controller, in-situ 
measurements showed a minimum of 12 minutes per cycle. 
Based on these durations, the real time has been accelerated 
by 2 to ensure the bench to accurately control the 
temperatures. 
 
‚Ä¢ 
Heat pump control 
 
The heat pump is controlled via programmable 
resistances that replace the heat pump outdoor and room 
temperature sensors. An outdoor temperature drop activates 
the heat pump compressor, and vice versa. This way the 
control of the heat pump is non-intrusive. 
 
C. Controllers‚Äô performances comparison 
Room temperature setpoint of ANN controller is set to 
22.5¬∞C with a comfort parameter ‚àÜT123 = 0.5¬∞C . This 
temperature corresponds to the mean room temperature 
observed with the conventional COL controller. 
A comparison of the controllers on the test week is 
depicted in Figure 12. COL controller leads to small room 
temperature overshoots in the afternoon. It can be noticed 
that when the GSHP is switched on in the morning of a 
sunny day, the dwelling is likely to be overheated in the 
afternoon. This is of course due to the fact that the 
conventional control logic does not integrate a prediction of 
solar gains.  
 
 
 
242
International Journal on Advances in Systems and Measurements, vol 6 no 1 & 2, year 2013, http://www.iariajournals.org/systems_and_measurements/
2013, ¬© Copyright by authors, Published under agreement with IARIA - www.iaria.org

 
Figure 12 :  Comparison of the controllers over the test week. % 15-22 March. 
 
      ANN controller keeps room temperature in the comfort 
range thanks to its prediction capability. Room temperature 
is lowered just before solar gains are expected so that to 
avoid overheating and benefit from free heat gains, leading 
to energy savings. Heating loads are thus shifted to 
anticipate solar gains. 
Results in terms of energy consumed and heat pump 
performances over the test week are presented in Figure 13.  
Thermal energy delivered to the floor heating is 152 kWh 
with COL and 147 kWh with ANN, i.e., a gain of 3%. Total 
electric energy consumed by the GSHP system is 60 kWh 
with COL whereas ANN controller only consumes 36 kWh. 
This gain of 40% in energy consumption is mainly due to the 
fact that the pump on the floor heating side is constantly 
running with COL.  
Heat pump efficiency is expressed here as a Seasonal 
Performance Factor (SPF), which is the ratio between the 
energy delivered by the heat pump and the electrical energy 
consumed by the compressor or by the compressor and the 
pumps (global SPF). The compressor SPFs are almost 
identical with both controllers. The ANN compressor SPF is 
slightly higher (4.6) than COL (4.5) as mean duration of 
compressor cycles is lower with ANN. Longer cycles indeed 
lead to higher temperatures in the floor heating and thus a 
lower heat pump efficiency. Global SPF with COL is only 
2.5 because of the high consumption of the pump on the 
building side, while global SPF with ANN is 3.9.  
 
VI. 
CONCLUSION 
For the purpose of comparing different controllers 
sequentially and under identical conditions, a test procedure 
has been developed on a calibrated semi-virtual test bench. A 
real GSHP has been connected to the test bench that 
emulates the building and the boreholes.  
 
Figure 13 : Test results in terms of energy consumption and heat pump efficiency SPF% over the testing week.
0
20
40
60
80
100
120
140
160
22
23
24
Ti [¬∞C]
 
 
COL
ANN
0
20
40
60
80
100
120
140
160
0
400
800
I [W/m2]
 
 
I
To
0
20
40
60
80
100
120
140
160
-5
5
15
To [¬∞C]
0
20
40
60
80
100
120
140
160
0
1
HP control [-]
Time [h]
243
International Journal on Advances in Systems and Measurements, vol 6 no 1 & 2, year 2013, http://www.iariajournals.org/systems_and_measurements/
2013, ¬© Copyright by authors, Published under agreement with IARIA - www.iaria.org

The controllers‚Äô tests can thus be carried out under 
dynamic conditions: dynamic weather conditions are used as 
input of a building simulation including floor heating and 
boreholes. The simulation environment has been designed to 
reproduce all characteristics (building, weather, boreholes, 
etc.) of an in-situ GSHP that was monitored during the 
2011/2012 heating season in the north of France. This way 
the tests were carried out under realistic and reproducible 
conditions, which is practically impossible with sequential 
in-situ tests. Another advantage of the semi-virtual test-
bench is that the real time of the test can be accelerated to 
significantly reduce the duration of the test (3.5 days instead 
of 7 days). 
The developed ANN predictive controller for single-
speed GSHP has been detailed including the training process, 
the determination of optimal input data, algorithm and 
structure.  
The ANN controller has been compared to the COL 
conventional controller during two sequential tests of one 
week on the bench. The ANN controller allows an energy 
gain of 40%, mainly due to the fact that the pump on the 
floor heating side has to be constantly running with COL. 
This also results in a better global SPF with ANN. 
 
VII. ACKNOWLEDGEMENTS 
The authors would like to thank the SoDa Service, 
managed by Transvalor S.A., for providing the solar 
radiation data used in this study. 
 
REFERENCES 
 
[1] T. Salque, P. Riederer, and D. Marchio, ‚ÄúDevelopment of a 
Neural Network-based Building Model and Application to 
Geothermal Heat Pumps Predictive Control‚Äù, SIMUL 2012, 
The Fourth International Conference on Advances in System 
Simulation, November 18-23, Lisbon, Portugal,  pp. 24-9, 
2012. 
[2] B.M. √Ökesson, and H.T. Toivonen, ‚ÄúA neural network model 
predictive controller‚Äù, Journal of Process Control, vol.16,  pp. 
937-46, 2006. 
[3] N. Morel, M. Bauer, El-Khoury, and J. Krauss, ‚ÄúNeurobat, a 
predictive and adaptive heating control system using artificial 
neural networks‚Äù, International Journal of Solar Energy,  pp. 
161-201, 2000. 
[4] P.S. Curtiss, G. Shavit, and K. Kreider, ‚ÄúNeural networks 
applied to buildings - a tutorial and case studies in prediction 
and adaptive control‚Äù, ASHRAE Transactions, vol.102, 1996. 
[5] H. Karlsson, and C.-E. Hagentoft, ‚ÄúApplication of model 
based predictive control for water-based floor heating in low 
energy residential buildings‚Äù, Building and Environment, 
vol.46,  pp. 556-69, 2011. 
[6] J. ≈†irok√Ω, F. Oldewurtel, J. Cigler, and S. Pr√≠vara, 
‚ÄúExperimental analysis of model predictive control for an 
energy efficient building heating system‚Äù, Applied Energy, 
vol.88,  pp. 3079-87, 2011. 
[7] A.A. Argiriou, I. Bellas-Velidis, M. Kummert, and P. Andr√©, 
‚ÄúA neural network controller for hydronic heating systems of 
solar buildings‚Äù, Neural Networks, vol.17,  pp. 427-40, 2004. 
[8] C. Verhelst, F. Logist, J. Van Impe, and L. Helsen, ‚ÄúStudy of 
the optimal control problem formulation for modulating air-
to-water heat pumps connected to a residential floor heating 
system‚Äù, Energy and Buildings, vol.45,  pp. 43-53, 2012. 
[9] Riederer P., Partenay V., and Raguideau O., ‚ÄúDynamic test 
method for the determination of the global seasonal 
performance factor of heat pumps used for heating, cooling 
and domestic hot water preparation.‚Äù, Eleventh International 
IBPSA Conference, Glasgow, Scotland, July 27-30, 2009. 
[10] ‚ÄúSolar Irradiation Database SODA ‚Äù, www.soda-is.com,  
[11] El Khoury Z., Riederer P., Couillaud N., Simon J., and R. M., 
‚ÄúA 
multizone 
building 
model 
for 
Matlab/Simulink 
environment‚Äù, Ninth International IBPSA Conference, 
Montreal, Canada, 2005. 
[12] T. Salque, D. Marchio, and P. Riederer, ‚ÄúSemi-virtual test 
bench for comparison of GSHP controllers: tuning of 
simulated part with measured data ‚Äù, 11th REHVA World 
Congress CLIMA 2013, June 16-19 (in press), 2013. 
[13] V. Partenay, P. Riederer, T. Salque, and E. Wurtz, ‚ÄúThe 
influence of the borehole short-time response on ground 
source heat pump system efficiency‚Äù, Energy and Buildings, 
vol.43,  pp. 1280-7, 2011. 
[14] P. Lute, and D. van Paassen, ‚ÄúOptimal indoor temperature 
control using a predictor‚Äù, IEEE Control Systems,  pp. 4-9, 
1995. 
[15] K.J. Astr√∂m, and B. Wittenmark, ‚ÄúComputer controlled 
systems : theory and design‚Äù, Prentice Hall, 1990. 
[16] MATLAB, ‚ÄúVersion 7.0.1, (R14SP1). Mathworks Inc., Ma., 
USA.‚Äù, Available from: http://www.mathworks.com,  
[17] Q.Y. Tang, and M.G. Feng, ‚ÄúDPS Data Processing System 
for Practical Statistics.‚Äù, Beijing: Science Press,  pp. 648, 
2002. 
[18] T. Chernichow, A. Piras, K. Imhof, P. Caire, Y. Jaccard, B. 
Dorizzi, et al., ‚ÄúShort term electric load forecasting with 
artificial neural networks.‚Äù, Engineering Intelligent Systems, 
vol.2,  pp. 85-99, 1996. 
[19] T. Salque, P. Riederer, and D. Marchio, ‚ÄúNeural predictive 
control for single-speed ground source heat pumps connected 
to a floor heating system‚Äù, Building Services Engineering 
Research and Technology, 2012. 
 
 
244
International Journal on Advances in Systems and Measurements, vol 6 no 1 & 2, year 2013, http://www.iariajournals.org/systems_and_measurements/
2013, ¬© Copyright by authors, Published under agreement with IARIA - www.iaria.org

