A Raptor-based Adaptive Erasure Code 
over Ka-band Space Channel 
 
Zhou Jie, Jiao Jian, Yang Zhi-hua, Gu Shu-shi, Zhang Qin-yu 
Communication Engineering Research Center of HITSZ 
Harbin Institute of Technology Shenzhen Graduate School 
Shen Zhen, China 
zqy@hit.edu 
 
 
Abstract—In order to efficiently resist the influence of weather 
dynamics over Ka-band link, this paper designs a practical 
Raptor based erasure code combined with a forecast model, 
which has adaptive code rate on different weather. The forecast 
model could capture the weather correlation through the 
Gilbert-Elliot model, and lower the forecast errors by employing 
CFDP (CCSDS File Delivery Protocol) asynchronous NAKs 
(Negative Acknowledgement) to feed back the channel state 
information (CSI). We provide analytical results on forecast 
error and simulation shows that the algorithm can significantly 
enhance the decoding performance, especially in the bad weather 
state, and maintain the link availability and high throughput 
over Ka-band weather dependent link. 
Keywords-Ka-band; Raptor code; forecast model; CFDP 
asynchronous NAK mode 
I. 
 INTRODUCTION 
The success of Mars Reconnaissance Orbiter (MRO) 
demonstrated the feasibility that future exploration missions 
employ the Ka-band [1-2]. Though 32GHz Ka-band signal 
increases the downlink throughput, file delivery is highly 
vulnerable to fluctuating weather states of ground station area 
and experiences severe errors which lead to frequent link 
outages [3-5]. For high reliable data return (i.e. with 99% 
weather availability), there is unexpectedly a 4.7 dB penalty at 
Ka-band compared to a 1.17 dB penalty at X-band [6]. 
To improve Ka-band link efficiency, many research focus 
on the rate adaption and long erasure correcting codes (LEC) at 
present [7-11]. The rate adaptive transmission scheme 
mitigates the adverse effect of fluctuation weather by 
dynamically adjusting the link margins, and it is also indicated 
the adaptive rate transmission scheme has significant 
advantages in the throughput and link availability compared to 
the constant rate transmission in [7], but there’s no specific 
coding scheme and the Markov model used is less accurate. On 
the other hand, the existing LEC schemes are RS, LDPC (IRA 
code, GeIRA code) and LDGM codes. RS code has limited 
optional parameters and large complexity, and the LDPC code 
needs a long code-length. These limitations are beyond the 
capacity of the probers in processing and storage. Contrast to 
LDPC code, the rateless fountain code, as one of the LDGM 
codes, is more suitable to resist the burst error. Therefore, the 
paper discusses an adaptive concatenated erasure coding 
technique with small code-length and linear encoding and 
decoding complexity, which could mitigate the error-floor by 
concatenating a pre-coding scheme. 
From the adaptive erasure code perspective, it is more 
meaningful to predict the weather state for the rate adaption. As 
a general method, Markov model could be exploited to forecast 
the weather state. However, the high forecast error in this 
model cannot meet the requirement of the reliable scientific 
data return. Hence, we propose a forecast model to degrade the 
forecast error, by employing CFDP asynchronous NAKs to 
feed back the channel state information (CSI). Based on the 
forecast model, we design a specific Raptor based erasure code 
with rate adaption to maintain link availability and high 
throughput. Raptor code, as a type of fountain code, could 
recover the whole file as the destination receives N packets a 
little more than k raw packets. Consequently the adaptive 
Raptor code could accommodate itself to the Ka-band weather 
dependent space channel.  
The rest of this paper is organized as follows: Section II 
describes a Ka-band channel forecast model and gives the 
analytical results on the forecast error. The details of Raptor 
based concatenated erasure coding scheme are presented in 
Section III. Section IV discusses parameter design and 
throughput analysis of adaptive erasure coding scheme. In 
Section V, simulation and discussion are presented. Finally, 
Section VI gives the conclusion. 
II. KA-BAND CHANNEL FORECAST MODEL 
A. Gilbert-Elliot channel 
Ka-band is highly vulnerable to weather impairments. The 
downlink data integrity is affected by packet errors badly, 
which are incurred by the system noise from the rain and 
cloudy. Therefore, it is necessary to establish a dynamics 
channel model to capture the weather correlation. 
A rain attenuation of Ka-band model is built to simulate 
link burst BERs associated with the changing weather states in 
[3-5]. In this model, a noise temperature threshold is defined as 
. If the sampled noise temperature is less than 
, define 
the weather as good state, denoting it as G, and most of the 
transmitted packets will be received successfully; the space 
downlink is available with low BERs (10-8~10-5). Otherwise, it 
is defined as bad state, representing it as B, significant error 
Tth
th
T
48
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-194-6
SPACOMM 2012 : The Fourth International Conference on Advances in Satellite and Space Communications

will occur for the high noise temperature of the receiver 
antenna. Relatively high BERs (10-4~10-3) are applied to 
capture severe packet loss rates (50%~99%), and make the link 
unusable. The dynamics of the Ka-band link are modeled as the 
Gilbert-Elliot model based on the AWGN channel, as shown in 
Fig. 1,  
  
Figure 1.  Two error state AWGN channel Gilbert-Elliot model 
Suppose we use BPSK modulation and we have 

0
2
b
BER
Q
E
N

 
0
Eb
N
is the SNR, where 
. Then, the 
relationship between noise temperature 
 and BER is: 
0
th
N
 K T

th
T




2
1
2
b
th
E
T
K
Q
BER




In GE model, the next state is only determined by the 
current state, so we define the transfer probabilities from G to 
B as P(B|G)=
G
 , and from B to G state as P(G|B)=
B
 , 
respectively. The state transfer matrix P can be written as: 





|
|
1
|
|
1
G
G



B
B
P G G
P B G
B


P G B
P B




   







P  

Using standard methods, the eigenvalues of P are found to 
be 
 and
1
 1
2
1
G
B



 


1 1
T
2
S
, 
with 
corresponding 
eigenvectors 
 and 
, where T 
denotes transpose. Consequently, we can write 
S1 


T
G
B




-1
P = SΛS 
where 
1
1
G
B




 




S
, 
1
2
0
0




 



Λ
. 
So the stationary probability of each state is: 




G
B
G
B
B
G
G
B
P
P











We define the matrix in (3) as the one-step transfer matrix, 
which can predict the next time weather state with the current 
state. And we define the matrix in (6) as the m-step transfer 
matrix, which can predict the weather state at the mth instants of 
time with the current state. 








2
2
2
2
2
1
1
1
1
m
m
m
G
B
m
m
G
B
P
P
P
P





2
m





















m
m
-1
P
SΛ S

Based on the Markov chain, if the channel at time 0 is in 
the G state, then the weather state forecast error at time m is 





2
2
2
2
1
1
m
m
m
G
B
P
P












2
1





2
2
2
1
m
m
m
G
B
P
P
, while be in B state, then 
the forecast error is 











. So 
the weather state forecast error 

eF
m  at time m associated 
with  is defined as: 
 
















2
2
2
2
2
2
1
1
1
1
m
m
m
e
G
G
B
m
m
B
F
m
P
P
P
P



















2
 m
             
2
B
G
P
P





From , we can easily see the forecast error will become 
higher when the value of m increases. So we need exploit a 
high quality forecast model to reduce the error for the data 
integrity. 
B. The forecast model based on the CFDP asynchronous 
NAK mode 
CFDP provides a store-and-forward file delivery capability 
operating across an end-to-end space link [12-13]. In the 
acknowledged transmission mode, communication reliability is 
guaranteed through negative acknowledgment (NAK) issued 
by the CFDP receiving entity. Four NAK algorithms can be 
chosen to adopt the different scenarios. Considering the 
asynchronous NAK mode, the receiver can set a timer to 
control the file checking time and then feedback the results to 
ensure reliability [14]. In this paper, we build a weather state 
forecast model combined the asynchronous NAK mode, as 
shown in Fig. 2. 
 
Figure 2.  The weather state forecast model 
In this forecast model, assume the duration of a weather 
state W is equal to round-trip time (RTT) and the duration of 
each transmission is the full resolution of the raw data, which is 
about 1.44 minute time scale, chosen to be consistent with [3].  
We define the duration of each transmission as a time 
window. Upon receipt of the first packet, the receiver will feed 
back the CSI on current weather state every other RTT until the 
file ends. It is in the state W1 that the sender will obtain the 
state W0 feed backed by the receiver after experiencing a 
49
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-194-6
SPACOMM 2012 : The Fourth International Conference on Advances in Satellite and Space Communications

transmission time. In this period W1, it needs to predict two 
steps weather parameters according to the previous state W0 
through the forecast model, as shown in following steps: 
a) one-step forecast area: the first part of data will reach 
the receiver being in this period W1 after a downlink 
transmission time (as “1” in Fig. 2), we can get the rate 
parameter for coding these data, using one-step transfer 
matrix. 
b) two-step forecast area: the second part will be sent 
during the second half of the state and then arrive the receiver 
at the next state W2 (as “2” in Fig. 2), which can be predicted 
by two-step transfer matrix for the parameter. 
As the one-step and two-step areas are the same length in 
the state W1, the forecast error Fe is expressed by 
 
0.5
1
0.5
e
e
F
F



 
2
 eF

0.05
0.05
0.05
0.05
0.1
0.1
0.1
0.1
0.1
0.15
0.15
0.15
0.15
0.15
0.2
0.2
0.2
0.2
0.2
0.25
0.25
0.25
0.25
0.25
0.3
0.3
0.3
0.3
0.3
0.35
0.35
0.35
0.35
0.35
0.35
0.4
0.4
0.4
0.4
0.4
0.45
0.45
0.45
λB
λG
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
0.05
0.05
0.05
0.1
0.1
0.1
0.1
0.15
0.15
0.15
0.15
0.2
0.2
0.2
0.2
0.2
0.25
0.25
0.25
0.25
0.25
0.3
0.3
0.3
0.3
0.3
0.35
0.35
0.35
0.35
0.35
0.4
0.4
0.4
0.4
0.4
0.45
0.45
0.45
0.45
λB
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
 
(a) One-step forecast error       (b) Two-step forecast error 
0 02
0.02
0.02
0.02
0.02
0.02
0.02
0.02
0.04
0.04
0.04
0.04
0.04
0.04
0.04
0.04
0.06
0.06
0.06
0.06
0.06
0.06
0.08
0.08
0.08
0.08
0.08
0.08
0.1
0.1
0.1
0.1
0.1
0.12
0.12
0.12
λB
λG
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
 
(c) The difference between the one-step and two-step forecast errors 
Figure 3.  Forecast error on different transition probabilities 
The Fig. 3 shows the influence of different 
B
  and 
G
  
on the one-step and two-step forecast errors. It can be seen that 
the error is close to maximum of 0.5 with both of the transfer 
probabilities tending to 0.5 gradually. If any probability is less 
than 0.05 or both exceed 0.95, the forecast error is within 10%. 
This result illustrates when one weather state is stable for a 
long time or two states switch steadily, the model has high 
forecast accuracy. 
Compared with (a) and (b) in Fig. 3, the two-step forecast 
error tends to maximum rapidly, which means two-step 
forecast error is larger than the one-step forecast error, using 
the same transfer matrix. Moreover the forecast error is larger 
when the transfer probability deviate more from 0.5. On the 
other hand, the error falls back to 0, when both of the transfer 
probabilities are close to edge (0 or 1), as shown in Fig. 3(c). 
Compared to the Markov model in Fig. 1, the forecast model 
combined with the CFDP asynchronous NAK mode in Fig. 2 
has a lower forecast error. 
III. DESIGN AND PERFORMANCE OF RAPTOR-BASED 
CONCATENATED ERASURE CODING SCHEME 
A. The design of concatenated erasure coding scheme 
Based on the proposed forecast model, we design a 
concatenated erasure coding scheme with small code length 
and linear encoding and decoding complexity, as shown in Fig. 
4. 
 
Figure 4.  Raptor based concatenated erasure code scheme 
The Raptor based concatenated erasure code parameter is 
defined as 

, ,
k n N Ω
,
, where k is the original information 
packets, n is the intermediate packets, N is fountain code 
erasure packets and Ω is degree distribution. The encoding 
process as follows: 
a) genetate n intermediate packets from the k raw packets 
using RS pre-code. 
b) generate N erausre packets from n intermediate packets 
using LT code with corresponding degree distribution. 
And the decoding process as follows: 
a) recovers n’ 
 n
 intermediate packets from the 
received erasure packets using BP algorithm. 
b) then recover corresponding raw packets from the n’ 
intermidiate packets using RS decoding algorithm. 
The BER determines the efficient values of k and n. The 
sender computes the BER related with a weather state to 
acquire code rate. 
B. The encoding and decoding performance of concatenated 
erasure code  
As mentioned above, RS code, as the pre-code of Raptor 
code, could recover the k raw packets from the n’ intermediate 
packets LT code recovers. In this section, we use weaken 
robust soliton distribution (WRSD) as the degree distribution 
with linear complexity, which can recover the majority of raw 
packets [10]. The generator function is defined as: 

 






1
2
D
i
x
ux

1
1
i
D
x
i
i
x
D
u












Ω

If Raptor code adopts the WRSD, it has been proved that 
any set 

1
2
1
n
 

  of received packets are sufficient to 
recover at least 


 



1
,
4
1
n








 intermediate 
packets via BP decoding, where the complexity is




O ln 1

. 
50
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-194-6
SPACOMM 2012 : The Fourth International Conference on Advances in Satellite and Space Communications

 
Figure 5.  Recovery capability of fountain code with WRSD 
Fig. 5 shows the relationship between code rate and 
unrecovered intermediate packet ratio as the raw packets are 
1000, 1500 and 2000, respectively. It can be seen that the ratios 
are lower than 0.05 when code rate is less than 0.9. So we can 
recover all raw packets by means of adding the RS code with 
rate less than 0.95. 
IV. PARAMETER DESIGN AND THROUGHPUT ANALYSIS OF 
ADAPTIVE ERASURE CODING SCHEME 
A. Parameter design of adaptive erausre code 
As mentioned in Section II, the BER varies with weather 
states transition, and we accommodate the BER variations by 
designing an adaptive parameter coding scheme. For the BER 
value, the forecast model in Fig. 2 can obtain it by forecasting 
the weather state when data arrive at the receiver. 
Consequently, we can achieve rate adaption as follows. 
Given a time window T, we assume the downlink data rate 
R and the code length L, then N
 T R L

 erasure packets 
will be transmitted during a time window. The relationship 
between packet loss rate and BER becomes: 

1
1

L
Ppacket
 
 BER

The scheme handles the changing packet loss rates by 
adjusting code rates of the rateless fountain code adaptively.  
GPC and BPC are defined as the G and B states parameter 
coding scheme respectively. We can receive 
G  erasure 
packets successfully and recover 
G  raw packets in G state 
with the BER 
egood  and the same as 
N
k
P
B
N , 
B
k  and 
ebad
P
 in 
B state. So the code rates of G and B state are given by: 

good
G
Coderate
k
N



bad
B
Cod

erate
k
N

The above analysis in Fig. 5 explains that if the error 
correction capacity of RS code is more than
n
, 
 erasure packets that the receiver get in certain 
BER, are sufficient to recover the entire file. When T and other 
communication conditions are fixed, the value of N is constant 
and there exist 


1
 Ppacket
 N
egood
ebad
P
 P
 and 
good
 Coder
atebad
Coderate
. 
Hence, this paper proposes an adaptive parameter coding 
scheme APC, which accommodates the code rates of Raptor 
code adaptively based on the weather state transition. Its 
statistical average code rate during a time window is obtained 
as follows: 

G
G
B
B
Coderateadaptive
 P
k
P
k
N




B. Analysis of link throughput 
The GPC can recover the entire file in G state, but recover 
little in B state. A time window throughput of the GPC is 
represented by: 


good
G
Throughput
 P

G
k
The BPC could recover all information in both states and 
then maintain the link availability. Its throughput in one time 
window is given by: 


bad
B
Throughput
k

Compared with  and , the link occur outage when 
the GPC is in B state. On the other hand, though the BPC keeps 
the link continuous, it results in a small throughput. In this 
section, the proposed APC could maintain the link availability 
and high throughput by updating the parameters according to 
the CSI. Its statistical average throughput during a time 
window can be expressed by: 


2
Throughputadaptive
PG
e
G
B
B
F
k
P
k






V. SIMULATION AND DISSCUSSION 
We choose 20K as the noise temperature threshold in [3] 
and the one-step transfer matrix is defined as: 

0.9773
0.0227
0.1667
0.8333


 



P

TABLE I.  
SIMULATION PARAMETERS 
Parameter 
Value 
Code length L 
1Kbyte 
A time window T 
1.44min 
Downlink data rate R 
20KBps 
Weather state probabilities 
PG=0.88, PB=0.12 
Erasure packets of each transmission N 
1728 
The weather state forecast error Fe 
0.0869 
BER 
G state: 10-8, 10-7, 10-6, 10-5 
B state: 10-4, 1.5×10-4 
GPC, BPC and APC code rates 
G state: 0.828,0.824, 0.820,0.752
B state: 0.3357, 0.1325 
LT code rates 
G state: 0.69,0.689,0.684,0.614 
B state: 0.2519, 0.1621 
Table I shows the simulation parameters of GPC, BPC, 
APC and adaptive LT code for comparison. The values refer to 
the typical Earth-Mars communication scenario. Code rates are 
obtained by the corresponding simulation of coding schemes 
with the Monte Carlo under the decoding failure rate 10-4. We 
execute 10000 simulations at each BER and average the result. 
51
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-194-6
SPACOMM 2012 : The Fourth International Conference on Advances in Satellite and Space Communications

ACKNOWLEDGMENT 
10
-8
10
-7
10
-6
10
-5
2
4
6
8
10
12
14
16
The good BERs
Throughput (kB/s)
 
This project has been supported by the Key Program of 
Natural Science Foundation of China (NSFC) under Grant No. 
61032003 and Natural Science Foundation for the Youth 
(NSFY) under Grant No. 61102083. 
REFERENCES 
[1] S. Shambayati, F. Bavarian, and D. Morabito. Link design and 
planning for Mars Reconnaissance Orbiter (MRO) Ka-band (32 
GHz) telecom demonstration [C]. IEEE Aerospace Conference, 
May 2005, pp. 1559-1569. 
[2] S. Shambayati. Deep space Ka-band link: design, continuity and 
completeness [C]. IEEE Aerospace Conference, March 2008, pp. 
1-14. 
[3] I. Sung and J. Gao. CFDP performance over weather-dependent 
Ka-band channel [C]. SpaceOps 2006 Conference, Rome, Italy, 
June 2006, pp. 1-21. 
[4] B. Maruddan, A. Kurniawan, S. Sugihartono, and A. Munir. 
Performance evaluation of Ka-Band satellite communication 
system in rain fading channel at tropical area [C]. International 
Conference on Electrical Engineering and Informatics, July 
2011, pp. 1-5. 
 
[5] M. Felice, C. Candilio, H. Xiong, Q. Gao, and R. Ricardo. 
Long-term rain attenuation prediction for Ka-Band link over 
Venezuela [C]. 2010 5th International Conference on Pervasive 
Computing and Applications (ICPCA), 2010, pp. 46-49. 
Figure 6.  Throughput of GPC, BPC and APC with bad BER 10-4 and 
1.5×10-4. The throughput of the LT code is also included for comparison. 
Fig. 6 shows the throughput in one time window of the 
GPC, BPC, APC and also adaptive LT code. It is indicated that 
with increased bad BER, the APC and LT coding schemes 
reduce their throughputs slightly, which illustrates that the bad 
BER is a factor of adaptive code throughput decline except the 
forecast error. Moreover, the proposed APC is superior to the 
adaptive LT code of same type with respect to throughput 
apparently. However, the throughput of GPC does not vary 
with the bad BERs since the link using GPC is equivalent to 
outage in the bad state. Similarly, the throughput of BPC is 
stable with the good BERs for 
egood
ebad
P
 P
. Both the APC 
and GPC have significantly better throughput than the BPC has. 
The APC is close to the GPC on throughput, but keeps the link 
continuous compared to the GPC. 
[6] G. 
Noreen, 
T. 
Komarek, 
and 
R. 
Diehl. 
Mars 
Telecommunications Orbiter Ka-band system design and 
operations [C]. 9th Ka-band Utilization Conference, Lacco 
Ameno, Italy, November 2003. 
[7] J.Sun, J. Gao, and S. Shambayati. Ka-band link optimization 
with rate adaptation [C]. IEEE Aerospace Conference, March 
2006, pp. 1-7. 
[8] T. Cola, H. Ernst, and M. Marchese. Application of long erasure 
codes and ARQ schemes for achieving high data transfer 
performance 
over 
long 
delay 
networks 
[J]. 
Satellite 
Communications and Navigation, May 2008, pp. 643-656 
[9] M. Luby. LT codes [C]. 43rd Annual IEEE Symposium on 
Foundations of Computer Science. Vancouver, BC, Canada, 
November 16-19, 2002. 
[10] A. Shokrollahi. Raptor codes [J]. IEEE Transactions on 
Information Theory, vol. 52, no. 6, June 2006, pp. 2551-2567. 
[11] Q. Li, L. Yin, and J. Lu. Application of LDPC codes for Deep 
Space Communication under Solar Scintillation Condition. 
ICOSSSE'11 Proceedings of the 10th WSEAS international 
conference on System science and simulation in engineering, 
2011. 
VI. CONCLUSION AND FUTURE WORK 
In this paper, for combating the adverse effects of 
frustration weather on data delivery, we design a Raptor based 
adaptive erasure coding scheme over a weather state forecast 
model, 
which 
has 
excellent 
encoding 
and 
decoding 
performance and low complexity. In the proposed scheme, 
CFDP asynchronous NAKs are employed to degrade the 
weather state forecast error. We design an adaptive parameter 
coding scheme APC on code rate, which could recover the total 
data especially in the bad weather state, enhance dramatically 
the decoding performance and keep the link available 
compared to the fixed parameter GPC. It also achieves 200% 
throughput increase compared to the reliable BPC and 
maintains high throughput. Therefore the adaptive erasure code 
is suitable for high-level reliable file delivery in exploration 
missions. 
Systematic fountain code will be designed in the future 
work, in order to improve flexibility of encoding and decoding 
schemes.  
[12] J. Jiao, Q. Guo, and Q. Zhang. Packets Interleaving CCSDS File 
Delivery Protocol in Deep Space Communication [J]. IEEE 
Aerospace Electronic System Magazine, vol.26, no.2, 2011, pp. 
5-11. 
[13] F. Flentge. Study on CFDP and DTN Architectures for ESA 
Space Missions [C]. The Third International Conference on 
Advances in Satellite and Space Communications, 2011, pp. 
75-80. 
[14] J. Jiao, Q. Zhang, and H. Li. An Optimal ARQ Timer Design of 
file delivery time in CFDP NAK Model [C]. Wicom09, Beijing, 
2009, pp. 3946-3950. 
52
Copyright (c) IARIA, 2012.     ISBN:  978-1-61208-194-6
SPACOMM 2012 : The Fourth International Conference on Advances in Satellite and Space Communications

